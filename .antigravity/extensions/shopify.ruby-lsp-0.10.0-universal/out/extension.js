"use strict";var GR=Object.create;var go=Object.defineProperty;var JR=Object.getOwnPropertyDescriptor;var XR=Object.getOwnPropertyNames;var QR=Object.getPrototypeOf,YR=Object.prototype.hasOwnProperty;var I=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ZR=(r,e)=>{for(var t in e)go(r,t,{get:e[t],enumerable:!0})},fg=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of XR(e))!YR.call(r,i)&&i!==t&&go(r,i,{get:()=>e[i],enumerable:!(n=JR(e,i))||n.enumerable});return r};var re=(r,e,t)=>(t=r!=null?GR(QR(r)):{},fg(e||!r||!r.__esModule?go(t,"default",{value:r,enumerable:!0}):t,r)),eS=r=>fg(go({},"__esModule",{value:!0}),r);var zn=I(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.asPromise=vt.thenable=vt.typedArray=vt.stringArray=vt.array=vt.func=vt.error=vt.number=vt.string=vt.boolean=void 0;function tS(r){return r===!0||r===!1}vt.boolean=tS;function hg(r){return typeof r=="string"||r instanceof String}vt.string=hg;function nS(r){return typeof r=="number"||r instanceof Number}vt.number=nS;function rS(r){return r instanceof Error}vt.error=rS;function pg(r){return typeof r=="function"}vt.func=pg;function gg(r){return Array.isArray(r)}vt.array=gg;function iS(r){return gg(r)&&r.every(e=>hg(e))}vt.stringArray=iS;function sS(r,e){return Array.isArray(r)&&r.every(e)}vt.typedArray=sS;function mg(r){return r&&pg(r.then)}vt.thenable=mg;function oS(r){return r instanceof Promise?r:mg(r)?new Promise((e,t)=>{r.then(n=>e(n),n=>t(n))}):Promise.resolve(r)}vt.asPromise=oS});var ki=I(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.stringArray=Vt.array=Vt.func=Vt.error=Vt.number=Vt.string=Vt.boolean=void 0;function aS(r){return r===!0||r===!1}Vt.boolean=aS;function vg(r){return typeof r=="string"||r instanceof String}Vt.string=vg;function cS(r){return typeof r=="number"||r instanceof Number}Vt.number=cS;function uS(r){return r instanceof Error}Vt.error=uS;function dS(r){return typeof r=="function"}Vt.func=dS;function yg(r){return Array.isArray(r)}Vt.array=yg;function lS(r){return yg(r)&&r.every(e=>vg(e))}Vt.stringArray=lS});var Du=I(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.Message=se.NotificationType9=se.NotificationType8=se.NotificationType7=se.NotificationType6=se.NotificationType5=se.NotificationType4=se.NotificationType3=se.NotificationType2=se.NotificationType1=se.NotificationType0=se.NotificationType=se.RequestType9=se.RequestType8=se.RequestType7=se.RequestType6=se.RequestType5=se.RequestType4=se.RequestType3=se.RequestType2=se.RequestType1=se.RequestType=se.RequestType0=se.AbstractMessageSignature=se.ParameterStructures=se.ResponseError=se.ErrorCodes=void 0;var ai=ki(),ru;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(ru||(se.ErrorCodes=ru={}));var iu=class r extends Error{constructor(e,t,n){super(t),this.code=ai.number(e)?e:ru.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};se.ResponseError=iu;var cn=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};se.ParameterStructures=cn;cn.auto=new cn("auto");cn.byPosition=new cn("byPosition");cn.byName=new cn("byName");var et=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return cn.auto}};se.AbstractMessageSignature=et;var su=class extends et{constructor(e){super(e,0)}};se.RequestType0=su;var ou=class extends et{constructor(e,t=cn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.RequestType=ou;var au=class extends et{constructor(e,t=cn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.RequestType1=au;var cu=class extends et{constructor(e){super(e,2)}};se.RequestType2=cu;var uu=class extends et{constructor(e){super(e,3)}};se.RequestType3=uu;var du=class extends et{constructor(e){super(e,4)}};se.RequestType4=du;var lu=class extends et{constructor(e){super(e,5)}};se.RequestType5=lu;var fu=class extends et{constructor(e){super(e,6)}};se.RequestType6=fu;var hu=class extends et{constructor(e){super(e,7)}};se.RequestType7=hu;var pu=class extends et{constructor(e){super(e,8)}};se.RequestType8=pu;var gu=class extends et{constructor(e){super(e,9)}};se.RequestType9=gu;var mu=class extends et{constructor(e,t=cn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.NotificationType=mu;var vu=class extends et{constructor(e){super(e,0)}};se.NotificationType0=vu;var yu=class extends et{constructor(e,t=cn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.NotificationType1=yu;var bu=class extends et{constructor(e){super(e,2)}};se.NotificationType2=bu;var wu=class extends et{constructor(e){super(e,3)}};se.NotificationType3=wu;var Cu=class extends et{constructor(e){super(e,4)}};se.NotificationType4=Cu;var Ru=class extends et{constructor(e){super(e,5)}};se.NotificationType5=Ru;var Su=class extends et{constructor(e){super(e,6)}};se.NotificationType6=Su;var _u=class extends et{constructor(e){super(e,7)}};se.NotificationType7=_u;var Tu=class extends et{constructor(e){super(e,8)}};se.NotificationType8=Tu;var Pu=class extends et{constructor(e){super(e,9)}};se.NotificationType9=Pu;var bg;(function(r){function e(i){let s=i;return s&&ai.string(s.method)&&(ai.string(s.id)||ai.number(s.id))}r.isRequest=e;function t(i){let s=i;return s&&ai.string(s.method)&&i.id===void 0}r.isNotification=t;function n(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(ai.string(s.id)||ai.number(s.id)||s.id===null)}r.isResponse=n})(bg||(se.Message=bg={}))});var Eu=I(Ar=>{"use strict";var wg;Object.defineProperty(Ar,"__esModule",{value:!0});Ar.LRUCache=Ar.LinkedMap=Ar.Touch=void 0;var zt;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})(zt||(Ar.Touch=zt={}));var mo=class{constructor(){this[wg]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=zt.None){let n=this._map.get(e);if(n)return t!==zt.None&&this.touch(n,t),n.value}set(e,t,n=zt.None){let i=this._map.get(e);if(i)i.value=t,n!==zt.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case zt.None:this.addItemLast(i);break;case zt.First:this.addItemFirst(i);break;case zt.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}[(wg=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==zt.First&&t!==zt.Last)){if(t===zt.First){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===zt.Last){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};Ar.LinkedMap=mo;var ku=class extends mo{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=zt.AsNew){return super.get(e,t)}peek(e){return super.get(e,zt.None)}set(e,t){return super.set(e,t,zt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};Ar.LRUCache=ku});var Rg=I(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.Disposable=void 0;var Cg;(function(r){function e(t){return{dispose:t}}r.create=e})(Cg||(vo.Disposable=Cg={}))});var jr=I(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0});var xu;function Iu(){if(xu===void 0)throw new Error("No runtime abstraction layer installed");return xu}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");xu=t}r.install=e})(Iu||(Iu={}));qu.default=Iu});var xi=I(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.Emitter=Ei.Event=void 0;var fS=jr(),Sg;(function(r){let e={dispose(){}};r.None=function(){return e}})(Sg||(Ei.Event=Sg={}));var Ou=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(i[s],e))}catch(a){(0,fS.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},yo=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new Ou),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};Ei.Emitter=yo;yo._noop=function(){}});var Co=I(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.CancellationTokenSource=Ii.CancellationToken=void 0;var hS=jr(),pS=ki(),Fu=xi(),bo;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Fu.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Fu.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||pS.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(bo||(Ii.CancellationToken=bo={}));var gS=Object.freeze(function(r,e){let t=(0,hS.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),wo=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?gS:(this._emitter||(this._emitter=new Fu.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Lu=class{get token(){return this._token||(this._token=new wo),this._token}cancel(){this._token?this._token.cancel():this._token=bo.Cancelled}dispose(){this._token?this._token instanceof wo&&this._token.dispose():this._token=bo.None}};Ii.CancellationTokenSource=Lu});var _g=I(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.SharedArrayReceiverStrategy=qi.SharedArraySenderStrategy=void 0;var mS=Co(),bs;(function(r){r.Continue=0,r.Cancelled=1})(bs||(bs={}));var Mu=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=bs.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let i=new Int32Array(n,0,1);Atomics.store(i,0,bs.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};qi.SharedArraySenderStrategy=Mu;var Nu=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===bs.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},Au=class{constructor(e){this.token=new Nu(e)}cancel(){}dispose(){}},ju=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new mS.CancellationTokenSource:new Au(t)}};qi.SharedArrayReceiverStrategy=ju});var Uu=I(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.Semaphore=void 0;var vS=jr(),$u=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,vS.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Ro.Semaphore=$u});var Pg=I($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.ReadableStreamMessageReader=$r.AbstractMessageReader=$r.MessageReader=void 0;var Hu=jr(),Oi=ki(),Wu=xi(),yS=Uu(),Tg;(function(r){function e(t){let n=t;return n&&Oi.func(n.listen)&&Oi.func(n.dispose)&&Oi.func(n.onError)&&Oi.func(n.onClose)&&Oi.func(n.onPartialMessage)}r.is=e})(Tg||($r.MessageReader=Tg={}));var So=class{constructor(){this.errorEmitter=new Wu.Emitter,this.closeEmitter=new Wu.Emitter,this.partialMessageEmitter=new Wu.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${Oi.string(e.message)?e.message:"unknown"}`)}};$r.AbstractMessageReader=So;var Vu;(function(r){function e(t){let n,i,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let d of t.contentDecoders)o.set(d.name,d);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let d of t.contentTypeDecoders)c.set(d.name,d)}return a===void 0&&(a=(0,Hu.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}r.fromOptions=e})(Vu||(Vu={}));var zu=class extends So{constructor(e,t){super(),this.readable=e,this.options=Vu.fromOptions(t),this.buffer=(0,Hu.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new yS.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let i=n.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(i)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,Hu.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};$r.ReadableStreamMessageReader=zu});var Ig=I(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.WriteableStreamMessageWriter=Ur.AbstractMessageWriter=Ur.MessageWriter=void 0;var Dg=jr(),ws=ki(),bS=Uu(),kg=xi(),wS="Content-Length: ",Eg=`\r
`,xg;(function(r){function e(t){let n=t;return n&&ws.func(n.dispose)&&ws.func(n.onClose)&&ws.func(n.onError)&&ws.func(n.write)}r.is=e})(xg||(Ur.MessageWriter=xg={}));var _o=class{constructor(){this.errorEmitter=new kg.Emitter,this.closeEmitter=new kg.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${ws.string(e.message)?e.message:"unknown"}`)}};Ur.AbstractMessageWriter=_o;var Ku;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,Dg.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,Dg.default)().applicationJson.encoder}}r.fromOptions=e})(Ku||(Ku={}));var Bu=class extends _o{constructor(e,t){super(),this.writable=e,this.options=Ku.fromOptions(t),this.errorCount=0,this.writeSemaphore=new bS.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let i=[];return i.push(wS,n.byteLength.toString(),Eg),i.push(Eg),this.doWrite(e,i,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};Ur.WriteableStreamMessageWriter=Bu});var qg=I(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.AbstractMessageBuffer=void 0;var CS=13,RS=10,SS=`\r
`,Gu=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){let d=this._chunks[n];for(i=0;i<d.length;){switch(d[i]){case CS:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case RS:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=d.byteLength,n++}if(t!==4)return;let o=this._read(s+i),a=new Map,c=this.toString(o,"ascii").split(SS);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){let g=c[d],v=g.indexOf(":");if(v===-1)throw new Error(`Message header must separate key and value using ':'
${g}`);let m=g.substr(0,v),S=g.substr(v+1).trim();a.set(e?m.toLowerCase():m,S)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};To.AbstractMessageBuffer=Gu});var Ng=I(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.createMessageConnection=ye.ConnectionOptions=ye.MessageStrategy=ye.CancellationStrategy=ye.CancellationSenderStrategy=ye.CancellationReceiverStrategy=ye.RequestCancellationReceiverStrategy=ye.IdCancellationReceiverStrategy=ye.ConnectionStrategy=ye.ConnectionError=ye.ConnectionErrors=ye.LogTraceNotification=ye.SetTraceNotification=ye.TraceFormat=ye.TraceValues=ye.Trace=ye.NullLogger=ye.ProgressType=ye.ProgressToken=void 0;var Og=jr(),dt=ki(),de=Du(),Fg=Eu(),Cs=xi(),Ju=Co(),_s;(function(r){r.type=new de.NotificationType("$/cancelRequest")})(_s||(_s={}));var Xu;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(Xu||(ye.ProgressToken=Xu={}));var Rs;(function(r){r.type=new de.NotificationType("$/progress")})(Rs||(Rs={}));var Qu=class{constructor(){}};ye.ProgressType=Qu;var Yu;(function(r){function e(t){return dt.func(t)}r.is=e})(Yu||(Yu={}));ye.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Le;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(Le||(ye.Trace=Le={}));var Lg;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(Lg||(ye.TraceValues=Lg={}));(function(r){function e(n){if(!dt.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(Le||(ye.Trace=Le={}));var kn;(function(r){r.Text="text",r.JSON="json"})(kn||(ye.TraceFormat=kn={}));(function(r){function e(t){return dt.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(kn||(ye.TraceFormat=kn={}));var Zu;(function(r){r.type=new de.NotificationType("$/setTrace")})(Zu||(ye.SetTraceNotification=Zu={}));var Po;(function(r){r.type=new de.NotificationType("$/logTrace")})(Po||(ye.LogTraceNotification=Po={}));var Ss;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(Ss||(ye.ConnectionErrors=Ss={}));var Fi=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};ye.ConnectionError=Fi;var ed;(function(r){function e(t){let n=t;return n&&dt.func(n.cancelUndispatched)}r.is=e})(ed||(ye.ConnectionStrategy=ed={}));var Do;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&dt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||dt.func(n.dispose))}r.is=e})(Do||(ye.IdCancellationReceiverStrategy=Do={}));var td;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&dt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||dt.func(n.dispose))}r.is=e})(td||(ye.RequestCancellationReceiverStrategy=td={}));var ko;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new Ju.CancellationTokenSource}});function e(t){return Do.is(t)||td.is(t)}r.is=e})(ko||(ye.CancellationReceiverStrategy=ko={}));var Eo;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(_s.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&dt.func(n.sendCancellation)&&dt.func(n.cleanup)}r.is=e})(Eo||(ye.CancellationSenderStrategy=Eo={}));var xo;(function(r){r.Message=Object.freeze({receiver:ko.Message,sender:Eo.Message});function e(t){let n=t;return n&&ko.is(n.receiver)&&Eo.is(n.sender)}r.is=e})(xo||(ye.CancellationStrategy=xo={}));var Io;(function(r){function e(t){let n=t;return n&&dt.func(n.handleMessage)}r.is=e})(Io||(ye.MessageStrategy=Io={}));var Mg;(function(r){function e(t){let n=t;return n&&(xo.is(n.cancellationStrategy)||ed.is(n.connectionStrategy)||Io.is(n.messageStrategy))}r.is=e})(Mg||(ye.ConnectionOptions=Mg={}));var rr;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(rr||(rr={}));function _S(r,e,t,n){let i=t!==void 0?t:ye.NullLogger,s=0,o=0,a=0,c="2.0",d,g=new Map,v,m=new Map,S=new Map,b,E=new Fg.LinkedMap,x=new Map,$=new Set,U=new Map,M=Le.Off,z=kn.Text,B,pe=rr.New,J=new Cs.Emitter,ce=new Cs.Emitter,Re=new Cs.Emitter,it=new Cs.Emitter,Ze=new Cs.Emitter,$e=n&&n.cancellationStrategy?n.cancellationStrategy:xo.Message;function Zt(l){if(l===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+l.toString()}function At(l){return l===null?"res-unknown-"+(++a).toString():"res-"+l.toString()}function kt(){return"not-"+(++o).toString()}function Et(l,C){de.Message.isRequest(C)?l.set(Zt(C.id),C):de.Message.isResponse(C)?l.set(At(C.id),C):l.set(kt(),C)}function bn(l){}function wn(){return pe===rr.Listening}function Ue(){return pe===rr.Closed}function Ct(){return pe===rr.Disposed}function Ot(){(pe===rr.New||pe===rr.Listening)&&(pe=rr.Closed,ce.fire(void 0))}function xt(l){J.fire([l,void 0,void 0])}function lr(l){J.fire(l)}r.onClose(Ot),r.onError(xt),e.onClose(Ot),e.onError(lr);function Cn(){b||E.size===0||(b=(0,Og.default)().timer.setImmediate(()=>{b=void 0,er()}))}function Rn(l){de.Message.isRequest(l)?$n(l):de.Message.isNotification(l)?_n(l):de.Message.isResponse(l)?Sn(l):Un(l)}function er(){if(E.size===0)return;let l=E.shift();try{let C=n?.messageStrategy;Io.is(C)?C.handleMessage(l,Rn):Rn(l)}finally{Cn()}}let fr=l=>{try{if(de.Message.isNotification(l)&&l.method===_s.type.method){let C=l.params.id,D=Zt(C),O=E.get(D);if(de.Message.isRequest(O)){let ee=n?.connectionStrategy,ae=ee&&ee.cancelUndispatched?ee.cancelUndispatched(O,bn):void 0;if(ae&&(ae.error!==void 0||ae.result!==void 0)){E.delete(D),U.delete(C),ae.id=O.id,jt(ae,l.method,Date.now()),e.write(ae).catch(()=>i.error("Sending response for canceled message failed."));return}}let ne=U.get(C);if(ne!==void 0){ne.cancel(),Ht(l);return}else $.add(C)}Et(E,l)}finally{Cn()}};function $n(l){if(Ct())return;function C(G,ie,Z){let he={jsonrpc:c,id:l.id};G instanceof de.ResponseError?he.error=G.toJson():he.result=G===void 0?null:G,jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function D(G,ie,Z){let he={jsonrpc:c,id:l.id,error:G.toJson()};jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function O(G,ie,Z){G===void 0&&(G=null);let he={jsonrpc:c,id:l.id,result:G};jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}hr(l);let ne=g.get(l.method),ee,ae;ne&&(ee=ne.type,ae=ne.handler);let ue=Date.now();if(ae||d){let G=l.id??String(Date.now()),ie=Do.is($e.receiver)?$e.receiver.createCancellationTokenSource(G):$e.receiver.createCancellationTokenSource(l);l.id!==null&&$.has(l.id)&&ie.cancel(),l.id!==null&&U.set(G,ie);try{let Z;if(ae)if(l.params===void 0){if(ee!==void 0&&ee.numberOfParams!==0){D(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines ${ee.numberOfParams} params but received none.`),l.method,ue);return}Z=ae(ie.token)}else if(Array.isArray(l.params)){if(ee!==void 0&&ee.parameterStructures===de.ParameterStructures.byName){D(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by name but received parameters by position`),l.method,ue);return}Z=ae(...l.params,ie.token)}else{if(ee!==void 0&&ee.parameterStructures===de.ParameterStructures.byPosition){D(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by position but received parameters by name`),l.method,ue);return}Z=ae(l.params,ie.token)}else d&&(Z=d(l.method,l.params,ie.token));let he=Z;Z?he.then?he.then(_e=>{U.delete(G),C(_e,l.method,ue)},_e=>{U.delete(G),_e instanceof de.ResponseError?D(_e,l.method,ue):_e&&dt.string(_e.message)?D(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${_e.message}`),l.method,ue):D(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ue)}):(U.delete(G),C(Z,l.method,ue)):(U.delete(G),O(Z,l.method,ue))}catch(Z){U.delete(G),Z instanceof de.ResponseError?C(Z,l.method,ue):Z&&dt.string(Z.message)?D(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${Z.message}`),l.method,ue):D(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ue)}}else D(new de.ResponseError(de.ErrorCodes.MethodNotFound,`Unhandled method ${l.method}`),l.method,ue)}function Sn(l){if(!Ct())if(l.id===null)l.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(l.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let C=l.id,D=x.get(C);if(Wn(l,D),D!==void 0){x.delete(C);try{if(l.error){let O=l.error;D.reject(new de.ResponseError(O.code,O.message,O.data))}else if(l.result!==void 0)D.resolve(l.result);else throw new Error("Should never happen.")}catch(O){O.message?i.error(`Response handler '${D.method}' failed with message: ${O.message}`):i.error(`Response handler '${D.method}' failed unexpectedly.`)}}}}function _n(l){if(Ct())return;let C,D;if(l.method===_s.type.method){let O=l.params.id;$.delete(O),Ht(l);return}else{let O=m.get(l.method);O&&(D=O.handler,C=O.type)}if(D||v)try{if(Ht(l),D)if(l.params===void 0)C!==void 0&&C.numberOfParams!==0&&C.parameterStructures!==de.ParameterStructures.byName&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received none.`),D();else if(Array.isArray(l.params)){let O=l.params;l.method===Rs.type.method&&O.length===2&&Xu.is(O[0])?D({token:O[0],value:O[1]}):(C!==void 0&&(C.parameterStructures===de.ParameterStructures.byName&&i.error(`Notification ${l.method} defines parameters by name but received parameters by position`),C.numberOfParams!==l.params.length&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received ${O.length} arguments`)),D(...O))}else C!==void 0&&C.parameterStructures===de.ParameterStructures.byPosition&&i.error(`Notification ${l.method} defines parameters by position but received parameters by name`),D(l.params);else v&&v(l.method,l.params)}catch(O){O.message?i.error(`Notification handler '${l.method}' failed with message: ${O.message}`):i.error(`Notification handler '${l.method}' failed unexpectedly.`)}else Re.fire(l)}function Un(l){if(!l){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(l,null,4)}`);let C=l;if(dt.string(C.id)||dt.number(C.id)){let D=C.id,O=x.get(D);O&&O.reject(new Error("The received response has neither a result nor an error property."))}}function We(l){if(l!=null)switch(M){case Le.Verbose:return JSON.stringify(l,null,4);case Le.Compact:return JSON.stringify(l);default:return}}function tr(l){if(!(M===Le.Off||!B))if(z===kn.Text){let C;(M===Le.Verbose||M===Le.Compact)&&l.params&&(C=`Params: ${We(l.params)}

`),B.log(`Sending request '${l.method} - (${l.id})'.`,C)}else Ke("send-request",l)}function Tn(l){if(!(M===Le.Off||!B))if(z===kn.Text){let C;(M===Le.Verbose||M===Le.Compact)&&(l.params?C=`Params: ${We(l.params)}

`:C=`No parameters provided.

`),B.log(`Sending notification '${l.method}'.`,C)}else Ke("send-notification",l)}function jt(l,C,D){if(!(M===Le.Off||!B))if(z===kn.Text){let O;(M===Le.Verbose||M===Le.Compact)&&(l.error&&l.error.data?O=`Error data: ${We(l.error.data)}

`:l.result?O=`Result: ${We(l.result)}

`:l.error===void 0&&(O=`No result returned.

`)),B.log(`Sending response '${C} - (${l.id})'. Processing request took ${Date.now()-D}ms`,O)}else Ke("send-response",l)}function hr(l){if(!(M===Le.Off||!B))if(z===kn.Text){let C;(M===Le.Verbose||M===Le.Compact)&&l.params&&(C=`Params: ${We(l.params)}

`),B.log(`Received request '${l.method} - (${l.id})'.`,C)}else Ke("receive-request",l)}function Ht(l){if(!(M===Le.Off||!B||l.method===Po.type.method))if(z===kn.Text){let C;(M===Le.Verbose||M===Le.Compact)&&(l.params?C=`Params: ${We(l.params)}

`:C=`No parameters provided.

`),B.log(`Received notification '${l.method}'.`,C)}else Ke("receive-notification",l)}function Wn(l,C){if(!(M===Le.Off||!B))if(z===kn.Text){let D;if((M===Le.Verbose||M===Le.Compact)&&(l.error&&l.error.data?D=`Error data: ${We(l.error.data)}

`:l.result?D=`Result: ${We(l.result)}

`:l.error===void 0&&(D=`No result returned.

`)),C){let O=l.error?` Request failed: ${l.error.message} (${l.error.code}).`:"";B.log(`Received response '${C.method} - (${l.id})' in ${Date.now()-C.timerStart}ms.${O}`,D)}else B.log(`Received response ${l.id} without active response promise.`,D)}else Ke("receive-response",l)}function Ke(l,C){if(!B||M===Le.Off)return;let D={isLSPMessage:!0,type:l,message:C,timestamp:Date.now()};B.log(D)}function gt(){if(Ue())throw new Fi(Ss.Closed,"Connection is closed.");if(Ct())throw new Fi(Ss.Disposed,"Connection is disposed.")}function It(){if(wn())throw new Fi(Ss.AlreadyListening,"Connection is already listening")}function en(){if(!wn())throw new Error("Call listen() first.")}function Rt(l){return l===void 0?null:l}function Pn(l){if(l!==null)return l}function Hn(l){return l!=null&&!Array.isArray(l)&&typeof l=="object"}function tn(l,C){switch(l){case de.ParameterStructures.auto:return Hn(C)?Pn(C):[Rt(C)];case de.ParameterStructures.byName:if(!Hn(C))throw new Error("Received parameters by name but param is not an object literal.");return Pn(C);case de.ParameterStructures.byPosition:return[Rt(C)];default:throw new Error(`Unknown parameter structure ${l.toString()}`)}}function Vn(l,C){let D,O=l.numberOfParams;switch(O){case 0:D=void 0;break;case 1:D=tn(l.parameterStructures,C[0]);break;default:D=[];for(let ne=0;ne<C.length&&ne<O;ne++)D.push(Rt(C[ne]));if(C.length<O)for(let ne=C.length;ne<O;ne++)D.push(null);break}return D}let mt={sendNotification:(l,...C)=>{gt();let D,O;if(dt.string(l)){D=l;let ee=C[0],ae=0,ue=de.ParameterStructures.auto;de.ParameterStructures.is(ee)&&(ae=1,ue=ee);let G=C.length,ie=G-ae;switch(ie){case 0:O=void 0;break;case 1:O=tn(ue,C[ae]);break;default:if(ue===de.ParameterStructures.byName)throw new Error(`Received ${ie} parameters for 'by Name' notification parameter structure.`);O=C.slice(ae,G).map(Z=>Rt(Z));break}}else{let ee=C;D=l.method,O=Vn(l,ee)}let ne={jsonrpc:c,method:D,params:O};return Tn(ne),e.write(ne).catch(ee=>{throw i.error("Sending notification failed."),ee})},onNotification:(l,C)=>{gt();let D;return dt.func(l)?v=l:C&&(dt.string(l)?(D=l,m.set(l,{type:void 0,handler:C})):(D=l.method,m.set(l.method,{type:l,handler:C}))),{dispose:()=>{D!==void 0?m.delete(D):v=void 0}}},onProgress:(l,C,D)=>{if(S.has(C))throw new Error(`Progress handler for token ${C} already registered`);return S.set(C,D),{dispose:()=>{S.delete(C)}}},sendProgress:(l,C,D)=>mt.sendNotification(Rs.type,{token:C,value:D}),onUnhandledProgress:it.event,sendRequest:(l,...C)=>{gt(),en();let D,O,ne;if(dt.string(l)){D=l;let G=C[0],ie=C[C.length-1],Z=0,he=de.ParameterStructures.auto;de.ParameterStructures.is(G)&&(Z=1,he=G);let _e=C.length;Ju.CancellationToken.is(ie)&&(_e=_e-1,ne=ie);let He=_e-Z;switch(He){case 0:O=void 0;break;case 1:O=tn(he,C[Z]);break;default:if(he===de.ParameterStructures.byName)throw new Error(`Received ${He} parameters for 'by Name' request parameter structure.`);O=C.slice(Z,_e).map(pr=>Rt(pr));break}}else{let G=C;D=l.method,O=Vn(l,G);let ie=l.numberOfParams;ne=Ju.CancellationToken.is(G[ie])?G[ie]:void 0}let ee=s++,ae;ne&&(ae=ne.onCancellationRequested(()=>{let G=$e.sender.sendCancellation(mt,ee);return G===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${ee}`),Promise.resolve()):G.catch(()=>{i.log(`Sending cancellation messages for id ${ee} failed`)})}));let ue={jsonrpc:c,id:ee,method:D,params:O};return tr(ue),typeof $e.sender.enableCancellation=="function"&&$e.sender.enableCancellation(ue),new Promise(async(G,ie)=>{let Z=He=>{G(He),$e.sender.cleanup(ee),ae?.dispose()},he=He=>{ie(He),$e.sender.cleanup(ee),ae?.dispose()},_e={method:D,timerStart:Date.now(),resolve:Z,reject:he};try{await e.write(ue),x.set(ee,_e)}catch(He){throw i.error("Sending request failed."),_e.reject(new de.ResponseError(de.ErrorCodes.MessageWriteError,He.message?He.message:"Unknown reason")),He}})},onRequest:(l,C)=>{gt();let D=null;return Yu.is(l)?(D=void 0,d=l):dt.string(l)?(D=null,C!==void 0&&(D=l,g.set(l,{handler:C,type:void 0}))):C!==void 0&&(D=l.method,g.set(l.method,{type:l,handler:C})),{dispose:()=>{D!==null&&(D!==void 0?g.delete(D):d=void 0)}}},hasPendingResponse:()=>x.size>0,trace:async(l,C,D)=>{let O=!1,ne=kn.Text;D!==void 0&&(dt.boolean(D)?O=D:(O=D.sendNotification||!1,ne=D.traceFormat||kn.Text)),M=l,z=ne,M===Le.Off?B=void 0:B=C,O&&!Ue()&&!Ct()&&await mt.sendNotification(Zu.type,{value:Le.toString(l)})},onError:J.event,onClose:ce.event,onUnhandledNotification:Re.event,onDispose:Ze.event,end:()=>{e.end()},dispose:()=>{if(Ct())return;pe=rr.Disposed,Ze.fire(void 0);let l=new de.ResponseError(de.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let C of x.values())C.reject(l);x=new Map,U=new Map,$=new Set,E=new Fg.LinkedMap,dt.func(e.dispose)&&e.dispose(),dt.func(r.dispose)&&r.dispose()},listen:()=>{gt(),It(),pe=rr.Listening,r.listen(fr)},inspect:()=>{(0,Og.default)().console.log("inspect")}};return mt.onNotification(Po.type,l=>{if(M===Le.Off||!B)return;let C=M===Le.Verbose||M===Le.Compact;B.log(l.message,C?l.verbose:void 0)}),mt.onNotification(Rs.type,l=>{let C=S.get(l.token);C?C(l.value):it.fire(l)}),mt}ye.createMessageConnection=_S});var qo=I(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.ProgressType=F.ProgressToken=F.createMessageConnection=F.NullLogger=F.ConnectionOptions=F.ConnectionStrategy=F.AbstractMessageBuffer=F.WriteableStreamMessageWriter=F.AbstractMessageWriter=F.MessageWriter=F.ReadableStreamMessageReader=F.AbstractMessageReader=F.MessageReader=F.SharedArrayReceiverStrategy=F.SharedArraySenderStrategy=F.CancellationToken=F.CancellationTokenSource=F.Emitter=F.Event=F.Disposable=F.LRUCache=F.Touch=F.LinkedMap=F.ParameterStructures=F.NotificationType9=F.NotificationType8=F.NotificationType7=F.NotificationType6=F.NotificationType5=F.NotificationType4=F.NotificationType3=F.NotificationType2=F.NotificationType1=F.NotificationType0=F.NotificationType=F.ErrorCodes=F.ResponseError=F.RequestType9=F.RequestType8=F.RequestType7=F.RequestType6=F.RequestType5=F.RequestType4=F.RequestType3=F.RequestType2=F.RequestType1=F.RequestType0=F.RequestType=F.Message=F.RAL=void 0;F.MessageStrategy=F.CancellationStrategy=F.CancellationSenderStrategy=F.CancellationReceiverStrategy=F.ConnectionError=F.ConnectionErrors=F.LogTraceNotification=F.SetTraceNotification=F.TraceFormat=F.TraceValues=F.Trace=void 0;var Xe=Du();Object.defineProperty(F,"Message",{enumerable:!0,get:function(){return Xe.Message}});Object.defineProperty(F,"RequestType",{enumerable:!0,get:function(){return Xe.RequestType}});Object.defineProperty(F,"RequestType0",{enumerable:!0,get:function(){return Xe.RequestType0}});Object.defineProperty(F,"RequestType1",{enumerable:!0,get:function(){return Xe.RequestType1}});Object.defineProperty(F,"RequestType2",{enumerable:!0,get:function(){return Xe.RequestType2}});Object.defineProperty(F,"RequestType3",{enumerable:!0,get:function(){return Xe.RequestType3}});Object.defineProperty(F,"RequestType4",{enumerable:!0,get:function(){return Xe.RequestType4}});Object.defineProperty(F,"RequestType5",{enumerable:!0,get:function(){return Xe.RequestType5}});Object.defineProperty(F,"RequestType6",{enumerable:!0,get:function(){return Xe.RequestType6}});Object.defineProperty(F,"RequestType7",{enumerable:!0,get:function(){return Xe.RequestType7}});Object.defineProperty(F,"RequestType8",{enumerable:!0,get:function(){return Xe.RequestType8}});Object.defineProperty(F,"RequestType9",{enumerable:!0,get:function(){return Xe.RequestType9}});Object.defineProperty(F,"ResponseError",{enumerable:!0,get:function(){return Xe.ResponseError}});Object.defineProperty(F,"ErrorCodes",{enumerable:!0,get:function(){return Xe.ErrorCodes}});Object.defineProperty(F,"NotificationType",{enumerable:!0,get:function(){return Xe.NotificationType}});Object.defineProperty(F,"NotificationType0",{enumerable:!0,get:function(){return Xe.NotificationType0}});Object.defineProperty(F,"NotificationType1",{enumerable:!0,get:function(){return Xe.NotificationType1}});Object.defineProperty(F,"NotificationType2",{enumerable:!0,get:function(){return Xe.NotificationType2}});Object.defineProperty(F,"NotificationType3",{enumerable:!0,get:function(){return Xe.NotificationType3}});Object.defineProperty(F,"NotificationType4",{enumerable:!0,get:function(){return Xe.NotificationType4}});Object.defineProperty(F,"NotificationType5",{enumerable:!0,get:function(){return Xe.NotificationType5}});Object.defineProperty(F,"NotificationType6",{enumerable:!0,get:function(){return Xe.NotificationType6}});Object.defineProperty(F,"NotificationType7",{enumerable:!0,get:function(){return Xe.NotificationType7}});Object.defineProperty(F,"NotificationType8",{enumerable:!0,get:function(){return Xe.NotificationType8}});Object.defineProperty(F,"NotificationType9",{enumerable:!0,get:function(){return Xe.NotificationType9}});Object.defineProperty(F,"ParameterStructures",{enumerable:!0,get:function(){return Xe.ParameterStructures}});var nd=Eu();Object.defineProperty(F,"LinkedMap",{enumerable:!0,get:function(){return nd.LinkedMap}});Object.defineProperty(F,"LRUCache",{enumerable:!0,get:function(){return nd.LRUCache}});Object.defineProperty(F,"Touch",{enumerable:!0,get:function(){return nd.Touch}});var TS=Rg();Object.defineProperty(F,"Disposable",{enumerable:!0,get:function(){return TS.Disposable}});var Ag=xi();Object.defineProperty(F,"Event",{enumerable:!0,get:function(){return Ag.Event}});Object.defineProperty(F,"Emitter",{enumerable:!0,get:function(){return Ag.Emitter}});var jg=Co();Object.defineProperty(F,"CancellationTokenSource",{enumerable:!0,get:function(){return jg.CancellationTokenSource}});Object.defineProperty(F,"CancellationToken",{enumerable:!0,get:function(){return jg.CancellationToken}});var $g=_g();Object.defineProperty(F,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return $g.SharedArraySenderStrategy}});Object.defineProperty(F,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return $g.SharedArrayReceiverStrategy}});var rd=Pg();Object.defineProperty(F,"MessageReader",{enumerable:!0,get:function(){return rd.MessageReader}});Object.defineProperty(F,"AbstractMessageReader",{enumerable:!0,get:function(){return rd.AbstractMessageReader}});Object.defineProperty(F,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return rd.ReadableStreamMessageReader}});var id=Ig();Object.defineProperty(F,"MessageWriter",{enumerable:!0,get:function(){return id.MessageWriter}});Object.defineProperty(F,"AbstractMessageWriter",{enumerable:!0,get:function(){return id.AbstractMessageWriter}});Object.defineProperty(F,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return id.WriteableStreamMessageWriter}});var PS=qg();Object.defineProperty(F,"AbstractMessageBuffer",{enumerable:!0,get:function(){return PS.AbstractMessageBuffer}});var Ut=Ng();Object.defineProperty(F,"ConnectionStrategy",{enumerable:!0,get:function(){return Ut.ConnectionStrategy}});Object.defineProperty(F,"ConnectionOptions",{enumerable:!0,get:function(){return Ut.ConnectionOptions}});Object.defineProperty(F,"NullLogger",{enumerable:!0,get:function(){return Ut.NullLogger}});Object.defineProperty(F,"createMessageConnection",{enumerable:!0,get:function(){return Ut.createMessageConnection}});Object.defineProperty(F,"ProgressToken",{enumerable:!0,get:function(){return Ut.ProgressToken}});Object.defineProperty(F,"ProgressType",{enumerable:!0,get:function(){return Ut.ProgressType}});Object.defineProperty(F,"Trace",{enumerable:!0,get:function(){return Ut.Trace}});Object.defineProperty(F,"TraceValues",{enumerable:!0,get:function(){return Ut.TraceValues}});Object.defineProperty(F,"TraceFormat",{enumerable:!0,get:function(){return Ut.TraceFormat}});Object.defineProperty(F,"SetTraceNotification",{enumerable:!0,get:function(){return Ut.SetTraceNotification}});Object.defineProperty(F,"LogTraceNotification",{enumerable:!0,get:function(){return Ut.LogTraceNotification}});Object.defineProperty(F,"ConnectionErrors",{enumerable:!0,get:function(){return Ut.ConnectionErrors}});Object.defineProperty(F,"ConnectionError",{enumerable:!0,get:function(){return Ut.ConnectionError}});Object.defineProperty(F,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return Ut.CancellationReceiverStrategy}});Object.defineProperty(F,"CancellationSenderStrategy",{enumerable:!0,get:function(){return Ut.CancellationSenderStrategy}});Object.defineProperty(F,"CancellationStrategy",{enumerable:!0,get:function(){return Ut.CancellationStrategy}});Object.defineProperty(F,"MessageStrategy",{enumerable:!0,get:function(){return Ut.MessageStrategy}});var DS=jr();F.RAL=DS.default});var Hg=I(cd=>{"use strict";Object.defineProperty(cd,"__esModule",{value:!0});var Ug=require("util"),Pr=qo(),Oo=class r extends Pr.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new Ug.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Oo.emptyBuffer=Buffer.allocUnsafe(0);var sd=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Pr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Pr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Pr.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),Pr.Disposable.create(()=>this.stream.off("data",e))}},od=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Pr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Pr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Pr.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,i)=>{let s=o=>{o==null?n():i(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},Wg=Object.freeze({messageBuffer:Object.freeze({create:r=>new Oo(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new Ug.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new sd(r),asWritableStream:r=>new od(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function ad(){return Wg}(function(r){function e(){Pr.RAL.install(Wg)}r.install=e})(ad||(ad={}));cd.default=ad});var di=I(Ee=>{"use strict";var kS=Ee&&Ee.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),ES=Ee&&Ee.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&kS(e,r,t)};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.createMessageConnection=Ee.createServerSocketTransport=Ee.createClientSocketTransport=Ee.createServerPipeTransport=Ee.createClientPipeTransport=Ee.generateRandomPipeName=Ee.StreamMessageWriter=Ee.StreamMessageReader=Ee.SocketMessageWriter=Ee.SocketMessageReader=Ee.PortMessageWriter=Ee.PortMessageReader=Ee.IPCMessageWriter=Ee.IPCMessageReader=void 0;var Li=Hg();Li.default.install();var Vg=require("path"),xS=require("os"),IS=require("crypto"),Mo=require("net"),En=qo();ES(qo(),Ee);var ud=class extends En.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),En.Disposable.create(()=>this.process.off("message",e))}};Ee.IPCMessageReader=ud;var dd=class extends En.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};Ee.IPCMessageWriter=dd;var ld=class extends En.AbstractMessageReader{constructor(e){super(),this.onData=new En.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};Ee.PortMessageReader=ld;var fd=class extends En.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};Ee.PortMessageWriter=fd;var ci=class extends En.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,Li.default)().stream.asReadableStream(e),t)}};Ee.SocketMessageReader=ci;var ui=class extends En.WriteableStreamMessageWriter{constructor(e,t){super((0,Li.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};Ee.SocketMessageWriter=ui;var Fo=class extends En.ReadableStreamMessageReader{constructor(e,t){super((0,Li.default)().stream.asReadableStream(e),t)}};Ee.StreamMessageReader=Fo;var Lo=class extends En.WriteableStreamMessageWriter{constructor(e,t){super((0,Li.default)().stream.asWritableStream(e),t)}};Ee.StreamMessageWriter=Lo;var zg=process.env.XDG_RUNTIME_DIR,qS=new Map([["linux",107],["darwin",103]]);function OS(){let r=(0,IS.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;zg?e=Vg.join(zg,`vscode-ipc-${r}.sock`):e=Vg.join(xS.tmpdir(),`vscode-${r}.sock`);let t=qS.get(process.platform);return t!==void 0&&e.length>t&&(0,Li.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}Ee.generateRandomPipeName=OS;function FS(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Mo.createServer)(a=>{o.close(),t([new ci(a,e),new ui(a,e)])});o.on("error",s),o.listen(r,()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}Ee.createClientPipeTransport=FS;function LS(r,e="utf-8"){let t=(0,Mo.createConnection)(r);return[new ci(t,e),new ui(t,e)]}Ee.createServerPipeTransport=LS;function MS(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Mo.createServer)(a=>{o.close(),t([new ci(a,e),new ui(a,e)])});o.on("error",s),o.listen(r,"127.0.0.1",()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}Ee.createClientSocketTransport=MS;function NS(r,e="utf-8"){let t=(0,Mo.createConnection)(r,"127.0.0.1");return[new ci(t,e),new ui(t,e)]}Ee.createServerSocketTransport=NS;function AS(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function jS(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function $S(r,e,t,n){t||(t=En.NullLogger);let i=AS(r)?new Fo(r):r,s=jS(e)?new Lo(e):e;return En.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,En.createMessageConnection)(i,s,t,n)}Ee.createMessageConnection=$S});var hd=I((mE,Kg)=>{"use strict";Kg.exports=di()});var Ao=I((Bg,No)=>{(function(r){if(typeof No=="object"&&typeof No.exports=="object"){var e=r(require,Bg);e!==void 0&&(No.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],r)})(function(r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=e.EOL=e.WorkspaceFolder=e.InlineCompletionContext=e.SelectedCompletionInfo=e.InlineCompletionTriggerKind=e.InlineCompletionList=e.InlineCompletionItem=e.StringValue=e.InlayHint=e.InlayHintLabelPart=e.InlayHintKind=e.InlineValueContext=e.InlineValueEvaluatableExpression=e.InlineValueVariableLookup=e.InlineValueText=e.SemanticTokens=e.SemanticTokenModifiers=e.SemanticTokenTypes=e.SelectionRange=e.DocumentLink=e.FormattingOptions=e.CodeLens=e.CodeAction=e.CodeActionContext=e.CodeActionTriggerKind=e.CodeActionKind=e.DocumentSymbol=e.WorkspaceSymbol=e.SymbolInformation=e.SymbolTag=e.SymbolKind=e.DocumentHighlight=e.DocumentHighlightKind=e.SignatureInformation=e.ParameterInformation=e.Hover=e.MarkedString=e.CompletionList=e.CompletionItem=e.CompletionItemLabelDetails=e.InsertTextMode=e.InsertReplaceEdit=e.CompletionItemTag=e.InsertTextFormat=e.CompletionItemKind=e.MarkupContent=e.MarkupKind=e.TextDocumentItem=e.OptionalVersionedTextDocumentIdentifier=e.VersionedTextDocumentIdentifier=e.TextDocumentIdentifier=e.WorkspaceChange=e.WorkspaceEdit=e.DeleteFile=e.RenameFile=e.CreateFile=e.TextDocumentEdit=e.AnnotatedTextEdit=e.ChangeAnnotationIdentifier=e.ChangeAnnotation=e.TextEdit=e.Command=e.Diagnostic=e.CodeDescription=e.DiagnosticTag=e.DiagnosticSeverity=e.DiagnosticRelatedInformation=e.FoldingRange=e.FoldingRangeKind=e.ColorPresentation=e.ColorInformation=e.Color=e.LocationLink=e.Location=e.Range=e.Position=e.uinteger=e.integer=e.URI=e.DocumentUri=void 0;var t;(function(p){function R(_){return typeof _=="string"}p.is=R})(t||(e.DocumentUri=t={}));var n;(function(p){function R(_){return typeof _=="string"}p.is=R})(n||(e.URI=n={}));var i;(function(p){p.MIN_VALUE=-2147483648,p.MAX_VALUE=2147483647;function R(_){return typeof _=="number"&&p.MIN_VALUE<=_&&_<=p.MAX_VALUE}p.is=R})(i||(e.integer=i={}));var s;(function(p){p.MIN_VALUE=0,p.MAX_VALUE=2147483647;function R(_){return typeof _=="number"&&p.MIN_VALUE<=_&&_<=p.MAX_VALUE}p.is=R})(s||(e.uinteger=s={}));var o;(function(p){function R(y,f){return y===Number.MAX_VALUE&&(y=s.MAX_VALUE),f===Number.MAX_VALUE&&(f=s.MAX_VALUE),{line:y,character:f}}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&P.uinteger(f.line)&&P.uinteger(f.character)}p.is=_})(o||(e.Position=o={}));var a;(function(p){function R(y,f,k,A){if(P.uinteger(y)&&P.uinteger(f)&&P.uinteger(k)&&P.uinteger(A))return{start:o.create(y,f),end:o.create(k,A)};if(o.is(y)&&o.is(f))return{start:y,end:f};throw new Error("Range#create called with invalid arguments[".concat(y,", ").concat(f,", ").concat(k,", ").concat(A,"]"))}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&o.is(f.start)&&o.is(f.end)}p.is=_})(a||(e.Range=a={}));var c;(function(p){function R(y,f){return{uri:y,range:f}}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&a.is(f.range)&&(P.string(f.uri)||P.undefined(f.uri))}p.is=_})(c||(e.Location=c={}));var d;(function(p){function R(y,f,k,A){return{targetUri:y,targetRange:f,targetSelectionRange:k,originSelectionRange:A}}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&a.is(f.targetRange)&&P.string(f.targetUri)&&a.is(f.targetSelectionRange)&&(a.is(f.originSelectionRange)||P.undefined(f.originSelectionRange))}p.is=_})(d||(e.LocationLink=d={}));var g;(function(p){function R(y,f,k,A){return{red:y,green:f,blue:k,alpha:A}}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&P.numberRange(f.red,0,1)&&P.numberRange(f.green,0,1)&&P.numberRange(f.blue,0,1)&&P.numberRange(f.alpha,0,1)}p.is=_})(g||(e.Color=g={}));var v;(function(p){function R(y,f){return{range:y,color:f}}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&a.is(f.range)&&g.is(f.color)}p.is=_})(v||(e.ColorInformation=v={}));var m;(function(p){function R(y,f,k){return{label:y,textEdit:f,additionalTextEdits:k}}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&P.string(f.label)&&(P.undefined(f.textEdit)||B.is(f))&&(P.undefined(f.additionalTextEdits)||P.typedArray(f.additionalTextEdits,B.is))}p.is=_})(m||(e.ColorPresentation=m={}));var S;(function(p){p.Comment="comment",p.Imports="imports",p.Region="region"})(S||(e.FoldingRangeKind=S={}));var b;(function(p){function R(y,f,k,A,ge,st){var Be={startLine:y,endLine:f};return P.defined(k)&&(Be.startCharacter=k),P.defined(A)&&(Be.endCharacter=A),P.defined(ge)&&(Be.kind=ge),P.defined(st)&&(Be.collapsedText=st),Be}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&P.uinteger(f.startLine)&&P.uinteger(f.startLine)&&(P.undefined(f.startCharacter)||P.uinteger(f.startCharacter))&&(P.undefined(f.endCharacter)||P.uinteger(f.endCharacter))&&(P.undefined(f.kind)||P.string(f.kind))}p.is=_})(b||(e.FoldingRange=b={}));var E;(function(p){function R(y,f){return{location:y,message:f}}p.create=R;function _(y){var f=y;return P.defined(f)&&c.is(f.location)&&P.string(f.message)}p.is=_})(E||(e.DiagnosticRelatedInformation=E={}));var x;(function(p){p.Error=1,p.Warning=2,p.Information=3,p.Hint=4})(x||(e.DiagnosticSeverity=x={}));var $;(function(p){p.Unnecessary=1,p.Deprecated=2})($||(e.DiagnosticTag=$={}));var U;(function(p){function R(_){var y=_;return P.objectLiteral(y)&&P.string(y.href)}p.is=R})(U||(e.CodeDescription=U={}));var M;(function(p){function R(y,f,k,A,ge,st){var Be={range:y,message:f};return P.defined(k)&&(Be.severity=k),P.defined(A)&&(Be.code=A),P.defined(ge)&&(Be.source=ge),P.defined(st)&&(Be.relatedInformation=st),Be}p.create=R;function _(y){var f,k=y;return P.defined(k)&&a.is(k.range)&&P.string(k.message)&&(P.number(k.severity)||P.undefined(k.severity))&&(P.integer(k.code)||P.string(k.code)||P.undefined(k.code))&&(P.undefined(k.codeDescription)||P.string((f=k.codeDescription)===null||f===void 0?void 0:f.href))&&(P.string(k.source)||P.undefined(k.source))&&(P.undefined(k.relatedInformation)||P.typedArray(k.relatedInformation,E.is))}p.is=_})(M||(e.Diagnostic=M={}));var z;(function(p){function R(y,f){for(var k=[],A=2;A<arguments.length;A++)k[A-2]=arguments[A];var ge={title:y,command:f};return P.defined(k)&&k.length>0&&(ge.arguments=k),ge}p.create=R;function _(y){var f=y;return P.defined(f)&&P.string(f.title)&&P.string(f.command)}p.is=_})(z||(e.Command=z={}));var B;(function(p){function R(k,A){return{range:k,newText:A}}p.replace=R;function _(k,A){return{range:{start:k,end:k},newText:A}}p.insert=_;function y(k){return{range:k,newText:""}}p.del=y;function f(k){var A=k;return P.objectLiteral(A)&&P.string(A.newText)&&a.is(A.range)}p.is=f})(B||(e.TextEdit=B={}));var pe;(function(p){function R(y,f,k){var A={label:y};return f!==void 0&&(A.needsConfirmation=f),k!==void 0&&(A.description=k),A}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&P.string(f.label)&&(P.boolean(f.needsConfirmation)||f.needsConfirmation===void 0)&&(P.string(f.description)||f.description===void 0)}p.is=_})(pe||(e.ChangeAnnotation=pe={}));var J;(function(p){function R(_){var y=_;return P.string(y)}p.is=R})(J||(e.ChangeAnnotationIdentifier=J={}));var ce;(function(p){function R(k,A,ge){return{range:k,newText:A,annotationId:ge}}p.replace=R;function _(k,A,ge){return{range:{start:k,end:k},newText:A,annotationId:ge}}p.insert=_;function y(k,A){return{range:k,newText:"",annotationId:A}}p.del=y;function f(k){var A=k;return B.is(A)&&(pe.is(A.annotationId)||J.is(A.annotationId))}p.is=f})(ce||(e.AnnotatedTextEdit=ce={}));var Re;(function(p){function R(y,f){return{textDocument:y,edits:f}}p.create=R;function _(y){var f=y;return P.defined(f)&&Ue.is(f.textDocument)&&Array.isArray(f.edits)}p.is=_})(Re||(e.TextDocumentEdit=Re={}));var it;(function(p){function R(y,f,k){var A={kind:"create",uri:y};return f!==void 0&&(f.overwrite!==void 0||f.ignoreIfExists!==void 0)&&(A.options=f),k!==void 0&&(A.annotationId=k),A}p.create=R;function _(y){var f=y;return f&&f.kind==="create"&&P.string(f.uri)&&(f.options===void 0||(f.options.overwrite===void 0||P.boolean(f.options.overwrite))&&(f.options.ignoreIfExists===void 0||P.boolean(f.options.ignoreIfExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}p.is=_})(it||(e.CreateFile=it={}));var Ze;(function(p){function R(y,f,k,A){var ge={kind:"rename",oldUri:y,newUri:f};return k!==void 0&&(k.overwrite!==void 0||k.ignoreIfExists!==void 0)&&(ge.options=k),A!==void 0&&(ge.annotationId=A),ge}p.create=R;function _(y){var f=y;return f&&f.kind==="rename"&&P.string(f.oldUri)&&P.string(f.newUri)&&(f.options===void 0||(f.options.overwrite===void 0||P.boolean(f.options.overwrite))&&(f.options.ignoreIfExists===void 0||P.boolean(f.options.ignoreIfExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}p.is=_})(Ze||(e.RenameFile=Ze={}));var $e;(function(p){function R(y,f,k){var A={kind:"delete",uri:y};return f!==void 0&&(f.recursive!==void 0||f.ignoreIfNotExists!==void 0)&&(A.options=f),k!==void 0&&(A.annotationId=k),A}p.create=R;function _(y){var f=y;return f&&f.kind==="delete"&&P.string(f.uri)&&(f.options===void 0||(f.options.recursive===void 0||P.boolean(f.options.recursive))&&(f.options.ignoreIfNotExists===void 0||P.boolean(f.options.ignoreIfNotExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}p.is=_})($e||(e.DeleteFile=$e={}));var Zt;(function(p){function R(_){var y=_;return y&&(y.changes!==void 0||y.documentChanges!==void 0)&&(y.documentChanges===void 0||y.documentChanges.every(function(f){return P.string(f.kind)?it.is(f)||Ze.is(f)||$e.is(f):Re.is(f)}))}p.is=R})(Zt||(e.WorkspaceEdit=Zt={}));var At=(function(){function p(R,_){this.edits=R,this.changeAnnotations=_}return p.prototype.insert=function(R,_,y){var f,k;if(y===void 0?f=B.insert(R,_):J.is(y)?(k=y,f=ce.insert(R,_,y)):(this.assertChangeAnnotations(this.changeAnnotations),k=this.changeAnnotations.manage(y),f=ce.insert(R,_,k)),this.edits.push(f),k!==void 0)return k},p.prototype.replace=function(R,_,y){var f,k;if(y===void 0?f=B.replace(R,_):J.is(y)?(k=y,f=ce.replace(R,_,y)):(this.assertChangeAnnotations(this.changeAnnotations),k=this.changeAnnotations.manage(y),f=ce.replace(R,_,k)),this.edits.push(f),k!==void 0)return k},p.prototype.delete=function(R,_){var y,f;if(_===void 0?y=B.del(R):J.is(_)?(f=_,y=ce.del(R,_)):(this.assertChangeAnnotations(this.changeAnnotations),f=this.changeAnnotations.manage(_),y=ce.del(R,f)),this.edits.push(y),f!==void 0)return f},p.prototype.add=function(R){this.edits.push(R)},p.prototype.all=function(){return this.edits},p.prototype.clear=function(){this.edits.splice(0,this.edits.length)},p.prototype.assertChangeAnnotations=function(R){if(R===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},p})(),kt=(function(){function p(R){this._annotations=R===void 0?Object.create(null):R,this._counter=0,this._size=0}return p.prototype.all=function(){return this._annotations},Object.defineProperty(p.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),p.prototype.manage=function(R,_){var y;if(J.is(R)?y=R:(y=this.nextId(),_=R),this._annotations[y]!==void 0)throw new Error("Id ".concat(y," is already in use."));if(_===void 0)throw new Error("No annotation provided for id ".concat(y));return this._annotations[y]=_,this._size++,y},p.prototype.nextId=function(){return this._counter++,this._counter.toString()},p})(),Et=(function(){function p(R){var _=this;this._textEditChanges=Object.create(null),R!==void 0?(this._workspaceEdit=R,R.documentChanges?(this._changeAnnotations=new kt(R.changeAnnotations),R.changeAnnotations=this._changeAnnotations.all(),R.documentChanges.forEach(function(y){if(Re.is(y)){var f=new At(y.edits,_._changeAnnotations);_._textEditChanges[y.textDocument.uri]=f}})):R.changes&&Object.keys(R.changes).forEach(function(y){var f=new At(R.changes[y]);_._textEditChanges[y]=f})):this._workspaceEdit={}}return Object.defineProperty(p.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),p.prototype.getTextEditChange=function(R){if(Ue.is(R)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var _={uri:R.uri,version:R.version},y=this._textEditChanges[_.uri];if(!y){var f=[],k={textDocument:_,edits:f};this._workspaceEdit.documentChanges.push(k),y=new At(f,this._changeAnnotations),this._textEditChanges[_.uri]=y}return y}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var y=this._textEditChanges[R];if(!y){var f=[];this._workspaceEdit.changes[R]=f,y=new At(f),this._textEditChanges[R]=y}return y}},p.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new kt,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},p.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},p.prototype.createFile=function(R,_,y){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var f;pe.is(_)||J.is(_)?f=_:y=_;var k,A;if(f===void 0?k=it.create(R,y):(A=J.is(f)?f:this._changeAnnotations.manage(f),k=it.create(R,y,A)),this._workspaceEdit.documentChanges.push(k),A!==void 0)return A},p.prototype.renameFile=function(R,_,y,f){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var k;pe.is(y)||J.is(y)?k=y:f=y;var A,ge;if(k===void 0?A=Ze.create(R,_,f):(ge=J.is(k)?k:this._changeAnnotations.manage(k),A=Ze.create(R,_,f,ge)),this._workspaceEdit.documentChanges.push(A),ge!==void 0)return ge},p.prototype.deleteFile=function(R,_,y){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var f;pe.is(_)||J.is(_)?f=_:y=_;var k,A;if(f===void 0?k=$e.create(R,y):(A=J.is(f)?f:this._changeAnnotations.manage(f),k=$e.create(R,y,A)),this._workspaceEdit.documentChanges.push(k),A!==void 0)return A},p})();e.WorkspaceChange=Et;var bn;(function(p){function R(y){return{uri:y}}p.create=R;function _(y){var f=y;return P.defined(f)&&P.string(f.uri)}p.is=_})(bn||(e.TextDocumentIdentifier=bn={}));var wn;(function(p){function R(y,f){return{uri:y,version:f}}p.create=R;function _(y){var f=y;return P.defined(f)&&P.string(f.uri)&&P.integer(f.version)}p.is=_})(wn||(e.VersionedTextDocumentIdentifier=wn={}));var Ue;(function(p){function R(y,f){return{uri:y,version:f}}p.create=R;function _(y){var f=y;return P.defined(f)&&P.string(f.uri)&&(f.version===null||P.integer(f.version))}p.is=_})(Ue||(e.OptionalVersionedTextDocumentIdentifier=Ue={}));var Ct;(function(p){function R(y,f,k,A){return{uri:y,languageId:f,version:k,text:A}}p.create=R;function _(y){var f=y;return P.defined(f)&&P.string(f.uri)&&P.string(f.languageId)&&P.integer(f.version)&&P.string(f.text)}p.is=_})(Ct||(e.TextDocumentItem=Ct={}));var Ot;(function(p){p.PlainText="plaintext",p.Markdown="markdown";function R(_){var y=_;return y===p.PlainText||y===p.Markdown}p.is=R})(Ot||(e.MarkupKind=Ot={}));var xt;(function(p){function R(_){var y=_;return P.objectLiteral(_)&&Ot.is(y.kind)&&P.string(y.value)}p.is=R})(xt||(e.MarkupContent=xt={}));var lr;(function(p){p.Text=1,p.Method=2,p.Function=3,p.Constructor=4,p.Field=5,p.Variable=6,p.Class=7,p.Interface=8,p.Module=9,p.Property=10,p.Unit=11,p.Value=12,p.Enum=13,p.Keyword=14,p.Snippet=15,p.Color=16,p.File=17,p.Reference=18,p.Folder=19,p.EnumMember=20,p.Constant=21,p.Struct=22,p.Event=23,p.Operator=24,p.TypeParameter=25})(lr||(e.CompletionItemKind=lr={}));var Cn;(function(p){p.PlainText=1,p.Snippet=2})(Cn||(e.InsertTextFormat=Cn={}));var Rn;(function(p){p.Deprecated=1})(Rn||(e.CompletionItemTag=Rn={}));var er;(function(p){function R(y,f,k){return{newText:y,insert:f,replace:k}}p.create=R;function _(y){var f=y;return f&&P.string(f.newText)&&a.is(f.insert)&&a.is(f.replace)}p.is=_})(er||(e.InsertReplaceEdit=er={}));var fr;(function(p){p.asIs=1,p.adjustIndentation=2})(fr||(e.InsertTextMode=fr={}));var $n;(function(p){function R(_){var y=_;return y&&(P.string(y.detail)||y.detail===void 0)&&(P.string(y.description)||y.description===void 0)}p.is=R})($n||(e.CompletionItemLabelDetails=$n={}));var Sn;(function(p){function R(_){return{label:_}}p.create=R})(Sn||(e.CompletionItem=Sn={}));var _n;(function(p){function R(_,y){return{items:_||[],isIncomplete:!!y}}p.create=R})(_n||(e.CompletionList=_n={}));var Un;(function(p){function R(y){return y.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}p.fromPlainText=R;function _(y){var f=y;return P.string(f)||P.objectLiteral(f)&&P.string(f.language)&&P.string(f.value)}p.is=_})(Un||(e.MarkedString=Un={}));var We;(function(p){function R(_){var y=_;return!!y&&P.objectLiteral(y)&&(xt.is(y.contents)||Un.is(y.contents)||P.typedArray(y.contents,Un.is))&&(_.range===void 0||a.is(_.range))}p.is=R})(We||(e.Hover=We={}));var tr;(function(p){function R(_,y){return y?{label:_,documentation:y}:{label:_}}p.create=R})(tr||(e.ParameterInformation=tr={}));var Tn;(function(p){function R(_,y){for(var f=[],k=2;k<arguments.length;k++)f[k-2]=arguments[k];var A={label:_};return P.defined(y)&&(A.documentation=y),P.defined(f)?A.parameters=f:A.parameters=[],A}p.create=R})(Tn||(e.SignatureInformation=Tn={}));var jt;(function(p){p.Text=1,p.Read=2,p.Write=3})(jt||(e.DocumentHighlightKind=jt={}));var hr;(function(p){function R(_,y){var f={range:_};return P.number(y)&&(f.kind=y),f}p.create=R})(hr||(e.DocumentHighlight=hr={}));var Ht;(function(p){p.File=1,p.Module=2,p.Namespace=3,p.Package=4,p.Class=5,p.Method=6,p.Property=7,p.Field=8,p.Constructor=9,p.Enum=10,p.Interface=11,p.Function=12,p.Variable=13,p.Constant=14,p.String=15,p.Number=16,p.Boolean=17,p.Array=18,p.Object=19,p.Key=20,p.Null=21,p.EnumMember=22,p.Struct=23,p.Event=24,p.Operator=25,p.TypeParameter=26})(Ht||(e.SymbolKind=Ht={}));var Wn;(function(p){p.Deprecated=1})(Wn||(e.SymbolTag=Wn={}));var Ke;(function(p){function R(_,y,f,k,A){var ge={name:_,kind:y,location:{uri:k,range:f}};return A&&(ge.containerName=A),ge}p.create=R})(Ke||(e.SymbolInformation=Ke={}));var gt;(function(p){function R(_,y,f,k){return k!==void 0?{name:_,kind:y,location:{uri:f,range:k}}:{name:_,kind:y,location:{uri:f}}}p.create=R})(gt||(e.WorkspaceSymbol=gt={}));var It;(function(p){function R(y,f,k,A,ge,st){var Be={name:y,detail:f,kind:k,range:A,selectionRange:ge};return st!==void 0&&(Be.children=st),Be}p.create=R;function _(y){var f=y;return f&&P.string(f.name)&&P.number(f.kind)&&a.is(f.range)&&a.is(f.selectionRange)&&(f.detail===void 0||P.string(f.detail))&&(f.deprecated===void 0||P.boolean(f.deprecated))&&(f.children===void 0||Array.isArray(f.children))&&(f.tags===void 0||Array.isArray(f.tags))}p.is=_})(It||(e.DocumentSymbol=It={}));var en;(function(p){p.Empty="",p.QuickFix="quickfix",p.Refactor="refactor",p.RefactorExtract="refactor.extract",p.RefactorInline="refactor.inline",p.RefactorRewrite="refactor.rewrite",p.Source="source",p.SourceOrganizeImports="source.organizeImports",p.SourceFixAll="source.fixAll"})(en||(e.CodeActionKind=en={}));var Rt;(function(p){p.Invoked=1,p.Automatic=2})(Rt||(e.CodeActionTriggerKind=Rt={}));var Pn;(function(p){function R(y,f,k){var A={diagnostics:y};return f!=null&&(A.only=f),k!=null&&(A.triggerKind=k),A}p.create=R;function _(y){var f=y;return P.defined(f)&&P.typedArray(f.diagnostics,M.is)&&(f.only===void 0||P.typedArray(f.only,P.string))&&(f.triggerKind===void 0||f.triggerKind===Rt.Invoked||f.triggerKind===Rt.Automatic)}p.is=_})(Pn||(e.CodeActionContext=Pn={}));var Hn;(function(p){function R(y,f,k){var A={title:y},ge=!0;return typeof f=="string"?(ge=!1,A.kind=f):z.is(f)?A.command=f:A.edit=f,ge&&k!==void 0&&(A.kind=k),A}p.create=R;function _(y){var f=y;return f&&P.string(f.title)&&(f.diagnostics===void 0||P.typedArray(f.diagnostics,M.is))&&(f.kind===void 0||P.string(f.kind))&&(f.edit!==void 0||f.command!==void 0)&&(f.command===void 0||z.is(f.command))&&(f.isPreferred===void 0||P.boolean(f.isPreferred))&&(f.edit===void 0||Zt.is(f.edit))}p.is=_})(Hn||(e.CodeAction=Hn={}));var tn;(function(p){function R(y,f){var k={range:y};return P.defined(f)&&(k.data=f),k}p.create=R;function _(y){var f=y;return P.defined(f)&&a.is(f.range)&&(P.undefined(f.command)||z.is(f.command))}p.is=_})(tn||(e.CodeLens=tn={}));var Vn;(function(p){function R(y,f){return{tabSize:y,insertSpaces:f}}p.create=R;function _(y){var f=y;return P.defined(f)&&P.uinteger(f.tabSize)&&P.boolean(f.insertSpaces)}p.is=_})(Vn||(e.FormattingOptions=Vn={}));var mt;(function(p){function R(y,f,k){return{range:y,target:f,data:k}}p.create=R;function _(y){var f=y;return P.defined(f)&&a.is(f.range)&&(P.undefined(f.target)||P.string(f.target))}p.is=_})(mt||(e.DocumentLink=mt={}));var l;(function(p){function R(y,f){return{range:y,parent:f}}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&a.is(f.range)&&(f.parent===void 0||p.is(f.parent))}p.is=_})(l||(e.SelectionRange=l={}));var C;(function(p){p.namespace="namespace",p.type="type",p.class="class",p.enum="enum",p.interface="interface",p.struct="struct",p.typeParameter="typeParameter",p.parameter="parameter",p.variable="variable",p.property="property",p.enumMember="enumMember",p.event="event",p.function="function",p.method="method",p.macro="macro",p.keyword="keyword",p.modifier="modifier",p.comment="comment",p.string="string",p.number="number",p.regexp="regexp",p.operator="operator",p.decorator="decorator"})(C||(e.SemanticTokenTypes=C={}));var D;(function(p){p.declaration="declaration",p.definition="definition",p.readonly="readonly",p.static="static",p.deprecated="deprecated",p.abstract="abstract",p.async="async",p.modification="modification",p.documentation="documentation",p.defaultLibrary="defaultLibrary"})(D||(e.SemanticTokenModifiers=D={}));var O;(function(p){function R(_){var y=_;return P.objectLiteral(y)&&(y.resultId===void 0||typeof y.resultId=="string")&&Array.isArray(y.data)&&(y.data.length===0||typeof y.data[0]=="number")}p.is=R})(O||(e.SemanticTokens=O={}));var ne;(function(p){function R(y,f){return{range:y,text:f}}p.create=R;function _(y){var f=y;return f!=null&&a.is(f.range)&&P.string(f.text)}p.is=_})(ne||(e.InlineValueText=ne={}));var ee;(function(p){function R(y,f,k){return{range:y,variableName:f,caseSensitiveLookup:k}}p.create=R;function _(y){var f=y;return f!=null&&a.is(f.range)&&P.boolean(f.caseSensitiveLookup)&&(P.string(f.variableName)||f.variableName===void 0)}p.is=_})(ee||(e.InlineValueVariableLookup=ee={}));var ae;(function(p){function R(y,f){return{range:y,expression:f}}p.create=R;function _(y){var f=y;return f!=null&&a.is(f.range)&&(P.string(f.expression)||f.expression===void 0)}p.is=_})(ae||(e.InlineValueEvaluatableExpression=ae={}));var ue;(function(p){function R(y,f){return{frameId:y,stoppedLocation:f}}p.create=R;function _(y){var f=y;return P.defined(f)&&a.is(y.stoppedLocation)}p.is=_})(ue||(e.InlineValueContext=ue={}));var G;(function(p){p.Type=1,p.Parameter=2;function R(_){return _===1||_===2}p.is=R})(G||(e.InlayHintKind=G={}));var ie;(function(p){function R(y){return{value:y}}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&(f.tooltip===void 0||P.string(f.tooltip)||xt.is(f.tooltip))&&(f.location===void 0||c.is(f.location))&&(f.command===void 0||z.is(f.command))}p.is=_})(ie||(e.InlayHintLabelPart=ie={}));var Z;(function(p){function R(y,f,k){var A={position:y,label:f};return k!==void 0&&(A.kind=k),A}p.create=R;function _(y){var f=y;return P.objectLiteral(f)&&o.is(f.position)&&(P.string(f.label)||P.typedArray(f.label,ie.is))&&(f.kind===void 0||G.is(f.kind))&&f.textEdits===void 0||P.typedArray(f.textEdits,B.is)&&(f.tooltip===void 0||P.string(f.tooltip)||xt.is(f.tooltip))&&(f.paddingLeft===void 0||P.boolean(f.paddingLeft))&&(f.paddingRight===void 0||P.boolean(f.paddingRight))}p.is=_})(Z||(e.InlayHint=Z={}));var he;(function(p){function R(_){return{kind:"snippet",value:_}}p.createSnippet=R})(he||(e.StringValue=he={}));var _e;(function(p){function R(_,y,f,k){return{insertText:_,filterText:y,range:f,command:k}}p.create=R})(_e||(e.InlineCompletionItem=_e={}));var He;(function(p){function R(_){return{items:_}}p.create=R})(He||(e.InlineCompletionList=He={}));var pr;(function(p){p.Invoked=0,p.Automatic=1})(pr||(e.InlineCompletionTriggerKind=pr={}));var Nr;(function(p){function R(_,y){return{range:_,text:y}}p.create=R})(Nr||(e.SelectedCompletionInfo=Nr={}));var h;(function(p){function R(_,y){return{triggerKind:_,selectedCompletionInfo:y}}p.create=R})(h||(e.InlineCompletionContext=h={}));var q;(function(p){function R(_){var y=_;return P.objectLiteral(y)&&n.is(y.uri)&&P.string(y.name)}p.is=R})(q||(e.WorkspaceFolder=q={})),e.EOL=[`
`,`\r
`,"\r"];var Y;(function(p){function R(k,A,ge,st){return new Fe(k,A,ge,st)}p.create=R;function _(k){var A=k;return!!(P.defined(A)&&P.string(A.uri)&&(P.undefined(A.languageId)||P.string(A.languageId))&&P.uinteger(A.lineCount)&&P.func(A.getText)&&P.func(A.positionAt)&&P.func(A.offsetAt))}p.is=_;function y(k,A){for(var ge=k.getText(),st=f(A,function(gr,u){var T=gr.range.start.line-u.range.start.line;return T===0?gr.range.start.character-u.range.start.character:T}),Be=ge.length,an=st.length-1;an>=0;an--){var Dn=st[an],nr=k.offsetAt(Dn.range.start),Pe=k.offsetAt(Dn.range.end);if(Pe<=Be)ge=ge.substring(0,nr)+Dn.newText+ge.substring(Pe,ge.length);else throw new Error("Overlapping edit");Be=nr}return ge}p.applyEdits=y;function f(k,A){if(k.length<=1)return k;var ge=k.length/2|0,st=k.slice(0,ge),Be=k.slice(ge);f(st,A),f(Be,A);for(var an=0,Dn=0,nr=0;an<st.length&&Dn<Be.length;){var Pe=A(st[an],Be[Dn]);Pe<=0?k[nr++]=st[an++]:k[nr++]=Be[Dn++]}for(;an<st.length;)k[nr++]=st[an++];for(;Dn<Be.length;)k[nr++]=Be[Dn++];return k}})(Y||(e.TextDocument=Y={}));var Fe=(function(){function p(R,_,y,f){this._uri=R,this._languageId=_,this._version=y,this._content=f,this._lineOffsets=void 0}return Object.defineProperty(p.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),p.prototype.getText=function(R){if(R){var _=this.offsetAt(R.start),y=this.offsetAt(R.end);return this._content.substring(_,y)}return this._content},p.prototype.update=function(R,_){this._content=R.text,this._version=_,this._lineOffsets=void 0},p.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var R=[],_=this._content,y=!0,f=0;f<_.length;f++){y&&(R.push(f),y=!1);var k=_.charAt(f);y=k==="\r"||k===`
`,k==="\r"&&f+1<_.length&&_.charAt(f+1)===`
`&&f++}y&&_.length>0&&R.push(_.length),this._lineOffsets=R}return this._lineOffsets},p.prototype.positionAt=function(R){R=Math.max(Math.min(R,this._content.length),0);var _=this.getLineOffsets(),y=0,f=_.length;if(f===0)return o.create(0,R);for(;y<f;){var k=Math.floor((y+f)/2);_[k]>R?f=k:y=k+1}var A=y-1;return o.create(A,R-_[A])},p.prototype.offsetAt=function(R){var _=this.getLineOffsets();if(R.line>=_.length)return this._content.length;if(R.line<0)return 0;var y=_[R.line],f=R.line+1<_.length?_[R.line+1]:this._content.length;return Math.max(Math.min(y+R.character,f),y)},Object.defineProperty(p.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),p})(),P;(function(p){var R=Object.prototype.toString;function _(Pe){return typeof Pe<"u"}p.defined=_;function y(Pe){return typeof Pe>"u"}p.undefined=y;function f(Pe){return Pe===!0||Pe===!1}p.boolean=f;function k(Pe){return R.call(Pe)==="[object String]"}p.string=k;function A(Pe){return R.call(Pe)==="[object Number]"}p.number=A;function ge(Pe,gr,u){return R.call(Pe)==="[object Number]"&&gr<=Pe&&Pe<=u}p.numberRange=ge;function st(Pe){return R.call(Pe)==="[object Number]"&&-2147483648<=Pe&&Pe<=2147483647}p.integer=st;function Be(Pe){return R.call(Pe)==="[object Number]"&&0<=Pe&&Pe<=2147483647}p.uinteger=Be;function an(Pe){return R.call(Pe)==="[object Function]"}p.func=an;function Dn(Pe){return Pe!==null&&typeof Pe=="object"}p.objectLiteral=Dn;function nr(Pe,gr){return Array.isArray(Pe)&&Pe.every(gr)}p.typedArray=nr})(P||(P={}))})});var ot=I(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.ProtocolNotificationType=un.ProtocolNotificationType0=un.ProtocolRequestType=un.ProtocolRequestType0=un.RegistrationType=un.MessageDirection=void 0;var Mi=di(),Gg;(function(r){r.clientToServer="clientToServer",r.serverToClient="serverToClient",r.both="both"})(Gg||(un.MessageDirection=Gg={}));var pd=class{constructor(e){this.method=e}};un.RegistrationType=pd;var gd=class extends Mi.RequestType0{constructor(e){super(e)}};un.ProtocolRequestType0=gd;var md=class extends Mi.RequestType{constructor(e){super(e,Mi.ParameterStructures.byName)}};un.ProtocolRequestType=md;var vd=class extends Mi.NotificationType0{constructor(e){super(e)}};un.ProtocolNotificationType0=vd;var yd=class extends Mi.NotificationType{constructor(e){super(e,Mi.ParameterStructures.byName)}};un.ProtocolNotificationType=yd});var jo=I(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.objectLiteral=St.typedArray=St.stringArray=St.array=St.func=St.error=St.number=St.string=St.boolean=void 0;function US(r){return r===!0||r===!1}St.boolean=US;function Jg(r){return typeof r=="string"||r instanceof String}St.string=Jg;function WS(r){return typeof r=="number"||r instanceof Number}St.number=WS;function HS(r){return r instanceof Error}St.error=HS;function VS(r){return typeof r=="function"}St.func=VS;function Xg(r){return Array.isArray(r)}St.array=Xg;function zS(r){return Xg(r)&&r.every(e=>Jg(e))}St.stringArray=zS;function KS(r,e){return Array.isArray(r)&&r.every(e)}St.typedArray=KS;function BS(r){return r!==null&&typeof r=="object"}St.objectLiteral=BS});var Zg=I($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.ImplementationRequest=void 0;var Qg=ot(),Yg;(function(r){r.method="textDocument/implementation",r.messageDirection=Qg.MessageDirection.clientToServer,r.type=new Qg.ProtocolRequestType(r.method)})(Yg||($o.ImplementationRequest=Yg={}))});var nm=I(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.TypeDefinitionRequest=void 0;var em=ot(),tm;(function(r){r.method="textDocument/typeDefinition",r.messageDirection=em.MessageDirection.clientToServer,r.type=new em.ProtocolRequestType(r.method)})(tm||(Uo.TypeDefinitionRequest=tm={}))});var sm=I(Ni=>{"use strict";Object.defineProperty(Ni,"__esModule",{value:!0});Ni.DidChangeWorkspaceFoldersNotification=Ni.WorkspaceFoldersRequest=void 0;var Wo=ot(),rm;(function(r){r.method="workspace/workspaceFolders",r.messageDirection=Wo.MessageDirection.serverToClient,r.type=new Wo.ProtocolRequestType0(r.method)})(rm||(Ni.WorkspaceFoldersRequest=rm={}));var im;(function(r){r.method="workspace/didChangeWorkspaceFolders",r.messageDirection=Wo.MessageDirection.clientToServer,r.type=new Wo.ProtocolNotificationType(r.method)})(im||(Ni.DidChangeWorkspaceFoldersNotification=im={}))});var cm=I(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.ConfigurationRequest=void 0;var om=ot(),am;(function(r){r.method="workspace/configuration",r.messageDirection=om.MessageDirection.serverToClient,r.type=new om.ProtocolRequestType(r.method)})(am||(Ho.ConfigurationRequest=am={}))});var lm=I(Ai=>{"use strict";Object.defineProperty(Ai,"__esModule",{value:!0});Ai.ColorPresentationRequest=Ai.DocumentColorRequest=void 0;var Vo=ot(),um;(function(r){r.method="textDocument/documentColor",r.messageDirection=Vo.MessageDirection.clientToServer,r.type=new Vo.ProtocolRequestType(r.method)})(um||(Ai.DocumentColorRequest=um={}));var dm;(function(r){r.method="textDocument/colorPresentation",r.messageDirection=Vo.MessageDirection.clientToServer,r.type=new Vo.ProtocolRequestType(r.method)})(dm||(Ai.ColorPresentationRequest=dm={}))});var pm=I(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.FoldingRangeRefreshRequest=ji.FoldingRangeRequest=void 0;var zo=ot(),fm;(function(r){r.method="textDocument/foldingRange",r.messageDirection=zo.MessageDirection.clientToServer,r.type=new zo.ProtocolRequestType(r.method)})(fm||(ji.FoldingRangeRequest=fm={}));var hm;(function(r){r.method="workspace/foldingRange/refresh",r.messageDirection=zo.MessageDirection.serverToClient,r.type=new zo.ProtocolRequestType0(r.method)})(hm||(ji.FoldingRangeRefreshRequest=hm={}))});var vm=I(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.DeclarationRequest=void 0;var gm=ot(),mm;(function(r){r.method="textDocument/declaration",r.messageDirection=gm.MessageDirection.clientToServer,r.type=new gm.ProtocolRequestType(r.method)})(mm||(Ko.DeclarationRequest=mm={}))});var wm=I(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.SelectionRangeRequest=void 0;var ym=ot(),bm;(function(r){r.method="textDocument/selectionRange",r.messageDirection=ym.MessageDirection.clientToServer,r.type=new ym.ProtocolRequestType(r.method)})(bm||(Bo.SelectionRangeRequest=bm={}))});var _m=I(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.WorkDoneProgressCancelNotification=Wr.WorkDoneProgressCreateRequest=Wr.WorkDoneProgress=void 0;var GS=di(),Go=ot(),Cm;(function(r){r.type=new GS.ProgressType;function e(t){return t===r.type}r.is=e})(Cm||(Wr.WorkDoneProgress=Cm={}));var Rm;(function(r){r.method="window/workDoneProgress/create",r.messageDirection=Go.MessageDirection.serverToClient,r.type=new Go.ProtocolRequestType(r.method)})(Rm||(Wr.WorkDoneProgressCreateRequest=Rm={}));var Sm;(function(r){r.method="window/workDoneProgress/cancel",r.messageDirection=Go.MessageDirection.clientToServer,r.type=new Go.ProtocolNotificationType(r.method)})(Sm||(Wr.WorkDoneProgressCancelNotification=Sm={}))});var km=I(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.CallHierarchyOutgoingCallsRequest=Hr.CallHierarchyIncomingCallsRequest=Hr.CallHierarchyPrepareRequest=void 0;var $i=ot(),Tm;(function(r){r.method="textDocument/prepareCallHierarchy",r.messageDirection=$i.MessageDirection.clientToServer,r.type=new $i.ProtocolRequestType(r.method)})(Tm||(Hr.CallHierarchyPrepareRequest=Tm={}));var Pm;(function(r){r.method="callHierarchy/incomingCalls",r.messageDirection=$i.MessageDirection.clientToServer,r.type=new $i.ProtocolRequestType(r.method)})(Pm||(Hr.CallHierarchyIncomingCallsRequest=Pm={}));var Dm;(function(r){r.method="callHierarchy/outgoingCalls",r.messageDirection=$i.MessageDirection.clientToServer,r.type=new $i.ProtocolRequestType(r.method)})(Dm||(Hr.CallHierarchyOutgoingCallsRequest=Dm={}))});var Fm=I(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.SemanticTokensRefreshRequest=dn.SemanticTokensRangeRequest=dn.SemanticTokensDeltaRequest=dn.SemanticTokensRequest=dn.SemanticTokensRegistrationType=dn.TokenFormat=void 0;var Dr=ot(),Em;(function(r){r.Relative="relative"})(Em||(dn.TokenFormat=Em={}));var Ts;(function(r){r.method="textDocument/semanticTokens",r.type=new Dr.RegistrationType(r.method)})(Ts||(dn.SemanticTokensRegistrationType=Ts={}));var xm;(function(r){r.method="textDocument/semanticTokens/full",r.messageDirection=Dr.MessageDirection.clientToServer,r.type=new Dr.ProtocolRequestType(r.method),r.registrationMethod=Ts.method})(xm||(dn.SemanticTokensRequest=xm={}));var Im;(function(r){r.method="textDocument/semanticTokens/full/delta",r.messageDirection=Dr.MessageDirection.clientToServer,r.type=new Dr.ProtocolRequestType(r.method),r.registrationMethod=Ts.method})(Im||(dn.SemanticTokensDeltaRequest=Im={}));var qm;(function(r){r.method="textDocument/semanticTokens/range",r.messageDirection=Dr.MessageDirection.clientToServer,r.type=new Dr.ProtocolRequestType(r.method),r.registrationMethod=Ts.method})(qm||(dn.SemanticTokensRangeRequest=qm={}));var Om;(function(r){r.method="workspace/semanticTokens/refresh",r.messageDirection=Dr.MessageDirection.serverToClient,r.type=new Dr.ProtocolRequestType0(r.method)})(Om||(dn.SemanticTokensRefreshRequest=Om={}))});var Nm=I(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});Jo.ShowDocumentRequest=void 0;var Lm=ot(),Mm;(function(r){r.method="window/showDocument",r.messageDirection=Lm.MessageDirection.serverToClient,r.type=new Lm.ProtocolRequestType(r.method)})(Mm||(Jo.ShowDocumentRequest=Mm={}))});var $m=I(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.LinkedEditingRangeRequest=void 0;var Am=ot(),jm;(function(r){r.method="textDocument/linkedEditingRange",r.messageDirection=Am.MessageDirection.clientToServer,r.type=new Am.ProtocolRequestType(r.method)})(jm||(Xo.LinkedEditingRangeRequest=jm={}))});var Gm=I(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.WillDeleteFilesRequest=Kt.DidDeleteFilesNotification=Kt.DidRenameFilesNotification=Kt.WillRenameFilesRequest=Kt.DidCreateFilesNotification=Kt.WillCreateFilesRequest=Kt.FileOperationPatternKind=void 0;var Kn=ot(),Um;(function(r){r.file="file",r.folder="folder"})(Um||(Kt.FileOperationPatternKind=Um={}));var Wm;(function(r){r.method="workspace/willCreateFiles",r.messageDirection=Kn.MessageDirection.clientToServer,r.type=new Kn.ProtocolRequestType(r.method)})(Wm||(Kt.WillCreateFilesRequest=Wm={}));var Hm;(function(r){r.method="workspace/didCreateFiles",r.messageDirection=Kn.MessageDirection.clientToServer,r.type=new Kn.ProtocolNotificationType(r.method)})(Hm||(Kt.DidCreateFilesNotification=Hm={}));var Vm;(function(r){r.method="workspace/willRenameFiles",r.messageDirection=Kn.MessageDirection.clientToServer,r.type=new Kn.ProtocolRequestType(r.method)})(Vm||(Kt.WillRenameFilesRequest=Vm={}));var zm;(function(r){r.method="workspace/didRenameFiles",r.messageDirection=Kn.MessageDirection.clientToServer,r.type=new Kn.ProtocolNotificationType(r.method)})(zm||(Kt.DidRenameFilesNotification=zm={}));var Km;(function(r){r.method="workspace/didDeleteFiles",r.messageDirection=Kn.MessageDirection.clientToServer,r.type=new Kn.ProtocolNotificationType(r.method)})(Km||(Kt.DidDeleteFilesNotification=Km={}));var Bm;(function(r){r.method="workspace/willDeleteFiles",r.messageDirection=Kn.MessageDirection.clientToServer,r.type=new Kn.ProtocolRequestType(r.method)})(Bm||(Kt.WillDeleteFilesRequest=Bm={}))});var Zm=I(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.MonikerRequest=Vr.MonikerKind=Vr.UniquenessLevel=void 0;var Jm=ot(),Xm;(function(r){r.document="document",r.project="project",r.group="group",r.scheme="scheme",r.global="global"})(Xm||(Vr.UniquenessLevel=Xm={}));var Qm;(function(r){r.$import="import",r.$export="export",r.local="local"})(Qm||(Vr.MonikerKind=Qm={}));var Ym;(function(r){r.method="textDocument/moniker",r.messageDirection=Jm.MessageDirection.clientToServer,r.type=new Jm.ProtocolRequestType(r.method)})(Ym||(Vr.MonikerRequest=Ym={}))});var rv=I(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.TypeHierarchySubtypesRequest=zr.TypeHierarchySupertypesRequest=zr.TypeHierarchyPrepareRequest=void 0;var Ui=ot(),ev;(function(r){r.method="textDocument/prepareTypeHierarchy",r.messageDirection=Ui.MessageDirection.clientToServer,r.type=new Ui.ProtocolRequestType(r.method)})(ev||(zr.TypeHierarchyPrepareRequest=ev={}));var tv;(function(r){r.method="typeHierarchy/supertypes",r.messageDirection=Ui.MessageDirection.clientToServer,r.type=new Ui.ProtocolRequestType(r.method)})(tv||(zr.TypeHierarchySupertypesRequest=tv={}));var nv;(function(r){r.method="typeHierarchy/subtypes",r.messageDirection=Ui.MessageDirection.clientToServer,r.type=new Ui.ProtocolRequestType(r.method)})(nv||(zr.TypeHierarchySubtypesRequest=nv={}))});var ov=I(Wi=>{"use strict";Object.defineProperty(Wi,"__esModule",{value:!0});Wi.InlineValueRefreshRequest=Wi.InlineValueRequest=void 0;var Qo=ot(),iv;(function(r){r.method="textDocument/inlineValue",r.messageDirection=Qo.MessageDirection.clientToServer,r.type=new Qo.ProtocolRequestType(r.method)})(iv||(Wi.InlineValueRequest=iv={}));var sv;(function(r){r.method="workspace/inlineValue/refresh",r.messageDirection=Qo.MessageDirection.serverToClient,r.type=new Qo.ProtocolRequestType0(r.method)})(sv||(Wi.InlineValueRefreshRequest=sv={}))});var dv=I(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.InlayHintRefreshRequest=Kr.InlayHintResolveRequest=Kr.InlayHintRequest=void 0;var Hi=ot(),av;(function(r){r.method="textDocument/inlayHint",r.messageDirection=Hi.MessageDirection.clientToServer,r.type=new Hi.ProtocolRequestType(r.method)})(av||(Kr.InlayHintRequest=av={}));var cv;(function(r){r.method="inlayHint/resolve",r.messageDirection=Hi.MessageDirection.clientToServer,r.type=new Hi.ProtocolRequestType(r.method)})(cv||(Kr.InlayHintResolveRequest=cv={}));var uv;(function(r){r.method="workspace/inlayHint/refresh",r.messageDirection=Hi.MessageDirection.serverToClient,r.type=new Hi.ProtocolRequestType0(r.method)})(uv||(Kr.InlayHintRefreshRequest=uv={}))});var vv=I(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.DiagnosticRefreshRequest=Bn.WorkspaceDiagnosticRequest=Bn.DocumentDiagnosticRequest=Bn.DocumentDiagnosticReportKind=Bn.DiagnosticServerCancellationData=void 0;var mv=di(),JS=jo(),Vi=ot(),lv;(function(r){function e(t){let n=t;return n&&JS.boolean(n.retriggerRequest)}r.is=e})(lv||(Bn.DiagnosticServerCancellationData=lv={}));var fv;(function(r){r.Full="full",r.Unchanged="unchanged"})(fv||(Bn.DocumentDiagnosticReportKind=fv={}));var hv;(function(r){r.method="textDocument/diagnostic",r.messageDirection=Vi.MessageDirection.clientToServer,r.type=new Vi.ProtocolRequestType(r.method),r.partialResult=new mv.ProgressType})(hv||(Bn.DocumentDiagnosticRequest=hv={}));var pv;(function(r){r.method="workspace/diagnostic",r.messageDirection=Vi.MessageDirection.clientToServer,r.type=new Vi.ProtocolRequestType(r.method),r.partialResult=new mv.ProgressType})(pv||(Bn.WorkspaceDiagnosticRequest=pv={}));var gv;(function(r){r.method="workspace/diagnostic/refresh",r.messageDirection=Vi.MessageDirection.serverToClient,r.type=new Vi.ProtocolRequestType0(r.method)})(gv||(Bn.DiagnosticRefreshRequest=gv={}))});var _v=I(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.DidCloseNotebookDocumentNotification=yt.DidSaveNotebookDocumentNotification=yt.DidChangeNotebookDocumentNotification=yt.NotebookCellArrayChange=yt.DidOpenNotebookDocumentNotification=yt.NotebookDocumentSyncRegistrationType=yt.NotebookDocument=yt.NotebookCell=yt.ExecutionSummary=yt.NotebookCellKind=void 0;var Ps=Ao(),ir=jo(),vr=ot(),bd;(function(r){r.Markup=1,r.Code=2;function e(t){return t===1||t===2}r.is=e})(bd||(yt.NotebookCellKind=bd={}));var wd;(function(r){function e(i,s){let o={executionOrder:i};return(s===!0||s===!1)&&(o.success=s),o}r.create=e;function t(i){let s=i;return ir.objectLiteral(s)&&Ps.uinteger.is(s.executionOrder)&&(s.success===void 0||ir.boolean(s.success))}r.is=t;function n(i,s){return i===s?!0:i==null||s===null||s===void 0?!1:i.executionOrder===s.executionOrder&&i.success===s.success}r.equals=n})(wd||(yt.ExecutionSummary=wd={}));var Yo;(function(r){function e(s,o){return{kind:s,document:o}}r.create=e;function t(s){let o=s;return ir.objectLiteral(o)&&bd.is(o.kind)&&Ps.DocumentUri.is(o.document)&&(o.metadata===void 0||ir.objectLiteral(o.metadata))}r.is=t;function n(s,o){let a=new Set;return s.document!==o.document&&a.add("document"),s.kind!==o.kind&&a.add("kind"),s.executionSummary!==o.executionSummary&&a.add("executionSummary"),(s.metadata!==void 0||o.metadata!==void 0)&&!i(s.metadata,o.metadata)&&a.add("metadata"),(s.executionSummary!==void 0||o.executionSummary!==void 0)&&!wd.equals(s.executionSummary,o.executionSummary)&&a.add("executionSummary"),a}r.diff=n;function i(s,o){if(s===o)return!0;if(s==null||o===null||o===void 0||typeof s!=typeof o||typeof s!="object")return!1;let a=Array.isArray(s),c=Array.isArray(o);if(a!==c)return!1;if(a&&c){if(s.length!==o.length)return!1;for(let d=0;d<s.length;d++)if(!i(s[d],o[d]))return!1}if(ir.objectLiteral(s)&&ir.objectLiteral(o)){let d=Object.keys(s),g=Object.keys(o);if(d.length!==g.length||(d.sort(),g.sort(),!i(d,g)))return!1;for(let v=0;v<d.length;v++){let m=d[v];if(!i(s[m],o[m]))return!1}}return!0}})(Yo||(yt.NotebookCell=Yo={}));var yv;(function(r){function e(n,i,s,o){return{uri:n,notebookType:i,version:s,cells:o}}r.create=e;function t(n){let i=n;return ir.objectLiteral(i)&&ir.string(i.uri)&&Ps.integer.is(i.version)&&ir.typedArray(i.cells,Yo.is)}r.is=t})(yv||(yt.NotebookDocument=yv={}));var zi;(function(r){r.method="notebookDocument/sync",r.messageDirection=vr.MessageDirection.clientToServer,r.type=new vr.RegistrationType(r.method)})(zi||(yt.NotebookDocumentSyncRegistrationType=zi={}));var bv;(function(r){r.method="notebookDocument/didOpen",r.messageDirection=vr.MessageDirection.clientToServer,r.type=new vr.ProtocolNotificationType(r.method),r.registrationMethod=zi.method})(bv||(yt.DidOpenNotebookDocumentNotification=bv={}));var wv;(function(r){function e(n){let i=n;return ir.objectLiteral(i)&&Ps.uinteger.is(i.start)&&Ps.uinteger.is(i.deleteCount)&&(i.cells===void 0||ir.typedArray(i.cells,Yo.is))}r.is=e;function t(n,i,s){let o={start:n,deleteCount:i};return s!==void 0&&(o.cells=s),o}r.create=t})(wv||(yt.NotebookCellArrayChange=wv={}));var Cv;(function(r){r.method="notebookDocument/didChange",r.messageDirection=vr.MessageDirection.clientToServer,r.type=new vr.ProtocolNotificationType(r.method),r.registrationMethod=zi.method})(Cv||(yt.DidChangeNotebookDocumentNotification=Cv={}));var Rv;(function(r){r.method="notebookDocument/didSave",r.messageDirection=vr.MessageDirection.clientToServer,r.type=new vr.ProtocolNotificationType(r.method),r.registrationMethod=zi.method})(Rv||(yt.DidSaveNotebookDocumentNotification=Rv={}));var Sv;(function(r){r.method="notebookDocument/didClose",r.messageDirection=vr.MessageDirection.clientToServer,r.type=new vr.ProtocolNotificationType(r.method),r.registrationMethod=zi.method})(Sv||(yt.DidCloseNotebookDocumentNotification=Sv={}))});var Dv=I(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.InlineCompletionRequest=void 0;var Tv=ot(),Pv;(function(r){r.method="textDocument/inlineCompletion",r.messageDirection=Tv.MessageDirection.clientToServer,r.type=new Tv.ProtocolRequestType(r.method)})(Pv||(Zo.InlineCompletionRequest=Pv={}))});var $y=I(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.WorkspaceSymbolRequest=w.CodeActionResolveRequest=w.CodeActionRequest=w.DocumentSymbolRequest=w.DocumentHighlightRequest=w.ReferencesRequest=w.DefinitionRequest=w.SignatureHelpRequest=w.SignatureHelpTriggerKind=w.HoverRequest=w.CompletionResolveRequest=w.CompletionRequest=w.CompletionTriggerKind=w.PublishDiagnosticsNotification=w.WatchKind=w.RelativePattern=w.FileChangeType=w.DidChangeWatchedFilesNotification=w.WillSaveTextDocumentWaitUntilRequest=w.WillSaveTextDocumentNotification=w.TextDocumentSaveReason=w.DidSaveTextDocumentNotification=w.DidCloseTextDocumentNotification=w.DidChangeTextDocumentNotification=w.TextDocumentContentChangeEvent=w.DidOpenTextDocumentNotification=w.TextDocumentSyncKind=w.TelemetryEventNotification=w.LogMessageNotification=w.ShowMessageRequest=w.ShowMessageNotification=w.MessageType=w.DidChangeConfigurationNotification=w.ExitNotification=w.ShutdownRequest=w.InitializedNotification=w.InitializeErrorCodes=w.InitializeRequest=w.WorkDoneProgressOptions=w.TextDocumentRegistrationOptions=w.StaticRegistrationOptions=w.PositionEncodingKind=w.FailureHandlingKind=w.ResourceOperationKind=w.UnregistrationRequest=w.RegistrationRequest=w.DocumentSelector=w.NotebookCellTextDocumentFilter=w.NotebookDocumentFilter=w.TextDocumentFilter=void 0;w.MonikerRequest=w.MonikerKind=w.UniquenessLevel=w.WillDeleteFilesRequest=w.DidDeleteFilesNotification=w.WillRenameFilesRequest=w.DidRenameFilesNotification=w.WillCreateFilesRequest=w.DidCreateFilesNotification=w.FileOperationPatternKind=w.LinkedEditingRangeRequest=w.ShowDocumentRequest=w.SemanticTokensRegistrationType=w.SemanticTokensRefreshRequest=w.SemanticTokensRangeRequest=w.SemanticTokensDeltaRequest=w.SemanticTokensRequest=w.TokenFormat=w.CallHierarchyPrepareRequest=w.CallHierarchyOutgoingCallsRequest=w.CallHierarchyIncomingCallsRequest=w.WorkDoneProgressCancelNotification=w.WorkDoneProgressCreateRequest=w.WorkDoneProgress=w.SelectionRangeRequest=w.DeclarationRequest=w.FoldingRangeRefreshRequest=w.FoldingRangeRequest=w.ColorPresentationRequest=w.DocumentColorRequest=w.ConfigurationRequest=w.DidChangeWorkspaceFoldersNotification=w.WorkspaceFoldersRequest=w.TypeDefinitionRequest=w.ImplementationRequest=w.ApplyWorkspaceEditRequest=w.ExecuteCommandRequest=w.PrepareRenameRequest=w.RenameRequest=w.PrepareSupportDefaultBehavior=w.DocumentOnTypeFormattingRequest=w.DocumentRangesFormattingRequest=w.DocumentRangeFormattingRequest=w.DocumentFormattingRequest=w.DocumentLinkResolveRequest=w.DocumentLinkRequest=w.CodeLensRefreshRequest=w.CodeLensResolveRequest=w.CodeLensRequest=w.WorkspaceSymbolResolveRequest=void 0;w.InlineCompletionRequest=w.DidCloseNotebookDocumentNotification=w.DidSaveNotebookDocumentNotification=w.DidChangeNotebookDocumentNotification=w.NotebookCellArrayChange=w.DidOpenNotebookDocumentNotification=w.NotebookDocumentSyncRegistrationType=w.NotebookDocument=w.NotebookCell=w.ExecutionSummary=w.NotebookCellKind=w.DiagnosticRefreshRequest=w.WorkspaceDiagnosticRequest=w.DocumentDiagnosticRequest=w.DocumentDiagnosticReportKind=w.DiagnosticServerCancellationData=w.InlayHintRefreshRequest=w.InlayHintResolveRequest=w.InlayHintRequest=w.InlineValueRefreshRequest=w.InlineValueRequest=w.TypeHierarchySupertypesRequest=w.TypeHierarchySubtypesRequest=w.TypeHierarchyPrepareRequest=void 0;var V=ot(),kv=Ao(),Lt=jo(),XS=Zg();Object.defineProperty(w,"ImplementationRequest",{enumerable:!0,get:function(){return XS.ImplementationRequest}});var QS=nm();Object.defineProperty(w,"TypeDefinitionRequest",{enumerable:!0,get:function(){return QS.TypeDefinitionRequest}});var My=sm();Object.defineProperty(w,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return My.WorkspaceFoldersRequest}});Object.defineProperty(w,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return My.DidChangeWorkspaceFoldersNotification}});var YS=cm();Object.defineProperty(w,"ConfigurationRequest",{enumerable:!0,get:function(){return YS.ConfigurationRequest}});var Ny=lm();Object.defineProperty(w,"DocumentColorRequest",{enumerable:!0,get:function(){return Ny.DocumentColorRequest}});Object.defineProperty(w,"ColorPresentationRequest",{enumerable:!0,get:function(){return Ny.ColorPresentationRequest}});var Ay=pm();Object.defineProperty(w,"FoldingRangeRequest",{enumerable:!0,get:function(){return Ay.FoldingRangeRequest}});Object.defineProperty(w,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return Ay.FoldingRangeRefreshRequest}});var ZS=vm();Object.defineProperty(w,"DeclarationRequest",{enumerable:!0,get:function(){return ZS.DeclarationRequest}});var e_=wm();Object.defineProperty(w,"SelectionRangeRequest",{enumerable:!0,get:function(){return e_.SelectionRangeRequest}});var Td=_m();Object.defineProperty(w,"WorkDoneProgress",{enumerable:!0,get:function(){return Td.WorkDoneProgress}});Object.defineProperty(w,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return Td.WorkDoneProgressCreateRequest}});Object.defineProperty(w,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return Td.WorkDoneProgressCancelNotification}});var Pd=km();Object.defineProperty(w,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return Pd.CallHierarchyIncomingCallsRequest}});Object.defineProperty(w,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return Pd.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(w,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return Pd.CallHierarchyPrepareRequest}});var Ki=Fm();Object.defineProperty(w,"TokenFormat",{enumerable:!0,get:function(){return Ki.TokenFormat}});Object.defineProperty(w,"SemanticTokensRequest",{enumerable:!0,get:function(){return Ki.SemanticTokensRequest}});Object.defineProperty(w,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return Ki.SemanticTokensDeltaRequest}});Object.defineProperty(w,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return Ki.SemanticTokensRangeRequest}});Object.defineProperty(w,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return Ki.SemanticTokensRefreshRequest}});Object.defineProperty(w,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return Ki.SemanticTokensRegistrationType}});var t_=Nm();Object.defineProperty(w,"ShowDocumentRequest",{enumerable:!0,get:function(){return t_.ShowDocumentRequest}});var n_=$m();Object.defineProperty(w,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return n_.LinkedEditingRangeRequest}});var li=Gm();Object.defineProperty(w,"FileOperationPatternKind",{enumerable:!0,get:function(){return li.FileOperationPatternKind}});Object.defineProperty(w,"DidCreateFilesNotification",{enumerable:!0,get:function(){return li.DidCreateFilesNotification}});Object.defineProperty(w,"WillCreateFilesRequest",{enumerable:!0,get:function(){return li.WillCreateFilesRequest}});Object.defineProperty(w,"DidRenameFilesNotification",{enumerable:!0,get:function(){return li.DidRenameFilesNotification}});Object.defineProperty(w,"WillRenameFilesRequest",{enumerable:!0,get:function(){return li.WillRenameFilesRequest}});Object.defineProperty(w,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return li.DidDeleteFilesNotification}});Object.defineProperty(w,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return li.WillDeleteFilesRequest}});var Dd=Zm();Object.defineProperty(w,"UniquenessLevel",{enumerable:!0,get:function(){return Dd.UniquenessLevel}});Object.defineProperty(w,"MonikerKind",{enumerable:!0,get:function(){return Dd.MonikerKind}});Object.defineProperty(w,"MonikerRequest",{enumerable:!0,get:function(){return Dd.MonikerRequest}});var kd=rv();Object.defineProperty(w,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return kd.TypeHierarchyPrepareRequest}});Object.defineProperty(w,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return kd.TypeHierarchySubtypesRequest}});Object.defineProperty(w,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return kd.TypeHierarchySupertypesRequest}});var jy=ov();Object.defineProperty(w,"InlineValueRequest",{enumerable:!0,get:function(){return jy.InlineValueRequest}});Object.defineProperty(w,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return jy.InlineValueRefreshRequest}});var Ed=dv();Object.defineProperty(w,"InlayHintRequest",{enumerable:!0,get:function(){return Ed.InlayHintRequest}});Object.defineProperty(w,"InlayHintResolveRequest",{enumerable:!0,get:function(){return Ed.InlayHintResolveRequest}});Object.defineProperty(w,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return Ed.InlayHintRefreshRequest}});var Ds=vv();Object.defineProperty(w,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return Ds.DiagnosticServerCancellationData}});Object.defineProperty(w,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return Ds.DocumentDiagnosticReportKind}});Object.defineProperty(w,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return Ds.DocumentDiagnosticRequest}});Object.defineProperty(w,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return Ds.WorkspaceDiagnosticRequest}});Object.defineProperty(w,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return Ds.DiagnosticRefreshRequest}});var yr=_v();Object.defineProperty(w,"NotebookCellKind",{enumerable:!0,get:function(){return yr.NotebookCellKind}});Object.defineProperty(w,"ExecutionSummary",{enumerable:!0,get:function(){return yr.ExecutionSummary}});Object.defineProperty(w,"NotebookCell",{enumerable:!0,get:function(){return yr.NotebookCell}});Object.defineProperty(w,"NotebookDocument",{enumerable:!0,get:function(){return yr.NotebookDocument}});Object.defineProperty(w,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return yr.NotebookDocumentSyncRegistrationType}});Object.defineProperty(w,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return yr.DidOpenNotebookDocumentNotification}});Object.defineProperty(w,"NotebookCellArrayChange",{enumerable:!0,get:function(){return yr.NotebookCellArrayChange}});Object.defineProperty(w,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return yr.DidChangeNotebookDocumentNotification}});Object.defineProperty(w,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return yr.DidSaveNotebookDocumentNotification}});Object.defineProperty(w,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return yr.DidCloseNotebookDocumentNotification}});var r_=Dv();Object.defineProperty(w,"InlineCompletionRequest",{enumerable:!0,get:function(){return r_.InlineCompletionRequest}});var Cd;(function(r){function e(t){let n=t;return Lt.string(n)||Lt.string(n.language)||Lt.string(n.scheme)||Lt.string(n.pattern)}r.is=e})(Cd||(w.TextDocumentFilter=Cd={}));var Rd;(function(r){function e(t){let n=t;return Lt.objectLiteral(n)&&(Lt.string(n.notebookType)||Lt.string(n.scheme)||Lt.string(n.pattern))}r.is=e})(Rd||(w.NotebookDocumentFilter=Rd={}));var Sd;(function(r){function e(t){let n=t;return Lt.objectLiteral(n)&&(Lt.string(n.notebook)||Rd.is(n.notebook))&&(n.language===void 0||Lt.string(n.language))}r.is=e})(Sd||(w.NotebookCellTextDocumentFilter=Sd={}));var _d;(function(r){function e(t){if(!Array.isArray(t))return!1;for(let n of t)if(!Lt.string(n)&&!Cd.is(n)&&!Sd.is(n))return!1;return!0}r.is=e})(_d||(w.DocumentSelector=_d={}));var Ev;(function(r){r.method="client/registerCapability",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(Ev||(w.RegistrationRequest=Ev={}));var xv;(function(r){r.method="client/unregisterCapability",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(xv||(w.UnregistrationRequest=xv={}));var Iv;(function(r){r.Create="create",r.Rename="rename",r.Delete="delete"})(Iv||(w.ResourceOperationKind=Iv={}));var qv;(function(r){r.Abort="abort",r.Transactional="transactional",r.TextOnlyTransactional="textOnlyTransactional",r.Undo="undo"})(qv||(w.FailureHandlingKind=qv={}));var Ov;(function(r){r.UTF8="utf-8",r.UTF16="utf-16",r.UTF32="utf-32"})(Ov||(w.PositionEncodingKind=Ov={}));var Fv;(function(r){function e(t){let n=t;return n&&Lt.string(n.id)&&n.id.length>0}r.hasId=e})(Fv||(w.StaticRegistrationOptions=Fv={}));var Lv;(function(r){function e(t){let n=t;return n&&(n.documentSelector===null||_d.is(n.documentSelector))}r.is=e})(Lv||(w.TextDocumentRegistrationOptions=Lv={}));var Mv;(function(r){function e(n){let i=n;return Lt.objectLiteral(i)&&(i.workDoneProgress===void 0||Lt.boolean(i.workDoneProgress))}r.is=e;function t(n){let i=n;return i&&Lt.boolean(i.workDoneProgress)}r.hasWorkDoneProgress=t})(Mv||(w.WorkDoneProgressOptions=Mv={}));var Nv;(function(r){r.method="initialize",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Nv||(w.InitializeRequest=Nv={}));var Av;(function(r){r.unknownProtocolVersion=1})(Av||(w.InitializeErrorCodes=Av={}));var jv;(function(r){r.method="initialized",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(jv||(w.InitializedNotification=jv={}));var $v;(function(r){r.method="shutdown",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType0(r.method)})($v||(w.ShutdownRequest=$v={}));var Uv;(function(r){r.method="exit",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType0(r.method)})(Uv||(w.ExitNotification=Uv={}));var Wv;(function(r){r.method="workspace/didChangeConfiguration",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Wv||(w.DidChangeConfigurationNotification=Wv={}));var Hv;(function(r){r.Error=1,r.Warning=2,r.Info=3,r.Log=4,r.Debug=5})(Hv||(w.MessageType=Hv={}));var Vv;(function(r){r.method="window/showMessage",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Vv||(w.ShowMessageNotification=Vv={}));var zv;(function(r){r.method="window/showMessageRequest",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(zv||(w.ShowMessageRequest=zv={}));var Kv;(function(r){r.method="window/logMessage",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Kv||(w.LogMessageNotification=Kv={}));var Bv;(function(r){r.method="telemetry/event",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Bv||(w.TelemetryEventNotification=Bv={}));var Gv;(function(r){r.None=0,r.Full=1,r.Incremental=2})(Gv||(w.TextDocumentSyncKind=Gv={}));var Jv;(function(r){r.method="textDocument/didOpen",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Jv||(w.DidOpenTextDocumentNotification=Jv={}));var Xv;(function(r){function e(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range!==void 0&&(i.rangeLength===void 0||typeof i.rangeLength=="number")}r.isIncremental=e;function t(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range===void 0&&i.rangeLength===void 0}r.isFull=t})(Xv||(w.TextDocumentContentChangeEvent=Xv={}));var Qv;(function(r){r.method="textDocument/didChange",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Qv||(w.DidChangeTextDocumentNotification=Qv={}));var Yv;(function(r){r.method="textDocument/didClose",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Yv||(w.DidCloseTextDocumentNotification=Yv={}));var Zv;(function(r){r.method="textDocument/didSave",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Zv||(w.DidSaveTextDocumentNotification=Zv={}));var ey;(function(r){r.Manual=1,r.AfterDelay=2,r.FocusOut=3})(ey||(w.TextDocumentSaveReason=ey={}));var ty;(function(r){r.method="textDocument/willSave",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(ty||(w.WillSaveTextDocumentNotification=ty={}));var ny;(function(r){r.method="textDocument/willSaveWaitUntil",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ny||(w.WillSaveTextDocumentWaitUntilRequest=ny={}));var ry;(function(r){r.method="workspace/didChangeWatchedFiles",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(ry||(w.DidChangeWatchedFilesNotification=ry={}));var iy;(function(r){r.Created=1,r.Changed=2,r.Deleted=3})(iy||(w.FileChangeType=iy={}));var sy;(function(r){function e(t){let n=t;return Lt.objectLiteral(n)&&(kv.URI.is(n.baseUri)||kv.WorkspaceFolder.is(n.baseUri))&&Lt.string(n.pattern)}r.is=e})(sy||(w.RelativePattern=sy={}));var oy;(function(r){r.Create=1,r.Change=2,r.Delete=4})(oy||(w.WatchKind=oy={}));var ay;(function(r){r.method="textDocument/publishDiagnostics",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(ay||(w.PublishDiagnosticsNotification=ay={}));var cy;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.TriggerForIncompleteCompletions=3})(cy||(w.CompletionTriggerKind=cy={}));var uy;(function(r){r.method="textDocument/completion",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(uy||(w.CompletionRequest=uy={}));var dy;(function(r){r.method="completionItem/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(dy||(w.CompletionResolveRequest=dy={}));var ly;(function(r){r.method="textDocument/hover",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ly||(w.HoverRequest=ly={}));var fy;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.ContentChange=3})(fy||(w.SignatureHelpTriggerKind=fy={}));var hy;(function(r){r.method="textDocument/signatureHelp",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(hy||(w.SignatureHelpRequest=hy={}));var py;(function(r){r.method="textDocument/definition",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(py||(w.DefinitionRequest=py={}));var gy;(function(r){r.method="textDocument/references",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(gy||(w.ReferencesRequest=gy={}));var my;(function(r){r.method="textDocument/documentHighlight",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(my||(w.DocumentHighlightRequest=my={}));var vy;(function(r){r.method="textDocument/documentSymbol",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(vy||(w.DocumentSymbolRequest=vy={}));var yy;(function(r){r.method="textDocument/codeAction",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(yy||(w.CodeActionRequest=yy={}));var by;(function(r){r.method="codeAction/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(by||(w.CodeActionResolveRequest=by={}));var wy;(function(r){r.method="workspace/symbol",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(wy||(w.WorkspaceSymbolRequest=wy={}));var Cy;(function(r){r.method="workspaceSymbol/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Cy||(w.WorkspaceSymbolResolveRequest=Cy={}));var Ry;(function(r){r.method="textDocument/codeLens",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ry||(w.CodeLensRequest=Ry={}));var Sy;(function(r){r.method="codeLens/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Sy||(w.CodeLensResolveRequest=Sy={}));var _y;(function(r){r.method="workspace/codeLens/refresh",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType0(r.method)})(_y||(w.CodeLensRefreshRequest=_y={}));var Ty;(function(r){r.method="textDocument/documentLink",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ty||(w.DocumentLinkRequest=Ty={}));var Py;(function(r){r.method="documentLink/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Py||(w.DocumentLinkResolveRequest=Py={}));var Dy;(function(r){r.method="textDocument/formatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Dy||(w.DocumentFormattingRequest=Dy={}));var ky;(function(r){r.method="textDocument/rangeFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ky||(w.DocumentRangeFormattingRequest=ky={}));var Ey;(function(r){r.method="textDocument/rangesFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ey||(w.DocumentRangesFormattingRequest=Ey={}));var xy;(function(r){r.method="textDocument/onTypeFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(xy||(w.DocumentOnTypeFormattingRequest=xy={}));var Iy;(function(r){r.Identifier=1})(Iy||(w.PrepareSupportDefaultBehavior=Iy={}));var qy;(function(r){r.method="textDocument/rename",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(qy||(w.RenameRequest=qy={}));var Oy;(function(r){r.method="textDocument/prepareRename",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Oy||(w.PrepareRenameRequest=Oy={}));var Fy;(function(r){r.method="workspace/executeCommand",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Fy||(w.ExecuteCommandRequest=Fy={}));var Ly;(function(r){r.method="workspace/applyEdit",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType("workspace/applyEdit")})(Ly||(w.ApplyWorkspaceEditRequest=Ly={}))});var Wy=I(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.createProtocolConnection=void 0;var Uy=di();function i_(r,e,t,n){return Uy.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,Uy.createMessageConnection)(r,e,t,n)}ea.createProtocolConnection=i_});var Vy=I(ln=>{"use strict";var s_=ln&&ln.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),ta=ln&&ln.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&s_(e,r,t)};Object.defineProperty(ln,"__esModule",{value:!0});ln.LSPErrorCodes=ln.createProtocolConnection=void 0;ta(di(),ln);ta(Ao(),ln);ta(ot(),ln);ta($y(),ln);var o_=Wy();Object.defineProperty(ln,"createProtocolConnection",{enumerable:!0,get:function(){return o_.createProtocolConnection}});var Hy;(function(r){r.lspReservedErrorRangeStart=-32899,r.RequestFailed=-32803,r.ServerCancelled=-32802,r.ContentModified=-32801,r.RequestCancelled=-32800,r.lspReservedErrorRangeEnd=-32800})(Hy||(ln.LSPErrorCodes=Hy={}))});var me=I(br=>{"use strict";var a_=br&&br.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),zy=br&&br.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&a_(e,r,t)};Object.defineProperty(br,"__esModule",{value:!0});br.createProtocolConnection=void 0;var c_=hd();zy(hd(),br);zy(Vy(),br);function u_(r,e,t,n){return(0,c_.createMessageConnection)(r,e,t,n)}br.createProtocolConnection=u_});var na=I(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.forEach=Bt.mapAsync=Bt.map=Bt.clearTestMode=Bt.setTestMode=Bt.Semaphore=Bt.Delayer=void 0;var Es=me(),xd=class{constructor(e){this.defaultDelay=e,this.timeout=void 0,this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0}trigger(e,t=this.defaultDelay){return this.task=e,t>=0&&this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise(n=>{this.onSuccess=n}).then(()=>{this.completionPromise=void 0,this.onSuccess=void 0;var n=this.task();return this.task=void 0,n})),(t>=0||this.timeout===void 0)&&(this.timeout=(0,Es.RAL)().timer.setTimeout(()=>{this.timeout=void 0,this.onSuccess(void 0)},t>=0?t:this.defaultDelay)),this.completionPromise}forceDelivery(){if(!this.completionPromise)return;this.cancelTimeout();let e=this.task();return this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0,e}isTriggered(){return this.timeout!==void 0}cancel(){this.cancelTimeout(),this.completionPromise=void 0}cancelTimeout(){this.timeout!==void 0&&(this.timeout.dispose(),this.timeout=void 0)}};Bt.Delayer=xd;var Id=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Es.RAL)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Bt.Semaphore=Id;var qd=!1;function d_(){qd=!0}Bt.setTestMode=d_;function l_(){qd=!1}Bt.clearTestMode=l_;var Ky=15,ks=class{constructor(e=Ky){this.yieldAfter=qd===!0?Math.max(e,2):Math.max(e,Ky),this.startTime=Date.now(),this.counter=0,this.total=0,this.counterInterval=1}start(){this.counter=0,this.total=0,this.counterInterval=1,this.startTime=Date.now()}shouldYield(){if(++this.counter>=this.counterInterval){let e=Date.now()-this.startTime,t=Math.max(0,this.yieldAfter-e);if(this.total+=this.counter,this.counter=0,e>=this.yieldAfter||t<=1)return this.counterInterval=1,this.total=0,!0;switch(e){case 0:case 1:this.counterInterval=this.total*2;break}}return!1}};async function f_(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new ks(n?.yieldAfter);function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=e(r[d]),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,Es.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}Bt.map=f_;async function h_(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new ks(n?.yieldAfter);async function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=await e(r[d],t),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=await o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,Es.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}Bt.mapAsync=h_;async function p_(r,e,t,n){if(r.length===0)return;let i=new ks(n?.yieldAfter);function s(a){i.start();for(let c=a;c<r.length;c++)if(e(r[c]),i.shouldYield())return n?.yieldCallback&&n.yieldCallback(),c+1;return-1}let o=s(0);for(;o!==-1&&!(t!==void 0&&t.isCancellationRequested);)o=await new Promise(a=>{(0,Es.RAL)().timer.setImmediate(()=>{a(s(o))})})}Bt.forEach=p_});var Ld=I(Fd=>{"use strict";Object.defineProperty(Fd,"__esModule",{value:!0});var g_=require("vscode"),Od=class extends g_.CompletionItem{constructor(e){super(e)}};Fd.default=Od});var Ad=I(Nd=>{"use strict";Object.defineProperty(Nd,"__esModule",{value:!0});var m_=require("vscode"),Md=class extends m_.CodeLens{constructor(e){super(e)}};Nd.default=Md});var Ud=I($d=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});var v_=require("vscode"),jd=class extends v_.DocumentLink{constructor(e,t){super(e,t)}};$d.default=jd});var Vd=I(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});var y_=require("vscode"),Wd=class extends y_.CodeAction{constructor(e,t){super(e),this.data=t}};Hd.default=Wd});var Bd=I(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.ProtocolDiagnostic=Bi.DiagnosticCode=void 0;var b_=require("vscode"),zd=zn(),By;(function(r){function e(t){let n=t;return n!=null&&(zd.number(n.value)||zd.string(n.value))&&zd.string(n.target)}r.is=e})(By||(Bi.DiagnosticCode=By={}));var Kd=class extends b_.Diagnostic{constructor(e,t,n,i){super(e,t,n),this.data=i,this.hasDiagnosticCode=!1}};Bi.ProtocolDiagnostic=Kd});var Xd=I(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});var w_=require("vscode"),Gd=class extends w_.CallHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Jd.default=Gd});var Zd=I(Yd=>{"use strict";Object.defineProperty(Yd,"__esModule",{value:!0});var C_=require("vscode"),Qd=class extends C_.TypeHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Yd.default=Qd});var nl=I(tl=>{"use strict";Object.defineProperty(tl,"__esModule",{value:!0});var ra=require("vscode"),el=class extends ra.SymbolInformation{constructor(e,t,n,i,s){let o=!(i instanceof ra.Uri);super(e,t,n,o?i:new ra.Location(i,new ra.Range(0,0,0,0))),this.hasRange=o,s!==void 0&&(this.data=s)}};tl.default=el});var sl=I(il=>{"use strict";Object.defineProperty(il,"__esModule",{value:!0});var R_=require("vscode"),rl=class extends R_.InlayHint{constructor(e,t,n){super(e,t,n)}};il.default=rl});var Qy=I(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.createConverter=void 0;var _t=require("vscode"),ve=me(),fi=zn(),Gy=na(),S_=Ld(),__=Ad(),T_=Ud(),Jy=Vd(),Xy=Bd(),P_=Xd(),D_=Zd(),k_=nl(),E_=sl(),ol;(function(r){function e(t){let n=t;return n&&!!n.inserting&&!!n.replacing}r.is=e})(ol||(ol={}));function x_(r){let t=r||(h=>h.toString());function n(h){return t(h)}function i(h){return{uri:t(h.uri)}}function s(h){return{uri:t(h.uri),languageId:h.languageId,version:h.version,text:h.getText()}}function o(h){return{uri:t(h.uri),version:h.version}}function a(h){return{textDocument:s(h)}}function c(h){let q=h;return!!q.document&&!!q.contentChanges}function d(h){let q=h;return!!q.uri&&!!q.version}function g(h,q,Y){if(d(h))return{textDocument:{uri:t(h.uri),version:h.version},contentChanges:[{text:h.getText()}]};if(c(h)){let Fe=q,P=Y;return{textDocument:{uri:t(Fe),version:P},contentChanges:h.contentChanges.map(R=>{let _=R.range;return{range:{start:{line:_.start.line,character:_.start.character},end:{line:_.end.line,character:_.end.character}},rangeLength:R.rangeLength,text:R.text}})}}else throw Error("Unsupported text document change parameter")}function v(h){return{textDocument:i(h)}}function m(h,q=!1){let Y={textDocument:i(h)};return q&&(Y.text=h.getText()),Y}function S(h){switch(h){case _t.TextDocumentSaveReason.Manual:return ve.TextDocumentSaveReason.Manual;case _t.TextDocumentSaveReason.AfterDelay:return ve.TextDocumentSaveReason.AfterDelay;case _t.TextDocumentSaveReason.FocusOut:return ve.TextDocumentSaveReason.FocusOut}return ve.TextDocumentSaveReason.Manual}function b(h){return{textDocument:i(h.document),reason:S(h.reason)}}function E(h){return{files:h.files.map(q=>({uri:t(q)}))}}function x(h){return{files:h.files.map(q=>({oldUri:t(q.oldUri),newUri:t(q.newUri)}))}}function $(h){return{files:h.files.map(q=>({uri:t(q)}))}}function U(h){return{files:h.files.map(q=>({uri:t(q)}))}}function M(h){return{files:h.files.map(q=>({oldUri:t(q.oldUri),newUri:t(q.newUri)}))}}function z(h){return{files:h.files.map(q=>({uri:t(q)}))}}function B(h,q){return{textDocument:i(h),position:kt(q)}}function pe(h){switch(h){case _t.CompletionTriggerKind.TriggerCharacter:return ve.CompletionTriggerKind.TriggerCharacter;case _t.CompletionTriggerKind.TriggerForIncompleteCompletions:return ve.CompletionTriggerKind.TriggerForIncompleteCompletions;default:return ve.CompletionTriggerKind.Invoked}}function J(h,q,Y){return{textDocument:i(h),position:kt(q),context:{triggerKind:pe(Y.triggerKind),triggerCharacter:Y.triggerCharacter}}}function ce(h){switch(h){case _t.SignatureHelpTriggerKind.Invoke:return ve.SignatureHelpTriggerKind.Invoked;case _t.SignatureHelpTriggerKind.TriggerCharacter:return ve.SignatureHelpTriggerKind.TriggerCharacter;case _t.SignatureHelpTriggerKind.ContentChange:return ve.SignatureHelpTriggerKind.ContentChange}}function Re(h){return{label:h.label}}function it(h){return h.map(Re)}function Ze(h){return{label:h.label,parameters:it(h.parameters)}}function $e(h){return h.map(Ze)}function Zt(h){return h===void 0?h:{signatures:$e(h.signatures),activeSignature:h.activeSignature,activeParameter:h.activeParameter}}function At(h,q,Y){return{textDocument:i(h),position:kt(q),context:{isRetrigger:Y.isRetrigger,triggerCharacter:Y.triggerCharacter,triggerKind:ce(Y.triggerKind),activeSignatureHelp:Zt(Y.activeSignatureHelp)}}}function kt(h){return{line:h.line,character:h.character}}function Et(h){return h==null?h:{line:h.line>ve.uinteger.MAX_VALUE?ve.uinteger.MAX_VALUE:h.line,character:h.character>ve.uinteger.MAX_VALUE?ve.uinteger.MAX_VALUE:h.character}}function bn(h,q){return Gy.map(h,Et,q)}function wn(h){return h.map(Et)}function Ue(h){return h==null?h:{start:Et(h.start),end:Et(h.end)}}function Ct(h){return h.map(Ue)}function Ot(h){return h==null?h:ve.Location.create(n(h.uri),Ue(h.range))}function xt(h){switch(h){case _t.DiagnosticSeverity.Error:return ve.DiagnosticSeverity.Error;case _t.DiagnosticSeverity.Warning:return ve.DiagnosticSeverity.Warning;case _t.DiagnosticSeverity.Information:return ve.DiagnosticSeverity.Information;case _t.DiagnosticSeverity.Hint:return ve.DiagnosticSeverity.Hint}}function lr(h){if(!h)return;let q=[];for(let Y of h){let Fe=Cn(Y);Fe!==void 0&&q.push(Fe)}return q.length>0?q:void 0}function Cn(h){switch(h){case _t.DiagnosticTag.Unnecessary:return ve.DiagnosticTag.Unnecessary;case _t.DiagnosticTag.Deprecated:return ve.DiagnosticTag.Deprecated;default:return}}function Rn(h){return{message:h.message,location:Ot(h.location)}}function er(h){return h.map(Rn)}function fr(h){if(h!=null)return fi.number(h)||fi.string(h)?h:{value:h.value,target:n(h.target)}}function $n(h){let q=ve.Diagnostic.create(Ue(h.range),h.message),Y=h instanceof Xy.ProtocolDiagnostic?h:void 0;Y!==void 0&&Y.data!==void 0&&(q.data=Y.data);let Fe=fr(h.code);return Xy.DiagnosticCode.is(Fe)?Y!==void 0&&Y.hasDiagnosticCode?q.code=Fe:(q.code=Fe.value,q.codeDescription={href:Fe.target}):q.code=Fe,fi.number(h.severity)&&(q.severity=xt(h.severity)),Array.isArray(h.tags)&&(q.tags=lr(h.tags)),h.relatedInformation&&(q.relatedInformation=er(h.relatedInformation)),h.source&&(q.source=h.source),q}function Sn(h,q){return h==null?h:Gy.map(h,$n,q)}function _n(h){return h==null?h:h.map($n)}function Un(h,q){switch(h){case"$string":return q;case ve.MarkupKind.PlainText:return{kind:h,value:q};case ve.MarkupKind.Markdown:return{kind:h,value:q.value};default:return`Unsupported Markup content received. Kind is: ${h}`}}function We(h){if(h===_t.CompletionItemTag.Deprecated)return ve.CompletionItemTag.Deprecated}function tr(h){if(h===void 0)return h;let q=[];for(let Y of h){let Fe=We(Y);Fe!==void 0&&q.push(Fe)}return q}function Tn(h,q){return q!==void 0?q:h+1}function jt(h,q=!1){let Y,Fe;fi.string(h.label)?Y=h.label:(Y=h.label.label,q&&(h.label.detail!==void 0||h.label.description!==void 0)&&(Fe={detail:h.label.detail,description:h.label.description}));let P={label:Y};Fe!==void 0&&(P.labelDetails=Fe);let p=h instanceof S_.default?h:void 0;h.detail&&(P.detail=h.detail),h.documentation&&(!p||p.documentationFormat==="$string"?P.documentation=h.documentation:P.documentation=Un(p.documentationFormat,h.documentation)),h.filterText&&(P.filterText=h.filterText),hr(P,h),fi.number(h.kind)&&(P.kind=Tn(h.kind,p&&p.originalItemKind)),h.sortText&&(P.sortText=h.sortText),h.additionalTextEdits&&(P.additionalTextEdits=Ke(h.additionalTextEdits)),h.commitCharacters&&(P.commitCharacters=h.commitCharacters.slice()),h.command&&(P.command=O(h.command)),(h.preselect===!0||h.preselect===!1)&&(P.preselect=h.preselect);let R=tr(h.tags);if(p){if(p.data!==void 0&&(P.data=p.data),p.deprecated===!0||p.deprecated===!1){if(p.deprecated===!0&&R!==void 0&&R.length>0){let _=R.indexOf(_t.CompletionItemTag.Deprecated);_!==-1&&R.splice(_,1)}P.deprecated=p.deprecated}p.insertTextMode!==void 0&&(P.insertTextMode=p.insertTextMode)}return R!==void 0&&R.length>0&&(P.tags=R),P.insertTextMode===void 0&&h.keepWhitespace===!0&&(P.insertTextMode=ve.InsertTextMode.adjustIndentation),P}function hr(h,q){let Y=ve.InsertTextFormat.PlainText,Fe,P;q.textEdit?(Fe=q.textEdit.newText,P=q.textEdit.range):q.insertText instanceof _t.SnippetString?(Y=ve.InsertTextFormat.Snippet,Fe=q.insertText.value):Fe=q.insertText,q.range&&(P=q.range),h.insertTextFormat=Y,q.fromEdit&&Fe!==void 0&&P!==void 0?h.textEdit=Ht(Fe,P):h.insertText=Fe}function Ht(h,q){return ol.is(q)?ve.InsertReplaceEdit.create(h,Ue(q.inserting),Ue(q.replacing)):{newText:h,range:Ue(q)}}function Wn(h){return{range:Ue(h.range),newText:h.newText}}function Ke(h){return h==null?h:h.map(Wn)}function gt(h){return h<=_t.SymbolKind.TypeParameter?h+1:ve.SymbolKind.Property}function It(h){return h}function en(h){return h.map(It)}function Rt(h,q,Y){return{textDocument:i(h),position:kt(q),context:{includeDeclaration:Y.includeDeclaration}}}async function Pn(h,q){let Y=ve.CodeAction.create(h.title);if(h instanceof Jy.default&&h.data!==void 0&&(Y.data=h.data),h.kind!==void 0&&(Y.kind=l(h.kind)),h.diagnostics!==void 0&&(Y.diagnostics=await Sn(h.diagnostics,q)),h.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return h.command!==void 0&&(Y.command=O(h.command)),h.isPreferred!==void 0&&(Y.isPreferred=h.isPreferred),h.disabled!==void 0&&(Y.disabled={reason:h.disabled.reason}),Y}function Hn(h){let q=ve.CodeAction.create(h.title);if(h instanceof Jy.default&&h.data!==void 0&&(q.data=h.data),h.kind!==void 0&&(q.kind=l(h.kind)),h.diagnostics!==void 0&&(q.diagnostics=_n(h.diagnostics)),h.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return h.command!==void 0&&(q.command=O(h.command)),h.isPreferred!==void 0&&(q.isPreferred=h.isPreferred),h.disabled!==void 0&&(q.disabled={reason:h.disabled.reason}),q}async function tn(h,q){if(h==null)return h;let Y;return h.only&&fi.string(h.only.value)&&(Y=[h.only.value]),ve.CodeActionContext.create(await Sn(h.diagnostics,q),Y,mt(h.triggerKind))}function Vn(h){if(h==null)return h;let q;return h.only&&fi.string(h.only.value)&&(q=[h.only.value]),ve.CodeActionContext.create(_n(h.diagnostics),q,mt(h.triggerKind))}function mt(h){switch(h){case _t.CodeActionTriggerKind.Invoke:return ve.CodeActionTriggerKind.Invoked;case _t.CodeActionTriggerKind.Automatic:return ve.CodeActionTriggerKind.Automatic;default:return}}function l(h){if(h!=null)return h.value}function C(h){return h==null?h:ve.InlineValueContext.create(h.frameId,Ue(h.stoppedLocation))}function D(h,q,Y){return{context:ve.InlineCompletionContext.create(Y.triggerKind,Y.selectedCompletionInfo),textDocument:i(h),position:Et(q)}}function O(h){let q=ve.Command.create(h.title,h.command);return h.arguments&&(q.arguments=h.arguments),q}function ne(h){let q=ve.CodeLens.create(Ue(h.range));return h.command&&(q.command=O(h.command)),h instanceof __.default&&h.data&&(q.data=h.data),q}function ee(h,q){let Y={tabSize:h.tabSize,insertSpaces:h.insertSpaces};return q.trimTrailingWhitespace&&(Y.trimTrailingWhitespace=!0),q.trimFinalNewlines&&(Y.trimFinalNewlines=!0),q.insertFinalNewline&&(Y.insertFinalNewline=!0),Y}function ae(h){return{textDocument:i(h)}}function ue(h){return{textDocument:i(h)}}function G(h){let q=ve.DocumentLink.create(Ue(h.range));h.target&&(q.target=n(h.target)),h.tooltip!==void 0&&(q.tooltip=h.tooltip);let Y=h instanceof T_.default?h:void 0;return Y&&Y.data&&(q.data=Y.data),q}function ie(h){return{textDocument:i(h)}}function Z(h){let q={name:h.name,kind:gt(h.kind),uri:n(h.uri),range:Ue(h.range),selectionRange:Ue(h.selectionRange)};return h.detail!==void 0&&h.detail.length>0&&(q.detail=h.detail),h.tags!==void 0&&(q.tags=en(h.tags)),h instanceof P_.default&&h.data!==void 0&&(q.data=h.data),q}function he(h){let q={name:h.name,kind:gt(h.kind),uri:n(h.uri),range:Ue(h.range),selectionRange:Ue(h.selectionRange)};return h.detail!==void 0&&h.detail.length>0&&(q.detail=h.detail),h.tags!==void 0&&(q.tags=en(h.tags)),h instanceof D_.default&&h.data!==void 0&&(q.data=h.data),q}function _e(h){let q=h instanceof k_.default?{name:h.name,kind:gt(h.kind),location:h.hasRange?Ot(h.location):{uri:t(h.location.uri)},data:h.data}:{name:h.name,kind:gt(h.kind),location:Ot(h.location)};return h.tags!==void 0&&(q.tags=en(h.tags)),h.containerName!==""&&(q.containerName=h.containerName),q}function He(h){let q=typeof h.label=="string"?h.label:h.label.map(pr),Y=ve.InlayHint.create(Et(h.position),q);return h.kind!==void 0&&(Y.kind=h.kind),h.textEdits!==void 0&&(Y.textEdits=Ke(h.textEdits)),h.tooltip!==void 0&&(Y.tooltip=Nr(h.tooltip)),h.paddingLeft!==void 0&&(Y.paddingLeft=h.paddingLeft),h.paddingRight!==void 0&&(Y.paddingRight=h.paddingRight),h instanceof E_.default&&h.data!==void 0&&(Y.data=h.data),Y}function pr(h){let q=ve.InlayHintLabelPart.create(h.value);return h.location!==void 0&&(q.location=Ot(h.location)),h.command!==void 0&&(q.command=O(h.command)),h.tooltip!==void 0&&(q.tooltip=Nr(h.tooltip)),q}function Nr(h){return typeof h=="string"?h:{kind:ve.MarkupKind.Markdown,value:h.value}}return{asUri:n,asTextDocumentIdentifier:i,asTextDocumentItem:s,asVersionedTextDocumentIdentifier:o,asOpenTextDocumentParams:a,asChangeTextDocumentParams:g,asCloseTextDocumentParams:v,asSaveTextDocumentParams:m,asWillSaveTextDocumentParams:b,asDidCreateFilesParams:E,asDidRenameFilesParams:x,asDidDeleteFilesParams:$,asWillCreateFilesParams:U,asWillRenameFilesParams:M,asWillDeleteFilesParams:z,asTextDocumentPositionParams:B,asCompletionParams:J,asSignatureHelpParams:At,asWorkerPosition:kt,asRange:Ue,asRanges:Ct,asPosition:Et,asPositions:bn,asPositionsSync:wn,asLocation:Ot,asDiagnosticSeverity:xt,asDiagnosticTag:Cn,asDiagnostic:$n,asDiagnostics:Sn,asDiagnosticsSync:_n,asCompletionItem:jt,asTextEdit:Wn,asSymbolKind:gt,asSymbolTag:It,asSymbolTags:en,asReferenceParams:Rt,asCodeAction:Pn,asCodeActionSync:Hn,asCodeActionContext:tn,asCodeActionContextSync:Vn,asInlineValueContext:C,asCommand:O,asCodeLens:ne,asFormattingOptions:ee,asDocumentSymbolParams:ae,asCodeLensParams:ue,asDocumentLink:G,asDocumentLinkParams:ie,asCallHierarchyItem:Z,asTypeHierarchyItem:he,asInlayHint:He,asWorkspaceSymbol:_e,asInlineCompletionParams:D}}ia.createConverter=x_});var eb=I(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.createConverter=void 0;var K=require("vscode"),le=me(),Gn=zn(),qe=na(),I_=Ld(),q_=Ad(),O_=Ud(),F_=Vd(),Yy=Bd(),L_=Xd(),M_=Zd(),N_=nl(),A_=sl(),Zy=me(),sa;(function(r){function e(t){let n=t;return n&&Gn.string(n.language)&&Gn.string(n.value)}r.is=e})(sa||(sa={}));function j_(r,e,t){let i=r||(u=>K.Uri.parse(u));function s(u){return i(u)}function o(u){let T=[];for(let j of u)if(typeof j=="string")T.push(j);else if(Zy.NotebookCellTextDocumentFilter.is(j))if(typeof j.notebook=="string")T.push({notebookType:j.notebook,language:j.language});else{let te=j.notebook.notebookType??"*";T.push({notebookType:te,scheme:j.notebook.scheme,pattern:j.notebook.pattern,language:j.language})}else Zy.TextDocumentFilter.is(j)&&T.push({language:j.language,scheme:j.scheme,pattern:j.pattern});return T}async function a(u,T){return qe.map(u,d,T)}function c(u){let T=new Array(u.length);for(let j=0;j<u.length;j++)T[j]=d(u[j]);return T}function d(u){let T=new Yy.ProtocolDiagnostic(b(u.range),u.message,x(u.severity),u.data);if(u.code!==void 0){if(typeof u.code=="string"||typeof u.code=="number")le.CodeDescription.is(u.codeDescription)?T.code={value:u.code,target:s(u.codeDescription.href)}:T.code=u.code;else if(Yy.DiagnosticCode.is(u.code)){T.hasDiagnosticCode=!0;let j=u.code;T.code={value:j.value,target:s(j.target)}}}return u.source&&(T.source=u.source),u.relatedInformation&&(T.relatedInformation=g(u.relatedInformation)),Array.isArray(u.tags)&&(T.tags=v(u.tags)),T}function g(u){let T=new Array(u.length);for(let j=0;j<u.length;j++){let te=u[j];T[j]=new K.DiagnosticRelatedInformation(xt(te.location),te.message)}return T}function v(u){if(!u)return;let T=[];for(let j of u){let te=m(j);te!==void 0&&T.push(te)}return T.length>0?T:void 0}function m(u){switch(u){case le.DiagnosticTag.Unnecessary:return K.DiagnosticTag.Unnecessary;case le.DiagnosticTag.Deprecated:return K.DiagnosticTag.Deprecated;default:return}}function S(u){return u?new K.Position(u.line,u.character):void 0}function b(u){return u?new K.Range(u.start.line,u.start.character,u.end.line,u.end.character):void 0}async function E(u,T){return qe.map(u,j=>new K.Range(j.start.line,j.start.character,j.end.line,j.end.character),T)}function x(u){if(u==null)return K.DiagnosticSeverity.Error;switch(u){case le.DiagnosticSeverity.Error:return K.DiagnosticSeverity.Error;case le.DiagnosticSeverity.Warning:return K.DiagnosticSeverity.Warning;case le.DiagnosticSeverity.Information:return K.DiagnosticSeverity.Information;case le.DiagnosticSeverity.Hint:return K.DiagnosticSeverity.Hint}return K.DiagnosticSeverity.Error}function $(u){if(Gn.string(u))return M(u);if(sa.is(u))return M().appendCodeblock(u.value,u.language);if(Array.isArray(u)){let T=[];for(let j of u){let te=M();sa.is(j)?te.appendCodeblock(j.value,j.language):te.appendMarkdown(j),T.push(te)}return T}else return M(u)}function U(u){if(Gn.string(u))return u;switch(u.kind){case le.MarkupKind.Markdown:return M(u.value);case le.MarkupKind.PlainText:return u.value;default:return`Unsupported Markup content received. Kind is: ${u.kind}`}}function M(u){let T;if(u===void 0||typeof u=="string")T=new K.MarkdownString(u);else switch(u.kind){case le.MarkupKind.Markdown:T=new K.MarkdownString(u.value);break;case le.MarkupKind.PlainText:T=new K.MarkdownString,T.appendText(u.value);break;default:T=new K.MarkdownString,T.appendText(`Unsupported Markup content received. Kind is: ${u.kind}`);break}return T.isTrusted=e,T.supportHtml=t,T}function z(u){if(u)return new K.Hover($(u.contents),b(u.range))}async function B(u,T,j){if(!u)return;if(Array.isArray(u))return qe.map(u,mr=>it(mr,T),j);let te=u,{defaultRange:Ft,commitCharacters:$t}=pe(te,T),Ve=await qe.map(te.items,mr=>it(mr,$t,Ft,te.itemDefaults?.insertTextMode,te.itemDefaults?.insertTextFormat,te.itemDefaults?.data),j);return new K.CompletionList(Ve,te.isIncomplete)}function pe(u,T){let j=u.itemDefaults?.editRange,te=u.itemDefaults?.commitCharacters??T;return le.Range.is(j)?{defaultRange:b(j),commitCharacters:te}:j!==void 0?{defaultRange:{inserting:b(j.insert),replacing:b(j.replace)},commitCharacters:te}:{defaultRange:void 0,commitCharacters:te}}function J(u){return le.CompletionItemKind.Text<=u&&u<=le.CompletionItemKind.TypeParameter?[u-1,void 0]:[K.CompletionItemKind.Text,u]}function ce(u){if(u===le.CompletionItemTag.Deprecated)return K.CompletionItemTag.Deprecated}function Re(u){if(u==null)return[];let T=[];for(let j of u){let te=ce(j);te!==void 0&&T.push(te)}return T}function it(u,T,j,te,Ft,$t){let Ve=Re(u.tags),mr=Ze(u),Ge=new I_.default(mr);u.detail&&(Ge.detail=u.detail),u.documentation&&(Ge.documentation=U(u.documentation),Ge.documentationFormat=Gn.string(u.documentation)?"$string":u.documentation.kind),u.filterText&&(Ge.filterText=u.filterText);let po=$e(u,j,Ft);if(po&&(Ge.insertText=po.text,Ge.range=po.range,Ge.fromEdit=po.fromEdit),Gn.number(u.kind)){let[BR,lg]=J(u.kind);Ge.kind=BR,lg&&(Ge.originalItemKind=lg)}u.sortText&&(Ge.sortText=u.sortText),u.additionalTextEdits&&(Ge.additionalTextEdits=Et(u.additionalTextEdits));let ug=u.commitCharacters!==void 0?Gn.stringArray(u.commitCharacters)?u.commitCharacters:void 0:T;ug&&(Ge.commitCharacters=ug.slice()),u.command&&(Ge.command=Ke(u.command)),(u.deprecated===!0||u.deprecated===!1)&&(Ge.deprecated=u.deprecated,u.deprecated===!0&&Ve.push(K.CompletionItemTag.Deprecated)),(u.preselect===!0||u.preselect===!1)&&(Ge.preselect=u.preselect);let dg=u.data??$t;dg!==void 0&&(Ge.data=dg),Ve.length>0&&(Ge.tags=Ve);let nu=u.insertTextMode??te;return nu!==void 0&&(Ge.insertTextMode=nu,nu===le.InsertTextMode.asIs&&(Ge.keepWhitespace=!0)),Ge}function Ze(u){return le.CompletionItemLabelDetails.is(u.labelDetails)?{label:u.label,detail:u.labelDetails.detail,description:u.labelDetails.description}:u.label}function $e(u,T,j){let te=u.insertTextFormat??j;if(u.textEdit!==void 0||T!==void 0){let[Ft,$t]=u.textEdit!==void 0?Zt(u.textEdit):[T,u.textEditText??u.label];return te===le.InsertTextFormat.Snippet?{text:new K.SnippetString($t),range:Ft,fromEdit:!0}:{text:$t,range:Ft,fromEdit:!0}}else return u.insertText?te===le.InsertTextFormat.Snippet?{text:new K.SnippetString(u.insertText),fromEdit:!1}:{text:u.insertText,fromEdit:!1}:void 0}function Zt(u){return le.InsertReplaceEdit.is(u)?[{inserting:b(u.insert),replacing:b(u.replace)},u.newText]:[b(u.range),u.newText]}function At(u){if(u)return new K.TextEdit(b(u.range),u.newText)}async function kt(u,T){if(u)return qe.map(u,At,T)}function Et(u){if(!u)return;let T=new Array(u.length);for(let j=0;j<u.length;j++)T[j]=At(u[j]);return T}async function bn(u,T){if(!u)return;let j=new K.SignatureHelp;return Gn.number(u.activeSignature)?j.activeSignature=u.activeSignature:j.activeSignature=0,Gn.number(u.activeParameter)?j.activeParameter=u.activeParameter:j.activeParameter=0,u.signatures&&(j.signatures=await wn(u.signatures,T)),j}async function wn(u,T){return qe.mapAsync(u,Ue,T)}async function Ue(u,T){let j=new K.SignatureInformation(u.label);return u.documentation!==void 0&&(j.documentation=U(u.documentation)),u.parameters!==void 0&&(j.parameters=await Ct(u.parameters,T)),u.activeParameter!==void 0&&(j.activeParameter=u.activeParameter),j}function Ct(u,T){return qe.map(u,Ot,T)}function Ot(u){let T=new K.ParameterInformation(u.label);return u.documentation&&(T.documentation=U(u.documentation)),T}function xt(u){return u?new K.Location(i(u.uri),b(u.range)):void 0}async function lr(u,T){if(u)return er(u,T)}async function Cn(u,T){if(u)return er(u,T)}function Rn(u){if(!u)return;let T={targetUri:i(u.targetUri),targetRange:b(u.targetRange),originSelectionRange:b(u.originSelectionRange),targetSelectionRange:b(u.targetSelectionRange)};if(!T.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return T}async function er(u,T){if(u)if(Gn.array(u)){if(u.length===0)return[];if(le.LocationLink.is(u[0])){let j=u;return qe.map(j,Rn,T)}else{let j=u;return qe.map(j,xt,T)}}else return le.LocationLink.is(u)?[Rn(u)]:xt(u)}async function fr(u,T){if(u)return qe.map(u,xt,T)}async function $n(u,T){if(u)return qe.map(u,Sn,T)}function Sn(u){let T=new K.DocumentHighlight(b(u.range));return Gn.number(u.kind)&&(T.kind=_n(u.kind)),T}function _n(u){switch(u){case le.DocumentHighlightKind.Text:return K.DocumentHighlightKind.Text;case le.DocumentHighlightKind.Read:return K.DocumentHighlightKind.Read;case le.DocumentHighlightKind.Write:return K.DocumentHighlightKind.Write}return K.DocumentHighlightKind.Text}async function Un(u,T){if(u)return qe.map(u,jt,T)}function We(u){return u<=le.SymbolKind.TypeParameter?u-1:K.SymbolKind.Property}function tr(u){if(u===le.SymbolTag.Deprecated)return K.SymbolTag.Deprecated}function Tn(u){if(u==null)return;let T=[];for(let j of u){let te=tr(j);te!==void 0&&T.push(te)}return T.length===0?void 0:T}function jt(u){let T=u.data,j=u.location,te=j.range===void 0||T!==void 0?new N_.default(u.name,We(u.kind),u.containerName??"",j.range===void 0?i(j.uri):new K.Location(i(u.location.uri),b(j.range)),T):new K.SymbolInformation(u.name,We(u.kind),u.containerName??"",new K.Location(i(u.location.uri),b(j.range)));return Wn(te,u),te}async function hr(u,T){if(u!=null)return qe.map(u,Ht,T)}function Ht(u){let T=new K.DocumentSymbol(u.name,u.detail||"",We(u.kind),b(u.range),b(u.selectionRange));if(Wn(T,u),u.children!==void 0&&u.children.length>0){let j=[];for(let te of u.children)j.push(Ht(te));T.children=j}return T}function Wn(u,T){u.tags=Tn(T.tags),T.deprecated&&(u.tags?u.tags.includes(K.SymbolTag.Deprecated)||(u.tags=u.tags.concat(K.SymbolTag.Deprecated)):u.tags=[K.SymbolTag.Deprecated])}function Ke(u){let T={title:u.title,command:u.command};return u.arguments&&(T.arguments=u.arguments),T}async function gt(u,T){if(u)return qe.map(u,Ke,T)}let It=new Map;It.set(le.CodeActionKind.Empty,K.CodeActionKind.Empty),It.set(le.CodeActionKind.QuickFix,K.CodeActionKind.QuickFix),It.set(le.CodeActionKind.Refactor,K.CodeActionKind.Refactor),It.set(le.CodeActionKind.RefactorExtract,K.CodeActionKind.RefactorExtract),It.set(le.CodeActionKind.RefactorInline,K.CodeActionKind.RefactorInline),It.set(le.CodeActionKind.RefactorRewrite,K.CodeActionKind.RefactorRewrite),It.set(le.CodeActionKind.Source,K.CodeActionKind.Source),It.set(le.CodeActionKind.SourceOrganizeImports,K.CodeActionKind.SourceOrganizeImports);function en(u){if(u==null)return;let T=It.get(u);if(T)return T;let j=u.split(".");T=K.CodeActionKind.Empty;for(let te of j)T=T.append(te);return T}function Rt(u){if(u!=null)return u.map(T=>en(T))}async function Pn(u,T){if(u==null)return;let j=new F_.default(u.title,u.data);return u.kind!==void 0&&(j.kind=en(u.kind)),u.diagnostics!==void 0&&(j.diagnostics=c(u.diagnostics)),u.edit!==void 0&&(j.edit=await mt(u.edit,T)),u.command!==void 0&&(j.command=Ke(u.command)),u.isPreferred!==void 0&&(j.isPreferred=u.isPreferred),u.disabled!==void 0&&(j.disabled={reason:u.disabled.reason}),j}function Hn(u,T){return qe.mapAsync(u,async j=>le.Command.is(j)?Ke(j):Pn(j,T),T)}function tn(u){if(!u)return;let T=new q_.default(b(u.range));return u.command&&(T.command=Ke(u.command)),u.data!==void 0&&u.data!==null&&(T.data=u.data),T}async function Vn(u,T){if(u)return qe.map(u,tn,T)}async function mt(u,T){if(!u)return;let j=new Map;if(u.changeAnnotations!==void 0){let $t=u.changeAnnotations;await qe.forEach(Object.keys($t),Ve=>{let mr=l($t[Ve]);j.set(Ve,mr)},T)}let te=$t=>{if($t!==void 0)return j.get($t)},Ft=new K.WorkspaceEdit;if(u.documentChanges){let $t=u.documentChanges;await qe.forEach($t,Ve=>{if(le.CreateFile.is(Ve))Ft.createFile(i(Ve.uri),Ve.options,te(Ve.annotationId));else if(le.RenameFile.is(Ve))Ft.renameFile(i(Ve.oldUri),i(Ve.newUri),Ve.options,te(Ve.annotationId));else if(le.DeleteFile.is(Ve))Ft.deleteFile(i(Ve.uri),Ve.options,te(Ve.annotationId));else if(le.TextDocumentEdit.is(Ve)){let mr=i(Ve.textDocument.uri);for(let Ge of Ve.edits)le.AnnotatedTextEdit.is(Ge)?Ft.replace(mr,b(Ge.range),Ge.newText,te(Ge.annotationId)):Ft.replace(mr,b(Ge.range),Ge.newText)}else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(Ve,void 0,4)}`)},T)}else if(u.changes){let $t=u.changes;await qe.forEach(Object.keys($t),Ve=>{Ft.set(i(Ve),Et($t[Ve]))},T)}return Ft}function l(u){if(u!==void 0)return{label:u.label,needsConfirmation:!!u.needsConfirmation,description:u.description}}function C(u){let T=b(u.range),j=u.target?s(u.target):void 0,te=new O_.default(T,j);return u.tooltip!==void 0&&(te.tooltip=u.tooltip),u.data!==void 0&&u.data!==null&&(te.data=u.data),te}async function D(u,T){if(u)return qe.map(u,C,T)}function O(u){return new K.Color(u.red,u.green,u.blue,u.alpha)}function ne(u){return new K.ColorInformation(b(u.range),O(u.color))}async function ee(u,T){if(u)return qe.map(u,ne,T)}function ae(u){let T=new K.ColorPresentation(u.label);return T.additionalTextEdits=Et(u.additionalTextEdits),u.textEdit&&(T.textEdit=At(u.textEdit)),T}async function ue(u,T){if(u)return qe.map(u,ae,T)}function G(u){if(u)switch(u){case le.FoldingRangeKind.Comment:return K.FoldingRangeKind.Comment;case le.FoldingRangeKind.Imports:return K.FoldingRangeKind.Imports;case le.FoldingRangeKind.Region:return K.FoldingRangeKind.Region}}function ie(u){return new K.FoldingRange(u.startLine,u.endLine,G(u.kind))}async function Z(u,T){if(u)return qe.map(u,ie,T)}function he(u){return new K.SelectionRange(b(u.range),u.parent?he(u.parent):void 0)}async function _e(u,T){return Array.isArray(u)?qe.map(u,he,T):[]}function He(u){return le.InlineValueText.is(u)?new K.InlineValueText(b(u.range),u.text):le.InlineValueVariableLookup.is(u)?new K.InlineValueVariableLookup(b(u.range),u.variableName,u.caseSensitiveLookup):new K.InlineValueEvaluatableExpression(b(u.range),u.expression)}async function pr(u,T){return Array.isArray(u)?qe.map(u,He,T):[]}async function Nr(u,T){let j=typeof u.label=="string"?u.label:await qe.map(u.label,h,T),te=new A_.default(S(u.position),j);return u.kind!==void 0&&(te.kind=u.kind),u.textEdits!==void 0&&(te.textEdits=await kt(u.textEdits,T)),u.tooltip!==void 0&&(te.tooltip=q(u.tooltip)),u.paddingLeft!==void 0&&(te.paddingLeft=u.paddingLeft),u.paddingRight!==void 0&&(te.paddingRight=u.paddingRight),u.data!==void 0&&(te.data=u.data),te}function h(u){let T=new K.InlayHintLabelPart(u.value);return u.location!==void 0&&(T.location=xt(u.location)),u.tooltip!==void 0&&(T.tooltip=q(u.tooltip)),u.command!==void 0&&(T.command=Ke(u.command)),T}function q(u){return typeof u=="string"?u:M(u)}async function Y(u,T){if(Array.isArray(u))return qe.mapAsync(u,Nr,T)}function Fe(u){if(u===null)return;let T=new L_.default(We(u.kind),u.name,u.detail||"",s(u.uri),b(u.range),b(u.selectionRange),u.data);return u.tags!==void 0&&(T.tags=Tn(u.tags)),T}async function P(u,T){if(u!==null)return qe.map(u,Fe,T)}async function p(u,T){return new K.CallHierarchyIncomingCall(Fe(u.from),await E(u.fromRanges,T))}async function R(u,T){if(u!==null)return qe.mapAsync(u,p,T)}async function _(u,T){return new K.CallHierarchyOutgoingCall(Fe(u.to),await E(u.fromRanges,T))}async function y(u,T){if(u!==null)return qe.mapAsync(u,_,T)}async function f(u,T){if(u!=null)return new K.SemanticTokens(new Uint32Array(u.data),u.resultId)}function k(u){return new K.SemanticTokensEdit(u.start,u.deleteCount,u.data!==void 0?new Uint32Array(u.data):void 0)}async function A(u,T){if(u!=null)return new K.SemanticTokensEdits(u.edits.map(k),u.resultId)}function ge(u){return u}async function st(u,T){if(u!=null)return new K.LinkedEditingRanges(await E(u.ranges,T),Be(u.wordPattern))}function Be(u){if(u!=null)return new RegExp(u)}function an(u){if(u===null)return;let T=new M_.default(We(u.kind),u.name,u.detail||"",s(u.uri),b(u.range),b(u.selectionRange),u.data);return u.tags!==void 0&&(T.tags=Tn(u.tags)),T}async function Dn(u,T){if(u!==null)return qe.map(u,an,T)}function nr(u){if(Gn.string(u))return u;if(le.RelativePattern.is(u)){if(le.URI.is(u.baseUri))return new K.RelativePattern(s(u.baseUri),u.pattern);if(le.WorkspaceFolder.is(u.baseUri)){let T=K.workspace.getWorkspaceFolder(s(u.baseUri.uri));return T!==void 0?new K.RelativePattern(T,u.pattern):void 0}}}async function Pe(u,T){if(!u)return;if(Array.isArray(u))return qe.map(u,Ft=>gr(Ft),T);let j=u,te=await qe.map(j.items,Ft=>gr(Ft),T);return new K.InlineCompletionList(te)}function gr(u){let T;typeof u.insertText=="string"?T=u.insertText:T=new K.SnippetString(u.insertText.value);let j;u.command&&(j=Ke(u.command));let te=new K.InlineCompletionItem(T,b(u.range),j);return u.filterText&&(te.filterText=u.filterText),te}return{asUri:s,asDocumentSelector:o,asDiagnostics:a,asDiagnostic:d,asRange:b,asRanges:E,asPosition:S,asDiagnosticSeverity:x,asDiagnosticTag:m,asHover:z,asCompletionResult:B,asCompletionItem:it,asTextEdit:At,asTextEdits:kt,asSignatureHelp:bn,asSignatureInformations:wn,asSignatureInformation:Ue,asParameterInformations:Ct,asParameterInformation:Ot,asDeclarationResult:lr,asDefinitionResult:Cn,asLocation:xt,asReferences:fr,asDocumentHighlights:$n,asDocumentHighlight:Sn,asDocumentHighlightKind:_n,asSymbolKind:We,asSymbolTag:tr,asSymbolTags:Tn,asSymbolInformations:Un,asSymbolInformation:jt,asDocumentSymbols:hr,asDocumentSymbol:Ht,asCommand:Ke,asCommands:gt,asCodeAction:Pn,asCodeActionKind:en,asCodeActionKinds:Rt,asCodeActionResult:Hn,asCodeLens:tn,asCodeLenses:Vn,asWorkspaceEdit:mt,asDocumentLink:C,asDocumentLinks:D,asFoldingRangeKind:G,asFoldingRange:ie,asFoldingRanges:Z,asColor:O,asColorInformation:ne,asColorInformations:ee,asColorPresentation:ae,asColorPresentations:ue,asSelectionRange:he,asSelectionRanges:_e,asInlineValue:He,asInlineValues:pr,asInlayHint:Nr,asInlayHints:Y,asSemanticTokensLegend:ge,asSemanticTokens:f,asSemanticTokensEdit:k,asSemanticTokensEdits:A,asCallHierarchyItem:Fe,asCallHierarchyItems:P,asCallHierarchyIncomingCall:p,asCallHierarchyIncomingCalls:R,asCallHierarchyOutgoingCall:_,asCallHierarchyOutgoingCalls:y,asLinkedEditingRanges:st,asTypeHierarchyItem:an,asTypeHierarchyItems:Dn,asGlobPattern:nr,asInlineCompletionResult:Pe,asInlineCompletionItem:gr}}oa.createConverter=j_});var at=I(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.generateUuid=Jn.parse=Jn.isUUID=Jn.v4=Jn.empty=void 0;var xs=class{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}},Is=class r extends xs{static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return r._oneOf(r._chars)}constructor(){super([r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-","4",r._randomHex(),r._randomHex(),r._randomHex(),"-",r._oneOf(r._timeHighBits),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex()].join(""))}};Is._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];Is._timeHighBits=["8","9","a","b"];Jn.empty=new xs("00000000-0000-0000-0000-000000000000");function tb(){return new Is}Jn.v4=tb;var $_=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function nb(r){return $_.test(r)}Jn.isUUID=nb;function U_(r){if(!nb(r))throw new Error("invalid uuid");return new xs(r)}Jn.parse=U_;function W_(){return tb().asHex()}Jn.generateUuid=W_});var cl=I(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.ProgressPart=void 0;var rb=require("vscode"),ib=me(),sb=zn(),al=class{constructor(e,t,n){this._client=e,this._token=t,this._reported=0,this._infinite=!1,this._lspProgressDisposable=this._client.onProgress(ib.WorkDoneProgress.type,this._token,i=>{switch(i.kind){case"begin":this.begin(i);break;case"report":this.report(i);break;case"end":this.done(),n&&n(this);break}})}begin(e){this._infinite=e.percentage===void 0,this._lspProgressDisposable!==void 0&&rb.window.withProgress({location:rb.ProgressLocation.Window,cancellable:e.cancellable,title:e.title},async(t,n)=>{if(this._lspProgressDisposable!==void 0)return this._progress=t,this._cancellationToken=n,this._tokenDisposable=this._cancellationToken.onCancellationRequested(()=>{this._client.sendNotification(ib.WorkDoneProgressCancelNotification.type,{token:this._token})}),this.report(e),new Promise((i,s)=>{this._resolve=i,this._reject=s})})}report(e){if(this._infinite&&sb.string(e.message))this._progress!==void 0&&this._progress.report({message:e.message});else if(sb.number(e.percentage)){let t=Math.max(0,Math.min(e.percentage,100)),n=Math.max(0,t-this._reported);this._reported+=n,this._progress!==void 0&&this._progress.report({message:e.message,increment:n})}}cancel(){this.cleanup(),this._reject!==void 0&&(this._reject(),this._resolve=void 0,this._reject=void 0)}done(){this.cleanup(),this._resolve!==void 0&&(this._resolve(),this._resolve=void 0,this._reject=void 0)}cleanup(){this._lspProgressDisposable!==void 0&&(this._lspProgressDisposable.dispose(),this._lspProgressDisposable=void 0),this._tokenDisposable!==void 0&&(this._tokenDisposable.dispose(),this._tokenDisposable=void 0),this._progress=void 0,this._cancellationToken=void 0}};aa.ProgressPart=al});var Ie=I(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.WorkspaceFeature=Mt.TextDocumentLanguageFeature=Mt.TextDocumentEventFeature=Mt.DynamicDocumentFeature=Mt.DynamicFeature=Mt.StaticFeature=Mt.ensure=Mt.LSPCancellationError=void 0;var hi=require("vscode"),ul=me(),nn=zn(),ob=at(),dl=class extends hi.CancellationError{constructor(e){super(),this.data=e}};Mt.LSPCancellationError=dl;function H_(r,e){return r[e]===void 0&&(r[e]={}),r[e]}Mt.ensure=H_;var ab;(function(r){function e(t){let n=t;return n!=null&&nn.func(n.fillClientCapabilities)&&nn.func(n.initialize)&&nn.func(n.getState)&&nn.func(n.clear)&&(n.fillInitializeParams===void 0||nn.func(n.fillInitializeParams))}r.is=e})(ab||(Mt.StaticFeature=ab={}));var cb;(function(r){function e(t){let n=t;return n!=null&&nn.func(n.fillClientCapabilities)&&nn.func(n.initialize)&&nn.func(n.getState)&&nn.func(n.clear)&&(n.fillInitializeParams===void 0||nn.func(n.fillInitializeParams))&&nn.func(n.register)&&nn.func(n.unregister)&&n.registrationType!==void 0}r.is=e})(cb||(Mt.DynamicFeature=cb={}));var qs=class{constructor(e){this._client=e}getState(){let e=this.getDocumentSelectors(),t=0;for(let i of e){t++;for(let s of hi.workspace.textDocuments)if(hi.languages.match(i,s)>0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}let n=t>0;return{kind:"document",id:this.registrationType.method,registrations:n,matches:!1}}};Mt.DynamicDocumentFeature=qs;var ll=class extends qs{static textDocumentFilter(e,t){for(let n of e)if(hi.languages.match(n,t)>0)return!0;return!1}constructor(e,t,n,i,s,o,a){super(e),this._event=t,this._type=n,this._middleware=i,this._createParams=s,this._textDocument=o,this._selectorFilter=a,this._selectors=new Map,this._onNotificationSent=new hi.EventEmitter}getStateInfo(){return[this._selectors.values(),!1]}getDocumentSelectors(){return this._selectors.values()}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=this._event(t=>{this.callback(t).catch(n=>{this._client.error(`Sending document notification ${this._type.method} failed.`,n)})})),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}async callback(e){let t=async n=>{let i=this._createParams(n);await this._client.sendNotification(this._type,i),this.notificationSent(this.getTextDocument(n),this._type,i)};if(this.matches(e)){let n=this._middleware();return n?n(e,i=>t(i)):t(e)}}matches(e){return this._client.hasDedicatedTextSynchronizationFeature(this._textDocument(e))?!1:!this._selectorFilter||this._selectorFilter(this._selectors.values(),e)}get onNotificationSent(){return this._onNotificationSent.event}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._onNotificationSent.dispose(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getProvider(e){for(let t of this._selectors.values())if(hi.languages.match(t,e)>0)return{send:n=>this.callback(n)}}};Mt.TextDocumentEventFeature=ll;var fl=class extends qs{constructor(e,t){super(e),this._registrationType=t,this._registrations=new Map}*getDocumentSelectors(){for(let e of this._registrations.values()){let t=e.data.registerOptions.documentSelector;t!==null&&(yield this._client.protocol2CodeConverter.asDocumentSelector(t))}}get registrationType(){return this._registrationType}register(e){if(!e.registerOptions.documentSelector)return;let t=this.registerLanguageProvider(e.registerOptions,e.id);this._registrations.set(e.id,{disposable:t[0],data:e,provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getRegistration(e,t){if(t){if(ul.TextDocumentRegistrationOptions.is(t)){let n=ul.StaticRegistrationOptions.hasId(t)?t.id:ob.generateUuid(),i=t.documentSelector??e;if(i)return[n,Object.assign({},t,{documentSelector:i})]}else if(nn.boolean(t)&&t===!0||ul.WorkDoneProgressOptions.is(t)){if(!e)return[void 0,void 0];let n=nn.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e});return[ob.generateUuid(),n]}}else return[void 0,void 0];return[void 0,void 0]}getRegistrationOptions(e,t){if(!(!e||!t))return nn.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e})}getProvider(e){for(let t of this._registrations.values()){let n=t.data.registerOptions.documentSelector;if(n!==null&&hi.languages.match(this._client.protocol2CodeConverter.asDocumentSelector(n),e)>0)return t.provider}}getAllProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};Mt.TextDocumentLanguageFeature=fl;var hl=class{constructor(e,t){this._client=e,this._registrationType=t,this._registrations=new Map}getState(){let e=this._registrations.size>0;return{kind:"workspace",id:this._registrationType.method,registrations:e}}get registrationType(){return this._registrationType}register(e){let t=this.registerLanguageProvider(e.registerOptions);this._registrations.set(e.id,{disposable:t[0],provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};Mt.WorkspaceFeature=hl});var db=I((sx,ub)=>{var V_=typeof process=="object"&&process&&process.platform==="win32";ub.exports=V_?{sep:"\\"}:{sep:"/"}});var gb=I((ox,pb)=>{"use strict";pb.exports=fb;function fb(r,e,t){r instanceof RegExp&&(r=lb(r,t)),e instanceof RegExp&&(e=lb(e,t));var n=hb(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function lb(r,e){var t=e.match(r);return t?t[0]:null}fb.range=hb;function hb(r,e,t){var n,i,s,o,a,c=t.indexOf(r),d=t.indexOf(e,c+1),g=c;if(c>=0&&d>0){if(r===e)return[c,d];for(n=[],s=t.length;g>=0&&!a;)g==c?(n.push(g),c=t.indexOf(r,g+1)):n.length==1?a=[n.pop(),d]:(i=n.pop(),i<s&&(s=i,o=d),d=t.indexOf(e,g+1)),g=c<d&&c>=0?c:d;n.length&&(a=[s,o])}return a}});var Sb=I((ax,Rb)=>{var mb=gb();Rb.exports=B_;var vb="\0SLASH"+Math.random()+"\0",yb="\0OPEN"+Math.random()+"\0",gl="\0CLOSE"+Math.random()+"\0",bb="\0COMMA"+Math.random()+"\0",wb="\0PERIOD"+Math.random()+"\0";function pl(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function z_(r){return r.split("\\\\").join(vb).split("\\{").join(yb).split("\\}").join(gl).split("\\,").join(bb).split("\\.").join(wb)}function K_(r){return r.split(vb).join("\\").split(yb).join("{").split(gl).join("}").split(bb).join(",").split(wb).join(".")}function Cb(r){if(!r)return[""];var e=[],t=mb("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,s=t.post,o=n.split(",");o[o.length-1]+="{"+i+"}";var a=Cb(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function B_(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),Os(z_(r),!0).map(K_)):[]}function G_(r){return"{"+r+"}"}function J_(r){return/^-?0\d/.test(r)}function X_(r,e){return r<=e}function Q_(r,e){return r>=e}function Os(r,e){var t=[],n=mb("{","}",r);if(!n)return[r];var i=n.pre,s=n.post.length?Os(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<s.length;o++){var a=i+"{"+n.body+"}"+s[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),g=c||d,v=n.body.indexOf(",")>=0;if(!g&&!v)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+gl+n.post,Os(r)):[r];var m;if(g)m=n.body.split(/\.\./);else if(m=Cb(n.body),m.length===1&&(m=Os(m[0],!1).map(G_),m.length===1))return s.map(function(it){return n.pre+m[0]+it});var S;if(g){var b=pl(m[0]),E=pl(m[1]),x=Math.max(m[0].length,m[1].length),$=m.length==3?Math.abs(pl(m[2])):1,U=X_,M=E<b;M&&($*=-1,U=Q_);var z=m.some(J_);S=[];for(var B=b;U(B,E);B+=$){var pe;if(d)pe=String.fromCharCode(B),pe==="\\"&&(pe="");else if(pe=String(B),z){var J=x-pe.length;if(J>0){var ce=new Array(J+1).join("0");B<0?pe="-"+ce+pe.slice(1):pe=ce+pe}}S.push(pe)}}else{S=[];for(var Re=0;Re<m.length;Re++)S.push.apply(S,Os(m[Re],!1))}for(var Re=0;Re<S.length;Re++)for(var o=0;o<s.length;o++){var a=i+S[Re]+s[o];(!e||g||a)&&t.push(a)}}return t}});var ua=I((ux,wl)=>{var xn=wl.exports=(r,e,t={})=>(ca(e),!t.nocomment&&e.charAt(0)==="#"?!1:new Gi(e,t).match(r));wl.exports=xn;var yl=db();xn.sep=yl.sep;var sr=Symbol("globstar **");xn.GLOBSTAR=sr;var Y_=Sb(),_b={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},bl="[^/]",ml=bl+"*?",Z_="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",eT="(?:(?!(?:\\/|^)\\.).)*?",Db=r=>r.split("").reduce((e,t)=>(e[t]=!0,e),{}),Tb=Db("().*{}+?[]^$\\!"),tT=Db("[.("),Pb=/\/+/;xn.filter=(r,e={})=>(t,n,i)=>xn(t,r,e);var Br=(r,e={})=>{let t={};return Object.keys(r).forEach(n=>t[n]=r[n]),Object.keys(e).forEach(n=>t[n]=e[n]),t};xn.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return xn;let e=xn,t=(n,i,s)=>e(n,i,Br(r,s));return t.Minimatch=class extends e.Minimatch{constructor(i,s){super(i,Br(r,s))}},t.Minimatch.defaults=n=>e.defaults(Br(r,n)).Minimatch,t.filter=(n,i)=>e.filter(n,Br(r,i)),t.defaults=n=>e.defaults(Br(r,n)),t.makeRe=(n,i)=>e.makeRe(n,Br(r,i)),t.braceExpand=(n,i)=>e.braceExpand(n,Br(r,i)),t.match=(n,i,s)=>e.match(n,i,Br(r,s)),t};xn.braceExpand=(r,e)=>kb(r,e);var kb=(r,e={})=>(ca(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:Y_(r)),nT=1024*64,ca=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>nT)throw new TypeError("pattern is too long")},vl=Symbol("subparse");xn.makeRe=(r,e)=>new Gi(r,e||{}).makeRe();xn.match=(r,e,t={})=>{let n=new Gi(e,t);return r=r.filter(i=>n.match(i)),n.options.nonull&&!r.length&&r.push(e),r};var rT=r=>r.replace(/\\(.)/g,"$1"),iT=r=>r.replace(/\\([^-\]])/g,"$1"),sT=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),oT=r=>r.replace(/[[\]\\]/g,"\\$&"),Gi=class{constructor(e,t){ca(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let n=this.globSet=this.braceExpand();t.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,n),n=this.globParts=n.map(i=>i.split(Pb)),this.debug(this.pattern,n),n=n.map((i,s,o)=>i.map(this.parse,this)),this.debug(this.pattern,n),n=n.filter(i=>i.indexOf(!1)===-1),this.debug(this.pattern,n),this.set=n}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,t=!1,n=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,o=0,a=e.length,c=t.length;s<a&&o<c;s++,o++){this.debug("matchOne loop");var d=t[o],g=e[s];if(this.debug(t,d,g),d===!1)return!1;if(d===sr){this.debug("GLOBSTAR",[t,d,g]);var v=s,m=o+1;if(m===c){for(this.debug("** at the end");s<a;s++)if(e[s]==="."||e[s]===".."||!i.dot&&e[s].charAt(0)===".")return!1;return!0}for(;v<a;){var S=e[v];if(this.debug(`
globstar while`,e,v,t,m,S),this.matchOne(e.slice(v),t.slice(m),n))return this.debug("globstar found match!",v,a,S),!0;if(S==="."||S===".."||!i.dot&&S.charAt(0)==="."){this.debug("dot detected!",e,v,t,m);break}this.debug("globstar swallow a segment, and continue"),v++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,v,t,m),v===a))}var b;if(typeof d=="string"?(b=g===d,this.debug("string match",d,g,b)):(b=g.match(d),this.debug("pattern match",d,g,b)),!b)return!1}if(s===a&&o===c)return!0;if(s===a)return n;if(o===c)return s===a-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return kb(this.pattern,this.options)}parse(e,t){ca(e);let n=this.options;if(e==="**")if(n.noglobstar)e="*";else return sr;if(e==="")return"";let i="",s=!1,o=!1,a=[],c=[],d,g=!1,v=-1,m=-1,S,b,E,x=e.charAt(0)===".",$=n.dot||x,U=()=>x?"":$?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",M=J=>J.charAt(0)==="."?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",z=()=>{if(d){switch(d){case"*":i+=ml,s=!0;break;case"?":i+=bl,s=!0;break;default:i+="\\"+d;break}this.debug("clearStateChar %j %j",d,i),d=!1}};for(let J=0,ce;J<e.length&&(ce=e.charAt(J));J++){if(this.debug("%s	%s %s %j",e,J,i,ce),o){if(ce==="/")return!1;Tb[ce]&&(i+="\\"),i+=ce,o=!1;continue}switch(ce){case"/":return!1;case"\\":if(g&&e.charAt(J+1)==="-"){i+=ce;continue}z(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,J,i,ce),g){this.debug("  in class"),ce==="!"&&J===m+1&&(ce="^"),i+=ce;continue}this.debug("call clearStateChar %j",d),z(),d=ce,n.noext&&z();continue;case"(":{if(g){i+="(";continue}if(!d){i+="\\(";continue}let Re={type:d,start:J-1,reStart:i.length,open:_b[d].open,close:_b[d].close};this.debug(this.pattern,"	",Re),a.push(Re),i+=Re.open,Re.start===0&&Re.type!=="!"&&(x=!0,i+=M(e.slice(J+1))),this.debug("plType %j %j",d,i),d=!1;continue}case")":{let Re=a[a.length-1];if(g||!Re){i+="\\)";continue}a.pop(),z(),s=!0,b=Re,i+=b.close,b.type==="!"&&c.push(Object.assign(b,{reEnd:i.length}));continue}case"|":{let Re=a[a.length-1];if(g||!Re){i+="\\|";continue}z(),i+="|",Re.start===0&&Re.type!=="!"&&(x=!0,i+=M(e.slice(J+1)));continue}case"[":if(z(),g){i+="\\"+ce;continue}g=!0,m=J,v=i.length,i+=ce;continue;case"]":if(J===m+1||!g){i+="\\"+ce;continue}S=e.substring(m+1,J);try{RegExp("["+oT(iT(S))+"]"),i+=ce}catch{i=i.substring(0,v)+"(?:$.)"}s=!0,g=!1;continue;default:z(),Tb[ce]&&!(ce==="^"&&g)&&(i+="\\"),i+=ce;break}}for(g&&(S=e.slice(m+1),E=this.parse(S,vl),i=i.substring(0,v)+"\\["+E[0],s=s||E[1]),b=a.pop();b;b=a.pop()){let J;J=i.slice(b.reStart+b.open.length),this.debug("setting tail",i,b),J=J.replace(/((?:\\{2}){0,64})(\\?)\|/g,(Re,it,Ze)=>(Ze||(Ze="\\"),it+it+Ze+"|")),this.debug(`tail=%j
   %s`,J,J,b,i);let ce=b.type==="*"?ml:b.type==="?"?bl:"\\"+b.type;s=!0,i=i.slice(0,b.reStart)+ce+"\\("+J}z(),o&&(i+="\\\\");let B=tT[i.charAt(0)];for(let J=c.length-1;J>-1;J--){let ce=c[J],Re=i.slice(0,ce.reStart),it=i.slice(ce.reStart,ce.reEnd-8),Ze=i.slice(ce.reEnd),$e=i.slice(ce.reEnd-8,ce.reEnd)+Ze,Zt=Re.split(")").length,At=Re.split("(").length-Zt,kt=Ze;for(let bn=0;bn<At;bn++)kt=kt.replace(/\)[+*?]?/,"");Ze=kt;let Et=Ze===""&&t!==vl?"(?:$|\\/)":"";i=Re+it+Ze+Et+$e}if(i!==""&&s&&(i="(?=.)"+i),B&&(i=U()+i),t===vl)return[i,s];if(n.nocase&&!s&&(s=e.toUpperCase()!==e.toLowerCase()),!s)return rT(e);let pe=n.nocase?"i":"";try{return Object.assign(new RegExp("^"+i+"$",pe),{_glob:e,_src:i})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,n=t.noglobstar?ml:t.dot?Z_:eT,i=t.nocase?"i":"",s=e.map(o=>(o=o.map(a=>typeof a=="string"?sT(a):a===sr?sr:a._src).reduce((a,c)=>(a[a.length-1]===sr&&c===sr||a.push(c),a),[]),o.forEach((a,c)=>{a!==sr||o[c-1]===sr||(c===0?o.length>1?o[c+1]="(?:\\/|"+n+"\\/)?"+o[c+1]:o[c]=n:c===o.length-1?o[c-1]+="(?:\\/|"+n+")?":(o[c-1]+="(?:\\/|\\/"+n+"\\/)"+o[c+1],o[c+1]=sr))}),o.filter(a=>a!==sr).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,i)}catch{this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let n=this.options;yl.sep!=="/"&&(e=e.split(yl.sep).join("/")),e=e.split(Pb),this.debug(this.pattern,"split",e);let i=this.set;this.debug(this.pattern,"set",i);let s;for(let o=e.length-1;o>=0&&(s=e[o],!s);o--);for(let o=0;o<i.length;o++){let a=i[o],c=e;if(n.matchBase&&a.length===1&&(c=[s]),this.matchOne(c,a,t))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return xn.defaults(e).Minimatch}};xn.Minimatch=Gi});var kl=I(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.DiagnosticFeature=Gr.DiagnosticPullMode=Gr.vsdiag=void 0;var aT=ua(),De=require("vscode"),bt=me(),cT=at(),Cl=Ie();function da(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var Xn;(function(r){let e;(function(t){t.full="full",t.unChanged="unChanged"})(e=r.DocumentDiagnosticReportKind||(r.DocumentDiagnosticReportKind={}))})(Xn||(Gr.vsdiag=Xn={}));var la;(function(r){r.onType="onType",r.onSave="onSave"})(la||(Gr.DiagnosticPullMode=la={}));var Gt;(function(r){r.active="open",r.reschedule="reschedule",r.outDated="drop"})(Gt||(Gt={}));var Rl=class r{constructor(){this.open=new Set,this._onOpen=new De.EventEmitter,this._onClose=new De.EventEmitter,r.fillTabResources(this.open);let e=t=>{if(t.closed.length===0&&t.opened.length===0)return;let n=this.open,i=new Set;r.fillTabResources(i);let s=new Set,o=new Set(i);for(let a of n.values())i.has(a)?o.delete(a):s.add(a);if(this.open=i,s.size>0){let a=new Set;for(let c of s)a.add(De.Uri.parse(c));this._onClose.fire(a)}if(o.size>0){let a=new Set;for(let c of o)a.add(De.Uri.parse(c));this._onOpen.fire(a)}};De.window.tabGroups.onDidChangeTabs!==void 0?this.disposable=De.window.tabGroups.onDidChangeTabs(e):this.disposable={dispose:()=>{}}}get onClose(){return this._onClose.event}get onOpen(){return this._onOpen.event}dispose(){this.disposable.dispose()}isActive(e){return e instanceof De.Uri?De.window.activeTextEditor?.document.uri===e:De.window.activeTextEditor?.document===e}isVisible(e){let t=e instanceof De.Uri?e:e.uri;return this.open.has(t.toString())}getTabResources(){let e=new Set;return r.fillTabResources(new Set,e),e}static fillTabResources(e,t){let n=e??new Set;for(let i of De.window.tabGroups.all)for(let s of i.tabs){let o=s.input,a;o instanceof De.TabInputText?a=o.uri:o instanceof De.TabInputTextDiff?a=o.modified:o instanceof De.TabInputCustom&&(a=o.uri),a!==void 0&&!n.has(a.toString())&&(n.add(a.toString()),t!==void 0&&t.add(a))}}},qt;(function(r){r[r.document=1]="document",r[r.workspace=2]="workspace"})(qt||(qt={}));var kr;(function(r){function e(t){return t instanceof De.Uri?t.toString():t.uri.toString()}r.asKey=e})(kr||(kr={}));var Sl=class{constructor(){this.documentPullStates=new Map,this.workspacePullStates=new Map}track(e,t,n){let i=e===qt.document?this.documentPullStates:this.workspacePullStates,[s,o,a]=t instanceof De.Uri?[t.toString(),t,n]:[t.uri.toString(),t.uri,t.version],c=i.get(s);return c===void 0&&(c={document:o,pulledVersion:a,resultId:void 0},i.set(s,c)),c}update(e,t,n,i){let s=e===qt.document?this.documentPullStates:this.workspacePullStates,[o,a,c,d]=t instanceof De.Uri?[t.toString(),t,n,i]:[t.uri.toString(),t.uri,t.version,n],g=s.get(o);g===void 0?(g={document:a,pulledVersion:c,resultId:d},s.set(o,g)):(g.pulledVersion=c,g.resultId=d)}unTrack(e,t){let n=kr.asKey(t);(e===qt.document?this.documentPullStates:this.workspacePullStates).delete(n)}tracks(e,t){let n=kr.asKey(t);return(e===qt.document?this.documentPullStates:this.workspacePullStates).has(n)}getResultId(e,t){let n=kr.asKey(t);return(e===qt.document?this.documentPullStates:this.workspacePullStates).get(n)?.resultId}getAllResultIds(){let e=[];for(let[t,n]of this.workspacePullStates)this.documentPullStates.has(t)&&(n=this.documentPullStates.get(t)),n.resultId!==void 0&&e.push({uri:t,value:n.resultId});return e}},_l=class{constructor(e,t,n){this.client=e,this.tabs=t,this.options=n,this.isDisposed=!1,this.onDidChangeDiagnosticsEmitter=new De.EventEmitter,this.provider=this.createProvider(),this.diagnostics=De.languages.createDiagnosticCollection(n.identifier),this.openRequests=new Map,this.documentStates=new Sl,this.workspaceErrorCounter=0}knows(e,t){let n=t instanceof De.Uri?t:t.uri;return this.documentStates.tracks(e,t)||this.openRequests.has(n.toString())}forget(e,t){this.documentStates.unTrack(e,t)}pull(e,t){if(this.isDisposed)return;let n=e instanceof De.Uri?e:e.uri;this.pullAsync(e).then(()=>{t&&t()},i=>{this.client.error(`Document pull failed for text document ${n.toString()}`,i,!1)})}async pullAsync(e,t){if(this.isDisposed)return;let n=e instanceof De.Uri,i=n?e:e.uri,s=i.toString();t=n?t:e.version;let o=this.openRequests.get(s),a=n?this.documentStates.track(qt.document,e,t):this.documentStates.track(qt.document,e);if(o===void 0){let c=new De.CancellationTokenSource;this.openRequests.set(s,{state:Gt.active,document:e,version:t,tokenSource:c});let d,g;try{d=await this.provider.provideDiagnostics(e,a.resultId,c.token)??{kind:Xn.DocumentDiagnosticReportKind.full,items:[]}}catch(v){if(v instanceof Cl.LSPCancellationError&&bt.DiagnosticServerCancellationData.is(v.data)&&v.data.retriggerRequest===!1&&(g={state:Gt.outDated,document:e}),g===void 0&&v instanceof De.CancellationError)g={state:Gt.reschedule,document:e};else throw v}if(g=g??this.openRequests.get(s),g===void 0){this.client.error(`Lost request state in diagnostic pull model. Clearing diagnostics for ${s}`),this.diagnostics.delete(i);return}if(this.openRequests.delete(s),!this.tabs.isVisible(e)){this.documentStates.unTrack(qt.document,e);return}if(g.state===Gt.outDated)return;d!==void 0&&(d.kind===Xn.DocumentDiagnosticReportKind.full&&this.diagnostics.set(i,d.items),a.pulledVersion=t,a.resultId=d.resultId),g.state===Gt.reschedule&&this.pull(e)}else o.state===Gt.active?(o.tokenSource.cancel(),this.openRequests.set(s,{state:Gt.reschedule,document:o.document})):o.state===Gt.outDated&&this.openRequests.set(s,{state:Gt.reschedule,document:o.document})}forgetDocument(e){let t=e instanceof De.Uri?e:e.uri,n=t.toString(),i=this.openRequests.get(n);this.options.workspaceDiagnostics?i!==void 0?this.openRequests.set(n,{state:Gt.reschedule,document:e}):this.pull(e,()=>{this.forget(qt.document,e)}):(i!==void 0&&(i.state===Gt.active&&i.tokenSource.cancel(),this.openRequests.set(n,{state:Gt.outDated,document:e})),this.diagnostics.delete(t),this.forget(qt.document,e))}pullWorkspace(){this.isDisposed||this.pullWorkspaceAsync().then(()=>{this.workspaceTimeout=(0,bt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3)},e=>{!(e instanceof Cl.LSPCancellationError)&&!bt.DiagnosticServerCancellationData.is(e.data)&&(this.client.error("Workspace diagnostic pull failed.",e,!1),this.workspaceErrorCounter++),this.workspaceErrorCounter<=5&&(this.workspaceTimeout=(0,bt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3))})}async pullWorkspaceAsync(){if(!this.provider.provideWorkspaceDiagnostics||this.isDisposed)return;this.workspaceCancellation!==void 0&&(this.workspaceCancellation.cancel(),this.workspaceCancellation=void 0),this.workspaceCancellation=new De.CancellationTokenSource;let e=this.documentStates.getAllResultIds().map(t=>({uri:this.client.protocol2CodeConverter.asUri(t.uri),value:t.value}));await this.provider.provideWorkspaceDiagnostics(e,this.workspaceCancellation.token,t=>{if(!(!t||this.isDisposed))for(let n of t.items)n.kind===Xn.DocumentDiagnosticReportKind.full&&(this.documentStates.tracks(qt.document,n.uri)||this.diagnostics.set(n.uri,n.items)),this.documentStates.update(qt.workspace,n.uri,n.version??void 0,n.resultId)})}createProvider(){let e={onDidChangeDiagnostics:this.onDidChangeDiagnosticsEmitter.event,provideDiagnostics:(t,n,i)=>{let s=(a,c,d)=>{let g={identifier:this.options.identifier,textDocument:{uri:this.client.code2ProtocolConverter.asUri(a instanceof De.Uri?a:a.uri)},previousResultId:c};return this.isDisposed===!0||!this.client.isRunning()?{kind:Xn.DocumentDiagnosticReportKind.full,items:[]}:this.client.sendRequest(bt.DocumentDiagnosticRequest.type,g,d).then(async v=>v==null||this.isDisposed||d.isCancellationRequested?{kind:Xn.DocumentDiagnosticReportKind.full,items:[]}:v.kind===bt.DocumentDiagnosticReportKind.Full?{kind:Xn.DocumentDiagnosticReportKind.full,resultId:v.resultId,items:await this.client.protocol2CodeConverter.asDiagnostics(v.items,d)}:{kind:Xn.DocumentDiagnosticReportKind.unChanged,resultId:v.resultId},v=>this.client.handleFailedRequest(bt.DocumentDiagnosticRequest.type,d,v,{kind:Xn.DocumentDiagnosticReportKind.full,items:[]}))},o=this.client.middleware;return o.provideDiagnostics?o.provideDiagnostics(t,n,i,s):s(t,n,i)}};return this.options.workspaceDiagnostics&&(e.provideWorkspaceDiagnostics=(t,n,i)=>{let s=async d=>d.kind===bt.DocumentDiagnosticReportKind.Full?{kind:Xn.DocumentDiagnosticReportKind.full,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version,items:await this.client.protocol2CodeConverter.asDiagnostics(d.items,n)}:{kind:Xn.DocumentDiagnosticReportKind.unChanged,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version},o=d=>{let g=[];for(let v of d)g.push({uri:this.client.code2ProtocolConverter.asUri(v.uri),value:v.value});return g},a=(d,g)=>{let v=(0,cT.generateUuid)(),m=this.client.onProgress(bt.WorkspaceDiagnosticRequest.partialResult,v,async b=>{if(b==null){i(null);return}let E={items:[]};for(let x of b.items)try{E.items.push(await s(x))}catch($){this.client.error("Converting workspace diagnostics failed.",$)}i(E)}),S={identifier:this.options.identifier,previousResultIds:o(d),partialResultToken:v};return this.isDisposed===!0||!this.client.isRunning()?{items:[]}:this.client.sendRequest(bt.WorkspaceDiagnosticRequest.type,S,g).then(async b=>{if(g.isCancellationRequested)return{items:[]};let E={items:[]};for(let x of b.items)E.items.push(await s(x));return m.dispose(),i(E),{items:[]}},b=>(m.dispose(),this.client.handleFailedRequest(bt.DocumentDiagnosticRequest.type,g,b,{items:[]})))},c=this.client.middleware;return c.provideWorkspaceDiagnostics?c.provideWorkspaceDiagnostics(t,n,i,a):a(t,n,i)}),e}dispose(){this.isDisposed=!0,this.workspaceCancellation?.cancel(),this.workspaceTimeout?.dispose();for(let[e,t]of this.openRequests)t.state===Gt.active&&t.tokenSource.cancel(),this.openRequests.set(e,{state:Gt.outDated,document:t.document});this.diagnostics.dispose()}},Tl=class{constructor(e){this.diagnosticRequestor=e,this.documents=new bt.LinkedMap,this.isDisposed=!1}add(e){if(this.isDisposed===!0)return;let t=kr.asKey(e);this.documents.has(t)||(this.documents.set(t,e,bt.Touch.Last),this.trigger())}remove(e){let t=kr.asKey(e);this.documents.delete(t),this.documents.size===0?this.stop():t===this.endDocumentKey()&&(this.endDocument=this.documents.last)}trigger(){if(this.isDisposed!==!0){if(this.intervalHandle!==void 0){this.endDocument=this.documents.last;return}this.endDocument=this.documents.last,this.intervalHandle=(0,bt.RAL)().timer.setInterval(()=>{let e=this.documents.first;if(e!==void 0){let t=kr.asKey(e);this.diagnosticRequestor.pull(e),this.documents.set(t,e,bt.Touch.Last),t===this.endDocumentKey()&&this.stop()}},200)}}dispose(){this.isDisposed=!0,this.stop(),this.documents.clear()}stop(){this.intervalHandle?.dispose(),this.intervalHandle=void 0,this.endDocument=void 0}endDocumentKey(){return this.endDocument!==void 0?kr.asKey(this.endDocument):void 0}},Pl=class{constructor(e,t,n){let i=e.clientOptions.diagnosticPullOptions??{onChange:!0,onSave:!1},s=e.protocol2CodeConverter.asDocumentSelector(n.documentSelector),o=[],a=b=>{let E=n.documentSelector;if(i.match!==void 0)return i.match(E,b);for(let x of E)if(bt.TextDocumentFilter.is(x)){if(typeof x=="string"||x.language!==void 0&&x.language!=="*"||x.scheme!==void 0&&x.scheme!=="*"&&x.scheme!==b.scheme)return!1;if(x.pattern!==void 0){let $=new aT.Minimatch(x.pattern,{noext:!0});if(!$.makeRe()||!$.match(b.fsPath))return!1}}return!0},c=b=>b instanceof De.Uri?a(b):De.languages.match(s,b)>0&&t.isVisible(b),d=b=>b instanceof De.Uri?this.activeTextDocument?.uri.toString()===b.toString():this.activeTextDocument===b;this.diagnosticRequestor=new _l(e,t,n),this.backgroundScheduler=new Tl(this.diagnosticRequestor);let g=b=>{!c(b)||!n.interFileDependencies||d(b)||this.backgroundScheduler.add(b)};this.activeTextDocument=De.window.activeTextEditor?.document,De.window.onDidChangeActiveTextEditor(b=>{let E=this.activeTextDocument;this.activeTextDocument=b?.document,E!==void 0&&g(E),this.activeTextDocument!==void 0&&this.backgroundScheduler.remove(this.activeTextDocument)});let v=e.getFeature(bt.DidOpenTextDocumentNotification.method);o.push(v.onNotificationSent(b=>{let E=b.textDocument;this.diagnosticRequestor.knows(qt.document,E)||c(E)&&this.diagnosticRequestor.pull(E,()=>{g(E)})})),o.push(t.onOpen(b=>{for(let E of b){if(this.diagnosticRequestor.knows(qt.document,E))continue;let x=E.toString(),$;for(let U of De.workspace.textDocuments)if(x===U.uri.toString()){$=U;break}$!==void 0&&c($)&&this.diagnosticRequestor.pull($,()=>{g($)})}}));let m=new Set;for(let b of De.workspace.textDocuments)c(b)&&(this.diagnosticRequestor.pull(b,()=>{g(b)}),m.add(b.uri.toString()));if(i.onTabs===!0)for(let b of t.getTabResources())!m.has(b.toString())&&c(b)&&this.diagnosticRequestor.pull(b,()=>{g(b)});if(i.onChange===!0){let b=e.getFeature(bt.DidChangeTextDocumentNotification.method);o.push(b.onNotificationSent(async E=>{let x=E.textDocument;(i.filter===void 0||!i.filter(x,la.onType))&&this.diagnosticRequestor.knows(qt.document,x)&&this.diagnosticRequestor.pull(x,()=>{this.backgroundScheduler.trigger()})}))}if(i.onSave===!0){let b=e.getFeature(bt.DidSaveTextDocumentNotification.method);o.push(b.onNotificationSent(E=>{let x=E.textDocument;(i.filter===void 0||!i.filter(x,la.onSave))&&this.diagnosticRequestor.knows(qt.document,x)&&this.diagnosticRequestor.pull(E.textDocument,()=>{this.backgroundScheduler.trigger()})}))}let S=e.getFeature(bt.DidCloseTextDocumentNotification.method);o.push(S.onNotificationSent(b=>{this.cleanUpDocument(b.textDocument)})),t.onClose(b=>{for(let E of b)this.cleanUpDocument(E)}),this.diagnosticRequestor.onDidChangeDiagnosticsEmitter.event(()=>{for(let b of De.workspace.textDocuments)c(b)&&this.diagnosticRequestor.pull(b)}),n.workspaceDiagnostics===!0&&n.identifier!=="da348dc5-c30a-4515-9d98-31ff3be38d14"&&this.diagnosticRequestor.pullWorkspace(),this.disposable=De.Disposable.from(...o,this.backgroundScheduler,this.diagnosticRequestor)}get onDidChangeDiagnosticsEmitter(){return this.diagnosticRequestor.onDidChangeDiagnosticsEmitter}get diagnostics(){return this.diagnosticRequestor.provider}cleanUpDocument(e){this.diagnosticRequestor.knows(qt.document,e)&&(this.diagnosticRequestor.forgetDocument(e),this.backgroundScheduler.remove(e))}},Dl=class extends Cl.TextDocumentLanguageFeature{constructor(e){super(e,bt.DocumentDiagnosticRequest.type)}fillClientCapabilities(e){let t=da(da(e,"textDocument"),"diagnostic");t.dynamicRegistration=!0,t.relatedDocumentSupport=!1,da(da(e,"workspace"),"diagnostics").refreshSupport=!0}initialize(e,t){this._client.onRequest(bt.DiagnosticRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeDiagnosticsEmitter.fire()});let[i,s]=this.getRegistration(t,e.diagnosticProvider);!i||!s||this.register({id:i,registerOptions:s})}clear(){this.tabs!==void 0&&(this.tabs.dispose(),this.tabs=void 0),super.clear()}registerLanguageProvider(e){this.tabs===void 0&&(this.tabs=new Rl);let t=new Pl(this._client,this.tabs,e);return[t.disposable,t]}};Gr.DiagnosticFeature=Dl});var Ib=I(ga=>{"use strict";Object.defineProperty(ga,"__esModule",{value:!0});ga.NotebookDocumentSyncFeature=void 0;var Jt=require("vscode"),uT=ua(),Er=me(),dT=at(),Eb=zn();function xb(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var Ji;(function(r){let e;(function(t){function n(m,S){return{version:m.version,uri:S.asUri(m.uri)}}t.asVersionedNotebookDocumentIdentifier=n;function i(m,S,b){let E=Er.NotebookDocument.create(b.asUri(m.uri),m.notebookType,m.version,s(S,b));return Object.keys(m.metadata).length>0&&(E.metadata=o(m.metadata)),E}t.asNotebookDocument=i;function s(m,S){return m.map(b=>a(b,S))}t.asNotebookCells=s;function o(m){return d(new Set,m)}t.asMetadata=o;function a(m,S){let b=Er.NotebookCell.create(c(m.kind),S.asUri(m.document.uri));return Object.keys(m.metadata).length>0&&(b.metadata=o(m.metadata)),m.executionSummary!==void 0&&Eb.number(m.executionSummary.executionOrder)&&Eb.boolean(m.executionSummary.success)&&(b.executionSummary={executionOrder:m.executionSummary.executionOrder,success:m.executionSummary.success}),b}t.asNotebookCell=a;function c(m){switch(m){case Jt.NotebookCellKind.Markup:return Er.NotebookCellKind.Markup;case Jt.NotebookCellKind.Code:return Er.NotebookCellKind.Code}}function d(m,S){if(m.has(S))throw new Error("Can't deep copy cyclic structures.");if(Array.isArray(S)){let b=[];for(let E of S)if(E!==null&&typeof E=="object"||Array.isArray(E))b.push(d(m,E));else{if(E instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");b.push(E)}return b}else{let b=Object.keys(S),E=Object.create(null);for(let x of b){let $=S[x];if($!==null&&typeof $=="object"||Array.isArray($))E[x]=d(m,$);else{if($ instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");E[x]=$}}return E}}function g(m,S){let b=S.asChangeTextDocumentParams(m,m.document.uri,m.document.version);return{document:b.textDocument,changes:b.contentChanges}}t.asTextContentChange=g;function v(m,S){let b=Object.create(null);if(m.metadata&&(b.metadata=r.c2p.asMetadata(m.metadata)),m.cells!==void 0){let E=Object.create(null),x=m.cells;x.structure&&(E.structure={array:{start:x.structure.array.start,deleteCount:x.structure.array.deleteCount,cells:x.structure.array.cells!==void 0?x.structure.array.cells.map($=>r.c2p.asNotebookCell($,S)):void 0},didOpen:x.structure.didOpen!==void 0?x.structure.didOpen.map($=>S.asOpenTextDocumentParams($.document).textDocument):void 0,didClose:x.structure.didClose!==void 0?x.structure.didClose.map($=>S.asCloseTextDocumentParams($.document).textDocument):void 0}),x.data!==void 0&&(E.data=x.data.map($=>r.c2p.asNotebookCell($,S))),x.textContent!==void 0&&(E.textContent=x.textContent.map($=>r.c2p.asTextContentChange($,S))),Object.keys(E).length>0&&(b.cells=E)}return b}t.asNotebookDocumentChangeEvent=v})(e=r.c2p||(r.c2p={}))})(Ji||(Ji={}));var El;(function(r){function e(a,c,d){let g=a.length,v=c.length,m=0;for(;m<v&&m<g&&t(a[m],c[m],d);)m++;if(m<v&&m<g){let S=g-1,b=v-1;for(;S>=0&&b>=0&&t(a[S],c[b],d);)S--,b--;let E=S+1-m,x=m===b+1?void 0:c.slice(m,b+1);return x!==void 0?{start:m,deleteCount:E,cells:x}:{start:m,deleteCount:E}}else return m<v?{start:m,deleteCount:0,cells:c.slice(m)}:m<g?{start:m,deleteCount:g-m}:void 0}r.computeDiff=e;function t(a,c,d=!0){return a.kind!==c.kind||a.document.uri.toString()!==c.document.uri.toString()||a.document.languageId!==c.document.languageId||!n(a.executionSummary,c.executionSummary)?!1:!d||d&&s(a.metadata,c.metadata)}function n(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.executionOrder===c.executionOrder&&a.success===c.success&&i(a.timing,c.timing)}function i(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.startTime===c.startTime&&a.endTime===c.endTime}function s(a,c){if(a===c)return!0;if(a==null||c===null||c===void 0||typeof a!=typeof c||typeof a!="object")return!1;let d=Array.isArray(a),g=Array.isArray(c);if(d!==g)return!1;if(d&&g){if(a.length!==c.length)return!1;for(let v=0;v<a.length;v++)if(!s(a[v],c[v]))return!1}if(o(a)&&o(c)){let v=Object.keys(a),m=Object.keys(c);if(v.length!==m.length||(v.sort(),m.sort(),!s(v,m)))return!1;for(let S=0;S<v.length;S++){let b=v[S];if(!s(a[b],c[b]))return!1}return!0}return!1}function o(a){return a!==null&&typeof a=="object"}r.isObjectLiteral=o})(El||(El={}));var xl;(function(r){function e(t,n){if(typeof t=="string")return t==="*"||n.notebookType===t;if(t.notebookType!==void 0&&t.notebookType!=="*"&&n.notebookType!==t.notebookType)return!1;let i=n.uri;if(t.scheme!==void 0&&t.scheme!=="*"&&i.scheme!==t.scheme)return!1;if(t.pattern!==void 0){let s=new uT.Minimatch(t.pattern,{noext:!0});if(!s.makeRe()||!s.match(i.fsPath))return!1}return!0}r.matchNotebook=e})(xl||(xl={}));var fa;(function(r){function e(n){let i=n.notebookSelector,s=[];for(let o of i){let a=(typeof o.notebook=="string"?o.notebook:o.notebook?.notebookType)??"*",c=typeof o.notebook=="string"?void 0:o.notebook?.scheme,d=typeof o.notebook=="string"?void 0:o.notebook?.pattern;if(o.cells!==void 0)for(let g of o.cells)s.push(t(a,c,d,g.language));else s.push(t(a,c,d,void 0))}return s}r.asDocumentSelector=e;function t(n,i,s,o){return i===void 0&&s===void 0?{notebook:n,language:o}:{notebook:{notebookType:n,scheme:i,pattern:s},language:o}}})(fa||(fa={}));var ha;(function(r){function e(t){return{cells:t,uris:new Set(t.map(n=>n.document.uri.toString()))}}r.create=e})(ha||(ha={}));var Xi=class{constructor(e,t){this.client=e,this.options=t,this.notebookSyncInfo=new Map,this.notebookDidOpen=new Set,this.disposables=[],this.selector=e.protocol2CodeConverter.asDocumentSelector(fa.asDocumentSelector(t)),Jt.workspace.onDidOpenNotebookDocument(n=>{this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n)},void 0,this.disposables);for(let n of Jt.workspace.notebookDocuments)this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n);Jt.workspace.onDidChangeNotebookDocument(n=>this.didChangeNotebookDocument(n),void 0,this.disposables),this.options.save===!0&&Jt.workspace.onDidSaveNotebookDocument(n=>this.didSave(n),void 0,this.disposables),Jt.workspace.onDidCloseNotebookDocument(n=>{this.didClose(n),this.notebookDidOpen.delete(n.uri.toString())},void 0,this.disposables)}getState(){for(let e of Jt.workspace.notebookDocuments)if(this.getMatchingCells(e)!==void 0)return{kind:"document",id:"$internal",registrations:!0,matches:!0};return{kind:"document",id:"$internal",registrations:!0,matches:!1}}get mode(){return"notebook"}handles(e){return Jt.languages.match(this.selector,e)>0}didOpenNotebookCellTextDocument(e,t){if(Jt.languages.match(this.selector,t.document)===0||!this.notebookDidOpen.has(e.uri.toString()))return;let n=this.notebookSyncInfo.get(e.uri.toString()),i=this.cellMatches(e,t);if(n!==void 0){let s=n.uris.has(t.document.uri.toString());if(i&&s||!i&&!s)return;if(i){let o=this.getMatchingCells(e);if(o!==void 0){let a=this.asNotebookDocumentChangeEvent(e,void 0,n,o);a!==void 0&&this.doSendChange(a,o).catch(()=>{})}}}else i&&this.doSendOpen(e,[t]).catch(()=>{})}didChangeNotebookCellTextDocument(e,t){Jt.languages.match(this.selector,t.document)!==0&&this.doSendChange({notebook:e,cells:{textContent:[t]}},void 0).catch(()=>{})}didCloseNotebookCellTextDocument(e,t){let n=this.notebookSyncInfo.get(e.uri.toString());if(n===void 0)return;let i=t.document.uri,s=n.cells.findIndex(o=>o.document.uri.toString()===i.toString());if(s!==-1)if(s===0&&n.cells.length===1)this.doSendClose(e,n.cells).catch(()=>{});else{let o=n.cells.slice(),a=o.splice(s,1);this.doSendChange({notebook:e,cells:{structure:{array:{start:s,deleteCount:1},didClose:a}}},o).catch(()=>{})}}dispose(){for(let e of this.disposables)e.dispose()}didOpen(e,t=this.getMatchingCells(e),n=this.notebookSyncInfo.get(e.uri.toString())){if(n!==void 0)if(t!==void 0){let i=this.asNotebookDocumentChangeEvent(e,void 0,n,t);i!==void 0&&this.doSendChange(i,t).catch(()=>{})}else this.doSendClose(e,[]).catch(()=>{});else{if(t===void 0)return;this.doSendOpen(e,t).catch(()=>{})}}didChangeNotebookDocument(e){let t=e.notebook,n=this.notebookSyncInfo.get(t.uri.toString());if(n===void 0){if(e.contentChanges.length===0)return;let i=this.getMatchingCells(t);if(i===void 0)return;this.didOpen(t,i,n)}else{let i=this.getMatchingCells(t);if(i===void 0){this.didClose(t,n);return}let s=this.asNotebookDocumentChangeEvent(e.notebook,e,n,i);s!==void 0&&this.doSendChange(s,i).catch(()=>{})}}didSave(e){this.notebookSyncInfo.get(e.uri.toString())!==void 0&&this.doSendSave(e).catch(()=>{})}didClose(e,t=this.notebookSyncInfo.get(e.uri.toString())){if(t===void 0)return;let n=e.getCells().filter(i=>t.uris.has(i.document.uri.toString()));this.doSendClose(e,n).catch(()=>{})}async sendDidOpenNotebookDocument(e){let t=this.getMatchingCells(e);if(t!==void 0)return this.doSendOpen(e,t)}async doSendOpen(e,t){let n=async(s,o)=>{let a=Ji.c2p.asNotebookDocument(s,o,this.client.code2ProtocolConverter),c=o.map(d=>this.client.code2ProtocolConverter.asTextDocumentItem(d.document));try{await this.client.sendNotification(Er.DidOpenNotebookDocumentNotification.type,{notebookDocument:a,cellTextDocuments:c})}catch(d){throw this.client.error("Sending DidOpenNotebookDocumentNotification failed",d),d}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.set(e.uri.toString(),ha.create(t)),i?.didOpen!==void 0?i.didOpen(e,t,n):n(e,t)}async sendDidChangeNotebookDocument(e){return this.doSendChange(e,void 0)}async doSendChange(e,t=this.getMatchingCells(e.notebook)){let n=async s=>{try{await this.client.sendNotification(Er.DidChangeNotebookDocumentNotification.type,{notebookDocument:Ji.c2p.asVersionedNotebookDocumentIdentifier(s.notebook,this.client.code2ProtocolConverter),change:Ji.c2p.asNotebookDocumentChangeEvent(s,this.client.code2ProtocolConverter)})}catch(o){throw this.client.error("Sending DidChangeNotebookDocumentNotification failed",o),o}},i=this.client.middleware?.notebooks;return e.cells?.structure!==void 0&&this.notebookSyncInfo.set(e.notebook.uri.toString(),ha.create(t??[])),i?.didChange!==void 0?i?.didChange(e,n):n(e)}async sendDidSaveNotebookDocument(e){return this.doSendSave(e)}async doSendSave(e){let t=async i=>{try{await this.client.sendNotification(Er.DidSaveNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(i.uri)}})}catch(s){throw this.client.error("Sending DidSaveNotebookDocumentNotification failed",s),s}},n=this.client.middleware?.notebooks;return n?.didSave!==void 0?n.didSave(e,t):t(e)}async sendDidCloseNotebookDocument(e){return this.doSendClose(e,this.getMatchingCells(e)??[])}async doSendClose(e,t){let n=async(s,o)=>{try{await this.client.sendNotification(Er.DidCloseNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(s.uri)},cellTextDocuments:o.map(a=>this.client.code2ProtocolConverter.asTextDocumentIdentifier(a.document))})}catch(a){throw this.client.error("Sending DidCloseNotebookDocumentNotification failed",a),a}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.delete(e.uri.toString()),i?.didClose!==void 0?i.didClose(e,t,n):n(e,t)}asNotebookDocumentChangeEvent(e,t,n,i){if(t!==void 0&&t.notebook!==e)throw new Error("Notebook must be identical");let s={notebook:e};t?.metadata!==void 0&&(s.metadata=Ji.c2p.asMetadata(t.metadata));let o;if(t?.cellChanges!==void 0&&t.cellChanges.length>0){let a=[];o=new Set(i.map(c=>c.document.uri.toString()));for(let c of t.cellChanges)o.has(c.cell.document.uri.toString())&&(c.executionSummary!==void 0||c.metadata!==void 0)&&a.push(c.cell);a.length>0&&(s.cells=s.cells??{},s.cells.data=a)}if((t?.contentChanges!==void 0&&t.contentChanges.length>0||t===void 0)&&n!==void 0&&i!==void 0){let a=n.cells,c=i,d=El.computeDiff(a,c,!1),g,v;if(d!==void 0){g=d.cells===void 0?new Map:new Map(d.cells.map(b=>[b.document.uri.toString(),b])),v=d.deleteCount===0?new Map:new Map(a.slice(d.start,d.start+d.deleteCount).map(b=>[b.document.uri.toString(),b]));for(let b of Array.from(v.keys()))g.has(b)&&(v.delete(b),g.delete(b));s.cells=s.cells??{};let m=[],S=[];if(g.size>0||v.size>0){for(let b of g.values())m.push(b);for(let b of v.values())S.push(b)}s.cells.structure={array:d,didOpen:m,didClose:S}}}return Object.keys(s).length>1?s:void 0}getMatchingCells(e,t=e.getCells()){if(this.options.notebookSelector!==void 0){for(let n of this.options.notebookSelector)if(n.notebook===void 0||xl.matchNotebook(n.notebook,e)){let i=this.filterCells(e,t,n.cells);return i.length===0?void 0:i}}}cellMatches(e,t){let n=this.getMatchingCells(e,[t]);return n!==void 0&&n[0]===t}filterCells(e,t,n){let i=n!==void 0?t.filter(s=>{let o=s.document.languageId;return n.some((a=>a.language==="*"||o===a.language))}):t;return typeof this.client.clientOptions.notebookDocumentOptions?.filterCells=="function"?this.client.clientOptions.notebookDocumentOptions.filterCells(e,i):i}},pa=class r{constructor(e){this.client=e,this.registrations=new Map,this.registrationType=Er.NotebookDocumentSyncRegistrationType.type,Jt.workspace.onDidOpenTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof Xi&&s.didOpenNotebookCellTextDocument(n,i)}),Jt.workspace.onDidChangeTextDocument(t=>{if(t.contentChanges.length===0)return;let n=t.document;if(n.uri.scheme!==r.CellScheme)return;let[i]=this.findNotebookDocumentAndCell(n);if(i!==void 0)for(let s of this.registrations.values())s instanceof Xi&&s.didChangeNotebookCellTextDocument(i,t)}),Jt.workspace.onDidCloseTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof Xi&&s.didCloseNotebookCellTextDocument(n,i)})}getState(){if(this.registrations.size===0)return{kind:"document",id:this.registrationType.method,registrations:!1,matches:!1};for(let e of this.registrations.values()){let t=e.getState();if(t.kind==="document"&&t.registrations===!0&&t.matches===!0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!1}}fillClientCapabilities(e){let t=xb(xb(e,"notebookDocument"),"synchronization");t.dynamicRegistration=!0,t.executionSummarySupport=!0}preInitialize(e){let t=e.notebookDocumentSync;t!==void 0&&(this.dedicatedChannel=this.client.protocol2CodeConverter.asDocumentSelector(fa.asDocumentSelector(t)))}initialize(e){let t=e.notebookDocumentSync;if(t===void 0)return;let n=t.id??dT.generateUuid();this.register({id:n,registerOptions:t})}register(e){let t=new Xi(this.client,e.registerOptions);this.registrations.set(e.id,t)}unregister(e){let t=this.registrations.get(e);t&&t.dispose()}clear(){for(let e of this.registrations.values())e.dispose();this.registrations.clear()}handles(e){if(e.uri.scheme!==r.CellScheme)return!1;if(this.dedicatedChannel!==void 0&&Jt.languages.match(this.dedicatedChannel,e)>0)return!0;for(let t of this.registrations.values())if(t.handles(e))return!0;return!1}getProvider(e){for(let t of this.registrations.values())if(t.handles(e.document))return t}findNotebookDocumentAndCell(e){let t=e.uri.toString();for(let n of Jt.workspace.notebookDocuments)for(let i of n.getCells())if(i.document.uri.toString()===t)return[n,i];return[void 0,void 0]}};ga.NotebookDocumentSyncFeature=pa;pa.CellScheme="vscode-notebook-cell"});var Ob=I(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.SyncConfigurationFeature=Jr.toJSONObject=Jr.ConfigurationFeature=void 0;var Qi=require("vscode"),Fs=me(),lT=zn(),fT=at(),qb=Ie(),Il=class{constructor(e){this._client=e}getState(){return{kind:"static"}}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.configuration=!0}initialize(){let e=this._client;e.onRequest(Fs.ConfigurationRequest.type,(t,n)=>{let i=o=>{let a=[];for(let c of o.items){let d=c.scopeUri!==void 0&&c.scopeUri!==null?this._client.protocol2CodeConverter.asUri(c.scopeUri):void 0;a.push(this.getConfiguration(d,c.section!==null?c.section:void 0))}return a},s=e.middleware.workspace;return s&&s.configuration?s.configuration(t,n,i):i(t,n)})}getConfiguration(e,t){let n=null;if(t){let i=t.lastIndexOf(".");if(i===-1)n=pi(Qi.workspace.getConfiguration(void 0,e).get(t));else{let s=Qi.workspace.getConfiguration(t.substr(0,i),e);s&&(n=pi(s.get(t.substr(i+1))))}}else{let i=Qi.workspace.getConfiguration(void 0,e);n={};for(let s of Object.keys(i))i.has(s)&&(n[s]=pi(i.get(s)))}return n===void 0&&(n=null),n}clear(){}};Jr.ConfigurationFeature=Il;function pi(r){if(r){if(Array.isArray(r))return r.map(pi);if(typeof r=="object"){let e=Object.create(null);for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=pi(r[t]));return e}}return r}Jr.toJSONObject=pi;var ql=class{constructor(e){this._client=e,this.isCleared=!1,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Fs.DidChangeConfigurationNotification.type}fillClientCapabilities(e){(0,qb.ensure)((0,qb.ensure)(e,"workspace"),"didChangeConfiguration").dynamicRegistration=!0}initialize(){this.isCleared=!1;let e=this._client.clientOptions.synchronize?.configurationSection;e!==void 0&&this.register({id:fT.generateUuid(),registerOptions:{section:e}})}register(e){let t=Qi.workspace.onDidChangeConfiguration(n=>{this.onDidChangeConfiguration(e.registerOptions.section,n)});this._listeners.set(e.id,t),e.registerOptions.section!==void 0&&this.onDidChangeConfiguration(e.registerOptions.section,void 0)}unregister(e){let t=this._listeners.get(e);t&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear(),this.isCleared=!0}onDidChangeConfiguration(e,t){if(this.isCleared)return;let n;if(lT.string(e)?n=[e]:n=e,n!==void 0&&t!==void 0&&!n.some(a=>t.affectsConfiguration(a)))return;let i=async o=>o===void 0?this._client.sendNotification(Fs.DidChangeConfigurationNotification.type,{settings:null}):this._client.sendNotification(Fs.DidChangeConfigurationNotification.type,{settings:this.extractSettingsInformation(o)}),s=this._client.middleware.workspace?.didChangeConfiguration;(s?s(n,i):i(n)).catch(o=>{this._client.error(`Sending notification ${Fs.DidChangeConfigurationNotification.type.method} failed`,o)})}extractSettingsInformation(e){function t(s,o){let a=s;for(let c=0;c<o.length-1;c++){let d=a[o[c]];d||(d=Object.create(null),a[o[c]]=d),a=d}return a}let n=this._client.clientOptions.workspaceFolder?this._client.clientOptions.workspaceFolder.uri:void 0,i=Object.create(null);for(let s=0;s<e.length;s++){let o=e[s],a=o.indexOf("."),c=null;if(a>=0?c=Qi.workspace.getConfiguration(o.substr(0,a),n).get(o.substr(a+1)):c=Qi.workspace.getConfiguration(void 0,n).get(o),c){let d=e[s].split(".");t(i,d)[d[d.length-1]]=pi(c)}}return i}};Jr.SyncConfigurationFeature=ql});var Fb=I(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.DidSaveTextDocumentFeature=fn.WillSaveWaitUntilFeature=fn.WillSaveFeature=fn.DidChangeTextDocumentFeature=fn.DidCloseTextDocumentFeature=fn.DidOpenTextDocumentFeature=void 0;var In=require("vscode"),Je=me(),lt=Ie(),Yi=at(),Ol=class extends lt.TextDocumentEventFeature{constructor(e,t){super(e,In.workspace.onDidOpenTextDocument,Je.DidOpenTextDocumentNotification.type,()=>e.middleware.didOpen,n=>e.code2ProtocolConverter.asOpenTextDocumentParams(n),n=>n,lt.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t}get openDocuments(){return this._syncedDocuments.values()}fillClientCapabilities(e){(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Yi.generateUuid(),registerOptions:{documentSelector:t}})}get registrationType(){return Je.DidOpenTextDocumentNotification.type}register(e){if(super.register(e),!e.registerOptions.documentSelector)return;let t=this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector);In.workspace.textDocuments.forEach(n=>{let i=n.uri.toString();if(!this._syncedDocuments.has(i)&&In.languages.match(t,n)>0&&!this._client.hasDedicatedTextSynchronizationFeature(n)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));(s.didOpen?s.didOpen(n,o):o(n)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)}),this._syncedDocuments.set(i,n)}})}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.set(e.uri.toString(),e),super.notificationSent(e,t,n)}};fn.DidOpenTextDocumentFeature=Ol;var Fl=class extends lt.TextDocumentEventFeature{constructor(e,t,n){super(e,In.workspace.onDidCloseTextDocument,Je.DidCloseTextDocumentNotification.type,()=>e.middleware.didClose,i=>e.code2ProtocolConverter.asCloseTextDocumentParams(i),i=>i,lt.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t,this._pendingTextDocumentChanges=n}get registrationType(){return Je.DidCloseTextDocumentNotification.type}fillClientCapabilities(e){(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Yi.generateUuid(),registerOptions:{documentSelector:t}})}async callback(e){await super.callback(e),this._pendingTextDocumentChanges.delete(e.uri.toString())}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.delete(e.uri.toString()),super.notificationSent(e,t,n)}unregister(e){let t=this._selectors.get(e);super.unregister(e);let n=this._selectors.values();this._syncedDocuments.forEach(i=>{if(In.languages.match(t,i)>0&&!this._selectorFilter(n,i)&&!this._client.hasDedicatedTextSynchronizationFeature(i)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));this._syncedDocuments.delete(i.uri.toString()),(s.didClose?s.didClose(i,o):o(i)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)})}})}};fn.DidCloseTextDocumentFeature=Fl;var Ll=class extends lt.DynamicDocumentFeature{constructor(e,t){super(e),this._changeData=new Map,this._onNotificationSent=new In.EventEmitter,this._onPendingChangeAdded=new In.EventEmitter,this._pendingTextDocumentChanges=t,this._syncKind=Je.TextDocumentSyncKind.None}get onNotificationSent(){return this._onNotificationSent.event}get onPendingChangeAdded(){return this._onPendingChangeAdded.event}get syncKind(){return this._syncKind}get registrationType(){return Je.DidChangeTextDocumentNotification.type}fillClientCapabilities(e){(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.change!==void 0&&n.change!==Je.TextDocumentSyncKind.None&&this.register({id:Yi.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},{syncKind:n.change})})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=In.workspace.onDidChangeTextDocument(this.callback,this)),this._changeData.set(e.id,{syncKind:e.registerOptions.syncKind,documentSelector:this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)}),this.updateSyncKind(e.registerOptions.syncKind))}*getDocumentSelectors(){for(let e of this._changeData.values())yield e.documentSelector}async callback(e){if(e.contentChanges.length===0)return;let t=e.document.uri,n=e.document.version,i=[];for(let s of this._changeData.values())if(In.languages.match(s.documentSelector,e.document)>0&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let o=this._client.middleware;if(s.syncKind===Je.TextDocumentSyncKind.Incremental){let a=async c=>{let d=this._client.code2ProtocolConverter.asChangeTextDocumentParams(c,t,n);await this._client.sendNotification(Je.DidChangeTextDocumentNotification.type,d),this.notificationSent(c.document,Je.DidChangeTextDocumentNotification.type,d)};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}else if(s.syncKind===Je.TextDocumentSyncKind.Full){let a=async c=>{let d=c.document.uri.toString();this._pendingTextDocumentChanges.set(d,c.document),this._onPendingChangeAdded.fire()};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}}return Promise.all(i).then(void 0,s=>{throw this._client.error(`Sending document notification ${Je.DidChangeTextDocumentNotification.type.method} failed`,s),s})}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){if(this._changeData.delete(e),this._changeData.size===0)this._listener&&(this._listener.dispose(),this._listener=void 0),this._syncKind=Je.TextDocumentSyncKind.None;else{this._syncKind=Je.TextDocumentSyncKind.None;for(let t of this._changeData.values())if(this.updateSyncKind(t.syncKind),this._syncKind===Je.TextDocumentSyncKind.Full)break}}clear(){this._pendingTextDocumentChanges.clear(),this._changeData.clear(),this._syncKind=Je.TextDocumentSyncKind.None,this._listener&&(this._listener.dispose(),this._listener=void 0)}getPendingDocumentChanges(e){if(this._pendingTextDocumentChanges.size===0)return[];let t;if(e.size===0)t=Array.from(this._pendingTextDocumentChanges.values()),this._pendingTextDocumentChanges.clear();else{t=[];for(let n of this._pendingTextDocumentChanges)e.has(n[0])||(t.push(n[1]),this._pendingTextDocumentChanges.delete(n[0]))}return t}getProvider(e){for(let t of this._changeData.values())if(In.languages.match(t.documentSelector,e)>0)return{send:n=>this.callback(n)}}updateSyncKind(e){if(this._syncKind!==Je.TextDocumentSyncKind.Full)switch(e){case Je.TextDocumentSyncKind.Full:this._syncKind=e;break;case Je.TextDocumentSyncKind.Incremental:this._syncKind===Je.TextDocumentSyncKind.None&&(this._syncKind=Je.TextDocumentSyncKind.Incremental);break}}};fn.DidChangeTextDocumentFeature=Ll;var Ml=class extends lt.TextDocumentEventFeature{constructor(e){super(e,In.workspace.onWillSaveTextDocument,Je.WillSaveTextDocumentNotification.type,()=>e.middleware.willSave,t=>e.code2ProtocolConverter.asWillSaveTextDocumentParams(t),t=>t.document,(t,n)=>lt.TextDocumentEventFeature.textDocumentFilter(t,n.document))}get registrationType(){return Je.WillSaveTextDocumentNotification.type}fillClientCapabilities(e){let t=(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization");t.willSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSave&&this.register({id:Yi.generateUuid(),registerOptions:{documentSelector:t}})}getTextDocument(e){return e.document}};fn.WillSaveFeature=Ml;var Nl=class extends lt.DynamicDocumentFeature{constructor(e){super(e),this._selectors=new Map}getDocumentSelectors(){return this._selectors.values()}get registrationType(){return Je.WillSaveTextDocumentWaitUntilRequest.type}fillClientCapabilities(e){let t=(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization");t.willSaveWaitUntil=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSaveWaitUntil&&this.register({id:Yi.generateUuid(),registerOptions:{documentSelector:t}})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=In.workspace.onWillSaveTextDocument(this.callback,this)),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}callback(e){if(lt.TextDocumentEventFeature.textDocumentFilter(this._selectors.values(),e.document)&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let t=this._client.middleware,n=i=>this._client.sendRequest(Je.WillSaveTextDocumentWaitUntilRequest.type,this._client.code2ProtocolConverter.asWillSaveTextDocumentParams(i)).then(async s=>{let o=await this._client.protocol2CodeConverter.asTextEdits(s);return o===void 0?[]:o});e.waitUntil(t.willSaveWaitUntil?t.willSaveWaitUntil(e,n):n(e))}}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}};fn.WillSaveWaitUntilFeature=Nl;var Al=class extends lt.TextDocumentEventFeature{constructor(e){super(e,In.workspace.onDidSaveTextDocument,Je.DidSaveTextDocumentNotification.type,()=>e.middleware.didSave,t=>e.code2ProtocolConverter.asSaveTextDocumentParams(t,this._includeText),t=>t,lt.TextDocumentEventFeature.textDocumentFilter),this._includeText=!1}get registrationType(){return Je.DidSaveTextDocumentNotification.type}fillClientCapabilities(e){(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization").didSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;if(t&&n&&n.save){let i=typeof n.save=="boolean"?{includeText:!1}:{includeText:!!n.save.includeText};this.register({id:Yi.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},i)})}}register(e){this._includeText=!!e.registerOptions.includeText,super.register(e)}getTextDocument(e){return e}};fn.DidSaveTextDocumentFeature=Al});var Lb=I(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0});ma.CompletionItemFeature=void 0;var hT=require("vscode"),ke=me(),jl=Ie(),pT=at(),gT=[ke.CompletionItemKind.Text,ke.CompletionItemKind.Method,ke.CompletionItemKind.Function,ke.CompletionItemKind.Constructor,ke.CompletionItemKind.Field,ke.CompletionItemKind.Variable,ke.CompletionItemKind.Class,ke.CompletionItemKind.Interface,ke.CompletionItemKind.Module,ke.CompletionItemKind.Property,ke.CompletionItemKind.Unit,ke.CompletionItemKind.Value,ke.CompletionItemKind.Enum,ke.CompletionItemKind.Keyword,ke.CompletionItemKind.Snippet,ke.CompletionItemKind.Color,ke.CompletionItemKind.File,ke.CompletionItemKind.Reference,ke.CompletionItemKind.Folder,ke.CompletionItemKind.EnumMember,ke.CompletionItemKind.Constant,ke.CompletionItemKind.Struct,ke.CompletionItemKind.Event,ke.CompletionItemKind.Operator,ke.CompletionItemKind.TypeParameter],$l=class extends jl.TextDocumentLanguageFeature{constructor(e){super(e,ke.CompletionRequest.type),this.labelDetailsSupport=new Map}fillClientCapabilities(e){let t=(0,jl.ensure)((0,jl.ensure)(e,"textDocument"),"completion");t.dynamicRegistration=!0,t.contextSupport=!0,t.completionItem={snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:[ke.MarkupKind.Markdown,ke.MarkupKind.PlainText],deprecatedSupport:!0,preselectSupport:!0,tagSupport:{valueSet:[ke.CompletionItemTag.Deprecated]},insertReplaceSupport:!0,resolveSupport:{properties:["documentation","detail","additionalTextEdits"]},insertTextModeSupport:{valueSet:[ke.InsertTextMode.asIs,ke.InsertTextMode.adjustIndentation]},labelDetailsSupport:!0},t.insertTextMode=ke.InsertTextMode.adjustIndentation,t.completionItemKind={valueSet:gT},t.completionList={itemDefaults:["commitCharacters","editRange","insertTextFormat","insertTextMode","data"]}}initialize(e,t){let n=this.getRegistrationOptions(t,e.completionProvider);n&&this.register({id:pT.generateUuid(),registerOptions:n})}registerLanguageProvider(e,t){this.labelDetailsSupport.set(t,!!e.completionItem?.labelDetailsSupport);let n=e.triggerCharacters??[],i=e.allCommitCharacters,s=e.documentSelector,o={provideCompletionItems:(a,c,d,g)=>{let v=this._client,m=this._client.middleware,S=(b,E,x,$)=>v.sendRequest(ke.CompletionRequest.type,v.code2ProtocolConverter.asCompletionParams(b,E,x),$).then(U=>$.isCancellationRequested?null:v.protocol2CodeConverter.asCompletionResult(U,i,$),U=>v.handleFailedRequest(ke.CompletionRequest.type,$,U,null));return m.provideCompletionItem?m.provideCompletionItem(a,c,g,d,S):S(a,c,g,d)},resolveCompletionItem:e.resolveProvider?(a,c)=>{let d=this._client,g=this._client.middleware,v=(m,S)=>d.sendRequest(ke.CompletionResolveRequest.type,d.code2ProtocolConverter.asCompletionItem(m,!!this.labelDetailsSupport.get(t)),S).then(b=>S.isCancellationRequested?null:d.protocol2CodeConverter.asCompletionItem(b),b=>d.handleFailedRequest(ke.CompletionResolveRequest.type,S,b,m));return g.resolveCompletionItem?g.resolveCompletionItem(a,c,v):v(a,c)}:void 0};return[hT.languages.registerCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(s),o,...n),o]}};ma.CompletionItemFeature=$l});var Mb=I(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});va.HoverFeature=void 0;var mT=require("vscode"),Ls=me(),Ul=Ie(),vT=at(),Wl=class extends Ul.TextDocumentLanguageFeature{constructor(e){super(e,Ls.HoverRequest.type)}fillClientCapabilities(e){let t=(0,Ul.ensure)((0,Ul.ensure)(e,"textDocument"),"hover");t.dynamicRegistration=!0,t.contentFormat=[Ls.MarkupKind.Markdown,Ls.MarkupKind.PlainText]}initialize(e,t){let n=this.getRegistrationOptions(t,e.hoverProvider);n&&this.register({id:vT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideHover:(i,s,o)=>{let a=this._client,c=(g,v,m)=>a.sendRequest(Ls.HoverRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(g,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asHover(S),S=>a.handleFailedRequest(Ls.HoverRequest.type,m,S,null)),d=a.middleware;return d.provideHover?d.provideHover(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return mT.languages.registerHoverProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};va.HoverFeature=Wl});var Nb=I(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.DefinitionFeature=void 0;var yT=require("vscode"),Hl=me(),Vl=Ie(),bT=at(),zl=class extends Vl.TextDocumentLanguageFeature{constructor(e){super(e,Hl.DefinitionRequest.type)}fillClientCapabilities(e){let t=(0,Vl.ensure)((0,Vl.ensure)(e,"textDocument"),"definition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.definitionProvider);n&&this.register({id:bT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDefinition:(i,s,o)=>{let a=this._client,c=(g,v,m)=>a.sendRequest(Hl.DefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(g,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,m),S=>a.handleFailedRequest(Hl.DefinitionRequest.type,m,S,null)),d=a.middleware;return d.provideDefinition?d.provideDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return yT.languages.registerDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};ya.DefinitionFeature=zl});var jb=I(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});ba.SignatureHelpFeature=void 0;var Ab=require("vscode"),Ms=me(),Kl=Ie(),wT=at(),Bl=class extends Kl.TextDocumentLanguageFeature{constructor(e){super(e,Ms.SignatureHelpRequest.type)}fillClientCapabilities(e){let t=(0,Kl.ensure)((0,Kl.ensure)(e,"textDocument"),"signatureHelp");t.dynamicRegistration=!0,t.signatureInformation={documentationFormat:[Ms.MarkupKind.Markdown,Ms.MarkupKind.PlainText]},t.signatureInformation.parameterInformation={labelOffsetSupport:!0},t.signatureInformation.activeParameterSupport=!0,t.contextSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.signatureHelpProvider);n&&this.register({id:wT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t={provideSignatureHelp:(n,i,s,o)=>{let a=this._client,c=(g,v,m,S)=>a.sendRequest(Ms.SignatureHelpRequest.type,a.code2ProtocolConverter.asSignatureHelpParams(g,v,m),S).then(b=>S.isCancellationRequested?null:a.protocol2CodeConverter.asSignatureHelp(b,S),b=>a.handleFailedRequest(Ms.SignatureHelpRequest.type,S,b,null)),d=a.middleware;return d.provideSignatureHelp?d.provideSignatureHelp(n,i,o,s,c):c(n,i,o,s)}};return[this.registerProvider(e,t),t]}registerProvider(e,t){let n=this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector);if(e.retriggerCharacters===void 0){let i=e.triggerCharacters||[];return Ab.languages.registerSignatureHelpProvider(n,t,...i)}else{let i={triggerCharacters:e.triggerCharacters||[],retriggerCharacters:e.retriggerCharacters||[]};return Ab.languages.registerSignatureHelpProvider(n,t,i)}}};ba.SignatureHelpFeature=Bl});var $b=I(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.DocumentHighlightFeature=void 0;var CT=require("vscode"),Gl=me(),Jl=Ie(),RT=at(),Xl=class extends Jl.TextDocumentLanguageFeature{constructor(e){super(e,Gl.DocumentHighlightRequest.type)}fillClientCapabilities(e){(0,Jl.ensure)((0,Jl.ensure)(e,"textDocument"),"documentHighlight").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentHighlightProvider);n&&this.register({id:RT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentHighlights:(i,s,o)=>{let a=this._client,c=(g,v,m)=>a.sendRequest(Gl.DocumentHighlightRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(g,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDocumentHighlights(S,m),S=>a.handleFailedRequest(Gl.DocumentHighlightRequest.type,m,S,null)),d=a.middleware;return d.provideDocumentHighlights?d.provideDocumentHighlights(i,s,o,c):c(i,s,o)}};return[CT.languages.registerDocumentHighlightProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};wa.DocumentHighlightFeature=Xl});var Zl=I(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.DocumentSymbolFeature=wr.SupportedSymbolTags=wr.SupportedSymbolKinds=void 0;var ST=require("vscode"),Me=me(),Ql=Ie(),_T=at();wr.SupportedSymbolKinds=[Me.SymbolKind.File,Me.SymbolKind.Module,Me.SymbolKind.Namespace,Me.SymbolKind.Package,Me.SymbolKind.Class,Me.SymbolKind.Method,Me.SymbolKind.Property,Me.SymbolKind.Field,Me.SymbolKind.Constructor,Me.SymbolKind.Enum,Me.SymbolKind.Interface,Me.SymbolKind.Function,Me.SymbolKind.Variable,Me.SymbolKind.Constant,Me.SymbolKind.String,Me.SymbolKind.Number,Me.SymbolKind.Boolean,Me.SymbolKind.Array,Me.SymbolKind.Object,Me.SymbolKind.Key,Me.SymbolKind.Null,Me.SymbolKind.EnumMember,Me.SymbolKind.Struct,Me.SymbolKind.Event,Me.SymbolKind.Operator,Me.SymbolKind.TypeParameter];wr.SupportedSymbolTags=[Me.SymbolTag.Deprecated];var Yl=class extends Ql.TextDocumentLanguageFeature{constructor(e){super(e,Me.DocumentSymbolRequest.type)}fillClientCapabilities(e){let t=(0,Ql.ensure)((0,Ql.ensure)(e,"textDocument"),"documentSymbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:wr.SupportedSymbolKinds},t.hierarchicalDocumentSymbolSupport=!0,t.tagSupport={valueSet:wr.SupportedSymbolTags},t.labelSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentSymbolProvider);n&&this.register({id:_T.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentSymbols:(s,o)=>{let a=this._client,c=async(g,v)=>{try{let m=await a.sendRequest(Me.DocumentSymbolRequest.type,a.code2ProtocolConverter.asDocumentSymbolParams(g),v);if(v.isCancellationRequested||m===void 0||m===null)return null;if(m.length===0)return[];{let S=m[0];return Me.DocumentSymbol.is(S)?await a.protocol2CodeConverter.asDocumentSymbols(m,v):await a.protocol2CodeConverter.asSymbolInformations(m,v)}}catch(m){return a.handleFailedRequest(Me.DocumentSymbolRequest.type,v,m,null)}},d=a.middleware;return d.provideDocumentSymbols?d.provideDocumentSymbols(s,o,c):c(s,o)}},i=e.label!==void 0?{label:e.label}:void 0;return[ST.languages.registerDocumentSymbolProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,i),n]}};wr.DocumentSymbolFeature=Yl});var Wb=I(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.WorkspaceSymbolFeature=void 0;var TT=require("vscode"),Ns=me(),ef=Ie(),Ub=Zl(),PT=at(),tf=class extends ef.WorkspaceFeature{constructor(e){super(e,Ns.WorkspaceSymbolRequest.type)}fillClientCapabilities(e){let t=(0,ef.ensure)((0,ef.ensure)(e,"workspace"),"symbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:Ub.SupportedSymbolKinds},t.tagSupport={valueSet:Ub.SupportedSymbolTags},t.resolveSupport={properties:["location.range"]}}initialize(e){e.workspaceSymbolProvider&&this.register({id:PT.generateUuid(),registerOptions:e.workspaceSymbolProvider===!0?{workDoneProgress:!1}:e.workspaceSymbolProvider})}registerLanguageProvider(e){let t={provideWorkspaceSymbols:(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(Ns.WorkspaceSymbolRequest.type,{query:c},d).then(g=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformations(g,d),g=>s.handleFailedRequest(Ns.WorkspaceSymbolRequest.type,d,g,null)),a=s.middleware;return a.provideWorkspaceSymbols?a.provideWorkspaceSymbols(n,i,o):o(n,i)},resolveWorkspaceSymbol:e.resolveProvider===!0?(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(Ns.WorkspaceSymbolResolveRequest.type,s.code2ProtocolConverter.asWorkspaceSymbol(c),d).then(g=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformation(g),g=>s.handleFailedRequest(Ns.WorkspaceSymbolResolveRequest.type,d,g,null)),a=s.middleware;return a.resolveWorkspaceSymbol?a.resolveWorkspaceSymbol(n,i,o):o(n,i)}:void 0};return[TT.languages.registerWorkspaceSymbolProvider(t),t]}};Ca.WorkspaceSymbolFeature=tf});var Hb=I(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});Ra.ReferencesFeature=void 0;var DT=require("vscode"),nf=me(),rf=Ie(),kT=at(),sf=class extends rf.TextDocumentLanguageFeature{constructor(e){super(e,nf.ReferencesRequest.type)}fillClientCapabilities(e){(0,rf.ensure)((0,rf.ensure)(e,"textDocument"),"references").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.referencesProvider);n&&this.register({id:kT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideReferences:(i,s,o,a)=>{let c=this._client,d=(v,m,S,b)=>c.sendRequest(nf.ReferencesRequest.type,c.code2ProtocolConverter.asReferenceParams(v,m,S),b).then(E=>b.isCancellationRequested?null:c.protocol2CodeConverter.asReferences(E,b),E=>c.handleFailedRequest(nf.ReferencesRequest.type,b,E,null)),g=c.middleware;return g.provideReferences?g.provideReferences(i,s,o,a,d):d(i,s,o,a)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return DT.languages.registerReferenceProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ra.ReferencesFeature=sf});var Vb=I(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});Sa.CodeActionFeature=void 0;var ET=require("vscode"),qn=me(),xT=at(),of=Ie(),af=class extends of.TextDocumentLanguageFeature{constructor(e){super(e,qn.CodeActionRequest.type)}fillClientCapabilities(e){let t=(0,of.ensure)((0,of.ensure)(e,"textDocument"),"codeAction");t.dynamicRegistration=!0,t.isPreferredSupport=!0,t.disabledSupport=!0,t.dataSupport=!0,t.resolveSupport={properties:["edit"]},t.codeActionLiteralSupport={codeActionKind:{valueSet:[qn.CodeActionKind.Empty,qn.CodeActionKind.QuickFix,qn.CodeActionKind.Refactor,qn.CodeActionKind.RefactorExtract,qn.CodeActionKind.RefactorInline,qn.CodeActionKind.RefactorRewrite,qn.CodeActionKind.Source,qn.CodeActionKind.SourceOrganizeImports]}},t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.codeActionProvider);n&&this.register({id:xT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideCodeActions:(i,s,o,a)=>{let c=this._client,d=async(v,m,S,b)=>{let E={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),range:c.code2ProtocolConverter.asRange(m),context:c.code2ProtocolConverter.asCodeActionContextSync(S)};return c.sendRequest(qn.CodeActionRequest.type,E,b).then(x=>b.isCancellationRequested||x===null||x===void 0?null:c.protocol2CodeConverter.asCodeActionResult(x,b),x=>c.handleFailedRequest(qn.CodeActionRequest.type,b,x,null))},g=c.middleware;return g.provideCodeActions?g.provideCodeActions(i,s,o,a,d):d(i,s,o,a)},resolveCodeAction:e.resolveProvider?(i,s)=>{let o=this._client,a=this._client.middleware,c=async(d,g)=>o.sendRequest(qn.CodeActionResolveRequest.type,o.code2ProtocolConverter.asCodeActionSync(d),g).then(v=>g.isCancellationRequested?d:o.protocol2CodeConverter.asCodeAction(v,g),v=>o.handleFailedRequest(qn.CodeActionResolveRequest.type,g,v,d));return a.resolveCodeAction?a.resolveCodeAction(i,s,c):c(i,s)}:void 0};return[ET.languages.registerCodeActionsProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.codeActionKinds?{providedCodeActionKinds:this._client.protocol2CodeConverter.asCodeActionKinds(e.codeActionKinds)}:void 0),n]}};Sa.CodeActionFeature=af});var Kb=I(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.CodeLensFeature=void 0;var zb=require("vscode"),Zi=me(),IT=at(),As=Ie(),cf=class extends As.TextDocumentLanguageFeature{constructor(e){super(e,Zi.CodeLensRequest.type)}fillClientCapabilities(e){(0,As.ensure)((0,As.ensure)(e,"textDocument"),"codeLens").dynamicRegistration=!0,(0,As.ensure)((0,As.ensure)(e,"workspace"),"codeLens").refreshSupport=!0}initialize(e,t){this._client.onRequest(Zi.CodeLensRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeCodeLensEmitter.fire()});let i=this.getRegistrationOptions(t,e.codeLensProvider);i&&this.register({id:IT.generateUuid(),registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new zb.EventEmitter,i={onDidChangeCodeLenses:n.event,provideCodeLenses:(s,o)=>{let a=this._client,c=(g,v)=>a.sendRequest(Zi.CodeLensRequest.type,a.code2ProtocolConverter.asCodeLensParams(g),v).then(m=>v.isCancellationRequested?null:a.protocol2CodeConverter.asCodeLenses(m,v),m=>a.handleFailedRequest(Zi.CodeLensRequest.type,v,m,null)),d=a.middleware;return d.provideCodeLenses?d.provideCodeLenses(s,o,c):c(s,o)},resolveCodeLens:e.resolveProvider?(s,o)=>{let a=this._client,c=(g,v)=>a.sendRequest(Zi.CodeLensResolveRequest.type,a.code2ProtocolConverter.asCodeLens(g),v).then(m=>v.isCancellationRequested?g:a.protocol2CodeConverter.asCodeLens(m),m=>a.handleFailedRequest(Zi.CodeLensResolveRequest.type,v,m,g)),d=a.middleware;return d.resolveCodeLens?d.resolveCodeLens(s,o,c):c(s,o)}:void 0};return[zb.languages.registerCodeLensProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeCodeLensEmitter:n}]}};_a.CodeLensFeature=cf});var Bb=I(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.DocumentOnTypeFormattingFeature=Xr.DocumentRangeFormattingFeature=Xr.DocumentFormattingFeature=void 0;var Ta=require("vscode"),or=me(),ff=at(),xr=Ie(),es;(function(r){function e(t){let n=Ta.workspace.getConfiguration("files",t);return{trimTrailingWhitespace:n.get("trimTrailingWhitespace"),trimFinalNewlines:n.get("trimFinalNewlines"),insertFinalNewline:n.get("insertFinalNewline")}}r.fromConfiguration=e})(es||(es={}));var uf=class extends xr.TextDocumentLanguageFeature{constructor(e){super(e,or.DocumentFormattingRequest.type)}fillClientCapabilities(e){(0,xr.ensure)((0,xr.ensure)(e,"textDocument"),"formatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentFormattingProvider);n&&this.register({id:ff.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentFormattingEdits:(i,s,o)=>{let a=this._client,c=(g,v,m)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(g),options:a.code2ProtocolConverter.asFormattingOptions(v,es.fromConfiguration(g))};return a.sendRequest(or.DocumentFormattingRequest.type,S,m).then(b=>m.isCancellationRequested?null:a.protocol2CodeConverter.asTextEdits(b,m),b=>a.handleFailedRequest(or.DocumentFormattingRequest.type,m,b,null))},d=a.middleware;return d.provideDocumentFormattingEdits?d.provideDocumentFormattingEdits(i,s,o,c):c(i,s,o)}};return[Ta.languages.registerDocumentFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Xr.DocumentFormattingFeature=uf;var df=class extends xr.TextDocumentLanguageFeature{constructor(e){super(e,or.DocumentRangeFormattingRequest.type)}fillClientCapabilities(e){let t=(0,xr.ensure)((0,xr.ensure)(e,"textDocument"),"rangeFormatting");t.dynamicRegistration=!0,t.rangesSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentRangeFormattingProvider);n&&this.register({id:ff.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentRangeFormattingEdits:(i,s,o,a)=>{let c=this._client,d=(v,m,S,b)=>{let E={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),range:c.code2ProtocolConverter.asRange(m),options:c.code2ProtocolConverter.asFormattingOptions(S,es.fromConfiguration(v))};return c.sendRequest(or.DocumentRangeFormattingRequest.type,E,b).then(x=>b.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(x,b),x=>c.handleFailedRequest(or.DocumentRangeFormattingRequest.type,b,x,null))},g=c.middleware;return g.provideDocumentRangeFormattingEdits?g.provideDocumentRangeFormattingEdits(i,s,o,a,d):d(i,s,o,a)}};return e.rangesSupport&&(n.provideDocumentRangesFormattingEdits=(i,s,o,a)=>{let c=this._client,d=(v,m,S,b)=>{let E={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),ranges:c.code2ProtocolConverter.asRanges(m),options:c.code2ProtocolConverter.asFormattingOptions(S,es.fromConfiguration(v))};return c.sendRequest(or.DocumentRangesFormattingRequest.type,E,b).then(x=>b.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(x,b),x=>c.handleFailedRequest(or.DocumentRangesFormattingRequest.type,b,x,null))},g=c.middleware;return g.provideDocumentRangesFormattingEdits?g.provideDocumentRangesFormattingEdits(i,s,o,a,d):d(i,s,o,a)}),[Ta.languages.registerDocumentRangeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Xr.DocumentRangeFormattingFeature=df;var lf=class extends xr.TextDocumentLanguageFeature{constructor(e){super(e,or.DocumentOnTypeFormattingRequest.type)}fillClientCapabilities(e){(0,xr.ensure)((0,xr.ensure)(e,"textDocument"),"onTypeFormatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentOnTypeFormattingProvider);n&&this.register({id:ff.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideOnTypeFormattingEdits:(s,o,a,c,d)=>{let g=this._client,v=(S,b,E,x,$)=>{let U={textDocument:g.code2ProtocolConverter.asTextDocumentIdentifier(S),position:g.code2ProtocolConverter.asPosition(b),ch:E,options:g.code2ProtocolConverter.asFormattingOptions(x,es.fromConfiguration(S))};return g.sendRequest(or.DocumentOnTypeFormattingRequest.type,U,$).then(M=>$.isCancellationRequested?null:g.protocol2CodeConverter.asTextEdits(M,$),M=>g.handleFailedRequest(or.DocumentOnTypeFormattingRequest.type,$,M,null))},m=g.middleware;return m.provideOnTypeFormattingEdits?m.provideOnTypeFormattingEdits(s,o,a,c,d,v):v(s,o,a,c,d)}},i=e.moreTriggerCharacter||[];return[Ta.languages.registerOnTypeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.firstTriggerCharacter,...i),n]}};Xr.DocumentOnTypeFormattingFeature=lf});var Jb=I(Pa=>{"use strict";Object.defineProperty(Pa,"__esModule",{value:!0});Pa.RenameFeature=void 0;var qT=require("vscode"),gi=me(),OT=at(),Gb=zn(),hf=Ie(),pf=class extends hf.TextDocumentLanguageFeature{constructor(e){super(e,gi.RenameRequest.type)}fillClientCapabilities(e){let t=(0,hf.ensure)((0,hf.ensure)(e,"textDocument"),"rename");t.dynamicRegistration=!0,t.prepareSupport=!0,t.prepareSupportDefaultBehavior=gi.PrepareSupportDefaultBehavior.Identifier,t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.renameProvider);n&&(Gb.boolean(e.renameProvider)&&(n.prepareProvider=!1),this.register({id:OT.generateUuid(),registerOptions:n}))}registerLanguageProvider(e){let t=e.documentSelector,n={provideRenameEdits:(i,s,o,a)=>{let c=this._client,d=(v,m,S,b)=>{let E={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),position:c.code2ProtocolConverter.asPosition(m),newName:S};return c.sendRequest(gi.RenameRequest.type,E,b).then(x=>b.isCancellationRequested?null:c.protocol2CodeConverter.asWorkspaceEdit(x,b),x=>c.handleFailedRequest(gi.RenameRequest.type,b,x,null,!1))},g=c.middleware;return g.provideRenameEdits?g.provideRenameEdits(i,s,o,a,d):d(i,s,o,a)},prepareRename:e.prepareProvider?(i,s,o)=>{let a=this._client,c=(g,v,m)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(g),position:a.code2ProtocolConverter.asPosition(v)};return a.sendRequest(gi.PrepareRenameRequest.type,S,m).then(b=>m.isCancellationRequested?null:gi.Range.is(b)?a.protocol2CodeConverter.asRange(b):this.isDefaultBehavior(b)?b.defaultBehavior===!0?null:Promise.reject(new Error("The element can't be renamed.")):b&&gi.Range.is(b.range)?{range:a.protocol2CodeConverter.asRange(b.range),placeholder:b.placeholder}:Promise.reject(new Error("The element can't be renamed.")),b=>{throw typeof b.message=="string"?new Error(b.message):new Error("The element can't be renamed.")})},d=a.middleware;return d.prepareRename?d.prepareRename(i,s,o,c):c(i,s,o)}:void 0};return[this.registerProvider(t,n),n]}registerProvider(e,t){return qT.languages.registerRenameProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}isDefaultBehavior(e){let t=e;return t&&Gb.boolean(t.defaultBehavior)}};Pa.RenameFeature=pf});var Xb=I(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.DocumentLinkFeature=void 0;var FT=require("vscode"),js=me(),gf=Ie(),LT=at(),mf=class extends gf.TextDocumentLanguageFeature{constructor(e){super(e,js.DocumentLinkRequest.type)}fillClientCapabilities(e){let t=(0,gf.ensure)((0,gf.ensure)(e,"textDocument"),"documentLink");t.dynamicRegistration=!0,t.tooltipSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentLinkProvider);n&&this.register({id:LT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentLinks:(i,s)=>{let o=this._client,a=(d,g)=>o.sendRequest(js.DocumentLinkRequest.type,o.code2ProtocolConverter.asDocumentLinkParams(d),g).then(v=>g.isCancellationRequested?null:o.protocol2CodeConverter.asDocumentLinks(v,g),v=>o.handleFailedRequest(js.DocumentLinkRequest.type,g,v,null)),c=o.middleware;return c.provideDocumentLinks?c.provideDocumentLinks(i,s,a):a(i,s)},resolveDocumentLink:e.resolveProvider?(i,s)=>{let o=this._client,a=(d,g)=>o.sendRequest(js.DocumentLinkResolveRequest.type,o.code2ProtocolConverter.asDocumentLink(d),g).then(v=>g.isCancellationRequested?d:o.protocol2CodeConverter.asDocumentLink(v),v=>o.handleFailedRequest(js.DocumentLinkResolveRequest.type,g,v,d)),c=o.middleware;return c.resolveDocumentLink?c.resolveDocumentLink(i,s,a):a(i,s)}:void 0};return[FT.languages.registerDocumentLinkProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Da.DocumentLinkFeature=mf});var Yb=I(ka=>{"use strict";Object.defineProperty(ka,"__esModule",{value:!0});ka.ExecuteCommandFeature=void 0;var MT=require("vscode"),vf=me(),NT=at(),Qb=Ie(),yf=class{constructor(e){this._client=e,this._commands=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._commands.size>0}}get registrationType(){return vf.ExecuteCommandRequest.type}fillClientCapabilities(e){(0,Qb.ensure)((0,Qb.ensure)(e,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(e){e.executeCommandProvider&&this.register({id:NT.generateUuid(),registerOptions:Object.assign({},e.executeCommandProvider)})}register(e){let t=this._client,n=t.middleware,i=(s,o)=>{let a={command:s,arguments:o};return t.sendRequest(vf.ExecuteCommandRequest.type,a).then(void 0,c=>t.handleFailedRequest(vf.ExecuteCommandRequest.type,void 0,c,void 0))};if(e.registerOptions.commands){let s=[];for(let o of e.registerOptions.commands)s.push(MT.commands.registerCommand(o,(...a)=>n.executeCommand?n.executeCommand(o,a,i):i(o,a)));this._commands.set(e.id,s)}}unregister(e){let t=this._commands.get(e);t&&t.forEach(n=>n.dispose())}clear(){this._commands.forEach(e=>{e.forEach(t=>t.dispose())}),this._commands.clear()}};ka.ExecuteCommandFeature=yf});var Zb=I(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.FileSystemWatcherFeature=void 0;var AT=require("vscode"),mi=me(),Ea=Ie(),bf=class{constructor(e,t){this._client=e,this._notifyFileEvent=t,this._watchers=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._watchers.size>0}}get registrationType(){return mi.DidChangeWatchedFilesNotification.type}fillClientCapabilities(e){(0,Ea.ensure)((0,Ea.ensure)(e,"workspace"),"didChangeWatchedFiles").dynamicRegistration=!0,(0,Ea.ensure)((0,Ea.ensure)(e,"workspace"),"didChangeWatchedFiles").relativePatternSupport=!0}initialize(e,t){}register(e){if(!Array.isArray(e.registerOptions.watchers))return;let t=[];for(let n of e.registerOptions.watchers){let i=this._client.protocol2CodeConverter.asGlobPattern(n.globPattern);if(i===void 0)continue;let s=!0,o=!0,a=!0;n.kind!==void 0&&n.kind!==null&&(s=(n.kind&mi.WatchKind.Create)!==0,o=(n.kind&mi.WatchKind.Change)!==0,a=(n.kind&mi.WatchKind.Delete)!==0);let c=AT.workspace.createFileSystemWatcher(i,!s,!o,!a);this.hookListeners(c,s,o,a,t),t.push(c)}this._watchers.set(e.id,t)}registerRaw(e,t){let n=[];for(let i of t)this.hookListeners(i,!0,!0,!0,n);this._watchers.set(e,n)}hookListeners(e,t,n,i,s){t&&e.onDidCreate(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:mi.FileChangeType.Created}),null,s),n&&e.onDidChange(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:mi.FileChangeType.Changed}),null,s),i&&e.onDidDelete(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:mi.FileChangeType.Deleted}),null,s)}unregister(e){let t=this._watchers.get(e);if(t)for(let n of t)n.dispose()}clear(){this._watchers.forEach(e=>{for(let t of e)t.dispose()}),this._watchers.clear()}};xa.FileSystemWatcherFeature=bf});var ew=I(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});Ia.ColorProviderFeature=void 0;var jT=require("vscode"),$s=me(),wf=Ie(),Cf=class extends wf.TextDocumentLanguageFeature{constructor(e){super(e,$s.DocumentColorRequest.type)}fillClientCapabilities(e){(0,wf.ensure)((0,wf.ensure)(e,"textDocument"),"colorProvider").dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.colorProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideColorPresentations:(i,s,o)=>{let a=this._client,c=(g,v,m)=>{let S={color:g,textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(v.document),range:a.code2ProtocolConverter.asRange(v.range)};return a.sendRequest($s.ColorPresentationRequest.type,S,m).then(b=>m.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorPresentations(b,m),b=>a.handleFailedRequest($s.ColorPresentationRequest.type,m,b,null))},d=a.middleware;return d.provideColorPresentations?d.provideColorPresentations(i,s,o,c):c(i,s,o)},provideDocumentColors:(i,s)=>{let o=this._client,a=(d,g)=>{let v={textDocument:o.code2ProtocolConverter.asTextDocumentIdentifier(d)};return o.sendRequest($s.DocumentColorRequest.type,v,g).then(m=>g.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorInformations(m,g),m=>o.handleFailedRequest($s.DocumentColorRequest.type,g,m,null))},c=o.middleware;return c.provideDocumentColors?c.provideDocumentColors(i,s,a):a(i,s)}};return[jT.languages.registerColorProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Ia.ColorProviderFeature=Cf});var tw=I(qa=>{"use strict";Object.defineProperty(qa,"__esModule",{value:!0});qa.ImplementationFeature=void 0;var $T=require("vscode"),Rf=me(),Sf=Ie(),_f=class extends Sf.TextDocumentLanguageFeature{constructor(e){super(e,Rf.ImplementationRequest.type)}fillClientCapabilities(e){let t=(0,Sf.ensure)((0,Sf.ensure)(e,"textDocument"),"implementation");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.implementationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideImplementation:(i,s,o)=>{let a=this._client,c=(g,v,m)=>a.sendRequest(Rf.ImplementationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(g,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,m),S=>a.handleFailedRequest(Rf.ImplementationRequest.type,m,S,null)),d=a.middleware;return d.provideImplementation?d.provideImplementation(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return $T.languages.registerImplementationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};qa.ImplementationFeature=_f});var nw=I(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.TypeDefinitionFeature=void 0;var UT=require("vscode"),Tf=me(),Us=Ie(),Pf=class extends Us.TextDocumentLanguageFeature{constructor(e){super(e,Tf.TypeDefinitionRequest.type)}fillClientCapabilities(e){(0,Us.ensure)((0,Us.ensure)(e,"textDocument"),"typeDefinition").dynamicRegistration=!0;let t=(0,Us.ensure)((0,Us.ensure)(e,"textDocument"),"typeDefinition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeDefinitionProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideTypeDefinition:(i,s,o)=>{let a=this._client,c=(g,v,m)=>a.sendRequest(Tf.TypeDefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(g,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,m),S=>a.handleFailedRequest(Tf.TypeDefinitionRequest.type,m,S,null)),d=a.middleware;return d.provideTypeDefinition?d.provideTypeDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return UT.languages.registerTypeDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Oa.TypeDefinitionFeature=Pf});var rw=I(ts=>{"use strict";Object.defineProperty(ts,"__esModule",{value:!0});ts.WorkspaceFoldersFeature=ts.arrayDiff=void 0;var WT=at(),Fa=require("vscode"),Ws=me();function Df(r,e){if(r!=null)return r[e]}function kf(r,e){return r.filter(t=>e.indexOf(t)<0)}ts.arrayDiff=kf;var Ef=class{constructor(e){this._client=e,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Ws.DidChangeWorkspaceFoldersNotification.type}fillInitializeParams(e){let t=Fa.workspace.workspaceFolders;this.initializeWithFolders(t),t===void 0?e.workspaceFolders=null:e.workspaceFolders=t.map(n=>this.asProtocol(n))}initializeWithFolders(e){this._initialFolders=e}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.workspaceFolders=!0}initialize(e){let t=this._client;t.onRequest(Ws.WorkspaceFoldersRequest.type,s=>{let o=()=>{let c=Fa.workspace.workspaceFolders;return c===void 0?null:c.map(g=>this.asProtocol(g))},a=t.middleware.workspace;return a&&a.workspaceFolders?a.workspaceFolders(s,o):o(s)});let n=Df(Df(Df(e,"workspace"),"workspaceFolders"),"changeNotifications"),i;typeof n=="string"?i=n:n===!0&&(i=WT.generateUuid()),i&&this.register({id:i,registerOptions:void 0})}sendInitialEvent(e){let t;if(this._initialFolders&&e){let n=kf(this._initialFolders,e),i=kf(e,this._initialFolders);(i.length>0||n.length>0)&&(t=this.doSendEvent(i,n))}else this._initialFolders?t=this.doSendEvent([],this._initialFolders):e&&(t=this.doSendEvent(e,[]));t!==void 0&&t.catch(n=>{this._client.error(`Sending notification ${Ws.DidChangeWorkspaceFoldersNotification.type.method} failed`,n)})}doSendEvent(e,t){let n={event:{added:e.map(i=>this.asProtocol(i)),removed:t.map(i=>this.asProtocol(i))}};return this._client.sendNotification(Ws.DidChangeWorkspaceFoldersNotification.type,n)}register(e){let t=e.id,n=this._client,i=Fa.workspace.onDidChangeWorkspaceFolders(s=>{let o=d=>this.doSendEvent(d.added,d.removed),a=n.middleware.workspace;(a&&a.didChangeWorkspaceFolders?a.didChangeWorkspaceFolders(s,o):o(s)).catch(d=>{this._client.error(`Sending notification ${Ws.DidChangeWorkspaceFoldersNotification.type.method} failed`,d)})});this._listeners.set(t,i),this.sendInitialEvent(Fa.workspace.workspaceFolders)}unregister(e){let t=this._listeners.get(e);t!==void 0&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear()}asProtocol(e){return e===void 0?null:{uri:this._client.code2ProtocolConverter.asUri(e.uri),name:e.name}}};ts.WorkspaceFoldersFeature=Ef});var sw=I(La=>{"use strict";Object.defineProperty(La,"__esModule",{value:!0});La.FoldingRangeFeature=void 0;var iw=require("vscode"),vi=me(),Hs=Ie(),xf=class extends Hs.TextDocumentLanguageFeature{constructor(e){super(e,vi.FoldingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Hs.ensure)((0,Hs.ensure)(e,"textDocument"),"foldingRange");t.dynamicRegistration=!0,t.rangeLimit=5e3,t.lineFoldingOnly=!0,t.foldingRangeKind={valueSet:[vi.FoldingRangeKind.Comment,vi.FoldingRangeKind.Imports,vi.FoldingRangeKind.Region]},t.foldingRange={collapsedText:!1},(0,Hs.ensure)((0,Hs.ensure)(e,"workspace"),"foldingRange").refreshSupport=!0}initialize(e,t){this._client.onRequest(vi.FoldingRangeRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeFoldingRange.fire()});let[n,i]=this.getRegistration(t,e.foldingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new iw.EventEmitter,i={onDidChangeFoldingRanges:n.event,provideFoldingRanges:(s,o,a)=>{let c=this._client,d=(v,m,S)=>{let b={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v)};return c.sendRequest(vi.FoldingRangeRequest.type,b,S).then(E=>S.isCancellationRequested?null:c.protocol2CodeConverter.asFoldingRanges(E,S),E=>c.handleFailedRequest(vi.FoldingRangeRequest.type,S,E,null))},g=c.middleware;return g.provideFoldingRanges?g.provideFoldingRanges(s,o,a,d):d(s,o,a)}};return[iw.languages.registerFoldingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeFoldingRange:n}]}};La.FoldingRangeFeature=xf});var ow=I(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});Ma.DeclarationFeature=void 0;var HT=require("vscode"),If=me(),qf=Ie(),Of=class extends qf.TextDocumentLanguageFeature{constructor(e){super(e,If.DeclarationRequest.type)}fillClientCapabilities(e){let t=(0,qf.ensure)((0,qf.ensure)(e,"textDocument"),"declaration");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.declarationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDeclaration:(i,s,o)=>{let a=this._client,c=(g,v,m)=>a.sendRequest(If.DeclarationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(g,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDeclarationResult(S,m),S=>a.handleFailedRequest(If.DeclarationRequest.type,m,S,null)),d=a.middleware;return d.provideDeclaration?d.provideDeclaration(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return HT.languages.registerDeclarationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ma.DeclarationFeature=Of});var aw=I(Na=>{"use strict";Object.defineProperty(Na,"__esModule",{value:!0});Na.SelectionRangeFeature=void 0;var VT=require("vscode"),Ff=me(),Lf=Ie(),Mf=class extends Lf.TextDocumentLanguageFeature{constructor(e){super(e,Ff.SelectionRangeRequest.type)}fillClientCapabilities(e){let t=(0,Lf.ensure)((0,Lf.ensure)(e,"textDocument"),"selectionRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.selectionRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideSelectionRanges:(i,s,o)=>{let a=this._client,c=async(g,v,m)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(g),positions:a.code2ProtocolConverter.asPositionsSync(v,m)};return a.sendRequest(Ff.SelectionRangeRequest.type,S,m).then(b=>m.isCancellationRequested?null:a.protocol2CodeConverter.asSelectionRanges(b,m),b=>a.handleFailedRequest(Ff.SelectionRangeRequest.type,m,b,null))},d=a.middleware;return d.provideSelectionRanges?d.provideSelectionRanges(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return VT.languages.registerSelectionRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Na.SelectionRangeFeature=Mf});var uw=I(Aa=>{"use strict";Object.defineProperty(Aa,"__esModule",{value:!0});Aa.ProgressFeature=void 0;var cw=me(),zT=cl();function KT(r,e){return r[e]===void 0&&(r[e]=Object.create(null)),r[e]}var Nf=class{constructor(e){this._client=e,this.activeParts=new Set}getState(){return{kind:"window",id:cw.WorkDoneProgressCreateRequest.method,registrations:this.activeParts.size>0}}fillClientCapabilities(e){KT(e,"window").workDoneProgress=!0}initialize(){let e=this._client,t=i=>{this.activeParts.delete(i)},n=i=>{this.activeParts.add(new zT.ProgressPart(this._client,i.token,t))};e.onRequest(cw.WorkDoneProgressCreateRequest.type,n)}clear(){for(let e of this.activeParts)e.done();this.activeParts.clear()}};Aa.ProgressFeature=Nf});var dw=I(ja=>{"use strict";Object.defineProperty(ja,"__esModule",{value:!0});ja.CallHierarchyFeature=void 0;var BT=require("vscode"),yi=me(),Af=Ie(),jf=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareCallHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let g=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(yi.CallHierarchyPrepareRequest.type,g,d).then(v=>d.isCancellationRequested?null:i.protocol2CodeConverter.asCallHierarchyItems(v,d),v=>i.handleFailedRequest(yi.CallHierarchyPrepareRequest.type,d,v,null))};return s.prepareCallHierarchy?s.prepareCallHierarchy(e,t,n,o):o(e,t,n)}provideCallHierarchyIncomingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(yi.CallHierarchyIncomingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyIncomingCalls(d,a),d=>n.handleFailedRequest(yi.CallHierarchyIncomingCallsRequest.type,a,d,null))};return i.provideCallHierarchyIncomingCalls?i.provideCallHierarchyIncomingCalls(e,t,s):s(e,t)}provideCallHierarchyOutgoingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(yi.CallHierarchyOutgoingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyOutgoingCalls(d,a),d=>n.handleFailedRequest(yi.CallHierarchyOutgoingCallsRequest.type,a,d,null))};return i.provideCallHierarchyOutgoingCalls?i.provideCallHierarchyOutgoingCalls(e,t,s):s(e,t)}},$f=class extends Af.TextDocumentLanguageFeature{constructor(e){super(e,yi.CallHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=e,n=(0,Af.ensure)((0,Af.ensure)(t,"textDocument"),"callHierarchy");n.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.callHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new jf(t);return[BT.languages.registerCallHierarchyProvider(this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};ja.CallHierarchyFeature=$f});var lw=I(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.SemanticTokensFeature=void 0;var $a=require("vscode"),be=me(),Vs=Ie(),GT=zn(),Uf=class extends Vs.TextDocumentLanguageFeature{constructor(e){super(e,be.SemanticTokensRegistrationType.type)}fillClientCapabilities(e){let t=(0,Vs.ensure)((0,Vs.ensure)(e,"textDocument"),"semanticTokens");t.dynamicRegistration=!0,t.tokenTypes=[be.SemanticTokenTypes.namespace,be.SemanticTokenTypes.type,be.SemanticTokenTypes.class,be.SemanticTokenTypes.enum,be.SemanticTokenTypes.interface,be.SemanticTokenTypes.struct,be.SemanticTokenTypes.typeParameter,be.SemanticTokenTypes.parameter,be.SemanticTokenTypes.variable,be.SemanticTokenTypes.property,be.SemanticTokenTypes.enumMember,be.SemanticTokenTypes.event,be.SemanticTokenTypes.function,be.SemanticTokenTypes.method,be.SemanticTokenTypes.macro,be.SemanticTokenTypes.keyword,be.SemanticTokenTypes.modifier,be.SemanticTokenTypes.comment,be.SemanticTokenTypes.string,be.SemanticTokenTypes.number,be.SemanticTokenTypes.regexp,be.SemanticTokenTypes.operator,be.SemanticTokenTypes.decorator],t.tokenModifiers=[be.SemanticTokenModifiers.declaration,be.SemanticTokenModifiers.definition,be.SemanticTokenModifiers.readonly,be.SemanticTokenModifiers.static,be.SemanticTokenModifiers.deprecated,be.SemanticTokenModifiers.abstract,be.SemanticTokenModifiers.async,be.SemanticTokenModifiers.modification,be.SemanticTokenModifiers.documentation,be.SemanticTokenModifiers.defaultLibrary],t.formats=[be.TokenFormat.Relative],t.requests={range:!0,full:{delta:!0}},t.multilineTokenSupport=!1,t.overlappingTokenSupport=!1,t.serverCancelSupport=!0,t.augmentsSyntaxTokens=!0,(0,Vs.ensure)((0,Vs.ensure)(e,"workspace"),"semanticTokens").refreshSupport=!0}initialize(e,t){this._client.onRequest(be.SemanticTokensRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeSemanticTokensEmitter.fire()});let[i,s]=this.getRegistration(t,e.semanticTokensProvider);!i||!s||this.register({id:i,registerOptions:s})}registerLanguageProvider(e){let t=e.documentSelector,n=GT.boolean(e.full)?e.full:e.full!==void 0,i=e.full!==void 0&&typeof e.full!="boolean"&&e.full.delta===!0,s=new $a.EventEmitter,o=n?{onDidChangeSemanticTokens:s.event,provideDocumentSemanticTokens:(S,b)=>{let E=this._client,x=E.middleware,$=(U,M)=>{let z={textDocument:E.code2ProtocolConverter.asTextDocumentIdentifier(U)};return E.sendRequest(be.SemanticTokensRequest.type,z,M).then(B=>M.isCancellationRequested?null:E.protocol2CodeConverter.asSemanticTokens(B,M),B=>E.handleFailedRequest(be.SemanticTokensRequest.type,M,B,null))};return x.provideDocumentSemanticTokens?x.provideDocumentSemanticTokens(S,b,$):$(S,b)},provideDocumentSemanticTokensEdits:i?(S,b,E)=>{let x=this._client,$=x.middleware,U=(M,z,B)=>{let pe={textDocument:x.code2ProtocolConverter.asTextDocumentIdentifier(M),previousResultId:z};return x.sendRequest(be.SemanticTokensDeltaRequest.type,pe,B).then(async J=>B.isCancellationRequested?null:be.SemanticTokens.is(J)?await x.protocol2CodeConverter.asSemanticTokens(J,B):await x.protocol2CodeConverter.asSemanticTokensEdits(J,B),J=>x.handleFailedRequest(be.SemanticTokensDeltaRequest.type,B,J,null))};return $.provideDocumentSemanticTokensEdits?$.provideDocumentSemanticTokensEdits(S,b,E,U):U(S,b,E)}:void 0}:void 0,c=e.range===!0?{provideDocumentRangeSemanticTokens:(S,b,E)=>{let x=this._client,$=x.middleware,U=(M,z,B)=>{let pe={textDocument:x.code2ProtocolConverter.asTextDocumentIdentifier(M),range:x.code2ProtocolConverter.asRange(z)};return x.sendRequest(be.SemanticTokensRangeRequest.type,pe,B).then(J=>B.isCancellationRequested?null:x.protocol2CodeConverter.asSemanticTokens(J,B),J=>x.handleFailedRequest(be.SemanticTokensRangeRequest.type,B,J,null))};return $.provideDocumentRangeSemanticTokens?$.provideDocumentRangeSemanticTokens(S,b,E,U):U(S,b,E)}}:void 0,d=[],g=this._client,v=g.protocol2CodeConverter.asSemanticTokensLegend(e.legend),m=g.protocol2CodeConverter.asDocumentSelector(t);return o!==void 0&&d.push($a.languages.registerDocumentSemanticTokensProvider(m,o,v)),c!==void 0&&d.push($a.languages.registerDocumentRangeSemanticTokensProvider(m,c,v)),[new $a.Disposable(()=>d.forEach(S=>S.dispose())),{range:c,full:o,onDidChangeSemanticTokensEmitter:s}]}};Ua.SemanticTokensFeature=Uf});var pw=I(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.WillDeleteFilesFeature=hn.WillRenameFilesFeature=hn.WillCreateFilesFeature=hn.DidDeleteFilesFeature=hn.DidRenameFilesFeature=hn.DidCreateFilesFeature=void 0;var Qn=require("vscode"),JT=ua(),Ir=me(),XT=at();function fw(r,e){return r[e]===void 0&&(r[e]={}),r[e]}function QT(r,e){return r[e]}function hw(r,e,t){r[e]=t}var zs=class r{constructor(e,t,n,i,s){this._client=e,this._event=t,this._registrationType=n,this._clientCapability=i,this._serverCapability=s,this._filters=new Map}getState(){return{kind:"workspace",id:this._registrationType.method,registrations:this._filters.size>0}}filterSize(){return this._filters.size}get registrationType(){return this._registrationType}fillClientCapabilities(e){let t=fw(fw(e,"workspace"),"fileOperations");hw(t,"dynamicRegistration",!0),hw(t,this._clientCapability,!0)}initialize(e){let t=e.workspace?.fileOperations,n=t!==void 0?QT(t,this._serverCapability):void 0;if(n?.filters!==void 0)try{this.register({id:XT.generateUuid(),registerOptions:{filters:n.filters}})}catch(i){this._client.warn(`Ignoring invalid glob pattern for ${this._serverCapability} registration: ${i}`)}}register(e){this._listener||(this._listener=this._event(this.send,this));let t=e.registerOptions.filters.map(n=>{let i=new JT.Minimatch(n.pattern.glob,r.asMinimatchOptions(n.pattern.options));if(!i.makeRe())throw new Error(`Invalid pattern ${n.pattern.glob}!`);return{scheme:n.scheme,matcher:i,kind:n.pattern.matches}});this._filters.set(e.id,t)}unregister(e){this._filters.delete(e),this._filters.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._filters.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getFileType(e){return r.getFileType(e)}async filter(e,t){let n=await Promise.all(e.files.map(async s=>{let o=t(s),a=o.fsPath.replace(/\\/g,"/");for(let c of this._filters.values())for(let d of c)if(!(d.scheme!==void 0&&d.scheme!==o.scheme)){if(d.matcher.match(a)){if(d.kind===void 0)return!0;let g=await this.getFileType(o);if(g===void 0)return this._client.error(`Failed to determine file type for ${o.toString()}.`),!0;if(g===Qn.FileType.File&&d.kind===Ir.FileOperationPatternKind.file||g===Qn.FileType.Directory&&d.kind===Ir.FileOperationPatternKind.folder)return!0}else if(d.kind===Ir.FileOperationPatternKind.folder&&await r.getFileType(o)===Qn.FileType.Directory&&d.matcher.match(`${a}/`))return!0}return!1})),i=e.files.filter((s,o)=>n[o]);return{...e,files:i}}static async getFileType(e){try{return(await Qn.workspace.fs.stat(e)).type}catch{return}}static asMinimatchOptions(e){let t={dot:!0};return e?.ignoreCase===!0&&(t.nocase=!0),t}},Wa=class extends zs{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._notificationType=n,this._accessUri=o,this._createParams=a}async send(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=async i=>this._client.sendNotification(this._notificationType,this._createParams(i));return this.doSend(t,n)}}},Ha=class extends Wa{constructor(){super(...arguments),this._fsPathFileTypes=new Map}async getFileType(e){let t=e.fsPath;if(this._fsPathFileTypes.has(t))return this._fsPathFileTypes.get(t);let n=await zs.getFileType(e);return n&&this._fsPathFileTypes.set(t,n),n}async cacheFileTypes(e,t){await this.filter(e,t)}clearFileTypeCache(){this._fsPathFileTypes.clear()}unregister(e){super.unregister(e),this.filterSize()===0&&this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}clear(){super.clear(),this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}},Wf=class extends Wa{constructor(e){super(e,Qn.workspace.onDidCreateFiles,Ir.DidCreateFilesNotification.type,"didCreate","didCreate",t=>t,e.code2ProtocolConverter.asDidCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.didCreateFiles?n.didCreateFiles(e,t):t(e)}};hn.DidCreateFilesFeature=Wf;var Hf=class extends Ha{constructor(e){super(e,Qn.workspace.onDidRenameFiles,Ir.DidRenameFilesNotification.type,"didRename","didRename",t=>t.oldUri,e.code2ProtocolConverter.asDidRenameFilesParams)}register(e){this._willListener||(this._willListener=Qn.workspace.onWillRenameFiles(this.willRename,this)),super.register(e)}willRename(e){e.waitUntil(this.cacheFileTypes(e,t=>t.oldUri))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didRenameFiles?n.didRenameFiles(e,t):t(e)}};hn.DidRenameFilesFeature=Hf;var Vf=class extends Ha{constructor(e){super(e,Qn.workspace.onDidDeleteFiles,Ir.DidDeleteFilesNotification.type,"didDelete","didDelete",t=>t,e.code2ProtocolConverter.asDidDeleteFilesParams)}register(e){this._willListener||(this._willListener=Qn.workspace.onWillDeleteFiles(this.willDelete,this)),super.register(e)}willDelete(e){e.waitUntil(this.cacheFileTypes(e,t=>t))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didDeleteFiles?n.didDeleteFiles(e,t):t(e)}};hn.DidDeleteFilesFeature=Vf;var Ks=class extends zs{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._requestType=n,this._accessUri=o,this._createParams=a}async send(e){let t=this.waitUntil(e);e.waitUntil(t)}async waitUntil(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=i=>this._client.sendRequest(this._requestType,this._createParams(i),i.token).then(this._client.protocol2CodeConverter.asWorkspaceEdit);return this.doSend(t,n)}else return}},zf=class extends Ks{constructor(e){super(e,Qn.workspace.onWillCreateFiles,Ir.WillCreateFilesRequest.type,"willCreate","willCreate",t=>t,e.code2ProtocolConverter.asWillCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willCreateFiles?n.willCreateFiles(e,t):t(e)}};hn.WillCreateFilesFeature=zf;var Kf=class extends Ks{constructor(e){super(e,Qn.workspace.onWillRenameFiles,Ir.WillRenameFilesRequest.type,"willRename","willRename",t=>t.oldUri,e.code2ProtocolConverter.asWillRenameFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willRenameFiles?n.willRenameFiles(e,t):t(e)}};hn.WillRenameFilesFeature=Kf;var Bf=class extends Ks{constructor(e){super(e,Qn.workspace.onWillDeleteFiles,Ir.WillDeleteFilesRequest.type,"willDelete","willDelete",t=>t,e.code2ProtocolConverter.asWillDeleteFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willDeleteFiles?n.willDeleteFiles(e,t):t(e)}};hn.WillDeleteFilesFeature=Bf});var gw=I(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.LinkedEditingFeature=void 0;var YT=require("vscode"),Gf=me(),Jf=Ie(),Xf=class extends Jf.TextDocumentLanguageFeature{constructor(e){super(e,Gf.LinkedEditingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Jf.ensure)((0,Jf.ensure)(e,"textDocument"),"linkedEditingRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.linkedEditingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideLinkedEditingRanges:(i,s,o)=>{let a=this._client,c=(g,v,m)=>a.sendRequest(Gf.LinkedEditingRangeRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(g,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asLinkedEditingRanges(S,m),S=>a.handleFailedRequest(Gf.LinkedEditingRangeRequest.type,m,S,null)),d=a.middleware;return d.provideLinkedEditingRange?d.provideLinkedEditingRange(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return YT.languages.registerLinkedEditingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Va.LinkedEditingFeature=Xf});var mw=I(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.TypeHierarchyFeature=void 0;var ZT=require("vscode"),bi=me(),Qf=Ie(),Yf=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareTypeHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let g=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(bi.TypeHierarchyPrepareRequest.type,g,d).then(v=>d.isCancellationRequested?null:i.protocol2CodeConverter.asTypeHierarchyItems(v,d),v=>i.handleFailedRequest(bi.TypeHierarchyPrepareRequest.type,d,v,null))};return s.prepareTypeHierarchy?s.prepareTypeHierarchy(e,t,n,o):o(e,t,n)}provideTypeHierarchySupertypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(bi.TypeHierarchySupertypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(bi.TypeHierarchySupertypesRequest.type,a,d,null))};return i.provideTypeHierarchySupertypes?i.provideTypeHierarchySupertypes(e,t,s):s(e,t)}provideTypeHierarchySubtypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(bi.TypeHierarchySubtypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(bi.TypeHierarchySubtypesRequest.type,a,d,null))};return i.provideTypeHierarchySubtypes?i.provideTypeHierarchySubtypes(e,t,s):s(e,t)}},Zf=class extends Qf.TextDocumentLanguageFeature{constructor(e){super(e,bi.TypeHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=(0,Qf.ensure)((0,Qf.ensure)(e,"textDocument"),"typeHierarchy");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new Yf(t);return[ZT.languages.registerTypeHierarchyProvider(t.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};za.TypeHierarchyFeature=Zf});var yw=I(Ba=>{"use strict";Object.defineProperty(Ba,"__esModule",{value:!0});Ba.InlineValueFeature=void 0;var vw=require("vscode"),Ka=me(),Bs=Ie(),eh=class extends Bs.TextDocumentLanguageFeature{constructor(e){super(e,Ka.InlineValueRequest.type)}fillClientCapabilities(e){(0,Bs.ensure)((0,Bs.ensure)(e,"textDocument"),"inlineValue").dynamicRegistration=!0,(0,Bs.ensure)((0,Bs.ensure)(e,"workspace"),"inlineValue").refreshSupport=!0}initialize(e,t){this._client.onRequest(Ka.InlineValueRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlineValues.fire()});let[n,i]=this.getRegistration(t,e.inlineValueProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new vw.EventEmitter,i={onDidChangeInlineValues:n.event,provideInlineValues:(s,o,a,c)=>{let d=this._client,g=(m,S,b,E)=>{let x={textDocument:d.code2ProtocolConverter.asTextDocumentIdentifier(m),range:d.code2ProtocolConverter.asRange(S),context:d.code2ProtocolConverter.asInlineValueContext(b)};return d.sendRequest(Ka.InlineValueRequest.type,x,E).then($=>E.isCancellationRequested?null:d.protocol2CodeConverter.asInlineValues($,E),$=>d.handleFailedRequest(Ka.InlineValueRequest.type,E,$,null))},v=d.middleware;return v.provideInlineValues?v.provideInlineValues(s,o,a,c,g):g(s,o,a,c)}};return[this.registerProvider(t,i),{provider:i,onDidChangeInlineValues:n}]}registerProvider(e,t){return vw.languages.registerInlineValuesProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ba.InlineValueFeature=eh});var ww=I(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});Ga.InlayHintsFeature=void 0;var bw=require("vscode"),ns=me(),Gs=Ie(),th=class extends Gs.TextDocumentLanguageFeature{constructor(e){super(e,ns.InlayHintRequest.type)}fillClientCapabilities(e){let t=(0,Gs.ensure)((0,Gs.ensure)(e,"textDocument"),"inlayHint");t.dynamicRegistration=!0,t.resolveSupport={properties:["tooltip","textEdits","label.tooltip","label.location","label.command"]},(0,Gs.ensure)((0,Gs.ensure)(e,"workspace"),"inlayHint").refreshSupport=!0}initialize(e,t){this._client.onRequest(ns.InlayHintRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlayHints.fire()});let[n,i]=this.getRegistration(t,e.inlayHintProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new bw.EventEmitter,i={onDidChangeInlayHints:n.event,provideInlayHints:(s,o,a)=>{let c=this._client,d=async(v,m,S)=>{let b={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),range:c.code2ProtocolConverter.asRange(m)};try{let E=await c.sendRequest(ns.InlayHintRequest.type,b,S);return S.isCancellationRequested?null:c.protocol2CodeConverter.asInlayHints(E,S)}catch(E){return c.handleFailedRequest(ns.InlayHintRequest.type,S,E,null)}},g=c.middleware;return g.provideInlayHints?g.provideInlayHints(s,o,a,d):d(s,o,a)}};return i.resolveInlayHint=e.resolveProvider===!0?(s,o)=>{let a=this._client,c=async(g,v)=>{try{let m=await a.sendRequest(ns.InlayHintResolveRequest.type,a.code2ProtocolConverter.asInlayHint(g),v);if(v.isCancellationRequested)return null;let S=a.protocol2CodeConverter.asInlayHint(m,v);return v.isCancellationRequested?null:S}catch(m){return a.handleFailedRequest(ns.InlayHintResolveRequest.type,v,m,null)}},d=a.middleware;return d.resolveInlayHint?d.resolveInlayHint(s,o,c):c(s,o)}:void 0,[this.registerProvider(t,i),{provider:i,onDidChangeInlayHints:n}]}registerProvider(e,t){return bw.languages.registerInlayHintsProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ga.InlayHintsFeature=th});var Cw=I(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});Ja.InlineCompletionItemFeature=void 0;var eP=require("vscode"),nh=me(),rh=Ie(),tP=at(),ih=class extends rh.TextDocumentLanguageFeature{constructor(e){super(e,nh.InlineCompletionRequest.type)}fillClientCapabilities(e){let t=(0,rh.ensure)((0,rh.ensure)(e,"textDocument"),"inlineCompletion");t.dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.inlineCompletionProvider);n&&this.register({id:tP.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideInlineCompletionItems:(i,s,o,a)=>{let c=this._client,d=this._client.middleware,g=(v,m,S,b)=>c.sendRequest(nh.InlineCompletionRequest.type,c.code2ProtocolConverter.asInlineCompletionParams(v,m,S),b).then(E=>b.isCancellationRequested?null:c.protocol2CodeConverter.asInlineCompletionResult(E,b),E=>c.handleFailedRequest(nh.InlineCompletionRequest.type,b,E,null));return d.provideInlineCompletionItems?d.provideInlineCompletionItems(i,s,o,a,g):g(i,s,o,a)}};return[eP.languages.registerInlineCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Ja.InlineCompletionItemFeature=ih});var dh=I(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.ProposedFeatures=Nt.BaseLanguageClient=Nt.MessageTransports=Nt.SuspendMode=Nt.State=Nt.CloseAction=Nt.ErrorAction=Nt.RevealOutputChannelOn=void 0;var je=require("vscode"),H=me(),nP=Qy(),rP=eb(),cr=zn(),Xa=na(),Rw=at(),iP=cl(),ar=Ie(),sP=kl(),Sw=Ib(),_w=Ob(),rs=Fb(),oP=Lb(),aP=Mb(),cP=Nb(),uP=jb(),dP=$b(),lP=Zl(),fP=Wb(),hP=Hb(),pP=Vb(),gP=Kb(),sh=Bb(),mP=Jb(),vP=Xb(),yP=Yb(),bP=Zb(),wP=ew(),CP=tw(),RP=nw(),SP=rw(),_P=sw(),TP=ow(),PP=aw(),DP=uw(),kP=dw(),EP=lw(),is=pw(),xP=gw(),IP=mw(),qP=yw(),OP=ww(),FP=Cw(),wi;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error",r[r.Never=4]="Never"})(wi||(Nt.RevealOutputChannelOn=wi={}));var Xs;(function(r){r[r.Continue=1]="Continue",r[r.Shutdown=2]="Shutdown"})(Xs||(Nt.ErrorAction=Xs={}));var Qr;(function(r){r[r.DoNotRestart=1]="DoNotRestart",r[r.Restart=2]="Restart"})(Qr||(Nt.CloseAction=Qr={}));var Js;(function(r){r[r.Stopped=1]="Stopped",r[r.Starting=3]="Starting",r[r.Running=2]="Running"})(Js||(Nt.State=Js={}));var Tw;(function(r){r.off="off",r.on="on"})(Tw||(Nt.SuspendMode=Tw={}));var oh;(function(r){function e(t){return t==null?!1:typeof t=="boolean"||typeof t=="object"&&t!==null&&cr.stringArray(t.enabledCommands)?t:!1}r.sanitizeIsTrusted=e})(oh||(oh={}));var ah=class{constructor(e,t){this.client=e,this.maxRestartCount=t,this.restarts=[]}error(e,t,n){return n&&n<=3?{action:Xs.Continue}:{action:Xs.Shutdown}}closed(){return this.restarts.push(Date.now()),this.restarts.length<=this.maxRestartCount?{action:Qr.Restart}:this.restarts[this.restarts.length-1]-this.restarts[0]<=180*1e3?{action:Qr.DoNotRestart,message:`The ${this.client.name} server crashed ${this.maxRestartCount+1} times in the last 3 minutes. The server will not be restarted. See the output for more information.`}:(this.restarts.shift(),{action:Qr.Restart})}},Te;(function(r){r.Initial="initial",r.Starting="starting",r.StartFailed="startFailed",r.Running="running",r.Stopping="stopping",r.Stopped="stopped"})(Te||(Te={}));var Pw;(function(r){function e(t){return t&&H.MessageReader.is(t.reader)&&H.MessageWriter.is(t.writer)}r.is=e})(Pw||(Nt.MessageTransports=Pw={}));var Qs=class r{constructor(e,t,n){this._traceFormat=H.TraceFormat.Text,this._diagnosticQueue=new Map,this._diagnosticQueueState={state:"idle"},this._features=[],this._dynamicFeatures=new Map,this.workspaceEditLock=new Xa.Semaphore(1),this._id=e,this._name=t,n=n||{};let i={isTrusted:!1,supportHtml:!1};n.markdown!==void 0&&(i.isTrusted=oh.sanitizeIsTrusted(n.markdown.isTrusted),i.supportHtml=n.markdown.supportHtml===!0),this._clientOptions={documentSelector:n.documentSelector??[],synchronize:n.synchronize??{},diagnosticCollectionName:n.diagnosticCollectionName,outputChannelName:n.outputChannelName??this._name,revealOutputChannelOn:n.revealOutputChannelOn??wi.Error,stdioEncoding:n.stdioEncoding??"utf8",initializationOptions:n.initializationOptions,initializationFailedHandler:n.initializationFailedHandler,progressOnInitialization:!!n.progressOnInitialization,errorHandler:n.errorHandler??this.createDefaultErrorHandler(n.connectionOptions?.maxRestartCount),middleware:n.middleware??{},uriConverters:n.uriConverters,workspaceFolder:n.workspaceFolder,connectionOptions:n.connectionOptions,markdown:i,diagnosticPullOptions:n.diagnosticPullOptions??{onChange:!0,onSave:!1},notebookDocumentOptions:n.notebookDocumentOptions??{}},this._clientOptions.synchronize=this._clientOptions.synchronize||{},this._state=Te.Initial,this._ignoredRegistrations=new Set,this._listeners=[],this._notificationHandlers=new Map,this._pendingNotificationHandlers=new Map,this._notificationDisposables=new Map,this._requestHandlers=new Map,this._pendingRequestHandlers=new Map,this._requestDisposables=new Map,this._progressHandlers=new Map,this._pendingProgressHandlers=new Map,this._progressDisposables=new Map,this._connection=void 0,this._initializeResult=void 0,n.outputChannel?(this._outputChannel=n.outputChannel,this._disposeOutputChannel=!1):(this._outputChannel=void 0,this._disposeOutputChannel=!0),this._traceOutputChannel=n.traceOutputChannel,this._diagnostics=void 0,this._pendingOpenNotifications=new Set,this._pendingChangeSemaphore=new Xa.Semaphore(1),this._pendingChangeDelayer=new Xa.Delayer(250),this._fileEvents=[],this._fileEventDelayer=new Xa.Delayer(250),this._onStop=void 0,this._telemetryEmitter=new H.Emitter,this._stateChangeEmitter=new H.Emitter,this._trace=H.Trace.Off,this._tracer={log:(s,o)=>{cr.string(s)?this.logTrace(s,o):this.logObjectTrace(s)}},this._c2p=nP.createConverter(n.uriConverters?n.uriConverters.code2Protocol:void 0),this._p2c=rP.createConverter(n.uriConverters?n.uriConverters.protocol2Code:void 0,this._clientOptions.markdown.isTrusted,this._clientOptions.markdown.supportHtml),this._syncedDocuments=new Map,this.registerBuiltinFeatures()}get name(){return this._name}get middleware(){return this._clientOptions.middleware??Object.create(null)}get clientOptions(){return this._clientOptions}get protocol2CodeConverter(){return this._p2c}get code2ProtocolConverter(){return this._c2p}get onTelemetry(){return this._telemetryEmitter.event}get onDidChangeState(){return this._stateChangeEmitter.event}get outputChannel(){return this._outputChannel||(this._outputChannel=je.window.createOutputChannel(this._clientOptions.outputChannelName?this._clientOptions.outputChannelName:this._name)),this._outputChannel}get traceOutputChannel(){return this._traceOutputChannel?this._traceOutputChannel:this.outputChannel}get diagnostics(){return this._diagnostics}get state(){return this.getPublicState()}get $state(){return this._state}set $state(e){let t=this.getPublicState();this._state=e;let n=this.getPublicState();n!==t&&this._stateChangeEmitter.fire({oldState:t,newState:n})}getPublicState(){switch(this.$state){case Te.Starting:return Js.Starting;case Te.Running:return Js.Running;default:return Js.Stopped}}get initializeResult(){return this._initializeResult}async sendRequest(e,...t){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));let n=await this.$start();this._didChangeTextDocumentFeature.syncKind===H.TextDocumentSyncKind.Full&&await this.sendPendingFullTextDocumentChanges(n);let i=this._clientOptions.middleware?.sendRequest;if(i!==void 0){let s,o;return t.length===1?H.CancellationToken.is(t[0])?o=t[0]:s=t[0]:t.length===2&&(s=t[0],o=t[1]),i(e,s,o,(a,c,d)=>{let g=[];return c!==void 0&&g.push(c),d!==void 0&&g.push(d),n.sendRequest(a,...g)})}else return n.sendRequest(e,...t)}onRequest(e,t){let n=typeof e=="string"?e:e.method;this._requestHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._requestDisposables.set(n,i.onRequest(e,t)),s={dispose:()=>{let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}):(this._pendingRequestHandlers.set(n,t),s={dispose:()=>{this._pendingRequestHandlers.delete(n);let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}),{dispose:()=>{this._requestHandlers.delete(n),s.dispose()}}}async sendNotification(e,t){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));let n=this._didChangeTextDocumentFeature.syncKind===H.TextDocumentSyncKind.Full,i;n&&typeof e!="string"&&e.method===H.DidOpenTextDocumentNotification.method&&(i=t?.textDocument.uri,this._pendingOpenNotifications.add(i));let s=await this.$start();n&&await this.sendPendingFullTextDocumentChanges(s),i!==void 0&&this._pendingOpenNotifications.delete(i);let o=this._clientOptions.middleware?.sendNotification;return o?o(e,s.sendNotification.bind(s),t):s.sendNotification(e,t)}onNotification(e,t){let n=typeof e=="string"?e:e.method;this._notificationHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._notificationDisposables.set(n,i.onNotification(e,t)),s={dispose:()=>{let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}):(this._pendingNotificationHandlers.set(n,t),s={dispose:()=>{this._pendingNotificationHandlers.delete(n);let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}),{dispose:()=>{this._notificationHandlers.delete(n),s.dispose()}}}async sendProgress(e,t,n){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));try{return(await this.$start()).sendProgress(e,t,n)}catch(i){throw this.error(`Sending progress for token ${t} failed.`,i),i}}onProgress(e,t,n){this._progressHandlers.set(t,{type:e,handler:n});let i=this.activeConnection(),s,o=this._clientOptions.middleware?.handleWorkDoneProgress,a=H.WorkDoneProgress.is(e)&&o!==void 0?c=>{o(t,c,()=>n(c))}:n;return i!==void 0?(this._progressDisposables.set(t,i.onProgress(e,t,a)),s={dispose:()=>{let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}):(this._pendingProgressHandlers.set(t,{type:e,handler:n}),s={dispose:()=>{this._pendingProgressHandlers.delete(t);let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}),{dispose:()=>{this._progressHandlers.delete(t),s.dispose()}}}createDefaultErrorHandler(e){if(e!==void 0&&e<0)throw new Error(`Invalid maxRestartCount: ${e}`);return new ah(this,e??4)}async setTrace(e){this._trace=e;let t=this.activeConnection();t!==void 0&&await t.trace(this._trace,this._tracer,{sendNotification:!1,traceFormat:this._traceFormat})}data2String(e){if(e instanceof H.ResponseError){let t=e;return`  Message: ${t.message}
  Code: ${t.code} ${t.data?`
`+t.data.toString():""}`}return e instanceof Error?cr.string(e.stack)?e.stack:e.message:cr.string(e)?e:e.toString()}debug(e,t,n=!0){this.logOutputMessage(H.MessageType.Debug,wi.Debug,"Debug",e,t,n)}info(e,t,n=!0){this.logOutputMessage(H.MessageType.Info,wi.Info,"Info",e,t,n)}warn(e,t,n=!0){this.logOutputMessage(H.MessageType.Warning,wi.Warn,"Warn",e,t,n)}error(e,t,n=!0){this.logOutputMessage(H.MessageType.Error,wi.Error,"Error",e,t,n)}logOutputMessage(e,t,n,i,s,o){this.outputChannel.appendLine(`[${n.padEnd(5)} - ${new Date().toLocaleTimeString()}] ${i}`),s!=null&&this.outputChannel.appendLine(this.data2String(s)),(o==="force"||o&&this._clientOptions.revealOutputChannelOn<=t)&&this.showNotificationMessage(e,i)}showNotificationMessage(e,t){t=t??"A request has failed. See the output for more information.",(e===H.MessageType.Error?je.window.showErrorMessage:e===H.MessageType.Warning?je.window.showWarningMessage:je.window.showInformationMessage)(t,"Go to output").then(i=>{i!==void 0&&this.outputChannel.show(!0)})}logTrace(e,t){this.traceOutputChannel.appendLine(`[Trace - ${new Date().toLocaleTimeString()}] ${e}`),t&&this.traceOutputChannel.appendLine(this.data2String(t))}logObjectTrace(e){e.isLSPMessage&&e.type?this.traceOutputChannel.append(`[LSP   - ${new Date().toLocaleTimeString()}] `):this.traceOutputChannel.append(`[Trace - ${new Date().toLocaleTimeString()}] `),e&&this.traceOutputChannel.appendLine(`${JSON.stringify(e)}`)}needsStart(){return this.$state===Te.Initial||this.$state===Te.Stopping||this.$state===Te.Stopped}needsStop(){return this.$state===Te.Starting||this.$state===Te.Running}activeConnection(){return this.$state===Te.Running&&this._connection!==void 0?this._connection:void 0}isRunning(){return this.$state===Te.Running}async start(){if(this._disposed==="disposing"||this._disposed==="disposed")throw new Error("Client got disposed and can't be restarted.");if(this.$state===Te.Stopping)throw new Error("Client is currently stopping. Can only restart a full stopped client");if(this._onStart!==void 0)return this._onStart;let[e,t,n]=this.createOnStartPromise();this._onStart=e,this._diagnostics===void 0&&(this._diagnostics=this._clientOptions.diagnosticCollectionName?je.languages.createDiagnosticCollection(this._clientOptions.diagnosticCollectionName):je.languages.createDiagnosticCollection());for(let[i,s]of this._notificationHandlers)this._pendingNotificationHandlers.has(i)||this._pendingNotificationHandlers.set(i,s);for(let[i,s]of this._requestHandlers)this._pendingRequestHandlers.has(i)||this._pendingRequestHandlers.set(i,s);for(let[i,s]of this._progressHandlers)this._pendingProgressHandlers.has(i)||this._pendingProgressHandlers.set(i,s);this.$state=Te.Starting;try{let i=await this.createConnection();i.onNotification(H.LogMessageNotification.type,s=>{switch(s.type){case H.MessageType.Error:this.error(s.message,void 0,!1);break;case H.MessageType.Warning:this.warn(s.message,void 0,!1);break;case H.MessageType.Info:this.info(s.message,void 0,!1);break;case H.MessageType.Debug:this.debug(s.message,void 0,!1);break;default:this.outputChannel.appendLine(s.message)}}),i.onNotification(H.ShowMessageNotification.type,s=>{switch(s.type){case H.MessageType.Error:je.window.showErrorMessage(s.message);break;case H.MessageType.Warning:je.window.showWarningMessage(s.message);break;case H.MessageType.Info:je.window.showInformationMessage(s.message);break;default:je.window.showInformationMessage(s.message)}}),i.onRequest(H.ShowMessageRequest.type,s=>{let o;switch(s.type){case H.MessageType.Error:o=je.window.showErrorMessage;break;case H.MessageType.Warning:o=je.window.showWarningMessage;break;case H.MessageType.Info:o=je.window.showInformationMessage;break;default:o=je.window.showInformationMessage}let a=s.actions||[];return o(s.message,...a)}),i.onNotification(H.TelemetryEventNotification.type,s=>{this._telemetryEmitter.fire(s)}),i.onRequest(H.ShowDocumentRequest.type,async s=>{let o=async c=>{let d=this.protocol2CodeConverter.asUri(c.uri);try{if(c.external===!0)return{success:await je.env.openExternal(d)};{let g={};return c.selection!==void 0&&(g.selection=this.protocol2CodeConverter.asRange(c.selection)),c.takeFocus===void 0||c.takeFocus===!1?g.preserveFocus=!0:c.takeFocus===!0&&(g.preserveFocus=!1),await je.window.showTextDocument(d,g),{success:!0}}}catch{return{success:!1}}},a=this._clientOptions.middleware.window?.showDocument;return a!==void 0?a(s,o):o(s)}),i.listen(),await this.initialize(i),t()}catch(i){this.$state=Te.StartFailed,this.error(`${this._name} client: couldn't create connection to server.`,i,"force"),n(i)}return this._onStart}createOnStartPromise(){let e,t;return[new Promise((i,s)=>{e=i,t=s}),e,t]}async initialize(e){this.refreshTrace(e,!1);let t=this._clientOptions.initializationOptions,[n,i]=this._clientOptions.workspaceFolder!==void 0?[this._clientOptions.workspaceFolder.uri.fsPath,[{uri:this._c2p.asUri(this._clientOptions.workspaceFolder.uri),name:this._clientOptions.workspaceFolder.name}]]:[this._clientGetRootPath(),null],s={processId:null,clientInfo:{name:je.env.appName,version:je.version},locale:this.getLocale(),rootPath:n||null,rootUri:n?this._c2p.asUri(je.Uri.file(n)):null,capabilities:this.computeClientCapabilities(),initializationOptions:cr.func(t)?t():t,trace:H.Trace.toString(this._trace),workspaceFolders:i};if(this.fillInitializeParams(s),this._clientOptions.progressOnInitialization){let o=Rw.generateUuid(),a=new iP.ProgressPart(e,o);s.workDoneToken=o;try{let c=await this.doInitialize(e,s);return a.done(),c}catch(c){throw a.cancel(),c}}else return this.doInitialize(e,s)}async doInitialize(e,t){try{let n=await e.initialize(t);if(n.capabilities.positionEncoding!==void 0&&n.capabilities.positionEncoding!==H.PositionEncodingKind.UTF16)throw new Error(`Unsupported position encoding (${n.capabilities.positionEncoding}) received from server ${this.name}`);this._initializeResult=n,this.$state=Te.Running;let i;cr.number(n.capabilities.textDocumentSync)?n.capabilities.textDocumentSync===H.TextDocumentSyncKind.None?i={openClose:!1,change:H.TextDocumentSyncKind.None,save:void 0}:i={openClose:!0,change:n.capabilities.textDocumentSync,save:{includeText:!1}}:n.capabilities.textDocumentSync!==void 0&&n.capabilities.textDocumentSync!==null&&(i=n.capabilities.textDocumentSync),this._capabilities=Object.assign({},n.capabilities,{resolvedTextDocumentSync:i}),e.onNotification(H.PublishDiagnosticsNotification.type,s=>this.handleDiagnostics(s)),e.onRequest(H.RegistrationRequest.type,s=>this.handleRegistrationRequest(s)),e.onRequest("client/registerFeature",s=>this.handleRegistrationRequest(s)),e.onRequest(H.UnregistrationRequest.type,s=>this.handleUnregistrationRequest(s)),e.onRequest("client/unregisterFeature",s=>this.handleUnregistrationRequest(s)),e.onRequest(H.ApplyWorkspaceEditRequest.type,s=>this.handleApplyWorkspaceEdit(s));for(let[s,o]of this._pendingNotificationHandlers)this._notificationDisposables.set(s,e.onNotification(s,o));this._pendingNotificationHandlers.clear();for(let[s,o]of this._pendingRequestHandlers)this._requestDisposables.set(s,e.onRequest(s,o));this._pendingRequestHandlers.clear();for(let[s,o]of this._pendingProgressHandlers)this._progressDisposables.set(s,e.onProgress(o.type,s,o.handler));return this._pendingProgressHandlers.clear(),await e.sendNotification(H.InitializedNotification.type,{}),this.hookFileEvents(e),this.hookConfigurationChanged(e),this.initializeFeatures(e),n}catch(n){throw this._clientOptions.initializationFailedHandler?this._clientOptions.initializationFailedHandler(n)?this.initialize(e):this.stop():n instanceof H.ResponseError&&n.data&&n.data.retry?je.window.showErrorMessage(n.message,{title:"Retry",id:"retry"}).then(i=>{i&&i.id==="retry"?this.initialize(e):this.stop()}):(n&&n.message&&je.window.showErrorMessage(n.message),this.error("Server initialization failed.",n),this.stop()),n}}_clientGetRootPath(){let e=je.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}stop(e=2e3){return this.shutdown("stop",e)}dispose(e=2e3){try{return this._disposed="disposing",this.stop(e)}finally{this._disposed="disposed"}}async shutdown(e,t){if(this.$state===Te.Stopped||this.$state===Te.Initial)return;if(this.$state===Te.Stopping){if(this._onStop!==void 0)return this._onStop;throw new Error("Client is stopping but no stop promise available.")}let n=this.activeConnection();if(n===void 0||this.$state!==Te.Running)throw new Error(`Client is not running and can't be stopped. It's current state is: ${this.$state}`);this._initializeResult=void 0,this.$state=Te.Stopping,this.cleanUp(e);let i=new Promise(o=>{(0,H.RAL)().timer.setTimeout(o,t)}),s=(async o=>(await o.shutdown(),await o.exit(),o))(n);return this._onStop=Promise.race([i,s]).then(o=>{if(o!==void 0)o.end(),o.dispose();else throw this.error("Stopping server timed out",void 0,!1),new Error("Stopping the server timed out")},o=>{throw this.error("Stopping server failed",o,!1),o}).finally(()=>{this.$state=Te.Stopped,e==="stop"&&this.cleanUpChannel(),this._onStart=void 0,this._onStop=void 0,this._connection=void 0,this._ignoredRegistrations.clear()})}cleanUp(e){this._fileEvents=[],this._fileEventDelayer.cancel();let t=this._listeners.splice(0,this._listeners.length);for(let n of t)n.dispose();this._syncedDocuments&&this._syncedDocuments.clear();for(let n of Array.from(this._features.entries()).map(i=>i[1]).reverse())n.clear();e==="stop"&&this._diagnostics!==void 0&&(this._diagnostics.dispose(),this._diagnostics=void 0),this._idleInterval!==void 0&&(this._idleInterval.dispose(),this._idleInterval=void 0)}cleanUpChannel(){this._outputChannel!==void 0&&this._disposeOutputChannel&&(this._outputChannel.dispose(),this._outputChannel=void 0)}notifyFileEvent(e){let t=this;async function n(s){return t._fileEvents.push(s),t._fileEventDelayer.trigger(async()=>{await t.sendNotification(H.DidChangeWatchedFilesNotification.type,{changes:t._fileEvents}),t._fileEvents=[]})}let i=this.clientOptions.middleware?.workspace;(i?.didChangeWatchedFile?i.didChangeWatchedFile(e,n):n(e)).catch(s=>{t.error("Notify file events failed.",s)})}async sendPendingFullTextDocumentChanges(e){return this._pendingChangeSemaphore.lock(async()=>{try{let t=this._didChangeTextDocumentFeature.getPendingDocumentChanges(this._pendingOpenNotifications);if(t.length===0)return;for(let n of t){let i=this.code2ProtocolConverter.asChangeTextDocumentParams(n);await e.sendNotification(H.DidChangeTextDocumentNotification.type,i),this._didChangeTextDocumentFeature.notificationSent(n,H.DidChangeTextDocumentNotification.type,i)}}catch(t){throw this.error("Sending pending changes failed",t,!1),t}})}triggerPendingChangeDelivery(){this._pendingChangeDelayer.trigger(async()=>{let e=this.activeConnection();if(e===void 0){this.triggerPendingChangeDelivery();return}await this.sendPendingFullTextDocumentChanges(e)}).catch(e=>this.error("Delivering pending changes failed",e,!1))}handleDiagnostics(e){if(!this._diagnostics)return;let t=e.uri;this._diagnosticQueueState.state==="busy"&&this._diagnosticQueueState.document===t&&this._diagnosticQueueState.tokenSource.cancel(),this._diagnosticQueue.set(e.uri,e.diagnostics),this.triggerDiagnosticQueue()}triggerDiagnosticQueue(){(0,H.RAL)().timer.setImmediate(()=>{this.workDiagnosticQueue()})}workDiagnosticQueue(){if(this._diagnosticQueueState.state==="busy")return;let e=this._diagnosticQueue.entries().next();if(e.done===!0)return;let[t,n]=e.value;this._diagnosticQueue.delete(t);let i=new je.CancellationTokenSource;this._diagnosticQueueState={state:"busy",document:t,tokenSource:i},this._p2c.asDiagnostics(n,i.token).then(s=>{if(!i.token.isCancellationRequested){let o=this._p2c.asUri(t),a=this.clientOptions.middleware;a.handleDiagnostics?a.handleDiagnostics(o,s,(c,d)=>this.setDiagnostics(c,d)):this.setDiagnostics(o,s)}}).finally(()=>{this._diagnosticQueueState={state:"idle"},this.triggerDiagnosticQueue()})}setDiagnostics(e,t){this._diagnostics&&this._diagnostics.set(e,t)}getLocale(){return je.env.language}async $start(){if(this.$state===Te.StartFailed)throw new Error("Previous start failed. Can't restart server.");await this.start();let e=this.activeConnection();if(e===void 0)throw new Error("Starting server failed");return e}async createConnection(){let e=(i,s,o)=>{this.handleConnectionError(i,s,o).catch(a=>this.error("Handling connection error failed",a))},t=()=>{this.handleConnectionClosed().catch(i=>this.error("Handling connection close failed",i))},n=await this.createMessageTransports(this._clientOptions.stdioEncoding||"utf8");return this._connection=LP(n.reader,n.writer,e,t,this._clientOptions.connectionOptions),this._connection}async handleConnectionClosed(){if(this.$state===Te.Stopped)return;try{this._connection!==void 0&&this._connection.dispose()}catch{}let e={action:Qr.DoNotRestart};if(this.$state!==Te.Stopping)try{e=await this._clientOptions.errorHandler.closed()}catch{}this._connection=void 0,e.action===Qr.DoNotRestart?(this.error(e.message??"Connection to server got closed. Server will not be restarted.",void 0,e.handled===!0?!1:"force"),this.cleanUp("stop"),this.$state===Te.Starting?this.$state=Te.StartFailed:this.$state=Te.Stopped,this._onStop=Promise.resolve(),this._onStart=void 0):e.action===Qr.Restart&&(this.info(e.message??"Connection to server got closed. Server will restart.",!e.handled),this.cleanUp("restart"),this.$state=Te.Initial,this._onStop=Promise.resolve(),this._onStart=void 0,this.start().catch(t=>this.error("Restarting server failed",t,"force")))}async handleConnectionError(e,t,n){let i=await this._clientOptions.errorHandler.error(e,t,n);i.action===Xs.Shutdown?(this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}
Shutting down server.`,void 0,i.handled===!0?!1:"force"),this.stop().catch(s=>{this.error("Stopping server failed",s,!1)})):this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}`,void 0,i.handled===!0?!1:"force")}hookConfigurationChanged(e){this._listeners.push(je.workspace.onDidChangeConfiguration(()=>{this.refreshTrace(e,!0)}))}refreshTrace(e,t=!1){let n=je.workspace.getConfiguration(this._id),i=H.Trace.Off,s=H.TraceFormat.Text;if(n){let o=n.get("trace.server","off");typeof o=="string"?i=H.Trace.fromString(o):(i=H.Trace.fromString(n.get("trace.server.verbosity","off")),s=H.TraceFormat.fromString(n.get("trace.server.format","text")))}this._trace=i,this._traceFormat=s,e.trace(this._trace,this._tracer,{sendNotification:t,traceFormat:this._traceFormat}).catch(o=>{this.error("Updating trace failed with error",o,!1)})}hookFileEvents(e){let t=this._clientOptions.synchronize.fileEvents;if(!t)return;let n;cr.array(t)?n=t:n=[t],n&&this._dynamicFeatures.get(H.DidChangeWatchedFilesNotification.type.method).registerRaw(Rw.generateUuid(),n)}registerFeatures(e){for(let t of e)this.registerFeature(t)}registerFeature(e){if(this._features.push(e),ar.DynamicFeature.is(e)){let t=e.registrationType;this._dynamicFeatures.set(t.method,e)}}getFeature(e){return this._dynamicFeatures.get(e)}hasDedicatedTextSynchronizationFeature(e){let t=this.getFeature(H.NotebookDocumentSyncRegistrationType.method);return t===void 0||!(t instanceof Sw.NotebookDocumentSyncFeature)?!1:t.handles(e)}registerBuiltinFeatures(){let e=new Map;this.registerFeature(new _w.ConfigurationFeature(this)),this.registerFeature(new rs.DidOpenTextDocumentFeature(this,this._syncedDocuments)),this._didChangeTextDocumentFeature=new rs.DidChangeTextDocumentFeature(this,e),this._didChangeTextDocumentFeature.onPendingChangeAdded(()=>{this.triggerPendingChangeDelivery()}),this.registerFeature(this._didChangeTextDocumentFeature),this.registerFeature(new rs.WillSaveFeature(this)),this.registerFeature(new rs.WillSaveWaitUntilFeature(this)),this.registerFeature(new rs.DidSaveTextDocumentFeature(this)),this.registerFeature(new rs.DidCloseTextDocumentFeature(this,this._syncedDocuments,e)),this.registerFeature(new bP.FileSystemWatcherFeature(this,t=>this.notifyFileEvent(t))),this.registerFeature(new oP.CompletionItemFeature(this)),this.registerFeature(new aP.HoverFeature(this)),this.registerFeature(new uP.SignatureHelpFeature(this)),this.registerFeature(new cP.DefinitionFeature(this)),this.registerFeature(new hP.ReferencesFeature(this)),this.registerFeature(new dP.DocumentHighlightFeature(this)),this.registerFeature(new lP.DocumentSymbolFeature(this)),this.registerFeature(new fP.WorkspaceSymbolFeature(this)),this.registerFeature(new pP.CodeActionFeature(this)),this.registerFeature(new gP.CodeLensFeature(this)),this.registerFeature(new sh.DocumentFormattingFeature(this)),this.registerFeature(new sh.DocumentRangeFormattingFeature(this)),this.registerFeature(new sh.DocumentOnTypeFormattingFeature(this)),this.registerFeature(new mP.RenameFeature(this)),this.registerFeature(new vP.DocumentLinkFeature(this)),this.registerFeature(new yP.ExecuteCommandFeature(this)),this.registerFeature(new _w.SyncConfigurationFeature(this)),this.registerFeature(new RP.TypeDefinitionFeature(this)),this.registerFeature(new CP.ImplementationFeature(this)),this.registerFeature(new wP.ColorProviderFeature(this)),this.clientOptions.workspaceFolder===void 0&&this.registerFeature(new SP.WorkspaceFoldersFeature(this)),this.registerFeature(new _P.FoldingRangeFeature(this)),this.registerFeature(new TP.DeclarationFeature(this)),this.registerFeature(new PP.SelectionRangeFeature(this)),this.registerFeature(new DP.ProgressFeature(this)),this.registerFeature(new kP.CallHierarchyFeature(this)),this.registerFeature(new EP.SemanticTokensFeature(this)),this.registerFeature(new xP.LinkedEditingFeature(this)),this.registerFeature(new is.DidCreateFilesFeature(this)),this.registerFeature(new is.DidRenameFilesFeature(this)),this.registerFeature(new is.DidDeleteFilesFeature(this)),this.registerFeature(new is.WillCreateFilesFeature(this)),this.registerFeature(new is.WillRenameFilesFeature(this)),this.registerFeature(new is.WillDeleteFilesFeature(this)),this.registerFeature(new IP.TypeHierarchyFeature(this)),this.registerFeature(new qP.InlineValueFeature(this)),this.registerFeature(new OP.InlayHintsFeature(this)),this.registerFeature(new sP.DiagnosticFeature(this)),this.registerFeature(new Sw.NotebookDocumentSyncFeature(this))}registerProposedFeatures(){this.registerFeatures(uh.createAll(this))}fillInitializeParams(e){for(let t of this._features)cr.func(t.fillInitializeParams)&&t.fillInitializeParams(e)}computeClientCapabilities(){let e={};(0,ar.ensure)(e,"workspace").applyEdit=!0;let t=(0,ar.ensure)((0,ar.ensure)(e,"workspace"),"workspaceEdit");t.documentChanges=!0,t.resourceOperations=[H.ResourceOperationKind.Create,H.ResourceOperationKind.Rename,H.ResourceOperationKind.Delete],t.failureHandling=H.FailureHandlingKind.TextOnlyTransactional,t.normalizesLineEndings=!0,t.changeAnnotationSupport={groupsOnLabel:!0};let n=(0,ar.ensure)((0,ar.ensure)(e,"textDocument"),"publishDiagnostics");n.relatedInformation=!0,n.versionSupport=!1,n.tagSupport={valueSet:[H.DiagnosticTag.Unnecessary,H.DiagnosticTag.Deprecated]},n.codeDescriptionSupport=!0,n.dataSupport=!0;let i=(0,ar.ensure)(e,"window"),s=(0,ar.ensure)(i,"showMessage");s.messageActionItem={additionalPropertiesSupport:!0};let o=(0,ar.ensure)(i,"showDocument");o.support=!0;let a=(0,ar.ensure)(e,"general");a.staleRequestSupport={cancel:!0,retryOnContentModified:Array.from(r.RequestsToCancelOnContentModified)},a.regularExpressions={engine:"ECMAScript",version:"ES2020"},a.markdown={parser:"marked",version:"1.1.0"},a.positionEncodings=["utf-16"],this._clientOptions.markdown.supportHtml&&(a.markdown.allowedTags=["ul","li","p","code","blockquote","ol","h1","h2","h3","h4","h5","h6","hr","em","pre","table","thead","tbody","tr","th","td","div","del","a","strong","br","img","span"]);for(let c of this._features)c.fillClientCapabilities(e);return e}initializeFeatures(e){let t=this._clientOptions.documentSelector;for(let n of this._features)cr.func(n.preInitialize)&&n.preInitialize(this._capabilities,t);for(let n of this._features)n.initialize(this._capabilities,t)}async handleRegistrationRequest(e){let t=this.clientOptions.middleware?.handleRegisterCapability;return t?t(e,n=>this.doRegisterCapability(n)):this.doRegisterCapability(e)}async doRegisterCapability(e){if(!this.isRunning()){for(let t of e.registrations)this._ignoredRegistrations.add(t.id);return}for(let t of e.registrations){let n=this._dynamicFeatures.get(t.method);if(n===void 0)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Registration failed.`));let i=t.registerOptions??{};i.documentSelector=i.documentSelector??this._clientOptions.documentSelector;let s={id:t.id,registerOptions:i};try{n.register(s)}catch(o){return Promise.reject(o)}}}async handleUnregistrationRequest(e){let t=this.clientOptions.middleware?.handleUnregisterCapability;return t?t(e,n=>this.doUnregisterCapability(n)):this.doUnregisterCapability(e)}async doUnregisterCapability(e){for(let t of e.unregisterations){if(this._ignoredRegistrations.has(t.id))continue;let n=this._dynamicFeatures.get(t.method);if(!n)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Unregistration failed.`));n.unregister(t.id)}}async handleApplyWorkspaceEdit(e){let t=e.edit,n=await this.workspaceEditLock.lock(()=>this._p2c.asWorkspaceEdit(t)),i=new Map;je.workspace.textDocuments.forEach(o=>i.set(o.uri.toString(),o));let s=!1;if(t.documentChanges){for(let o of t.documentChanges)if(H.TextDocumentEdit.is(o)&&o.textDocument.version&&o.textDocument.version>=0){let a=this._p2c.asUri(o.textDocument.uri).toString(),c=i.get(a);if(c&&c.version!==o.textDocument.version){s=!0;break}}}return s?Promise.resolve({applied:!1}):cr.asPromise(je.workspace.applyEdit(n).then(o=>({applied:o})))}handleFailedRequest(e,t,n,i,s=!0){if(n instanceof H.ResponseError){if(n.code===H.ErrorCodes.PendingResponseRejected||n.code===H.ErrorCodes.ConnectionInactive)return i;if(n.code===H.LSPErrorCodes.RequestCancelled||n.code===H.LSPErrorCodes.ServerCancelled){if(t!==void 0&&t.isCancellationRequested)return i;throw n.data!==void 0?new ar.LSPCancellationError(n.data):new je.CancellationError}else if(n.code===H.LSPErrorCodes.ContentModified){if(r.RequestsToCancelOnContentModified.has(e.method)||r.CancellableResolveCalls.has(e.method))throw new je.CancellationError;return i}}throw this.error(`Request ${e.method} failed.`,n,s),n}};Nt.BaseLanguageClient=Qs;Qs.RequestsToCancelOnContentModified=new Set([H.SemanticTokensRequest.method,H.SemanticTokensRangeRequest.method,H.SemanticTokensDeltaRequest.method]);Qs.CancellableResolveCalls=new Set([H.CompletionResolveRequest.method,H.CodeLensResolveRequest.method,H.CodeActionResolveRequest.method,H.InlayHintResolveRequest.method,H.DocumentLinkResolveRequest.method,H.WorkspaceSymbolResolveRequest.method]);var ch=class{error(e){(0,H.RAL)().console.error(e)}warn(e){(0,H.RAL)().console.warn(e)}info(e){(0,H.RAL)().console.info(e)}log(e){(0,H.RAL)().console.log(e)}};function LP(r,e,t,n,i){let s=new ch,o=(0,H.createProtocolConnection)(r,e,s,i);return o.onError(c=>{t(c[0],c[1],c[2])}),o.onClose(n),{listen:()=>o.listen(),sendRequest:o.sendRequest,onRequest:o.onRequest,hasPendingResponse:o.hasPendingResponse,sendNotification:o.sendNotification,onNotification:o.onNotification,onProgress:o.onProgress,sendProgress:o.sendProgress,trace:(c,d,g)=>{let v={sendNotification:!1,traceFormat:H.TraceFormat.Text};return g===void 0?o.trace(c,d,v):(cr.boolean(g),o.trace(c,d,g))},initialize:c=>o.sendRequest(H.InitializeRequest.type,c),shutdown:()=>o.sendRequest(H.ShutdownRequest.type,void 0),exit:()=>o.sendNotification(H.ExitNotification.type),end:()=>o.end(),dispose:()=>o.dispose()}}var uh;(function(r){function e(t){return[new FP.InlineCompletionItemFeature(t)]}r.createAll=e})(uh||(Nt.ProposedFeatures=uh={}))});var kw=I(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});Qa.terminate=void 0;var Dw=require("child_process"),MP=require("path"),NP=process.platform==="win32",AP=process.platform==="darwin",jP=process.platform==="linux";function $P(r,e){if(NP)try{let i={stdio:["pipe","pipe","ignore"]};return e&&(i.cwd=e),Dw.execFileSync("taskkill",["/T","/F","/PID",r.pid.toString()],i),!0}catch{return!1}else if(jP||AP)try{var t=(0,MP.join)(__dirname,"terminateProcess.sh"),n=Dw.spawnSync(t,[r.pid.toString()]);return!n.error}catch{return!1}else return r.kill("SIGKILL"),!0}Qa.terminate=$P});var lh=I((Bx,Ew)=>{"use strict";Ew.exports=me()});var Ys=I((Gx,xw)=>{"use strict";var UP=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};xw.exports=UP});var Ya=I((Jx,Iw)=>{"use strict";var WP="2.0.0",HP=Number.MAX_SAFE_INTEGER||9007199254740991,VP=16,zP=250,KP=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Iw.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:VP,MAX_SAFE_BUILD_LENGTH:zP,MAX_SAFE_INTEGER:HP,RELEASE_TYPES:KP,SEMVER_SPEC_VERSION:WP,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Za=I((Cr,qw)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:fh,MAX_SAFE_BUILD_LENGTH:BP,MAX_LENGTH:GP}=Ya(),JP=Ys();Cr=qw.exports={};var XP=Cr.re=[],QP=Cr.safeRe=[],X=Cr.src=[],YP=Cr.safeSrc=[],Q=Cr.t={},ZP=0,hh="[a-zA-Z0-9-]",eD=[["\\s",1],["\\d",GP],[hh,BP]],tD=r=>{for(let[e,t]of eD)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},we=(r,e,t)=>{let n=tD(e),i=ZP++;JP(r,i,e),Q[r]=i,X[i]=e,YP[i]=n,XP[i]=new RegExp(e,t?"g":void 0),QP[i]=new RegExp(n,t?"g":void 0)};we("NUMERICIDENTIFIER","0|[1-9]\\d*");we("NUMERICIDENTIFIERLOOSE","\\d+");we("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${hh}*`);we("MAINVERSION",`(${X[Q.NUMERICIDENTIFIER]})\\.(${X[Q.NUMERICIDENTIFIER]})\\.(${X[Q.NUMERICIDENTIFIER]})`);we("MAINVERSIONLOOSE",`(${X[Q.NUMERICIDENTIFIERLOOSE]})\\.(${X[Q.NUMERICIDENTIFIERLOOSE]})\\.(${X[Q.NUMERICIDENTIFIERLOOSE]})`);we("PRERELEASEIDENTIFIER",`(?:${X[Q.NONNUMERICIDENTIFIER]}|${X[Q.NUMERICIDENTIFIER]})`);we("PRERELEASEIDENTIFIERLOOSE",`(?:${X[Q.NONNUMERICIDENTIFIER]}|${X[Q.NUMERICIDENTIFIERLOOSE]})`);we("PRERELEASE",`(?:-(${X[Q.PRERELEASEIDENTIFIER]}(?:\\.${X[Q.PRERELEASEIDENTIFIER]})*))`);we("PRERELEASELOOSE",`(?:-?(${X[Q.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${X[Q.PRERELEASEIDENTIFIERLOOSE]})*))`);we("BUILDIDENTIFIER",`${hh}+`);we("BUILD",`(?:\\+(${X[Q.BUILDIDENTIFIER]}(?:\\.${X[Q.BUILDIDENTIFIER]})*))`);we("FULLPLAIN",`v?${X[Q.MAINVERSION]}${X[Q.PRERELEASE]}?${X[Q.BUILD]}?`);we("FULL",`^${X[Q.FULLPLAIN]}$`);we("LOOSEPLAIN",`[v=\\s]*${X[Q.MAINVERSIONLOOSE]}${X[Q.PRERELEASELOOSE]}?${X[Q.BUILD]}?`);we("LOOSE",`^${X[Q.LOOSEPLAIN]}$`);we("GTLT","((?:<|>)?=?)");we("XRANGEIDENTIFIERLOOSE",`${X[Q.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);we("XRANGEIDENTIFIER",`${X[Q.NUMERICIDENTIFIER]}|x|X|\\*`);we("XRANGEPLAIN",`[v=\\s]*(${X[Q.XRANGEIDENTIFIER]})(?:\\.(${X[Q.XRANGEIDENTIFIER]})(?:\\.(${X[Q.XRANGEIDENTIFIER]})(?:${X[Q.PRERELEASE]})?${X[Q.BUILD]}?)?)?`);we("XRANGEPLAINLOOSE",`[v=\\s]*(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:${X[Q.PRERELEASELOOSE]})?${X[Q.BUILD]}?)?)?`);we("XRANGE",`^${X[Q.GTLT]}\\s*${X[Q.XRANGEPLAIN]}$`);we("XRANGELOOSE",`^${X[Q.GTLT]}\\s*${X[Q.XRANGEPLAINLOOSE]}$`);we("COERCEPLAIN",`(^|[^\\d])(\\d{1,${fh}})(?:\\.(\\d{1,${fh}}))?(?:\\.(\\d{1,${fh}}))?`);we("COERCE",`${X[Q.COERCEPLAIN]}(?:$|[^\\d])`);we("COERCEFULL",X[Q.COERCEPLAIN]+`(?:${X[Q.PRERELEASE]})?(?:${X[Q.BUILD]})?(?:$|[^\\d])`);we("COERCERTL",X[Q.COERCE],!0);we("COERCERTLFULL",X[Q.COERCEFULL],!0);we("LONETILDE","(?:~>?)");we("TILDETRIM",`(\\s*)${X[Q.LONETILDE]}\\s+`,!0);Cr.tildeTrimReplace="$1~";we("TILDE",`^${X[Q.LONETILDE]}${X[Q.XRANGEPLAIN]}$`);we("TILDELOOSE",`^${X[Q.LONETILDE]}${X[Q.XRANGEPLAINLOOSE]}$`);we("LONECARET","(?:\\^)");we("CARETTRIM",`(\\s*)${X[Q.LONECARET]}\\s+`,!0);Cr.caretTrimReplace="$1^";we("CARET",`^${X[Q.LONECARET]}${X[Q.XRANGEPLAIN]}$`);we("CARETLOOSE",`^${X[Q.LONECARET]}${X[Q.XRANGEPLAINLOOSE]}$`);we("COMPARATORLOOSE",`^${X[Q.GTLT]}\\s*(${X[Q.LOOSEPLAIN]})$|^$`);we("COMPARATOR",`^${X[Q.GTLT]}\\s*(${X[Q.FULLPLAIN]})$|^$`);we("COMPARATORTRIM",`(\\s*)${X[Q.GTLT]}\\s*(${X[Q.LOOSEPLAIN]}|${X[Q.XRANGEPLAIN]})`,!0);Cr.comparatorTrimReplace="$1$2$3";we("HYPHENRANGE",`^\\s*(${X[Q.XRANGEPLAIN]})\\s+-\\s+(${X[Q.XRANGEPLAIN]})\\s*$`);we("HYPHENRANGELOOSE",`^\\s*(${X[Q.XRANGEPLAINLOOSE]})\\s+-\\s+(${X[Q.XRANGEPLAINLOOSE]})\\s*$`);we("STAR","(<|>)?=?\\s*\\*");we("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");we("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ec=I((Xx,Ow)=>{"use strict";var nD=Object.freeze({loose:!0}),rD=Object.freeze({}),iD=r=>r?typeof r!="object"?nD:r:rD;Ow.exports=iD});var Nw=I((Qx,Mw)=>{"use strict";var Fw=/^[0-9]+$/,Lw=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=Fw.test(r),n=Fw.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},sD=(r,e)=>Lw(e,r);Mw.exports={compareIdentifiers:Lw,rcompareIdentifiers:sD}});var Zs=I((Yx,jw)=>{"use strict";var tc=Ys(),{MAX_LENGTH:Aw,MAX_SAFE_INTEGER:nc}=Ya(),{safeRe:rc,t:ic}=Za(),oD=ec(),{compareIdentifiers:ph}=Nw(),gh=class r{constructor(e,t){if(t=oD(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Aw)throw new TypeError(`version is longer than ${Aw} characters`);tc("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?rc[ic.LOOSE]:rc[ic.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>nc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>nc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>nc||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<nc)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(tc("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],i=e.prerelease[t];if(tc("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return ph(n,i)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],i=e.build[t];if(tc("build compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return ph(n,i)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let i=`-${t}`.match(this.options.loose?rc[ic.PRERELEASELOOSE]:rc[ic.PRERELEASE]);if(!i||i[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];n===!1&&(s=[t]),ph(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};jw.exports=gh});var Ww=I((Zx,Uw)=>{"use strict";var $w=Zs(),aD=(r,e,t=!1)=>{if(r instanceof $w)return r;try{return new $w(r,e)}catch(n){if(!t)return null;throw n}};Uw.exports=aD});var Vw=I((eI,Hw)=>{"use strict";var mh=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};Hw.exports=mh});var Ci=I((tI,Kw)=>{"use strict";var zw=Zs(),cD=(r,e,t)=>new zw(r,t).compare(new zw(e,t));Kw.exports=cD});var Gw=I((nI,Bw)=>{"use strict";var uD=Ci(),dD=(r,e,t)=>uD(r,e,t)===0;Bw.exports=dD});var Xw=I((rI,Jw)=>{"use strict";var lD=Ci(),fD=(r,e,t)=>lD(r,e,t)!==0;Jw.exports=fD});var Yw=I((iI,Qw)=>{"use strict";var hD=Ci(),pD=(r,e,t)=>hD(r,e,t)>0;Qw.exports=pD});var eC=I((sI,Zw)=>{"use strict";var gD=Ci(),mD=(r,e,t)=>gD(r,e,t)>=0;Zw.exports=mD});var nC=I((oI,tC)=>{"use strict";var vD=Ci(),yD=(r,e,t)=>vD(r,e,t)<0;tC.exports=yD});var iC=I((aI,rC)=>{"use strict";var bD=Ci(),wD=(r,e,t)=>bD(r,e,t)<=0;rC.exports=wD});var oC=I((cI,sC)=>{"use strict";var CD=Gw(),RD=Xw(),SD=Yw(),_D=eC(),TD=nC(),PD=iC(),DD=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return CD(r,t,n);case"!=":return RD(r,t,n);case">":return SD(r,t,n);case">=":return _D(r,t,n);case"<":return TD(r,t,n);case"<=":return PD(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};sC.exports=DD});var hC=I((uI,fC)=>{"use strict";var eo=Symbol("SemVer ANY"),bh=class r{static get ANY(){return eo}constructor(e,t){if(t=aC(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),yh("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===eo?this.value="":this.value=this.operator+this.semver.version,yh("comp",this)}parse(e){let t=this.options.loose?cC[uC.COMPARATORLOOSE]:cC[uC.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new dC(n[2],this.options.loose):this.semver=eo}toString(){return this.value}test(e){if(yh("Comparator.test",e,this.options.loose),this.semver===eo||e===eo)return!0;if(typeof e=="string")try{e=new dC(e,this.options)}catch{return!1}return vh(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new lC(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new lC(this.value,t).test(e.semver):(t=aC(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||vh(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||vh(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};fC.exports=bh;var aC=ec(),{safeRe:cC,t:uC}=Za(),vh=oC(),yh=Ys(),dC=Zs(),lC=wh()});var wh=I((dI,vC)=>{"use strict";var kD=/\s+/g,Ch=class r{constructor(e,t){if(t=xD(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Rh)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(kD," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!gC(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&ND(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&LD)|(this.options.loose&&MD))+":"+e,i=pC.get(n);if(i)return i;let s=this.options.loose,o=s?rn[Xt.HYPHENRANGELOOSE]:rn[Xt.HYPHENRANGE];e=e.replace(o,BD(this.options.includePrerelease)),tt("hyphen replace",e),e=e.replace(rn[Xt.COMPARATORTRIM],qD),tt("comparator trim",e),e=e.replace(rn[Xt.TILDETRIM],OD),tt("tilde trim",e),e=e.replace(rn[Xt.CARETTRIM],FD),tt("caret trim",e);let a=e.split(" ").map(v=>AD(v,this.options)).join(" ").split(/\s+/).map(v=>KD(v,this.options));s&&(a=a.filter(v=>(tt("loose invalid filter",v,this.options),!!v.match(rn[Xt.COMPARATORLOOSE])))),tt("range list",a);let c=new Map,d=a.map(v=>new Rh(v,this.options));for(let v of d){if(gC(v))return[v];c.set(v.value,v)}c.size>1&&c.has("")&&c.delete("");let g=[...c.values()];return pC.set(n,g),g}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>mC(n,t)&&e.set.some(i=>mC(i,t)&&n.every(s=>i.every(o=>s.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new ID(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(GD(this.set[t],e,this.options))return!0;return!1}};vC.exports=Ch;var ED=Vw(),pC=new ED,xD=ec(),Rh=hC(),tt=Ys(),ID=Zs(),{safeRe:rn,t:Xt,comparatorTrimReplace:qD,tildeTrimReplace:OD,caretTrimReplace:FD}=Za(),{FLAG_INCLUDE_PRERELEASE:LD,FLAG_LOOSE:MD}=Ya(),gC=r=>r.value==="<0.0.0-0",ND=r=>r.value==="",mC=(r,e)=>{let t=!0,n=r.slice(),i=n.pop();for(;t&&n.length;)t=n.every(s=>i.intersects(s,e)),i=n.pop();return t},AD=(r,e)=>(r=r.replace(rn[Xt.BUILD],""),tt("comp",r,e),r=UD(r,e),tt("caret",r),r=jD(r,e),tt("tildes",r),r=HD(r,e),tt("xrange",r),r=zD(r,e),tt("stars",r),r),sn=r=>!r||r.toLowerCase()==="x"||r==="*",jD=(r,e)=>r.trim().split(/\s+/).map(t=>$D(t,e)).join(" "),$D=(r,e)=>{let t=e.loose?rn[Xt.TILDELOOSE]:rn[Xt.TILDE];return r.replace(t,(n,i,s,o,a)=>{tt("tilde",r,n,i,s,o,a);let c;return sn(i)?c="":sn(s)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:sn(o)?c=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:a?(tt("replaceTilde pr",a),c=`>=${i}.${s}.${o}-${a} <${i}.${+s+1}.0-0`):c=`>=${i}.${s}.${o} <${i}.${+s+1}.0-0`,tt("tilde return",c),c})},UD=(r,e)=>r.trim().split(/\s+/).map(t=>WD(t,e)).join(" "),WD=(r,e)=>{tt("caret",r,e);let t=e.loose?rn[Xt.CARETLOOSE]:rn[Xt.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(i,s,o,a,c)=>{tt("caret",r,i,s,o,a,c);let d;return sn(s)?d="":sn(o)?d=`>=${s}.0.0${n} <${+s+1}.0.0-0`:sn(a)?s==="0"?d=`>=${s}.${o}.0${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.0${n} <${+s+1}.0.0-0`:c?(tt("replaceCaret pr",c),s==="0"?o==="0"?d=`>=${s}.${o}.${a}-${c} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}-${c} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a}-${c} <${+s+1}.0.0-0`):(tt("no pr"),s==="0"?o==="0"?d=`>=${s}.${o}.${a}${n} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),tt("caret return",d),d})},HD=(r,e)=>(tt("replaceXRanges",r,e),r.split(/\s+/).map(t=>VD(t,e)).join(" ")),VD=(r,e)=>{r=r.trim();let t=e.loose?rn[Xt.XRANGELOOSE]:rn[Xt.XRANGE];return r.replace(t,(n,i,s,o,a,c)=>{tt("xRange",r,n,i,s,o,a,c);let d=sn(s),g=d||sn(o),v=g||sn(a),m=v;return i==="="&&m&&(i=""),c=e.includePrerelease?"-0":"",d?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&m?(g&&(o=0),a=0,i===">"?(i=">=",g?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):i==="<="&&(i="<",g?s=+s+1:o=+o+1),i==="<"&&(c="-0"),n=`${i+s}.${o}.${a}${c}`):g?n=`>=${s}.0.0${c} <${+s+1}.0.0-0`:v&&(n=`>=${s}.${o}.0${c} <${s}.${+o+1}.0-0`),tt("xRange return",n),n})},zD=(r,e)=>(tt("replaceStars",r,e),r.trim().replace(rn[Xt.STAR],"")),KD=(r,e)=>(tt("replaceGTE0",r,e),r.trim().replace(rn[e.includePrerelease?Xt.GTE0PRE:Xt.GTE0],"")),BD=r=>(e,t,n,i,s,o,a,c,d,g,v,m)=>(sn(n)?t="":sn(i)?t=`>=${n}.0.0${r?"-0":""}`:sn(s)?t=`>=${n}.${i}.0${r?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,sn(d)?c="":sn(g)?c=`<${+d+1}.0.0-0`:sn(v)?c=`<${d}.${+g+1}.0-0`:m?c=`<=${d}.${g}.${v}-${m}`:r?c=`<${d}.${g}.${+v+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),GD=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(tt(r[n].semver),r[n].semver!==Rh.ANY&&r[n].semver.prerelease.length>0){let i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var bC=I((lI,yC)=>{"use strict";var JD=wh(),XD=(r,e,t)=>{try{e=new JD(e,t)}catch{return!1}return e.test(r)};yC.exports=XD});var CC=I(On=>{"use strict";var QD=On&&On.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),Sh=On&&On.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&QD(e,r,t)};Object.defineProperty(On,"__esModule",{value:!0});On.DiagnosticPullMode=On.vsdiag=void 0;Sh(me(),On);Sh(Ie(),On);var wC=kl();Object.defineProperty(On,"vsdiag",{enumerable:!0,get:function(){return wC.vsdiag}});Object.defineProperty(On,"DiagnosticPullMode",{enumerable:!0,get:function(){return wC.DiagnosticPullMode}});Sh(dh(),On)});var sc=I(pn=>{"use strict";var YD=pn&&pn.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),_C=pn&&pn.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&YD(e,r,t)};Object.defineProperty(pn,"__esModule",{value:!0});pn.SettingMonitor=pn.LanguageClient=pn.TransportKind=void 0;var qr=require("child_process"),_h=require("fs"),Th=require("path"),Zr=require("vscode"),ct=zn(),RC=dh(),ZD=kw(),ft=lh(),ek=Ww(),tk=bC();_C(lh(),pn);_C(CC(),pn);var SC="^1.82.0",ht;(function(r){r[r.stdio=0]="stdio",r[r.ipc=1]="ipc",r[r.pipe=2]="pipe",r[r.socket=3]="socket"})(ht||(pn.TransportKind=ht={}));var Yr;(function(r){function e(t){let n=t;return n&&n.kind===ht.socket&&ct.number(n.port)}r.isSocket=e})(Yr||(Yr={}));var Ph;(function(r){function e(t){return ct.string(t.command)}r.is=e})(Ph||(Ph={}));var Dh;(function(r){function e(t){return ct.string(t.module)}r.is=e})(Dh||(Dh={}));var kh;(function(r){function e(t){let n=t;return n&&n.writer!==void 0&&n.reader!==void 0}r.is=e})(kh||(kh={}));var Eh;(function(r){function e(t){let n=t;return n&&n.process!==void 0&&typeof n.detached=="boolean"}r.is=e})(Eh||(Eh={}));var xh=class extends RC.BaseLanguageClient{constructor(e,t,n,i,s){let o,a,c,d,g;ct.string(t)?(o=e,a=t,c=n,d=i,g=!!s):(o=e.toLowerCase(),a=e,c=t,d=n,g=i),g===void 0&&(g=!1),super(o,a,d),this._serverOptions=c,this._forceDebug=g,this._isInDebugMode=g;try{this.checkVersion()}catch(v){throw ct.string(v.message)&&this.outputChannel.appendLine(v.message),v}}checkVersion(){let e=ek(Zr.version);if(!e)throw new Error(`No valid VS Code version detected. Version string is: ${Zr.version}`);if(e.prerelease&&e.prerelease.length>0&&(e.prerelease=[]),!tk(e,SC))throw new Error(`The language client requires VS Code version ${SC} but received version ${Zr.version}`)}get isInDebugMode(){return this._isInDebugMode}async restart(){await this.stop(),this.isInDebugMode?(await new Promise(e=>setTimeout(e,1e3)),await this.start()):await this.start()}stop(e=2e3){return super.stop(e).finally(()=>{if(this._serverProcess){let t=this._serverProcess;this._serverProcess=void 0,(this._isDetached===void 0||!this._isDetached)&&this.checkProcessDied(t),this._isDetached=void 0}})}checkProcessDied(e){!e||e.pid===void 0||setTimeout(()=>{try{e.pid!==void 0&&(process.kill(e.pid,0),(0,ZD.terminate)(e))}catch{}},2e3)}handleConnectionClosed(){return this._serverProcess=void 0,super.handleConnectionClosed()}fillInitializeParams(e){super.fillInitializeParams(e),e.processId===null&&(e.processId=process.pid)}createMessageTransports(e){function t(g,v){if(!g&&!v)return;let m=Object.create(null);return Object.keys(process.env).forEach(S=>m[S]=process.env[S]),v&&(m.ELECTRON_RUN_AS_NODE="1",m.ELECTRON_NO_ASAR="1"),g&&Object.keys(g).forEach(S=>m[S]=g[S]),m}let n=["--debug=","--debug-brk=","--inspect=","--inspect-brk="],i=["--debug","--debug-brk","--inspect","--inspect-brk"];function s(){let g=process.execArgv;return g?g.some(v=>n.some(m=>v.startsWith(m))||i.some(m=>v===m)):!1}function o(g){if(g.stdin===null||g.stdout===null||g.stderr===null)throw new Error("Process created without stdio streams")}let a=this._serverOptions;if(ct.func(a))return a().then(g=>{if(RC.MessageTransports.is(g))return this._isDetached=!!g.detached,g;if(kh.is(g))return this._isDetached=!!g.detached,{reader:new ft.StreamMessageReader(g.reader),writer:new ft.StreamMessageWriter(g.writer)};{let v;return Eh.is(g)?(v=g.process,this._isDetached=g.detached):(v=g,this._isDetached=!1),v.stderr.on("data",m=>this.outputChannel.append(ct.string(m)?m:m.toString(e))),{reader:new ft.StreamMessageReader(v.stdout),writer:new ft.StreamMessageWriter(v.stdin)}}});let c,d=a;return d.run||d.debug?this._forceDebug||s()?(c=d.debug,this._isInDebugMode=!0):(c=d.run,this._isInDebugMode=!1):c=a,this._getServerWorkingDir(c.options).then(g=>{if(Dh.is(c)&&c.module){let v=c,m=v.transport||ht.stdio;if(v.runtime){let S=[],b=v.options??Object.create(null);b.execArgv&&b.execArgv.forEach(U=>S.push(U)),S.push(v.module),v.args&&v.args.forEach(U=>S.push(U));let E=Object.create(null);E.cwd=g,E.env=t(b.env,!1);let x=this._getRuntimePath(v.runtime,g),$;if(m===ht.ipc?(E.stdio=[null,null,null,"ipc"],S.push("--node-ipc")):m===ht.stdio?S.push("--stdio"):m===ht.pipe?($=(0,ft.generateRandomPipeName)(),S.push(`--pipe=${$}`)):Yr.isSocket(m)&&S.push(`--socket=${m.port}`),S.push(`--clientProcessId=${process.pid.toString()}`),m===ht.ipc||m===ht.stdio){let U=qr.spawn(x,S,E);return!U||!U.pid?ss(U,`Launching server using runtime ${x} failed.`):(this._serverProcess=U,U.stderr.on("data",M=>this.outputChannel.append(ct.string(M)?M:M.toString(e))),m===ht.ipc?(U.stdout.on("data",M=>this.outputChannel.append(ct.string(M)?M:M.toString(e))),Promise.resolve({reader:new ft.IPCMessageReader(U),writer:new ft.IPCMessageWriter(U)})):Promise.resolve({reader:new ft.StreamMessageReader(U.stdout),writer:new ft.StreamMessageWriter(U.stdin)}))}else{if(m===ht.pipe)return(0,ft.createClientPipeTransport)($).then(U=>{let M=qr.spawn(x,S,E);return!M||!M.pid?ss(M,`Launching server using runtime ${x} failed.`):(this._serverProcess=M,M.stderr.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),M.stdout.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),U.onConnected().then(z=>({reader:z[0],writer:z[1]})))});if(Yr.isSocket(m))return(0,ft.createClientSocketTransport)(m.port).then(U=>{let M=qr.spawn(x,S,E);return!M||!M.pid?ss(M,`Launching server using runtime ${x} failed.`):(this._serverProcess=M,M.stderr.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),M.stdout.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),U.onConnected().then(z=>({reader:z[0],writer:z[1]})))})}}else{let S;return new Promise((b,E)=>{let x=(v.args&&v.args.slice())??[];m===ht.ipc?x.push("--node-ipc"):m===ht.stdio?x.push("--stdio"):m===ht.pipe?(S=(0,ft.generateRandomPipeName)(),x.push(`--pipe=${S}`)):Yr.isSocket(m)&&x.push(`--socket=${m.port}`),x.push(`--clientProcessId=${process.pid.toString()}`);let $=v.options??Object.create(null);if($.env=t($.env,!0),$.execArgv=$.execArgv||[],$.cwd=g,$.silent=!0,m===ht.ipc||m===ht.stdio){let U=qr.fork(v.module,x||[],$);o(U),this._serverProcess=U,U.stderr.on("data",M=>this.outputChannel.append(ct.string(M)?M:M.toString(e))),m===ht.ipc?(U.stdout.on("data",M=>this.outputChannel.append(ct.string(M)?M:M.toString(e))),b({reader:new ft.IPCMessageReader(this._serverProcess),writer:new ft.IPCMessageWriter(this._serverProcess)})):b({reader:new ft.StreamMessageReader(U.stdout),writer:new ft.StreamMessageWriter(U.stdin)})}else m===ht.pipe?(0,ft.createClientPipeTransport)(S).then(U=>{let M=qr.fork(v.module,x||[],$);o(M),this._serverProcess=M,M.stderr.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),M.stdout.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),U.onConnected().then(z=>{b({reader:z[0],writer:z[1]})},E)},E):Yr.isSocket(m)&&(0,ft.createClientSocketTransport)(m.port).then(U=>{let M=qr.fork(v.module,x||[],$);o(M),this._serverProcess=M,M.stderr.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),M.stdout.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),U.onConnected().then(z=>{b({reader:z[0],writer:z[1]})},E)},E)})}}else if(Ph.is(c)&&c.command){let v=c,m=c.args!==void 0?c.args.slice(0):[],S,b=c.transport;if(b===ht.stdio)m.push("--stdio");else if(b===ht.pipe)S=(0,ft.generateRandomPipeName)(),m.push(`--pipe=${S}`);else if(Yr.isSocket(b))m.push(`--socket=${b.port}`);else if(b===ht.ipc)throw new Error("Transport kind ipc is not support for command executable");let E=Object.assign({},v.options);if(E.cwd=E.cwd||g,b===void 0||b===ht.stdio){let x=qr.spawn(v.command,m,E);return!x||!x.pid?ss(x,`Launching server using command ${v.command} failed.`):(x.stderr.on("data",$=>this.outputChannel.append(ct.string($)?$:$.toString(e))),this._serverProcess=x,this._isDetached=!!E.detached,Promise.resolve({reader:new ft.StreamMessageReader(x.stdout),writer:new ft.StreamMessageWriter(x.stdin)}))}else{if(b===ht.pipe)return(0,ft.createClientPipeTransport)(S).then(x=>{let $=qr.spawn(v.command,m,E);return!$||!$.pid?ss($,`Launching server using command ${v.command} failed.`):(this._serverProcess=$,this._isDetached=!!E.detached,$.stderr.on("data",U=>this.outputChannel.append(ct.string(U)?U:U.toString(e))),$.stdout.on("data",U=>this.outputChannel.append(ct.string(U)?U:U.toString(e))),x.onConnected().then(U=>({reader:U[0],writer:U[1]})))});if(Yr.isSocket(b))return(0,ft.createClientSocketTransport)(b.port).then(x=>{let $=qr.spawn(v.command,m,E);return!$||!$.pid?ss($,`Launching server using command ${v.command} failed.`):(this._serverProcess=$,this._isDetached=!!E.detached,$.stderr.on("data",U=>this.outputChannel.append(ct.string(U)?U:U.toString(e))),$.stdout.on("data",U=>this.outputChannel.append(ct.string(U)?U:U.toString(e))),x.onConnected().then(U=>({reader:U[0],writer:U[1]})))})}}return Promise.reject(new Error("Unsupported server configuration "+JSON.stringify(a,null,4)))}).finally(()=>{this._serverProcess!==void 0&&this._serverProcess.on("exit",(g,v)=>{g!==null&&this.error(`Server process exited with code ${g}.`,void 0,!1),v!==null&&this.error(`Server process exited with signal ${v}.`,void 0,!1)})})}_getRuntimePath(e,t){if(Th.isAbsolute(e))return e;let n=this._mainGetRootPath();if(n!==void 0){let i=Th.join(n,e);if(_h.existsSync(i))return i}if(t!==void 0){let i=Th.join(t,e);if(_h.existsSync(i))return i}return e}_mainGetRootPath(){let e=Zr.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}_getServerWorkingDir(e){let t=e&&e.cwd;return t||(t=this.clientOptions.workspaceFolder?this.clientOptions.workspaceFolder.uri.fsPath:this._mainGetRootPath()),t?new Promise(n=>{_h.lstat(t,(i,s)=>{n(!i&&s.isDirectory()?t:void 0)})}):Promise.resolve(void 0)}};pn.LanguageClient=xh;var Ih=class{constructor(e,t){this._client=e,this._setting=t,this._listeners=[]}start(){return Zr.workspace.onDidChangeConfiguration(this.onDidChangeConfiguration,this,this._listeners),this.onDidChangeConfiguration(),new Zr.Disposable(()=>{this._client.needsStop()&&this._client.stop()})}onDidChangeConfiguration(){let e=this._setting.indexOf("."),t=e>=0?this._setting.substr(0,e):this._setting,n=e>=0?this._setting.substr(e+1):void 0,i=n?Zr.workspace.getConfiguration(t).get(n,!1):Zr.workspace.getConfiguration(t);i&&this._client.needsStart()?this._client.start().catch(s=>this._client.error("Start failed after configuration change",s,"force")):!i&&this._client.needsStop()&&this._client.stop().catch(s=>this._client.error("Stop failed after configuration change",s,"force"))}};pn.SettingMonitor=Ih;function ss(r,e){return r===null?Promise.reject(e):new Promise((t,n)=>{r.on("error",i=>{n(`${e} ${i}`)}),setImmediate(()=>n(e))})}});var oc=I((pI,TC)=>{"use strict";TC.exports=sc()});var us=I(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.stringArray=Qt.array=Qt.func=Qt.error=Qt.number=Qt.string=Qt.boolean=void 0;function ck(r){return r===!0||r===!1}Qt.boolean=ck;function $C(r){return typeof r=="string"||r instanceof String}Qt.string=$C;function uk(r){return typeof r=="number"||r instanceof Number}Qt.number=uk;function dk(r){return r instanceof Error}Qt.error=dk;function lk(r){return typeof r=="function"}Qt.func=lk;function UC(r){return Array.isArray(r)}Qt.array=UC;function fk(r){return UC(r)&&r.every(e=>$C(e))}Qt.stringArray=fk});var mp=I(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.Message=oe.NotificationType9=oe.NotificationType8=oe.NotificationType7=oe.NotificationType6=oe.NotificationType5=oe.NotificationType4=oe.NotificationType3=oe.NotificationType2=oe.NotificationType1=oe.NotificationType0=oe.NotificationType=oe.RequestType9=oe.RequestType8=oe.RequestType7=oe.RequestType6=oe.RequestType5=oe.RequestType4=oe.RequestType3=oe.RequestType2=oe.RequestType1=oe.RequestType=oe.RequestType0=oe.AbstractMessageSignature=oe.ParameterStructures=oe.ResponseError=oe.ErrorCodes=void 0;var Ti=us(),Kh;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(Kh||(oe.ErrorCodes=Kh={}));var Bh=class r extends Error{constructor(e,t,n){super(t),this.code=Ti.number(e)?e:Kh.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};oe.ResponseError=Bh;var vn=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};oe.ParameterStructures=vn;vn.auto=new vn("auto");vn.byPosition=new vn("byPosition");vn.byName=new vn("byName");var nt=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return vn.auto}};oe.AbstractMessageSignature=nt;var Gh=class extends nt{constructor(e){super(e,0)}};oe.RequestType0=Gh;var Jh=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};oe.RequestType=Jh;var Xh=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};oe.RequestType1=Xh;var Qh=class extends nt{constructor(e){super(e,2)}};oe.RequestType2=Qh;var Yh=class extends nt{constructor(e){super(e,3)}};oe.RequestType3=Yh;var Zh=class extends nt{constructor(e){super(e,4)}};oe.RequestType4=Zh;var ep=class extends nt{constructor(e){super(e,5)}};oe.RequestType5=ep;var tp=class extends nt{constructor(e){super(e,6)}};oe.RequestType6=tp;var np=class extends nt{constructor(e){super(e,7)}};oe.RequestType7=np;var rp=class extends nt{constructor(e){super(e,8)}};oe.RequestType8=rp;var ip=class extends nt{constructor(e){super(e,9)}};oe.RequestType9=ip;var sp=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};oe.NotificationType=sp;var op=class extends nt{constructor(e){super(e,0)}};oe.NotificationType0=op;var ap=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};oe.NotificationType1=ap;var cp=class extends nt{constructor(e){super(e,2)}};oe.NotificationType2=cp;var up=class extends nt{constructor(e){super(e,3)}};oe.NotificationType3=up;var dp=class extends nt{constructor(e){super(e,4)}};oe.NotificationType4=dp;var lp=class extends nt{constructor(e){super(e,5)}};oe.NotificationType5=lp;var fp=class extends nt{constructor(e){super(e,6)}};oe.NotificationType6=fp;var hp=class extends nt{constructor(e){super(e,7)}};oe.NotificationType7=hp;var pp=class extends nt{constructor(e){super(e,8)}};oe.NotificationType8=pp;var gp=class extends nt{constructor(e){super(e,9)}};oe.NotificationType9=gp;var WC;(function(r){function e(i){let s=i;return s&&Ti.string(s.method)&&(Ti.string(s.id)||Ti.number(s.id))}r.isRequest=e;function t(i){let s=i;return s&&Ti.string(s.method)&&i.id===void 0}r.isNotification=t;function n(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(Ti.string(s.id)||Ti.number(s.id)||s.id===null)}r.isResponse=n})(WC||(oe.Message=WC={}))});var yp=I(ri=>{"use strict";var HC;Object.defineProperty(ri,"__esModule",{value:!0});ri.LRUCache=ri.LinkedMap=ri.Touch=void 0;var Yt;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})(Yt||(ri.Touch=Yt={}));var Dc=class{constructor(){this[HC]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=Yt.None){let n=this._map.get(e);if(n)return t!==Yt.None&&this.touch(n,t),n.value}set(e,t,n=Yt.None){let i=this._map.get(e);if(i)i.value=t,n!==Yt.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case Yt.None:this.addItemLast(i);break;case Yt.First:this.addItemFirst(i);break;case Yt.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}[(HC=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==Yt.First&&t!==Yt.Last)){if(t===Yt.First){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===Yt.Last){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};ri.LinkedMap=Dc;var vp=class extends Dc{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=Yt.AsNew){return super.get(e,t)}peek(e){return super.get(e,Yt.None)}set(e,t){return super.set(e,t,Yt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};ri.LRUCache=vp});var zC=I(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.Disposable=void 0;var VC;(function(r){function e(t){return{dispose:t}}r.create=e})(VC||(kc.Disposable=VC={}))});var ii=I(Cp=>{"use strict";Object.defineProperty(Cp,"__esModule",{value:!0});var bp;function wp(){if(bp===void 0)throw new Error("No runtime abstraction layer installed");return bp}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");bp=t}r.install=e})(wp||(wp={}));Cp.default=wp});var ls=I(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.Emitter=ds.Event=void 0;var hk=ii(),KC;(function(r){let e={dispose(){}};r.None=function(){return e}})(KC||(ds.Event=KC={}));var Rp=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(i[s],e))}catch(a){(0,hk.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},Ec=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new Rp),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};ds.Emitter=Ec;Ec._noop=function(){}});var qc=I(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.CancellationTokenSource=fs.CancellationToken=void 0;var pk=ii(),gk=us(),Sp=ls(),xc;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Sp.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Sp.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||gk.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(xc||(fs.CancellationToken=xc={}));var mk=Object.freeze(function(r,e){let t=(0,pk.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),Ic=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?mk:(this._emitter||(this._emitter=new Sp.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},_p=class{get token(){return this._token||(this._token=new Ic),this._token}cancel(){this._token?this._token.cancel():this._token=xc.Cancelled}dispose(){this._token?this._token instanceof Ic&&this._token.dispose():this._token=xc.None}};fs.CancellationTokenSource=_p});var BC=I(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.SharedArrayReceiverStrategy=hs.SharedArraySenderStrategy=void 0;var vk=qc(),oo;(function(r){r.Continue=0,r.Cancelled=1})(oo||(oo={}));var Tp=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=oo.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let i=new Int32Array(n,0,1);Atomics.store(i,0,oo.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};hs.SharedArraySenderStrategy=Tp;var Pp=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===oo.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},Dp=class{constructor(e){this.token=new Pp(e)}cancel(){}dispose(){}},kp=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new vk.CancellationTokenSource:new Dp(t)}};hs.SharedArrayReceiverStrategy=kp});var xp=I(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.Semaphore=void 0;var yk=ii(),Ep=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,yk.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Oc.Semaphore=Ep});var JC=I(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.ReadableStreamMessageReader=si.AbstractMessageReader=si.MessageReader=void 0;var qp=ii(),ps=us(),Ip=ls(),bk=xp(),GC;(function(r){function e(t){let n=t;return n&&ps.func(n.listen)&&ps.func(n.dispose)&&ps.func(n.onError)&&ps.func(n.onClose)&&ps.func(n.onPartialMessage)}r.is=e})(GC||(si.MessageReader=GC={}));var Fc=class{constructor(){this.errorEmitter=new Ip.Emitter,this.closeEmitter=new Ip.Emitter,this.partialMessageEmitter=new Ip.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${ps.string(e.message)?e.message:"unknown"}`)}};si.AbstractMessageReader=Fc;var Op;(function(r){function e(t){let n,i,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let d of t.contentDecoders)o.set(d.name,d);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let d of t.contentTypeDecoders)c.set(d.name,d)}return a===void 0&&(a=(0,qp.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}r.fromOptions=e})(Op||(Op={}));var Fp=class extends Fc{constructor(e,t){super(),this.readable=e,this.options=Op.fromOptions(t),this.buffer=(0,qp.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new bk.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let i=n.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(i)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,qp.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};si.ReadableStreamMessageReader=Fp});var eR=I(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.WriteableStreamMessageWriter=oi.AbstractMessageWriter=oi.MessageWriter=void 0;var XC=ii(),ao=us(),wk=xp(),QC=ls(),Ck="Content-Length: ",YC=`\r
`,ZC;(function(r){function e(t){let n=t;return n&&ao.func(n.dispose)&&ao.func(n.onClose)&&ao.func(n.onError)&&ao.func(n.write)}r.is=e})(ZC||(oi.MessageWriter=ZC={}));var Lc=class{constructor(){this.errorEmitter=new QC.Emitter,this.closeEmitter=new QC.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${ao.string(e.message)?e.message:"unknown"}`)}};oi.AbstractMessageWriter=Lc;var Lp;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,XC.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,XC.default)().applicationJson.encoder}}r.fromOptions=e})(Lp||(Lp={}));var Mp=class extends Lc{constructor(e,t){super(),this.writable=e,this.options=Lp.fromOptions(t),this.errorCount=0,this.writeSemaphore=new wk.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let i=[];return i.push(Ck,n.byteLength.toString(),YC),i.push(YC),this.doWrite(e,i,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};oi.WriteableStreamMessageWriter=Mp});var tR=I(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.AbstractMessageBuffer=void 0;var Rk=13,Sk=10,_k=`\r
`,Np=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){let d=this._chunks[n];for(i=0;i<d.length;){switch(d[i]){case Rk:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case Sk:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=d.byteLength,n++}if(t!==4)return;let o=this._read(s+i),a=new Map,c=this.toString(o,"ascii").split(_k);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){let g=c[d],v=g.indexOf(":");if(v===-1)throw new Error(`Message header must separate key and value using ':'
${g}`);let m=g.substr(0,v),S=g.substr(v+1).trim();a.set(e?m.toLowerCase():m,S)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};Mc.AbstractMessageBuffer=Np});var oR=I(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.createMessageConnection=Ce.ConnectionOptions=Ce.MessageStrategy=Ce.CancellationStrategy=Ce.CancellationSenderStrategy=Ce.CancellationReceiverStrategy=Ce.RequestCancellationReceiverStrategy=Ce.IdCancellationReceiverStrategy=Ce.ConnectionStrategy=Ce.ConnectionError=Ce.ConnectionErrors=Ce.LogTraceNotification=Ce.SetTraceNotification=Ce.TraceFormat=Ce.TraceValues=Ce.Trace=Ce.NullLogger=Ce.ProgressType=Ce.ProgressToken=void 0;var nR=ii(),pt=us(),fe=mp(),rR=yp(),co=ls(),Ap=qc(),fo;(function(r){r.type=new fe.NotificationType("$/cancelRequest")})(fo||(fo={}));var jp;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(jp||(Ce.ProgressToken=jp={}));var uo;(function(r){r.type=new fe.NotificationType("$/progress")})(uo||(uo={}));var $p=class{constructor(){}};Ce.ProgressType=$p;var Up;(function(r){function e(t){return pt.func(t)}r.is=e})(Up||(Up={}));Ce.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Ae;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(Ae||(Ce.Trace=Ae={}));var iR;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(iR||(Ce.TraceValues=iR={}));(function(r){function e(n){if(!pt.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(Ae||(Ce.Trace=Ae={}));var Mn;(function(r){r.Text="text",r.JSON="json"})(Mn||(Ce.TraceFormat=Mn={}));(function(r){function e(t){return pt.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(Mn||(Ce.TraceFormat=Mn={}));var Wp;(function(r){r.type=new fe.NotificationType("$/setTrace")})(Wp||(Ce.SetTraceNotification=Wp={}));var Nc;(function(r){r.type=new fe.NotificationType("$/logTrace")})(Nc||(Ce.LogTraceNotification=Nc={}));var lo;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(lo||(Ce.ConnectionErrors=lo={}));var gs=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};Ce.ConnectionError=gs;var Hp;(function(r){function e(t){let n=t;return n&&pt.func(n.cancelUndispatched)}r.is=e})(Hp||(Ce.ConnectionStrategy=Hp={}));var Ac;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&pt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||pt.func(n.dispose))}r.is=e})(Ac||(Ce.IdCancellationReceiverStrategy=Ac={}));var Vp;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&pt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||pt.func(n.dispose))}r.is=e})(Vp||(Ce.RequestCancellationReceiverStrategy=Vp={}));var jc;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new Ap.CancellationTokenSource}});function e(t){return Ac.is(t)||Vp.is(t)}r.is=e})(jc||(Ce.CancellationReceiverStrategy=jc={}));var $c;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(fo.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&pt.func(n.sendCancellation)&&pt.func(n.cleanup)}r.is=e})($c||(Ce.CancellationSenderStrategy=$c={}));var Uc;(function(r){r.Message=Object.freeze({receiver:jc.Message,sender:$c.Message});function e(t){let n=t;return n&&jc.is(n.receiver)&&$c.is(n.sender)}r.is=e})(Uc||(Ce.CancellationStrategy=Uc={}));var Wc;(function(r){function e(t){let n=t;return n&&pt.func(n.handleMessage)}r.is=e})(Wc||(Ce.MessageStrategy=Wc={}));var sR;(function(r){function e(t){let n=t;return n&&(Uc.is(n.cancellationStrategy)||Hp.is(n.connectionStrategy)||Wc.is(n.messageStrategy))}r.is=e})(sR||(Ce.ConnectionOptions=sR={}));var ur;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(ur||(ur={}));function Tk(r,e,t,n){let i=t!==void 0?t:Ce.NullLogger,s=0,o=0,a=0,c="2.0",d,g=new Map,v,m=new Map,S=new Map,b,E=new rR.LinkedMap,x=new Map,$=new Set,U=new Map,M=Ae.Off,z=Mn.Text,B,pe=ur.New,J=new co.Emitter,ce=new co.Emitter,Re=new co.Emitter,it=new co.Emitter,Ze=new co.Emitter,$e=n&&n.cancellationStrategy?n.cancellationStrategy:Uc.Message;function Zt(l){if(l===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+l.toString()}function At(l){return l===null?"res-unknown-"+(++a).toString():"res-"+l.toString()}function kt(){return"not-"+(++o).toString()}function Et(l,C){fe.Message.isRequest(C)?l.set(Zt(C.id),C):fe.Message.isResponse(C)?l.set(At(C.id),C):l.set(kt(),C)}function bn(l){}function wn(){return pe===ur.Listening}function Ue(){return pe===ur.Closed}function Ct(){return pe===ur.Disposed}function Ot(){(pe===ur.New||pe===ur.Listening)&&(pe=ur.Closed,ce.fire(void 0))}function xt(l){J.fire([l,void 0,void 0])}function lr(l){J.fire(l)}r.onClose(Ot),r.onError(xt),e.onClose(Ot),e.onError(lr);function Cn(){b||E.size===0||(b=(0,nR.default)().timer.setImmediate(()=>{b=void 0,er()}))}function Rn(l){fe.Message.isRequest(l)?$n(l):fe.Message.isNotification(l)?_n(l):fe.Message.isResponse(l)?Sn(l):Un(l)}function er(){if(E.size===0)return;let l=E.shift();try{let C=n?.messageStrategy;Wc.is(C)?C.handleMessage(l,Rn):Rn(l)}finally{Cn()}}let fr=l=>{try{if(fe.Message.isNotification(l)&&l.method===fo.type.method){let C=l.params.id,D=Zt(C),O=E.get(D);if(fe.Message.isRequest(O)){let ee=n?.connectionStrategy,ae=ee&&ee.cancelUndispatched?ee.cancelUndispatched(O,bn):void 0;if(ae&&(ae.error!==void 0||ae.result!==void 0)){E.delete(D),U.delete(C),ae.id=O.id,jt(ae,l.method,Date.now()),e.write(ae).catch(()=>i.error("Sending response for canceled message failed."));return}}let ne=U.get(C);if(ne!==void 0){ne.cancel(),Ht(l);return}else $.add(C)}Et(E,l)}finally{Cn()}};function $n(l){if(Ct())return;function C(G,ie,Z){let he={jsonrpc:c,id:l.id};G instanceof fe.ResponseError?he.error=G.toJson():he.result=G===void 0?null:G,jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function D(G,ie,Z){let he={jsonrpc:c,id:l.id,error:G.toJson()};jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function O(G,ie,Z){G===void 0&&(G=null);let he={jsonrpc:c,id:l.id,result:G};jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}hr(l);let ne=g.get(l.method),ee,ae;ne&&(ee=ne.type,ae=ne.handler);let ue=Date.now();if(ae||d){let G=l.id??String(Date.now()),ie=Ac.is($e.receiver)?$e.receiver.createCancellationTokenSource(G):$e.receiver.createCancellationTokenSource(l);l.id!==null&&$.has(l.id)&&ie.cancel(),l.id!==null&&U.set(G,ie);try{let Z;if(ae)if(l.params===void 0){if(ee!==void 0&&ee.numberOfParams!==0){D(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines ${ee.numberOfParams} params but received none.`),l.method,ue);return}Z=ae(ie.token)}else if(Array.isArray(l.params)){if(ee!==void 0&&ee.parameterStructures===fe.ParameterStructures.byName){D(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by name but received parameters by position`),l.method,ue);return}Z=ae(...l.params,ie.token)}else{if(ee!==void 0&&ee.parameterStructures===fe.ParameterStructures.byPosition){D(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by position but received parameters by name`),l.method,ue);return}Z=ae(l.params,ie.token)}else d&&(Z=d(l.method,l.params,ie.token));let he=Z;Z?he.then?he.then(_e=>{U.delete(G),C(_e,l.method,ue)},_e=>{U.delete(G),_e instanceof fe.ResponseError?D(_e,l.method,ue):_e&&pt.string(_e.message)?D(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${_e.message}`),l.method,ue):D(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ue)}):(U.delete(G),C(Z,l.method,ue)):(U.delete(G),O(Z,l.method,ue))}catch(Z){U.delete(G),Z instanceof fe.ResponseError?C(Z,l.method,ue):Z&&pt.string(Z.message)?D(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${Z.message}`),l.method,ue):D(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ue)}}else D(new fe.ResponseError(fe.ErrorCodes.MethodNotFound,`Unhandled method ${l.method}`),l.method,ue)}function Sn(l){if(!Ct())if(l.id===null)l.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(l.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let C=l.id,D=x.get(C);if(Wn(l,D),D!==void 0){x.delete(C);try{if(l.error){let O=l.error;D.reject(new fe.ResponseError(O.code,O.message,O.data))}else if(l.result!==void 0)D.resolve(l.result);else throw new Error("Should never happen.")}catch(O){O.message?i.error(`Response handler '${D.method}' failed with message: ${O.message}`):i.error(`Response handler '${D.method}' failed unexpectedly.`)}}}}function _n(l){if(Ct())return;let C,D;if(l.method===fo.type.method){let O=l.params.id;$.delete(O),Ht(l);return}else{let O=m.get(l.method);O&&(D=O.handler,C=O.type)}if(D||v)try{if(Ht(l),D)if(l.params===void 0)C!==void 0&&C.numberOfParams!==0&&C.parameterStructures!==fe.ParameterStructures.byName&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received none.`),D();else if(Array.isArray(l.params)){let O=l.params;l.method===uo.type.method&&O.length===2&&jp.is(O[0])?D({token:O[0],value:O[1]}):(C!==void 0&&(C.parameterStructures===fe.ParameterStructures.byName&&i.error(`Notification ${l.method} defines parameters by name but received parameters by position`),C.numberOfParams!==l.params.length&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received ${O.length} arguments`)),D(...O))}else C!==void 0&&C.parameterStructures===fe.ParameterStructures.byPosition&&i.error(`Notification ${l.method} defines parameters by position but received parameters by name`),D(l.params);else v&&v(l.method,l.params)}catch(O){O.message?i.error(`Notification handler '${l.method}' failed with message: ${O.message}`):i.error(`Notification handler '${l.method}' failed unexpectedly.`)}else Re.fire(l)}function Un(l){if(!l){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(l,null,4)}`);let C=l;if(pt.string(C.id)||pt.number(C.id)){let D=C.id,O=x.get(D);O&&O.reject(new Error("The received response has neither a result nor an error property."))}}function We(l){if(l!=null)switch(M){case Ae.Verbose:return JSON.stringify(l,null,4);case Ae.Compact:return JSON.stringify(l);default:return}}function tr(l){if(!(M===Ae.Off||!B))if(z===Mn.Text){let C;(M===Ae.Verbose||M===Ae.Compact)&&l.params&&(C=`Params: ${We(l.params)}

`),B.log(`Sending request '${l.method} - (${l.id})'.`,C)}else Ke("send-request",l)}function Tn(l){if(!(M===Ae.Off||!B))if(z===Mn.Text){let C;(M===Ae.Verbose||M===Ae.Compact)&&(l.params?C=`Params: ${We(l.params)}

`:C=`No parameters provided.

`),B.log(`Sending notification '${l.method}'.`,C)}else Ke("send-notification",l)}function jt(l,C,D){if(!(M===Ae.Off||!B))if(z===Mn.Text){let O;(M===Ae.Verbose||M===Ae.Compact)&&(l.error&&l.error.data?O=`Error data: ${We(l.error.data)}

`:l.result?O=`Result: ${We(l.result)}

`:l.error===void 0&&(O=`No result returned.

`)),B.log(`Sending response '${C} - (${l.id})'. Processing request took ${Date.now()-D}ms`,O)}else Ke("send-response",l)}function hr(l){if(!(M===Ae.Off||!B))if(z===Mn.Text){let C;(M===Ae.Verbose||M===Ae.Compact)&&l.params&&(C=`Params: ${We(l.params)}

`),B.log(`Received request '${l.method} - (${l.id})'.`,C)}else Ke("receive-request",l)}function Ht(l){if(!(M===Ae.Off||!B||l.method===Nc.type.method))if(z===Mn.Text){let C;(M===Ae.Verbose||M===Ae.Compact)&&(l.params?C=`Params: ${We(l.params)}

`:C=`No parameters provided.

`),B.log(`Received notification '${l.method}'.`,C)}else Ke("receive-notification",l)}function Wn(l,C){if(!(M===Ae.Off||!B))if(z===Mn.Text){let D;if((M===Ae.Verbose||M===Ae.Compact)&&(l.error&&l.error.data?D=`Error data: ${We(l.error.data)}

`:l.result?D=`Result: ${We(l.result)}

`:l.error===void 0&&(D=`No result returned.

`)),C){let O=l.error?` Request failed: ${l.error.message} (${l.error.code}).`:"";B.log(`Received response '${C.method} - (${l.id})' in ${Date.now()-C.timerStart}ms.${O}`,D)}else B.log(`Received response ${l.id} without active response promise.`,D)}else Ke("receive-response",l)}function Ke(l,C){if(!B||M===Ae.Off)return;let D={isLSPMessage:!0,type:l,message:C,timestamp:Date.now()};B.log(D)}function gt(){if(Ue())throw new gs(lo.Closed,"Connection is closed.");if(Ct())throw new gs(lo.Disposed,"Connection is disposed.")}function It(){if(wn())throw new gs(lo.AlreadyListening,"Connection is already listening")}function en(){if(!wn())throw new Error("Call listen() first.")}function Rt(l){return l===void 0?null:l}function Pn(l){if(l!==null)return l}function Hn(l){return l!=null&&!Array.isArray(l)&&typeof l=="object"}function tn(l,C){switch(l){case fe.ParameterStructures.auto:return Hn(C)?Pn(C):[Rt(C)];case fe.ParameterStructures.byName:if(!Hn(C))throw new Error("Received parameters by name but param is not an object literal.");return Pn(C);case fe.ParameterStructures.byPosition:return[Rt(C)];default:throw new Error(`Unknown parameter structure ${l.toString()}`)}}function Vn(l,C){let D,O=l.numberOfParams;switch(O){case 0:D=void 0;break;case 1:D=tn(l.parameterStructures,C[0]);break;default:D=[];for(let ne=0;ne<C.length&&ne<O;ne++)D.push(Rt(C[ne]));if(C.length<O)for(let ne=C.length;ne<O;ne++)D.push(null);break}return D}let mt={sendNotification:(l,...C)=>{gt();let D,O;if(pt.string(l)){D=l;let ee=C[0],ae=0,ue=fe.ParameterStructures.auto;fe.ParameterStructures.is(ee)&&(ae=1,ue=ee);let G=C.length,ie=G-ae;switch(ie){case 0:O=void 0;break;case 1:O=tn(ue,C[ae]);break;default:if(ue===fe.ParameterStructures.byName)throw new Error(`Received ${ie} parameters for 'by Name' notification parameter structure.`);O=C.slice(ae,G).map(Z=>Rt(Z));break}}else{let ee=C;D=l.method,O=Vn(l,ee)}let ne={jsonrpc:c,method:D,params:O};return Tn(ne),e.write(ne).catch(ee=>{throw i.error("Sending notification failed."),ee})},onNotification:(l,C)=>{gt();let D;return pt.func(l)?v=l:C&&(pt.string(l)?(D=l,m.set(l,{type:void 0,handler:C})):(D=l.method,m.set(l.method,{type:l,handler:C}))),{dispose:()=>{D!==void 0?m.delete(D):v=void 0}}},onProgress:(l,C,D)=>{if(S.has(C))throw new Error(`Progress handler for token ${C} already registered`);return S.set(C,D),{dispose:()=>{S.delete(C)}}},sendProgress:(l,C,D)=>mt.sendNotification(uo.type,{token:C,value:D}),onUnhandledProgress:it.event,sendRequest:(l,...C)=>{gt(),en();let D,O,ne;if(pt.string(l)){D=l;let G=C[0],ie=C[C.length-1],Z=0,he=fe.ParameterStructures.auto;fe.ParameterStructures.is(G)&&(Z=1,he=G);let _e=C.length;Ap.CancellationToken.is(ie)&&(_e=_e-1,ne=ie);let He=_e-Z;switch(He){case 0:O=void 0;break;case 1:O=tn(he,C[Z]);break;default:if(he===fe.ParameterStructures.byName)throw new Error(`Received ${He} parameters for 'by Name' request parameter structure.`);O=C.slice(Z,_e).map(pr=>Rt(pr));break}}else{let G=C;D=l.method,O=Vn(l,G);let ie=l.numberOfParams;ne=Ap.CancellationToken.is(G[ie])?G[ie]:void 0}let ee=s++,ae;ne&&(ae=ne.onCancellationRequested(()=>{let G=$e.sender.sendCancellation(mt,ee);return G===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${ee}`),Promise.resolve()):G.catch(()=>{i.log(`Sending cancellation messages for id ${ee} failed`)})}));let ue={jsonrpc:c,id:ee,method:D,params:O};return tr(ue),typeof $e.sender.enableCancellation=="function"&&$e.sender.enableCancellation(ue),new Promise(async(G,ie)=>{let Z=He=>{G(He),$e.sender.cleanup(ee),ae?.dispose()},he=He=>{ie(He),$e.sender.cleanup(ee),ae?.dispose()},_e={method:D,timerStart:Date.now(),resolve:Z,reject:he};try{x.set(ee,_e),await e.write(ue)}catch(He){throw x.delete(ee),_e.reject(new fe.ResponseError(fe.ErrorCodes.MessageWriteError,He.message?He.message:"Unknown reason")),i.error("Sending request failed."),He}})},onRequest:(l,C)=>{gt();let D=null;return Up.is(l)?(D=void 0,d=l):pt.string(l)?(D=null,C!==void 0&&(D=l,g.set(l,{handler:C,type:void 0}))):C!==void 0&&(D=l.method,g.set(l.method,{type:l,handler:C})),{dispose:()=>{D!==null&&(D!==void 0?g.delete(D):d=void 0)}}},hasPendingResponse:()=>x.size>0,trace:async(l,C,D)=>{let O=!1,ne=Mn.Text;D!==void 0&&(pt.boolean(D)?O=D:(O=D.sendNotification||!1,ne=D.traceFormat||Mn.Text)),M=l,z=ne,M===Ae.Off?B=void 0:B=C,O&&!Ue()&&!Ct()&&await mt.sendNotification(Wp.type,{value:Ae.toString(l)})},onError:J.event,onClose:ce.event,onUnhandledNotification:Re.event,onDispose:Ze.event,end:()=>{e.end()},dispose:()=>{if(Ct())return;pe=ur.Disposed,Ze.fire(void 0);let l=new fe.ResponseError(fe.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let C of x.values())C.reject(l);x=new Map,U=new Map,$=new Set,E=new rR.LinkedMap,pt.func(e.dispose)&&e.dispose(),pt.func(r.dispose)&&r.dispose()},listen:()=>{gt(),It(),pe=ur.Listening,r.listen(fr)},inspect:()=>{(0,nR.default)().console.log("inspect")}};return mt.onNotification(Nc.type,l=>{if(M===Ae.Off||!B)return;let C=M===Ae.Verbose||M===Ae.Compact;B.log(l.message,C?l.verbose:void 0)}),mt.onNotification(uo.type,l=>{let C=S.get(l.token);C?C(l.value):it.fire(l)}),mt}Ce.createMessageConnection=Tk});var Hc=I(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.ProgressType=L.ProgressToken=L.createMessageConnection=L.NullLogger=L.ConnectionOptions=L.ConnectionStrategy=L.AbstractMessageBuffer=L.WriteableStreamMessageWriter=L.AbstractMessageWriter=L.MessageWriter=L.ReadableStreamMessageReader=L.AbstractMessageReader=L.MessageReader=L.SharedArrayReceiverStrategy=L.SharedArraySenderStrategy=L.CancellationToken=L.CancellationTokenSource=L.Emitter=L.Event=L.Disposable=L.LRUCache=L.Touch=L.LinkedMap=L.ParameterStructures=L.NotificationType9=L.NotificationType8=L.NotificationType7=L.NotificationType6=L.NotificationType5=L.NotificationType4=L.NotificationType3=L.NotificationType2=L.NotificationType1=L.NotificationType0=L.NotificationType=L.ErrorCodes=L.ResponseError=L.RequestType9=L.RequestType8=L.RequestType7=L.RequestType6=L.RequestType5=L.RequestType4=L.RequestType3=L.RequestType2=L.RequestType1=L.RequestType0=L.RequestType=L.Message=L.RAL=void 0;L.MessageStrategy=L.CancellationStrategy=L.CancellationSenderStrategy=L.CancellationReceiverStrategy=L.ConnectionError=L.ConnectionErrors=L.LogTraceNotification=L.SetTraceNotification=L.TraceFormat=L.TraceValues=L.Trace=void 0;var Qe=mp();Object.defineProperty(L,"Message",{enumerable:!0,get:function(){return Qe.Message}});Object.defineProperty(L,"RequestType",{enumerable:!0,get:function(){return Qe.RequestType}});Object.defineProperty(L,"RequestType0",{enumerable:!0,get:function(){return Qe.RequestType0}});Object.defineProperty(L,"RequestType1",{enumerable:!0,get:function(){return Qe.RequestType1}});Object.defineProperty(L,"RequestType2",{enumerable:!0,get:function(){return Qe.RequestType2}});Object.defineProperty(L,"RequestType3",{enumerable:!0,get:function(){return Qe.RequestType3}});Object.defineProperty(L,"RequestType4",{enumerable:!0,get:function(){return Qe.RequestType4}});Object.defineProperty(L,"RequestType5",{enumerable:!0,get:function(){return Qe.RequestType5}});Object.defineProperty(L,"RequestType6",{enumerable:!0,get:function(){return Qe.RequestType6}});Object.defineProperty(L,"RequestType7",{enumerable:!0,get:function(){return Qe.RequestType7}});Object.defineProperty(L,"RequestType8",{enumerable:!0,get:function(){return Qe.RequestType8}});Object.defineProperty(L,"RequestType9",{enumerable:!0,get:function(){return Qe.RequestType9}});Object.defineProperty(L,"ResponseError",{enumerable:!0,get:function(){return Qe.ResponseError}});Object.defineProperty(L,"ErrorCodes",{enumerable:!0,get:function(){return Qe.ErrorCodes}});Object.defineProperty(L,"NotificationType",{enumerable:!0,get:function(){return Qe.NotificationType}});Object.defineProperty(L,"NotificationType0",{enumerable:!0,get:function(){return Qe.NotificationType0}});Object.defineProperty(L,"NotificationType1",{enumerable:!0,get:function(){return Qe.NotificationType1}});Object.defineProperty(L,"NotificationType2",{enumerable:!0,get:function(){return Qe.NotificationType2}});Object.defineProperty(L,"NotificationType3",{enumerable:!0,get:function(){return Qe.NotificationType3}});Object.defineProperty(L,"NotificationType4",{enumerable:!0,get:function(){return Qe.NotificationType4}});Object.defineProperty(L,"NotificationType5",{enumerable:!0,get:function(){return Qe.NotificationType5}});Object.defineProperty(L,"NotificationType6",{enumerable:!0,get:function(){return Qe.NotificationType6}});Object.defineProperty(L,"NotificationType7",{enumerable:!0,get:function(){return Qe.NotificationType7}});Object.defineProperty(L,"NotificationType8",{enumerable:!0,get:function(){return Qe.NotificationType8}});Object.defineProperty(L,"NotificationType9",{enumerable:!0,get:function(){return Qe.NotificationType9}});Object.defineProperty(L,"ParameterStructures",{enumerable:!0,get:function(){return Qe.ParameterStructures}});var zp=yp();Object.defineProperty(L,"LinkedMap",{enumerable:!0,get:function(){return zp.LinkedMap}});Object.defineProperty(L,"LRUCache",{enumerable:!0,get:function(){return zp.LRUCache}});Object.defineProperty(L,"Touch",{enumerable:!0,get:function(){return zp.Touch}});var Pk=zC();Object.defineProperty(L,"Disposable",{enumerable:!0,get:function(){return Pk.Disposable}});var aR=ls();Object.defineProperty(L,"Event",{enumerable:!0,get:function(){return aR.Event}});Object.defineProperty(L,"Emitter",{enumerable:!0,get:function(){return aR.Emitter}});var cR=qc();Object.defineProperty(L,"CancellationTokenSource",{enumerable:!0,get:function(){return cR.CancellationTokenSource}});Object.defineProperty(L,"CancellationToken",{enumerable:!0,get:function(){return cR.CancellationToken}});var uR=BC();Object.defineProperty(L,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return uR.SharedArraySenderStrategy}});Object.defineProperty(L,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return uR.SharedArrayReceiverStrategy}});var Kp=JC();Object.defineProperty(L,"MessageReader",{enumerable:!0,get:function(){return Kp.MessageReader}});Object.defineProperty(L,"AbstractMessageReader",{enumerable:!0,get:function(){return Kp.AbstractMessageReader}});Object.defineProperty(L,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Kp.ReadableStreamMessageReader}});var Bp=eR();Object.defineProperty(L,"MessageWriter",{enumerable:!0,get:function(){return Bp.MessageWriter}});Object.defineProperty(L,"AbstractMessageWriter",{enumerable:!0,get:function(){return Bp.AbstractMessageWriter}});Object.defineProperty(L,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Bp.WriteableStreamMessageWriter}});var Dk=tR();Object.defineProperty(L,"AbstractMessageBuffer",{enumerable:!0,get:function(){return Dk.AbstractMessageBuffer}});var Wt=oR();Object.defineProperty(L,"ConnectionStrategy",{enumerable:!0,get:function(){return Wt.ConnectionStrategy}});Object.defineProperty(L,"ConnectionOptions",{enumerable:!0,get:function(){return Wt.ConnectionOptions}});Object.defineProperty(L,"NullLogger",{enumerable:!0,get:function(){return Wt.NullLogger}});Object.defineProperty(L,"createMessageConnection",{enumerable:!0,get:function(){return Wt.createMessageConnection}});Object.defineProperty(L,"ProgressToken",{enumerable:!0,get:function(){return Wt.ProgressToken}});Object.defineProperty(L,"ProgressType",{enumerable:!0,get:function(){return Wt.ProgressType}});Object.defineProperty(L,"Trace",{enumerable:!0,get:function(){return Wt.Trace}});Object.defineProperty(L,"TraceValues",{enumerable:!0,get:function(){return Wt.TraceValues}});Object.defineProperty(L,"TraceFormat",{enumerable:!0,get:function(){return Wt.TraceFormat}});Object.defineProperty(L,"SetTraceNotification",{enumerable:!0,get:function(){return Wt.SetTraceNotification}});Object.defineProperty(L,"LogTraceNotification",{enumerable:!0,get:function(){return Wt.LogTraceNotification}});Object.defineProperty(L,"ConnectionErrors",{enumerable:!0,get:function(){return Wt.ConnectionErrors}});Object.defineProperty(L,"ConnectionError",{enumerable:!0,get:function(){return Wt.ConnectionError}});Object.defineProperty(L,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return Wt.CancellationReceiverStrategy}});Object.defineProperty(L,"CancellationSenderStrategy",{enumerable:!0,get:function(){return Wt.CancellationSenderStrategy}});Object.defineProperty(L,"CancellationStrategy",{enumerable:!0,get:function(){return Wt.CancellationStrategy}});Object.defineProperty(L,"MessageStrategy",{enumerable:!0,get:function(){return Wt.MessageStrategy}});var kk=ii();L.RAL=kk.default});var fR=I(Qp=>{"use strict";Object.defineProperty(Qp,"__esModule",{value:!0});var dR=require("util"),Lr=Hc(),Vc=class r extends Lr.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new dR.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Vc.emptyBuffer=Buffer.allocUnsafe(0);var Gp=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Lr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Lr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Lr.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),Lr.Disposable.create(()=>this.stream.off("data",e))}},Jp=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Lr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Lr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Lr.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,i)=>{let s=o=>{o==null?n():i(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},lR=Object.freeze({messageBuffer:Object.freeze({create:r=>new Vc(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new dR.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new Gp(r),asWritableStream:r=>new Jp(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function Xp(){return lR}(function(r){function e(){Lr.RAL.install(lR)}r.install=e})(Xp||(Xp={}));Qp.default=Xp});var gR=I(xe=>{"use strict";var Ek=xe&&xe.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),xk=xe&&xe.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Ek(e,r,t)};Object.defineProperty(xe,"__esModule",{value:!0});xe.createMessageConnection=xe.createServerSocketTransport=xe.createClientSocketTransport=xe.createServerPipeTransport=xe.createClientPipeTransport=xe.generateRandomPipeName=xe.StreamMessageWriter=xe.StreamMessageReader=xe.SocketMessageWriter=xe.SocketMessageReader=xe.PortMessageWriter=xe.PortMessageReader=xe.IPCMessageWriter=xe.IPCMessageReader=void 0;var ms=fR();ms.default.install();var hR=require("path"),Ik=require("os"),qk=require("crypto"),Bc=require("net"),Nn=Hc();xk(Hc(),xe);var Yp=class extends Nn.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),Nn.Disposable.create(()=>this.process.off("message",e))}};xe.IPCMessageReader=Yp;var Zp=class extends Nn.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};xe.IPCMessageWriter=Zp;var eg=class extends Nn.AbstractMessageReader{constructor(e){super(),this.onData=new Nn.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};xe.PortMessageReader=eg;var tg=class extends Nn.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};xe.PortMessageWriter=tg;var Pi=class extends Nn.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,ms.default)().stream.asReadableStream(e),t)}};xe.SocketMessageReader=Pi;var Di=class extends Nn.WriteableStreamMessageWriter{constructor(e,t){super((0,ms.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};xe.SocketMessageWriter=Di;var zc=class extends Nn.ReadableStreamMessageReader{constructor(e,t){super((0,ms.default)().stream.asReadableStream(e),t)}};xe.StreamMessageReader=zc;var Kc=class extends Nn.WriteableStreamMessageWriter{constructor(e,t){super((0,ms.default)().stream.asWritableStream(e),t)}};xe.StreamMessageWriter=Kc;var pR=process.env.XDG_RUNTIME_DIR,Ok=new Map([["linux",107],["darwin",103]]);function Fk(){let r=(0,qk.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;pR?e=hR.join(pR,`vscode-ipc-${r}.sock`):e=hR.join(Ik.tmpdir(),`vscode-${r}.sock`);let t=Ok.get(process.platform);return t!==void 0&&e.length>t&&(0,ms.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}xe.generateRandomPipeName=Fk;function Lk(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Bc.createServer)(a=>{o.close(),t([new Pi(a,e),new Di(a,e)])});o.on("error",s),o.listen(r,()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}xe.createClientPipeTransport=Lk;function Mk(r,e="utf-8"){let t=(0,Bc.createConnection)(r);return[new Pi(t,e),new Di(t,e)]}xe.createServerPipeTransport=Mk;function Nk(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Bc.createServer)(a=>{o.close(),t([new Pi(a,e),new Di(a,e)])});o.on("error",s),o.listen(r,"127.0.0.1",()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}xe.createClientSocketTransport=Nk;function Ak(r,e="utf-8"){let t=(0,Bc.createConnection)(r,"127.0.0.1");return[new Pi(t,e),new Di(t,e)]}xe.createServerSocketTransport=Ak;function jk(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function $k(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function Uk(r,e,t,n){t||(t=Nn.NullLogger);let i=jk(r)?new zc(r):r,s=$k(e)?new Kc(e):e;return Nn.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,Nn.createMessageConnection)(i,s,t,n)}xe.createMessageConnection=Uk});var vR=I((i0,mR)=>{"use strict";mR.exports=gR()});var Qk={};ZR(Qk,{activate:()=>Gk,deactivate:()=>Jk});module.exports=eS(Qk);var KR=re(require("os")),on=re(require("vscode"));var VR=re(require("os")),zR=re(require("path")),N=re(require("vscode")),ag=re(oc());var to=class{provideTextDocumentContent(e){let t="Not a valid Ruby LSP document";switch(e.path){case"show-syntax-tree":t=e.query;break;case"show-diagnose-state":t=e.query;break}return t}};var MC=require("crypto"),wt=re(require("vscode")),Rc=re(oc());var yc=re(require("path")),Lh=re(require("os")),Oe=re(require("vscode"));var PC=require("child_process"),DC=require("crypto"),kC=require("util"),ei=re(require("vscode"));var Yn=new ei.EventEmitter,gn=(0,kC.promisify)(PC.exec),ac="Ruby LSP",Rr=ei.window.createOutputChannel(ac,{log:!0}),ti=["ruby","erb"],qh={tapiocaAddon:1,launcher:.3,fullTestDiscovery:1};function EC(r,e){let t=null;return function(...n){return t&&clearTimeout(t),new Promise((i,s)=>{t=setTimeout(()=>{r(...n).then(o=>i(o)).catch(o=>s(o))},e)})}}function Or(r){let e=ei.workspace.getConfiguration("rubyLsp").get("featureFlags");if(e[r]===!1||e.all===!1)return!1;let t=qh[r];if(e.all&&t!==-1||e[r])return!0;let n=ei.env.machineId,i=(0,DC.createHash)("sha256").update(`${n}-${r}`).digest("hex");return parseInt(i.substring(0,8),16)/4294967295<t}var Ri=re(require("vscode"));var no=re(require("path")),xC=re(require("os")),Sr=re(require("vscode"));var cc="RUBY_LSP_ACTIVATION_SEPARATOR",nk="RUBY_LSP_VS",rk="RUBY_LSP_FS",Tt=class{constructor(e,t,n,i){this.workspaceFolder=e,this.outputChannel=t,this.context=n,this.manuallySelectRuby=i;let s=Sr.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=no.default.isAbsolute(s)?s:no.default.resolve(no.default.join(this.workspaceFolder.uri.fsPath,s))),this.bundleUri=this.customBundleGemfile?Sr.Uri.file(no.default.dirname(this.customBundleGemfile)):e.uri}async runEnvActivationScript(e){let t=Sr.Uri.joinPath(this.context.extensionUri,"activation.rb"),n=await this.runScript(`${e} -EUTF-8:UTF-8 '${t.fsPath}'`),i=new RegExp(`${cc}([^]*)${cc}`).exec(n.stderr),[s,o,a,...c]=i[1].split(rk);return{version:s,gemPath:o.split(","),yjit:a==="true",env:Object.fromEntries(c.map(d=>d.split(nk)))}}runScript(e){let t;return Sr.env.shell.length>0&&xC.default.platform()!=="win32"&&(t=Sr.env.shell),this.outputChannel.info(`Running command: \`${e}\` in ${this.bundleUri.fsPath} using shell: ${t}`),gn(e,{cwd:this.bundleUri.fsPath,shell:t,env:process.env,encoding:"utf-8"})}async findExec(e,t){for(let n of e)try{let i=Sr.Uri.joinPath(n,t);return await Sr.workspace.fs.stat(i),this.outputChannel.info(`Found ${t} executable at ${n.fsPath}`),i.fsPath}catch{}return t}};var ro=class extends Error{},uc=class extends Tt{async activate(){try{await Ri.workspace.fs.stat(Ri.Uri.joinPath(this.bundleUri,".shadowenv.d"))}catch{throw new Error("The Ruby LSP version manager is configured to be shadowenv,         but no .shadowenv.d directory was found in the workspace")}let e=await this.findExec([Ri.Uri.file("/opt/homebrew/bin")],"shadowenv");try{let t=await this.runEnvActivationScript(`${e} exec -- ruby`);return delete t.env.BUNDLE_GEMFILE,{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}catch(t){if(t.message.includes("untrusted shadowenv program")){if(await Ri.window.showErrorMessage(`Tried to activate Shadowenv, but the workspace is untrusted.
           Workspaces must be trusted to before allowing Shadowenv to load the environment for security reasons.`,"Trust workspace","Shutdown Ruby LSP")==="Trust workspace")return await gn("shadowenv trust",{cwd:this.bundleUri.fsPath}),this.activate();throw new ro("Cannot activate Ruby environment in an untrusted workspace")}try{await gn("shadowenv --version")}catch{throw new Error(`Shadowenv executable not found. Ensure it is installed and available in the PATH.
           This error may happen if your shell configuration is failing to be sourced from the editor or if
           another extension is mutating the process PATH.`)}throw new Error(`Failed to activate Ruby environment with Shadowenv: ${t.message}`)}}};var Oh=re(require("os")),_r=re(require("path")),Ne=re(require("vscode"));var io=class extends Error{},os=class extends Tt{constructor(t,n,i,s){super(t,n,i,s);this.rubyInstallationUris=[Ne.Uri.joinPath(Ne.Uri.file(Oh.default.homedir()),".rubies"),Ne.Uri.joinPath(Ne.Uri.file("/"),"opt","rubies")];let o=Ne.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.chrubyRubies");o&&this.rubyInstallationUris.push(...o.map(a=>Ne.Uri.file(a)))}async activate(){let t=await this.discoverRubyVersion(),n;try{if(t)n=await this.findRubyUri(t);else{let d=await this.fallbackWithCancellation("No .ruby-version file found. Trying to fall back to latest installed Ruby in 10 seconds","You can create a .ruby-version file in a parent directory to configure a fallback",this.findFallbackRuby.bind(this),this.rubyVersionError.bind(this));t=d.rubyVersion,n=d.uri}}catch(d){if(d instanceof io)return this.activate();throw d}try{if(!n){let d={...t},g=await this.fallbackWithCancellation(`Couldn't find installation for ${t.version}. Trying to fall back to other Ruby in 10 seconds`,"You can cancel this fallback and install the required Ruby",async()=>this.findClosestRubyInstallation(d),()=>this.missingRubyError(d.version));t=g.rubyVersion,n=g.uri}}catch(d){if(d instanceof io)return this.activate();throw d}this.outputChannel.info(`Discovered Ruby installation at ${n.fsPath}`);let{defaultGems:i,gemHome:s,yjit:o,version:a}=await this.runActivationScript(n,t);this.outputChannel.info(`Activated Ruby environment: defaultGems=${i} gemHome=${s} yjit=${o}`);let c={GEM_HOME:s,GEM_PATH:`${s}${_r.default.delimiter}${i}`,PATH:`${_r.default.join(s,"bin")}${_r.default.delimiter}${_r.default.join(i,"bin")}${_r.default.delimiter}${_r.default.dirname(n.fsPath)}${_r.default.delimiter}${this.getProcessPath()}`};return{env:{...process.env,...c},yjit:o,version:a,gemPath:[s,i]}}getProcessPath(){return process.env.PATH}async findRubyUri(t){let n=t.engine?[`${t.engine}-${t.version}`,t.version]:[t.version,`ruby-${t.version}`];for(let i of this.rubyInstallationUris){let s;try{s=(await Ne.workspace.fs.readDirectory(i)).sort((o,a)=>a[0].localeCompare(o[0]))}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${i.fsPath} but it doesn't exist`);continue}for(let o of n){let a=s.find(([c])=>c.startsWith(o));if(a)return Ne.Uri.joinPath(i,a[0],"bin","ruby")}}}async runActivationScript(t,n){let i=Ne.Uri.joinPath(this.context.extensionUri,"chruby_activation.rb"),s=await this.runScript(`${t.fsPath} -EUTF-8:UTF-8 '${i.fsPath}' ${n.version}`),[o,a,c,d]=s.stderr.split(cc);return{defaultGems:o,gemHome:a,yjit:c==="true",version:d}}async findClosestRubyInstallation(t){let[n,i,s]=t.version.split("."),o=[];for(let c of this.rubyInstallationUris)try{(await Ne.workspace.fs.readDirectory(c)).forEach(([d])=>{let g=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(d);g?.groups&&g.groups.version.startsWith(n)&&o.push({uri:Ne.Uri.joinPath(c,d,"bin","ruby"),rubyVersion:{engine:g.groups.engine,version:g.groups.version}})})}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${c.fsPath} but it doesn't exist`);continue}let a=o.sort((c,d)=>{let g=c.rubyVersion.version.split("."),v=d.rubyVersion.version.split("."),m=Math.abs(Number(g[1])-Number(i)),S=Math.abs(Number(v[1])-Number(i));return m===S?Number(v[2]||0)-Number(g[2]||0):m-S})[0];if(a)return a;throw new Error("Cannot find any Ruby installations")}async discoverRubyVersion(){let t=this.bundleUri,n=_r.default.parse(t.fsPath).root,i,s;for(;t.fsPath!==n;){try{s=Ne.Uri.joinPath(t,".ruby-version"),i=(await Ne.workspace.fs.readFile(s)).toString().trim()}catch{t=Ne.Uri.file(_r.default.dirname(t.fsPath));continue}if(i==="")throw new Error(`Ruby version file ${s.fsPath} is empty`);let o=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(i);if(!o?.groups)throw new Error(`Ruby version file ${s.fsPath} contains invalid format. Expected (engine-)?version, got ${i}`);return this.outputChannel.info(`Discovered Ruby version ${i} from ${s.fsPath}`),{engine:o.groups.engine,version:o.groups.version}}}async fallbackWithCancellation(t,n,i,s){let o;try{o=await Ne.workspace.fs.readFile(Ne.Uri.joinPath(this.workspaceFolder.uri,"Gemfile"))}catch{}if(o&&/^ruby(\s|\()("|')[\d.]+/.test(o.toString()))throw s();return await Ne.window.withProgress({title:t,location:Ne.ProgressLocation.Notification,cancellable:!0},async(c,d)=>{if(c.report({message:n}),await new Promise(g=>{setTimeout(g,1e4),d.onCancellationRequested(()=>{g()})}),d.isCancellationRequested)throw await this.handleCancelledFallback(s),new io;return i()})}async handleCancelledFallback(t){let n=await Ne.window.showInformationMessage(`The Ruby LSP requires a Ruby version to launch.
      You can define a fallback for the system or for the Ruby LSP only`,"System","Ruby LSP only");throw n==="System"?await this.createParentRubyVersionFile(t):n==="Ruby LSP only"&&await this.manuallySelectRuby(),t()}async createParentRubyVersionFile(t){let n=[];for(let o of this.rubyInstallationUris){let a;try{a=(await Ne.workspace.fs.readDirectory(o)).sort((c,d)=>d[0].localeCompare(c[0])),a.forEach(c=>{n.push({label:c[0]})})}catch{continue}}let i=await Ne.window.showQuickPick(n,{title:"Select a Ruby version to use as fallback",ignoreFocusOut:!0});if(!i)throw t();let s=await Ne.window.showOpenDialog({defaultUri:Ne.Uri.file(Oh.default.homedir()),openLabel:"Add fallback in this directory",canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:"Select the directory to create the .ruby-version fallback in"});if(!s)throw t();await Ne.workspace.fs.writeFile(Ne.Uri.joinPath(s[0],".ruby-version"),Buffer.from(i.label))}async findFallbackRuby(){for(let t of this.rubyInstallationUris){let n;try{n=(await Ne.workspace.fs.readDirectory(t)).sort((o,a)=>a[0].localeCompare(o[0]));let i,s;for(let o of n){let a=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(o[0]);if(a?.groups){i=a.groups,s=o;break}}if(s&&i)return{uri:Ne.Uri.joinPath(t,s[0],"bin","ruby"),rubyVersion:{engine:i.engine,version:i.version}}}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${t.fsPath} but it doesn't exist`);continue}}throw new Error("Cannot find any Ruby installations")}missingRubyError(t){return new Error(`Cannot find Ruby installation for version ${t}`)}rubyVersionError(){return new Error(`Cannot find .ruby-version file. Please specify the Ruby version in a
           .ruby-version either in ${this.bundleUri.fsPath} or in a parent directory`)}};var IC=re(require("os")),Zn=re(require("vscode"));var dc=class extends Tt{async activate(){let e=await this.findMiseUri(),t=await this.runEnvActivationScript(`${e.fsPath} x -- ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findMiseUri(){let t=Zn.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.miseExecutablePath");if(t){let i=Zn.Uri.file(t);try{return await Zn.workspace.fs.stat(i),i}catch{throw new Error(`Mise executable configured as ${i.fsPath}, but that file doesn't exist`)}}let n=[Zn.Uri.joinPath(Zn.Uri.file(IC.default.homedir()),".local","bin","mise"),Zn.Uri.joinPath(Zn.Uri.file("/"),"opt","homebrew","bin","mise"),Zn.Uri.joinPath(Zn.Uri.file("/"),"usr","bin","mise")];for(let i of n)try{return await Zn.workspace.fs.stat(i),i}catch{}throw new Error(`The Ruby LSP version manager is configured to be Mise, but could not find Mise installation. Searched in
        ${n.join(", ")}`)}};var lc=re(require("os")),ni=re(require("vscode"));var fc=class extends os{getProcessPath(){return process.env.Path??process.env.PATH??process.env.path}async findRubyUri(e){let[t,n,i]=e.version.split(".").map(Number),s=[ni.Uri.joinPath(ni.Uri.file("C:"),`Ruby${t}${n}-${lc.default.arch()}`),ni.Uri.joinPath(ni.Uri.file(lc.default.homedir()),`Ruby${t}${n}-${lc.default.arch()}`)];for(let o of s)try{return await ni.workspace.fs.stat(o),ni.Uri.joinPath(o,"bin","ruby")}catch{}throw new Error(`Cannot find installation directory for Ruby version ${e.version}.         Searched in ${s.map(o=>o.fsPath).join(", ")}`)}async runActivationScript(e,t){let n=await super.runActivationScript(e,t);return n.gemHome=n.gemHome.replace(/\//g,"\\"),n.defaultGems=n.defaultGems.replace(/\//g,"\\"),n}};var Si=re(require("vscode"));var hc=class extends Tt{async activate(){let e=await this.findRbenv(),t=await this.runEnvActivationScript(`${e} exec ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRbenv(){let t=Si.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.rbenvExecutablePath");return t?this.ensureRbenvExistsAt(t):this.findExec([Si.Uri.file("/opt/homebrew/bin"),Si.Uri.file("/usr/local/bin")],"rbenv")}async ensureRbenvExistsAt(e){try{return await Si.workspace.fs.stat(Si.Uri.file(e)),e}catch{throw new Error(`The Ruby LSP version manager is configured to be rbenv, but ${e} does not exist`)}}};var qC=re(require("os")),Fr=re(require("vscode"));var pc=class extends Tt{async activate(){let e=await this.findRvmInstallation(),t=await this.runEnvActivationScript(e.fsPath),n=Object.entries(t.env).map(([i,s])=>`${i}=${s}`).join(" ");return this.outputChannel.info(`Activated Ruby environment: ${n}`),{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRvmInstallation(){let e=[Fr.Uri.joinPath(Fr.Uri.file(qC.default.homedir()),".rvm","bin","rvm-auto-ruby"),Fr.Uri.joinPath(Fr.Uri.file("/"),"usr","local","rvm","bin","rvm-auto-ruby"),Fr.Uri.joinPath(Fr.Uri.file("/"),"usr","share","rvm","bin","rvm-auto-ruby")];for(let t of e)try{return await Fr.workspace.fs.stat(t),t}catch{}throw new Error(`Cannot find RVM installation directory. Searched in ${e.map(t=>t.fsPath).join(",")}`)}};var as=class extends Tt{constructor(e,t,n,i,s){super(e,t,n,i),this.rubyPath=s??"ruby"}async activate(){let e=await this.runEnvActivationScript(this.rubyPath);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}};var OC=re(require("vscode"));var gc=class extends Tt{async activate(){let e=await this.runEnvActivationScript(`${this.customCommand()} && ruby`);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}customCommand(){let t=OC.workspace.getConfiguration("rubyLsp").get("customRubyCommand");if(t===void 0)throw new Error("The customRubyCommand configuration must be set when 'custom' is selected as the version manager.         See the [README](https://shopify.github.io/ruby-lsp/version-managers.html) for instructions.");return t}};var FC=re(require("os")),Fh=re(require("path")),Pt=re(require("vscode"));var mc=class extends Tt{async activate(){let e=[Pt.Uri.joinPath(Pt.Uri.file("/"),"opt","homebrew","bin"),Pt.Uri.joinPath(Pt.Uri.file("/"),"usr","local","bin")],t=await this.getConfiguredAsdfPath()??await this.findAsdfInstallation()??await this.findExec(e,"asdf"),n=Fh.default.extname(t)===""?t:`. ${t} && asdf`,i=await this.runEnvActivationScript(`${n} exec ruby`);return{env:{...process.env,...i.env},yjit:i.yjit,version:i.version,gemPath:i.gemPath}}async findAsdfInstallation(){let e=Fh.default.basename(Pt.env.shell)==="fish"?"asdf.fish":"asdf.sh",t=[Pt.Uri.joinPath(Pt.Uri.file(FC.default.homedir()),".asdf",e),Pt.Uri.joinPath(Pt.Uri.file("/"),"opt","asdf-vm",e),Pt.Uri.joinPath(Pt.Uri.file("/"),"opt","homebrew","opt","asdf","libexec",e),Pt.Uri.joinPath(Pt.Uri.file("/"),"usr","local","opt","asdf","libexec",e)];for(let n of t)try{return await Pt.workspace.fs.stat(n),n.fsPath}catch{}this.outputChannel.info(`Could not find installation for ASDF < v0.16. Searched in ${t.join(", ")}`)}async getConfiguredAsdfPath(){let t=Pt.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.asdfExecutablePath");if(!t)return;let n=Pt.Uri.file(t);try{return await Pt.workspace.fs.stat(n),this.outputChannel.info(`Using configured ASDF executable path: ${t}`),n.fsPath}catch{throw new Error(`ASDF executable configured as ${n.fsPath}, but that file doesn't exist`)}}};var Fn=re(require("vscode"));var vc=class extends Tt{async activate(){let e=await this.findRv(),t=await this.runEnvActivationScript(`${e} ruby run --`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRv(){let t=Fn.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.rvExecutablePath");if(t)return this.ensureRvExistsAt(t);{let n=[Fn.Uri.joinPath(Fn.Uri.file("/"),"home","linuxbrew",".linuxbrew","bin"),Fn.Uri.joinPath(Fn.Uri.file("/"),"usr","local","bin"),Fn.Uri.joinPath(Fn.Uri.file("/"),"opt","homebrew","bin"),Fn.Uri.joinPath(Fn.Uri.file("/"),"usr","bin")];return this.findExec(n,"rv")}}async ensureRvExistsAt(e){try{return await Fn.workspace.fs.stat(Fn.Uri.file(e)),e}catch{throw new Error(`The Ruby LSP version manager is configured to be rv, but ${e} does not exist`)}}};async function ik(){let r=[Oe.Uri.joinPath(Oe.Uri.file(Lh.default.homedir()),".local","bin","mise"),Oe.Uri.joinPath(Oe.Uri.file("/"),"opt","homebrew","bin","mise"),Oe.Uri.joinPath(Oe.Uri.file("/"),"usr","bin","mise")];for(let e of r)try{return await Oe.workspace.fs.stat(e),!0}catch{}return!1}var Mh=(v=>(v.Asdf="asdf",v.Auto="auto",v.Chruby="chruby",v.Rbenv="rbenv",v.Rvm="rvm",v.Shadowenv="shadowenv",v.Mise="mise",v.RubyInstaller="rubyInstaller",v.Rv="rv",v.None="none",v.Custom="custom",v))(Mh||{}),bc=class{constructor(e,t,n,i){this.gemPath=[];this.#e=Oe.workspace.getConfiguration("rubyLsp").get("rubyVersionManager");this._env={};this._error=!1;this.context=e,this.workspaceFolder=t,this.outputChannel=n,this.telemetry=i;let s=Oe.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=yc.default.isAbsolute(s)?s:yc.default.resolve(yc.default.join(this.workspaceFolder.uri.fsPath,s)))}#e;get versionManager(){return this.#e}set versionManager(e){typeof e=="string"?this.#e.identifier=e:this.#e=e}get env(){return this._env}get error(){return this._error}async activateRuby(e=Oe.workspace.getConfiguration("rubyLsp").get("rubyVersionManager")){this.versionManager=e,this._error=!1;let t=await this.cachedWorkspaceRubyPath();if(t)await this.runActivation(new as(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),t));else{this.versionManager.identifier==="auto"&&(await this.discoverVersionManager(),this.outputChannel.info(`Discovered version manager ${this.versionManager.identifier}`));try{await this.runManagerActivation()}catch(n){n instanceof ro||this.telemetry.logError(n,{appType:"extension",appVersion:this.context.extension.packageJSON.version,versionManager:this.versionManager.identifier,workspace:new Oe.TelemetryTrustedValue(this.workspaceFolder.name)});let i=Oe.workspace.getConfiguration("rubyLsp").get("rubyExecutablePath");if(i)await this.runActivation(new as(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),i));else{if(this._error=!0,this.context.extensionMode===Oe.ExtensionMode.Test)throw n;await this.handleRubyError(n.message)}}}this.error||(this.fetchRubyVersionInfo(),await this.setupBundlePath())}async manuallySelectRuby(){let e=await Oe.window.showInformationMessage("Configure global or workspace specific fallback for the Ruby LSP?","global","workspace","clear previous workspace selection");if(!e)return;if(e==="clear previous workspace selection")return await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,void 0),this.activateRuby();let t=await Oe.window.showOpenDialog({title:`Select Ruby binary path for ${e} configuration`,openLabel:"Select Ruby binary",canSelectMany:!1});if(!t)return;let n=t[0].fsPath;return e==="global"?await Oe.workspace.getConfiguration("rubyLsp").update("rubyExecutablePath",n,!0):await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,n),this.activateRuby()}mergeComposedEnvironment(e){this._env={...this._env,...e}}async runActivation(e){let{env:t,version:n,yjit:i,gemPath:s}=await e.activate(),[o,a,c]=n.split(".").map(Number);this.sanitizeEnvironment(t),this.context.extensionMode!==Oe.ExtensionMode.Test&&(process.env=t),this._env=t,this.rubyVersion=n,this.yjitEnabled=i&&o>3||o===3&&a>=2,this.gemPath.push(...s)}fetchRubyVersionInfo(){let[e,t,n]=this.rubyVersion.split(".").map(Number);if(e<3)throw new Error(`The Ruby LSP requires Ruby 3.0 or newer to run. This project is using ${this.rubyVersion}.         [See alternatives](https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#ruby-version-requirement)`);this.yjitEnabled&&e===3&&t===2&&(this._env.RUBYOPT?this._env.RUBYOPT.concat(" --yjit"):this._env.RUBYOPT="--yjit")}sanitizeEnvironment(e){Object.keys(e).forEach(t=>{t.startsWith("RUBY_GC")&&delete e[t]}),delete e.VERBOSE,delete e.DEBUG}async runManagerActivation(){switch(this.versionManager.identifier){case"asdf":await this.runActivation(new mc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"chruby":await this.runActivation(new os(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rbenv":await this.runActivation(new hc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rvm":await this.runActivation(new pc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"mise":await this.runActivation(new dc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rv":await this.runActivation(new vc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rubyInstaller":await this.runActivation(new fc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"custom":await this.runActivation(new gc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"none":await this.runActivation(new as(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;default:await this.runActivation(new uc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break}}async setupBundlePath(){if(this.customBundleGemfile)try{await Oe.workspace.fs.stat(Oe.Uri.file(this.customBundleGemfile)),this._env.BUNDLE_GEMFILE=this.customBundleGemfile}catch{throw new Error(`The configured bundle gemfile ${this.customBundleGemfile} does not exist`)}}async discoverVersionManager(){try{await Oe.workspace.fs.stat(Oe.Uri.joinPath(this.workspaceFolder.uri,".shadowenv.d")),this.versionManager.identifier="shadowenv";return}catch{}let e=["chruby","rbenv","rvm","asdf","rv"];for(let t of e)if(await this.toolExists(t)){this.versionManager=t;return}if(await ik()){this.versionManager="mise";return}if(Lh.default.platform()==="win32"){this.versionManager="rubyInstaller";return}this.versionManager="none"}async toolExists(e){try{let n=`${Oe.env.shell.replace(/(\s+)/g,"\\$1")} -i -c '${e} --version'`;return this.outputChannel.info(`Checking if ${e} is available on the path with command: ${n}`),await gn(n,{cwd:this.workspaceFolder.uri.fsPath,timeout:1e3}),!0}catch{return!1}}async handleRubyError(e){let t=await Oe.window.showErrorMessage(`Automatic Ruby environment activation with ${this.versionManager.identifier} failed: ${e}`,"Retry","Select Ruby manually");if(t)return t==="Retry"&&await Oe.commands.executeCommand("workbench.action.reloadWindow"),this.manuallySelectRuby()}async cachedWorkspaceRubyPath(){let e=this.context.workspaceState.get(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`);if(e)try{return await Oe.workspace.fs.stat(Oe.Uri.file(e)),e}catch{this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,void 0);return}}};var cs=re(require("path")),jh=re(require("os")),wc=require("perf_hooks"),Se=re(require("vscode")),Ln=re(oc());function sk(){let r=Object.keys(qh);return Object.fromEntries(r.map(e=>[e,Or(e)]))}function ok(r,e){let t,n,i=Se.workspace.getConfiguration("rubyLsp"),s=i.get("branch"),o=i.get("bundleGemfile"),a=i.get("useBundlerCompose"),c=i.get("bypassTypechecker"),d={cwd:r.uri.fsPath,env:c?{...e,RUBY_LSP_BYPASS_TYPECHECKER:"true"}:e,shell:!0};if(o.length>0)t={command:"bundle",args:["exec","ruby-lsp"],options:d},n={command:"bundle",args:["exec","ruby-lsp","--debug"],options:d};else if(a)t={command:"bundle",args:["compose","gem","ruby-lsp"],options:d},n={command:"bundle",args:["compose","gem","ruby-lsp","--","--debug"],options:d};else{let g=r.uri.fsPath,v=cs.default.basename(g)==="ruby-lsp"&&jh.default.platform()!=="win32"?cs.default.join(g,"exe","ruby-lsp"):"ruby-lsp",m=[];s.length>0&&m.push("--branch",s),Or("launcher")&&m.push("--use-launcher"),t={command:v,args:m,options:d},n={command:v,args:m.concat(["--debug"]),options:d}}return{run:t,debug:n}}function ak(r,e,t,n,i,s){let o=r.get("pullDiagnosticsOn"),a={onChange:o==="change"||o==="both",onSave:o==="save"||o==="both"},c=r.get("enabledFeatures"),d=Object.keys(c).filter(m=>c[m]),g=e.uri.fsPath.replace(/\/$/,""),v=ti.flatMap(m=>({scheme:"file",language:m,pattern:`${g}/**/*`}));return i&&ti.forEach(m=>{v.push({language:m,scheme:"untitled"})}),n.gemPath.forEach(m=>{let S=m.replace(/\\/g,"/");v.push({scheme:"file",language:"ruby",pattern:`${S}/**/*`}),/lib\/ruby\/gems\/(?=\d)/.test(S)&&v.push({scheme:"file",language:"ruby",pattern:`${S.replace(/lib\/ruby\/gems\/(?=\d)/,"lib/ruby/")}/**/*`})}),r.get("erbSupport")||(v=v.filter(m=>m.language!=="erb")),{documentSelector:v,workspaceFolder:e,diagnosticCollectionName:ac,outputChannel:t,revealOutputChannelOn:Ln.RevealOutputChannelOn.Never,diagnosticPullOptions:a,errorHandler:new Nh(e,s),initializationOptions:{enabledFeatures:d,featuresConfiguration:r.get("featuresConfiguration"),formatter:r.get("formatter"),linters:r.get("linters"),indexing:r.get("indexing"),addonSettings:r.get("addonSettings"),enabledFeatureFlags:sk(),telemetryMachineId:Se.env.machineId}}}var Nh=class{constructor(e,t){this.workspaceFolder=e,this.telemetry=t}error(e,t,n){return{action:Ln.ErrorAction.Shutdown,handled:!0}}async closed(){let e=Se.workspace.getConfiguration("rubyLsp").get("useLauncher")?"launcher":"direct";return this.telemetry.logUsage("ruby_lsp.launch_failure",{type:"counter",attributes:{label:e}}),await Se.window.showErrorMessage(`Launching the Ruby LSP failed. This typically happens due to an error with version manager
      integration or Bundler issues.

      [Logs](command:workbench.action.output.toggleOutput) |
      [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) |
      [Run bundle install](command:rubyLsp.bundleInstall?"${this.workspaceFolder.uri.toString()}")`,"Retry","Shutdown")==="Retry"?{action:Ln.CloseAction.Restart,handled:!0}:{action:Ln.CloseAction.DoNotRestart,handled:!0}}},Ah=class{fillClientCapabilities(e){e.experimental={requestDelegation:!0}}initialize(e,t){}getState(){return{kind:"static"}}clear(){}},so=class extends Ln.LanguageClient{constructor(t,n,i,s,o,a,c,d=!1,g){super(ac,ok(o,i.env),ak(Se.workspace.getConfiguration("rubyLsp"),o,a,i,d,n),g);this.degraded=!1;this.virtualDocuments=new Map;this.subscriptions=[];this.registerFeature(new Ah),this.workspaceOutputChannel=a,this.virtualDocuments=c,this.registerMiddleware(),this.workingDirectory=o.uri.fsPath,this.baseFolder=cs.default.basename(this.workingDirectory),this.telemetry=n,this.createTestItems=s,this.#e=t,this.ruby=i,this.#t="",this.subscriptions.push(this.onNotification("delegate/textDocument/virtualState",v=>{this.virtualDocuments.set(v.textDocument.uri,v.textDocument.text)}),this.onTelemetry(v=>{v.type==="error"?this.telemetry.logError({message:v.errorMessage,name:v.errorClass,stack:v.stack},{appType:"server",appVersion:this.serverVersion,workspace:new Se.TelemetryTrustedValue(cs.default.basename(this.workingDirectory))}):v.type==="data"&&this.validServerTelemetry(v)&&this.telemetry.logUsage(v.eventName,v.data)})),this.indexingPromise=new Promise(v=>{this.clientOptions.middleware.handleWorkDoneProgress=(m,S,b)=>{m.toString()==="indexing-progress"&&S.kind==="end"&&v(),b(m,S)}})}#e;#t;async afterStart(){this.#t=this.initializeResult?.formatter,this.serverVersion=this.initializeResult?.serverInfo?.version,this.initializeResult?.degraded_mode&&(this.degraded=this.initializeResult?.degraded_mode),this.initializeResult?.bundle_env&&this.ruby.mergeComposedEnvironment(this.initializeResult.bundle_env),await this.fetchAddons()}async fetchAddons(){if(this.initializeResult?.capabilities.experimental?.addon_detection)try{this.addons=await this.sendRequest("rubyLsp/workspace/addons",{})}catch(t){this.workspaceOutputChannel.error(`Error while fetching addons: ${t.data.errorMessage}`)}}async waitForIndexing(){return this.indexingPromise}get formatter(){return this.#t}get context(){return this.#e}set context(t){this.#e=t}async sendShowSyntaxTreeRequest(t,n){return this.sendRequest("rubyLsp/textDocument/showSyntaxTree",{textDocument:{uri:t.toString()},range:n})}async discoverTests(t){return this.sendRequest("rubyLsp/discoverTests",{textDocument:{uri:t.toString()}})}async resolveTestCommands(t){return this.sendRequest("rubyLsp/resolveTestCommands",{items:t})}async dispose(t){return this.subscriptions.forEach(n=>n.dispose()),this.subscriptions=[],super.dispose(t)}async sendGoToRelevantFileRequest(t){return this.sendRequest("experimental/goToRelevantFile",{textDocument:{uri:t.toString()}})}async benchmarkMiddleware(t,n,i){if(this.state!==Ln.State.Running)return i();let s=typeof t=="string"?t:t.method;try{wc.performance.mark(`${s}.start`);let o=await i();wc.performance.mark(`${s}.end`);let a=wc.performance.measure("benchmarks",`${s}.start`,`${s}.end`);return this.logResponseTime(a.duration,s),o}catch(o){if(o.code===-32900)return this.executeDelegateRequest(t,n);if(o.data)if(this.baseFolder==="ruby-lsp"||this.baseFolder==="ruby-lsp-rails")await Se.window.showErrorMessage(`Ruby LSP error ${o.data.errorClass}: ${o.data.errorMessage}

${o.data.backtrace}`);else{let{errorMessage:a,errorClass:c,backtrace:d}=o.data;if(a&&c&&d&&o.code===Ln.ErrorCodes.InternalError){let g=new Se.TelemetryTrustedValue(d.split(`
`).map(v=>v.replace(jh.default.homedir(),"~")).join(`
`));this.telemetry.logError({message:a,name:c,stack:g},{...o.data,appType:"server",appVersion:this.serverVersion,workspace:new Se.TelemetryTrustedValue(cs.default.basename(this.workingDirectory))})}}throw o}}async executeDelegateRequest(t,n){let i=typeof t=="string"?t:t.method,s=n.textDocument.uri;if(!s)return null;let o=this.virtualDocumentUri(s);switch(i){case"textDocument/completion":return Se.commands.executeCommand("vscode.executeCompletionItemProvider",Se.Uri.parse(o),n.position,n.context.triggerCharacter).then(a=>(a.items.forEach(c=>{c.documentation&&typeof c.documentation!="string"&&"value"in c.documentation&&(c.documentation.kind="markdown"),c.data={...c.data,delegateCompletion:!0}}),a));case"textDocument/hover":return Se.commands.executeCommand("vscode.executeHoverProvider",Se.Uri.parse(o),n.position);case"textDocument/definition":return Se.commands.executeCommand("vscode.executeDefinitionProvider",Se.Uri.parse(o),n.position);case"textDocument/signatureHelp":return Se.commands.executeCommand("vscode.executeSignatureHelpProvider",Se.Uri.parse(o),n.position,n.context?.triggerCharacter);case"textDocument/documentHighlight":return Se.commands.executeCommand("vscode.executeDocumentHighlights",Se.Uri.parse(o),n.position);default:return this.workspaceOutputChannel.warn(`Attempted to delegate unsupported request ${i}`),null}}registerMiddleware(){this.clientOptions.middleware={provideCodeLenses:async(t,n,i)=>{let s=await i(t,n);if(s){let o=s.filter(a=>a.data?.type==="test");o.length&&this.createTestItems(o)}return s},provideOnTypeFormattingEdits:async(t,n,i,s,o,a)=>{let c=await this.sendRequest("textDocument/onTypeFormatting",{textDocument:{uri:t.uri.toString()},position:n,ch:i,options:s},o);if(!c)return null;let d=c.find(x=>x.newText==="$0");if(!d)return c;c.splice(c.indexOf(d),1);let g=new Se.WorkspaceEdit;g.set(t.uri,c);let m=Se.window.activeTextEditor.document.lineAt(d.range.start.line).text;await Se.workspace.applyEdit(g);let S=Se.window.activeTextEditor?.options.insertSpaces?" ":"	",b=0;/^\s*$/.exec(m)&&(b=d.range.end.character);let E=S.repeat(b);return await Se.window.activeTextEditor.insertSnippet(new Se.SnippetString(`${E}${d.newText}`),new Se.Selection(d.range.start,d.range.end)),null},sendRequest:async(t,n,i,s)=>this.benchmarkMiddleware(t,n,()=>s(t,n,i)),sendNotification:async(t,n,i)=>this.benchmarkMiddleware(t,i,()=>n(t,i)),didClose:(t,n)=>(this.virtualDocuments.delete(t.uri.toString(!0)),n(t)),provideFoldingRanges:async(t,n,i,s)=>{if(t.languageId==="erb"){let o=this.virtualDocumentUri(t.uri.toString(!0)),a=await Se.commands.executeCommand("vscode.executeFoldingRangeProvider",Se.Uri.parse(o)),c=await s(t,n,i);return a.concat(c??[])}return s(t,n,i)},provideDocumentLinks:async(t,n,i)=>{if(t.languageId==="erb"){let s=this.virtualDocumentUri(t.uri.toString(!0)),o=await Se.commands.executeCommand("vscode.executeLinkProvider",Se.Uri.parse(s)),a=await i(t,n);return o.concat(a??[])}return i(t,n)}}}virtualDocumentUri(t){let n=/\.([^.]+)\.erb$/.exec(t)?.[1]||"html";return`embedded-content://${n}/${encodeURIComponent(t)}.${n}`}logResponseTime(t,n){this.telemetry.logUsage("ruby_lsp.response_time",{type:"histogram",value:t,attributes:{message:new Se.TelemetryTrustedValue(n),lspVersion:this.serverVersion,rubyVersion:this.ruby.rubyVersion}})}validServerTelemetry(t){let{eventName:n,data:{type:i,value:s}}=t;return typeof n=="string"&&(i==="histogram"&&typeof s=="number"||i==="counter"&&(typeof s=="number"||!s))}};var Cc=class{constructor(e,t){this.prefix=`(${e})`,this.actualChannel=t,this.onDidChangeLogLevel=this.actualChannel.onDidChangeLogLevel}get name(){return this.actualChannel.name}get logLevel(){return this.actualChannel.logLevel}trace(e,...t){this.actualChannel.trace(`${this.prefix} ${e}`,...t)}debug(e,...t){this.actualChannel.debug(`${this.prefix} ${e}`,...t)}info(e,...t){this.actualChannel.info(`${this.prefix} ${e}`,...t)}warn(e,...t){this.actualChannel.warn(`${this.prefix} ${e}`,...t)}error(e,...t){this.actualChannel.error(`${this.prefix} ${e}`,...t)}append(e){this.actualChannel.append(`${this.prefix} ${e}`)}appendLine(e){this.actualChannel.appendLine(`${this.prefix} ${e}`)}replace(e){this.actualChannel.replace(`${this.prefix} ${e}`)}clear(){this.actualChannel.clear()}show(e,t){this.actualChannel.show(t)}hide(){this.actualChannel.hide()}dispose(){this.actualChannel.dispose()}};var LC=["Gemfile.lock","gems.locked"],Sc=class{constructor(e,t,n,i,s,o=!1){this.virtualDocuments=new Map;this.restartDocumentShas=new Map;this.needsRestart=!1;this.subscriptions=[];this.#e=!1;this.#t=!1;this.debouncedRestart=EC(async e=>{this.outputChannel.info(`Restarting the Ruby LSP because ${e}`),await this.restart()},5e3);this.context=e,this.workspaceFolder=t,this.outputChannel=new Cc(t.name,Rr),this.telemetry=n,this.ruby=new bc(e,t,this.outputChannel,n),this.createTestItems=i,this.isMainWorkspace=o,this.virtualDocuments=s}#e;#t;async activate(){let e=wt.extensions.getExtension("vscode.git"),t=this.workspaceFolder.uri;if(e)try{let i=await e.exports.getAPI(1).openRepository(this.workspaceFolder.uri);i&&(t=i.rootUri)}catch{}this.registerCreateDeleteWatcher(t,".git/{rebase-merge,rebase-apply,BISECT_START,CHERRY_PICK_HEAD}"),this.registerRestarts();for(let n of LC){let i=wt.Uri.joinPath(this.workspaceFolder.uri,n),s=await this.fileContentsSha(i);s&&this.restartDocumentShas.set(i.fsPath,s)}}async start(e){if(await this.ruby.activateRuby(),this.ruby.error){this.error=!0;return}try{if((await wt.workspace.fs.stat(this.workspaceFolder.uri)).permissions)throw new Error(`Directory ${this.workspaceFolder.uri.fsPath} is readonly.`)}catch{this.error=!0,await wt.window.showErrorMessage(`Directory ${this.workspaceFolder.uri.fsPath} is not writable. The Ruby LSP server needs to be able to create a
        .ruby-lsp directory to function appropriately. Consider switching to a directory for which VS Code has write
        permissions`);return}try{await this.installOrUpdateServer(!1)}catch(t){this.error=!0,await wt.window.showErrorMessage(`Failed to setup the bundle: ${t.message}.         See [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) for help`);return}this.lspClient&&await this.stop(),this.lspClient=new so(this.context,this.telemetry,this.ruby,this.createTestItems,this.workspaceFolder,this.outputChannel,this.virtualDocuments,this.isMainWorkspace,e);try{Yn.fire(this),await wt.window.withProgress({location:wt.ProgressLocation.Window,title:"Initializing Ruby LSP"},async()=>{await this.lspClient.start(),await this.lspClient.afterStart()}),Yn.fire(this),this.needsRestart&&(this.needsRestart=!1,await this.debouncedRestart("a restart was requested while the server was still booting"))}catch(t){this.error=!0,this.outputChannel.error(`Error starting the server: ${t.message}`)}}async stop(){await this.lspClient?.dispose()}async restart(){try{if(this.#e)return;if(this.error=!1,!this.lspClient)return this.start();let e=!1;switch(this.lspClient.state){case Rc.State.Starting:this.needsRestart=!0;break;case Rc.State.Running:e=!this.lspClient.initializeResult?.capabilities.experimental.compose_bundle||await this.composingBundleSucceeds(),e&&(await this.stop(),this.lspClient=void 0,await this.start());break;case Rc.State.Stopped:await this.stop(),this.lspClient=void 0,await this.start();break}}catch(e){this.error=!0,this.outputChannel.error(`Error restarting the server: ${e.message}`)}}async dispose(){this.subscriptions.forEach(e=>e.dispose()),await this.lspClient?.dispose()}async installOrUpdateServer(e){if(wt.workspace.getConfiguration("rubyLsp").get("bundleGemfile").length>0)return;let n=1440*60*1e3,i=this.context.workspaceState.get("rubyLsp.lastGemUpdate"),s=["ruby-lsp","language_server-protocol","prism","rbs"],{stdout:o}=await gn(`gem list ${s.join(" ")}`,{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env});if(!s.every(a=>new RegExp(`${a}\\s`).exec(o))){await gn("gem install ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now());return}if(e){let a=wt.Uri.joinPath(this.workspaceFolder.uri,".ruby-lsp");try{await wt.workspace.fs.delete(a,{recursive:!0})}catch{this.outputChannel.info(`Tried deleting ${a.fsPath}, but it doesn't exist`)}}if(e||i===void 0||Date.now()-i>n)try{await gn("gem update ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now())}catch(a){this.outputChannel.error(`Failed to update global ruby-lsp gem: ${a}`)}}get error(){return this.#t}set error(e){Yn.fire(this),this.#t=e}get inhibitRestart(){return this.#e}async execute(e,t=!1){t&&(this.outputChannel.show(),this.outputChannel.info(`Running "${e}"`));let n=await gn(e,{env:this.ruby.env,cwd:this.workspaceFolder.uri.fsPath});return t&&(n.stderr.length>0?this.outputChannel.error(n.stderr):this.outputChannel.info(n.stdout)),n}registerRestarts(){this.createRestartWatcher(`{${LC.join(",")}}`),this.subscriptions.push(wt.workspace.onDidChangeConfiguration(async e=>{e.affectsConfiguration("rubyLsp")&&await this.debouncedRestart("configuration changed")}))}createRestartWatcher(e){let t=wt.workspace.createFileSystemWatcher(new wt.RelativePattern(this.workspaceFolder,e)),n=async s=>{let o=s.fsPath,a=await this.fileContentsSha(s);a&&this.restartDocumentShas.get(o)!==a&&(this.restartDocumentShas.set(o,a),await this.debouncedRestart(`${o} changed, matching ${e}`))},i=async s=>{this.restartDocumentShas.delete(s.fsPath),await this.debouncedRestart(`${s.fsPath} changed, matching ${e}`)};this.subscriptions.push(t,t.onDidChange(n),t.onDidCreate(n),t.onDidDelete(i))}registerCreateDeleteWatcher(e,t){let n=wt.workspace.createFileSystemWatcher(new wt.RelativePattern(e,t)),i=()=>{this.#e=!0},s=async o=>{this.#e=!1,await this.debouncedRestart(`${o.fsPath} changed, matching ${t}`)};this.subscriptions.push(n,n.onDidCreate(i),n.onDidDelete(s))}async fileContentsSha(e){let t;try{t=await wt.workspace.fs.readFile(e)}catch{return}let n=(0,MC.createHash)("sha256");return n.update(t.toString()),n.digest("hex")}async composingBundleSucceeds(){if(!this.lspClient)return!1;try{return(await this.lspClient.sendRequest("rubyLsp/composeBundle")).success}catch{return!1}}};var mn=re(require("vscode")),_c=re(sc());var NC=[{label:"Ruby LSP: Start",description:"rubyLsp.start"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"}],$h=[{label:"Ruby LSP: Stop",description:"rubyLsp.stop"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"},{label:"Ruby LSP: Open server changelog in browser",description:"rubyLsp.showServerChangelog"}],_i=class{constructor(e){let t=ti.map(n=>({language:n}));this.item=mn.languages.createLanguageStatusItem(e,t)}dispose(){this.item.dispose()}},Uh=class extends _i{constructor(){super("rubyVersion"),this.item.name="Ruby Version",this.item.command={title:"Configure",command:"rubyLsp.selectRubyVersionManager"},this.item.text="Activating Ruby environment",this.item.severity=mn.LanguageStatusSeverity.Information}refresh(e){e.ruby.error?(this.item.text="Failed to activate Ruby",this.item.severity=mn.LanguageStatusSeverity.Error):(this.item.text=`Using Ruby ${e.ruby.rubyVersion} with ${e.ruby.versionManager.identifier}`,this.item.severity=mn.LanguageStatusSeverity.Information)}},Wh=class extends _i{constructor(){super("server"),this.item.name="Ruby LSP Server Status",this.item.text="Ruby LSP: Starting",this.item.severity=mn.LanguageStatusSeverity.Information,this.item.command={title:"Configure",command:"rubyLsp.serverOptions",arguments:[$h]}}refresh(e){if(e.error){this.item.text="Ruby LSP: Error",this.item.command.arguments=[NC],this.item.severity=mn.LanguageStatusSeverity.Error;return}if(e.lspClient)switch(e.lspClient.state){case _c.State.Running:{this.item.text=e.lspClient.serverVersion?`Ruby LSP server v${e.lspClient.serverVersion}: Running`:"Ruby LSP: Running",e.lspClient.degraded?(this.item.text+=" (degraded)",this.item.severity=mn.LanguageStatusSeverity.Warning):this.item.severity=mn.LanguageStatusSeverity.Information,this.item.command.arguments=[$h];break}case _c.State.Starting:{this.item.text="Ruby LSP: Starting",this.item.command.arguments=[$h],this.item.severity=mn.LanguageStatusSeverity.Information;break}case _c.State.Stopped:{this.item.text="Ruby LSP: Stopped",this.item.command.arguments=[NC],this.item.severity=mn.LanguageStatusSeverity.Information;break}}}},Hh=class extends _i{constructor(){super("features"),this.item.name="Ruby LSP Features",this.item.command={title:"Manage",command:"rubyLsp.toggleFeatures"},this.item.text="Fetching feature information"}refresh(e){let n=mn.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),i=Object.keys(n).filter(s=>n[s]);this.item.text=`${i.length}/${Object.keys(n).length} features enabled`}},Vh=class extends _i{constructor(){super("formatter"),this.item.name="Ruby LSP Formatter",this.item.command={title:"Help",command:"rubyLsp.formatterHelp"},this.item.text="Fetching formatter information"}refresh(e){e.lspClient&&(e.lspClient.formatter?this.item.text=`Formatter: ${e.lspClient.formatter}`:this.item.text="Formatter: requires server to be v0.12.4 or higher to display this field")}},zh=class extends _i{constructor(){super("addons"),this.item.name="Ruby LSP Add-ons",this.item.text="Fetching add-on information"}refresh(e){e.lspClient&&(e.lspClient.addons===void 0?this.item.text="Addons: requires server to be v0.17.4 or higher to display this field":e.lspClient.addons.length===0?this.item.text="Addons: none":(this.item.text=`Addons: ${e.lspClient.addons.length}`,this.item.command={title:"Details",command:"rubyLsp.displayAddons"}))}},Tc=class{constructor(){this.items=[];this.items=[new Uh,new Wh,new Hh,new Vh,new zh],Yn.event(e=>{e&&this.items.forEach(t=>t.refresh(e))})}dispose(){this.items.forEach(e=>e.dispose())}};var ER=require("child_process"),xR=require("util"),Mr=re(require("path")),W=re(require("vscode"));var jC=re(require("vscode")),Pc=class{constructor(e,...t){this.tokenSource=new jC.CancellationTokenSource;[e,...t].forEach(n=>{n.onCancellationRequested(()=>{this.tokenSource.cancel()})})}dispose(){this.tokenSource.dispose()}isCancellationRequested(){return this.tokenSource.token.isCancellationRequested}onCancellationRequested(e){this.tokenSource.token.onCancellationRequested(e)}};var yR=require("child_process"),bR=re(require("net")),wR=re(require("os")),CR=re(require("path")),An=re(vR()),rt=re(require("vscode")),vs={start:new An.NotificationType("start"),pass:new An.NotificationType("pass"),skip:new An.NotificationType("skip"),fail:new An.NotificationType("fail"),error:new An.NotificationType("error"),finish:new An.NotificationType("finish")};var Gc=class{constructor(e,t,n){this.promises=[];this.disposables=[];this.terminals=new Map;this.findTestItem=t,this.createTestRun=n,e.subscriptions.push(rt.window.onDidCloseTerminal(i=>{this.terminals.delete(i.name)}))}async activate(){this.tcpServer=await this.startServer()}async execute(e,t,n,i,s,o){this.currentWorkspace=i,this.run=e,await new Promise((a,c)=>{this.executionPromise={resolve:a,reject:c};let d=new AbortController;o.onCancellationRequested(async()=>{this.run.appendOutput(`\r
Test run cancelled.`),d.abort(),await this.finalize(!0)}),s==="run"?this.spawnTestProcess(t,n,i.workspaceFolder.uri.fsPath,d):s==="runInTerminal"?this.runInTerminal(t,i.workspaceFolder):this.launchDebugger(t,n,i)})}dispose(){this.tcpServer?.close(),this.connection?.dispose()}async launchDebugger(e,t,n){await rt.debug.startDebugging(n.workspaceFolder,{type:"ruby_lsp",name:"Debug",request:"launch",program:e,env:{...t,DISABLE_SPRING:"1"}},{testRun:this.run})||this.executionPromise.reject(new Error("Failed to start debugging session"));let s=new Promise(o=>{let a=rt.debug.onDidTerminateDebugSession(c=>{a.dispose(),o()})});this.promises.push(s)}runInTerminal(e,t){let n=t.uri.fsPath,i=`${t.name}: test`,s=rt.window.terminals.find(o=>o.name===i);s||(s=rt.window.createTerminal({name:i,cwd:n,env:{DISABLE_SPRING:"1"}})),this.terminals.set(i,s),s.show(),s.sendText(e)}spawnTestProcess(e,t,n,i){let s=new Promise((o,a)=>{let c=(0,yR.spawn)(e,{env:{...t,DISABLE_SPRING:"1"},stdio:["pipe","pipe","pipe"],shell:!0,signal:i.signal,cwd:n});c.stdout.on("data",d=>{this.run.appendOutput(d.toString().replace(/\n/g,`\r
`))}),c.stderr.on("data",d=>{this.run.appendOutput(d.toString().replace(/\n/g,`\r
`))}),c.on("exit",d=>{o()})});this.promises.push(s)}async startServer(){return new Promise((e,t)=>{let n=bR.default.createServer();n.on("error",t),n.unref(),n.listen(0,"localhost",async()=>{let i=n.address();if(!i)throw new Error("Failed setup TCP server for streaming updates");this.tcpPort=typeof i=="string"?i:i.port.toString();let s=this.tcpPort.toString();await this.updatePortMap(s),n.on("connection",o=>{this.connection=An.createMessageConnection(new An.StreamMessageReader(o),new An.StreamMessageWriter(o)),this.registerStreamingEvents(),this.run||(this.run=this.createTestRun(new rt.TestRunRequest(void 0,void 0,void 0,void 0,!0),"on_demand_run_in_terminal")),this.connection.listen()}),e(n)})})}async updatePortMap(e){let t=rt.Uri.file(CR.default.join(wR.default.tmpdir(),"ruby-lsp"));await rt.workspace.fs.createDirectory(t);let n=Object.fromEntries(rt.workspace.workspaceFolders.map(a=>[a.uri.fsPath,e])),i=rt.Uri.joinPath(t,"test_reporter_port_db.json"),s;try{let a=await rt.workspace.fs.readFile(i);s=JSON.parse(a.toString())}catch{s={}}let o={...s,...n};await rt.workspace.fs.writeFile(i,Buffer.from(JSON.stringify(o)))}async finalize(e){if(e&&this.currentWorkspace){let t=this.terminals.get(`${this.currentWorkspace.workspaceFolder.name}: test`);t&&t.sendText("")}await Promise.all(this.promises),this.disposables.forEach(t=>t.dispose()),this.promises=[],this.disposables=[],this.connection&&(this.connection.end(),this.connection.dispose()),this.run&&this.run.name==="on_demand_run_in_terminal"&&this.run.end(),this.run=void 0,this.executionPromise.resolve()}registerStreamingEvents(){if(!this.connection)return;let e=new Map,t=(n,i)=>{let s=e.get(n),o=s?Date.now()-s:void 0;i(o)};this.disposables.push(this.connection.onNotification(vs.finish,()=>this.finalize(!1))),this.disposables.push(this.connection.onNotification(vs.start,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri),n.line).then(i=>{i&&(this.run.started(i),e.set(i.id,Date.now()))}))})),this.disposables.push(this.connection.onNotification(vs.pass,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri)).then(i=>{i&&t(i.id,s=>this.run.passed(i,s))}))})),this.disposables.push(this.connection.onNotification(vs.fail,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri)).then(i=>{i&&t(i.id,s=>this.run.failed(i,new rt.TestMessage(n.message),s))}))})),this.disposables.push(this.connection.onNotification(vs.error,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri)).then(i=>{i&&t(i.id,s=>this.run.errored(i,new rt.TestMessage(n.message),s))}))})),this.disposables.push(this.connection.onNotification(vs.skip,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri)).then(i=>{i&&this.run.skipped(i)}))}))}};var Hk=(0,xR.promisify)(ER.exec),IR="**/{test,spec,features}/**/",ng=`${IR}{*_test.rb,test_*.rb,*_spec.rb,*.feature}`,RR=new W.TestTag("workspace"),SR=new W.TestTag("test_dir"),_R=new W.TestTag("test_group"),Tr=new W.TestTag("debug"),TR=new W.TestTag("test_file"),rg="Run",PR="Run in terminal",DR="Debug",kR="Coverage",Jc=class{constructor(e,t,n,i){this.testTimeout=W.workspace.getConfiguration("rubyLsp").get("testTimeout");this.fullDiscovery=Or("fullTestDiscovery");this.coverageData=new WeakMap;this.telemetry=t,this.currentWorkspace=n,this.getOrActivateWorkspace=i,this.testController=W.tests.createTestController("rubyTests","Ruby Tests"),this.runner=new Gc(e,this.findTestItem.bind(this),this.testController.createTestRun.bind(this.testController)),this.fullDiscovery&&(this.testController.resolveHandler=this.resolveHandler.bind(this),this.testController.refreshHandler=this.refreshHandler.bind(this)),this.testCommands=new WeakMap,this.testRunProfile=this.testController.createRunProfile(rg,W.TestRunProfileKind.Run,this.fullDiscovery?this.runTest.bind(this):this.runHandler.bind(this),!0,void 0,!0),this.testDebugProfile=this.testController.createRunProfile(DR,W.TestRunProfileKind.Debug,this.fullDiscovery?this.runTest.bind(this):this.debugHandler.bind(this),!1,Tr),this.coverageProfile=this.testController.createRunProfile(kR,W.TestRunProfileKind.Coverage,this.fullDiscovery?this.runTest.bind(this):async()=>{await W.window.showInformationMessage(`Running tests with coverage requires the new explorer implementation,
               which is currently under development.
               If you wish to enable it, set the "fullTestDiscovery" feature flag to "true"`)},!1),this.coverageProfile.loadDetailedCoverage=async(a,c,d)=>this.coverageData.get(c),this.runInTerminalProfile=this.testController.createRunProfile(PR,W.TestRunProfileKind.Run,this.runTest.bind(this),!1);let s=W.workspace.createFileSystemWatcher(ng),o=W.workspace.createFileSystemWatcher(IR,!0,!0,!1);e.subscriptions.push(this.testController,this.testDebugProfile,this.testRunProfile,this.coverageProfile,this.runner,this.runInTerminalProfile,W.window.onDidCloseTerminal(a=>{a===this.terminal&&(this.terminal=void 0)}),s,o,s.onDidCreate(async a=>{let c=W.workspace.getWorkspaceFolder(a);if(!c||!W.workspace.workspaceFolders)return;let d=W.workspace.workspaceFolders.length===1?this.testController.items:this.testController.items.get(c.uri.toString())?.children;d&&await this.addTestItemsForFile(a,c,d)}),s.onDidChange(async a=>{let c=await this.getParentTestItem(a);if(c){let d=c.children.get(a.toString());d&&(d.children.replace([]),await this.resolveHandler(d))}}),o.onDidDelete(async a=>{if(a.fsPath.split(Mr.default.sep).includes(".git"))return;let d=await this.getParentTestItem(a);d&&d.children.delete(a.toString())}),s.onDidDelete(async a=>{let c=await this.getParentTestItem(a);c&&c.children.delete(a.toString())}))}createTestItems(e){if(this.fullDiscovery)return;this.testController.items.forEach(i=>{this.testController.items.delete(i.id),this.testCommands.delete(i)});let t=new Map,n=W.Uri.from({scheme:"file",path:e[0].command.arguments[0]});e.forEach(i=>{let[s,o,a,c,d]=i.command.arguments,g=this.testController.createTestItem(o,d||o,n),v=i.data;if(g.tags=[new W.TestTag(v.kind)],this.testCommands.set(g,a),g.range=new W.Range(new W.Position(c.start_line,c.start_column),new W.Position(c.end_line,c.end_column)),v.id?(t.set(v.id,g),g.canResolveChildren=!0):g.tags=[...g.tags,Tr],v.group_id){let m=t.get(v.group_id);m?m.children.add(g):this.currentWorkspace()?.outputChannel.error(`Test example "${o}" is attached to group_id ${v.group_id}, but that group does not exist`)}else this.testController.items.add(g)})}runTestInTerminal(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"",this.terminal===void 0&&(this.terminal=this.getTerminal()),this.terminal.show(!0),this.terminal.sendText(n),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test_in_terminal",vscodemachineid:W.env.machineId}})}async runOnClick(e){let t=this.findTestById(e);if(!t)return;await W.commands.executeCommand("vscode.revealTestInExplorer",t);let n=new W.CancellationTokenSource;n.token.onCancellationRequested(async()=>{n?.dispose(),n=null,await W.window.showInformationMessage("Cancelled the progress")});let i=new W.TestRunRequest([t],[],this.testRunProfile);return this.testRunProfile.runHandler(i,n.token)}debugTest(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"";let i=this.currentWorkspace();if(!i)throw new Error("No workspace found. Debugging requires a workspace to be opened");return W.debug.startDebugging(i.workspaceFolder,{type:"ruby_lsp",name:"Debug",request:"launch",program:n,env:{...i.ruby.env,DISABLE_SPRING:"1"}})}buildRequestTestItems(e,t){if(!t)return e.map(i=>this.testItemToServerItem(i));let n=[];return e.forEach(i=>{let s=this.recursivelyFilter(i,t);s&&n.push(s)}),n}async runViaCommand(e,t,n){let i=W.Uri.file(e),s=await this.findTestItem(t,i);if(!s){await W.window.showErrorMessage(`Attempted to run "${t}" defined in "${e}", but that test has not been discovered.
        Does the file path match the expected glob pattern?
        [Read more](https://shopify.github.io/ruby-lsp/test_explorer.html)

        Expected pattern: "**/{test,spec,features}/**/{*_test.rb,test_*.rb,*_spec.rb,*.feature}"`);return}n==="run"&&await W.commands.executeCommand("vscode.revealTestInExplorer",s);let o=new W.CancellationTokenSource;o.token.onCancellationRequested(async()=>{o.dispose(),await W.window.showInformationMessage("Cancelled the progress")});let a;switch(n){case"debug":a=this.testDebugProfile;break;case"runInTerminal":a=this.runInTerminalProfile;break;default:a=this.testRunProfile;break}let c=new W.TestRunRequest([s],[],a);return this.runTest(c,o.token)}async runTest(e,t){if(this.telemetry.logUsage("ruby_lsp.test_explorer",{type:"counter",attributes:{label:e.profile?.label||rg,vscodemachineid:W.env.machineId,continuousMode:e.continuous??!1}}),e.continuous){let n=[],i=W.workspace.createFileSystemWatcher(ng,!0,!1,!0);n.push(i,i.onDidChange(async()=>{let s=new W.TestRunRequest(e.include,e.exclude,e.profile,!1,e.preserveFocus);await this.handleTests(s,t)})),n.push(t.onCancellationRequested(()=>{n.forEach(s=>s.dispose())}))}else await this.handleTests(e,t)}async findTestItem(e,t,n){this.testController.items.size===0&&await W.window.withProgress({title:"Discovering tests",location:W.ProgressLocation.Notification},async a=>{await this.resolveHandler(void 0,a)});let i=await this.getParentTestItem(t);if(!i)return;if(i.id===e)return i;let s=i.children.get(t.toString());if(!s)return;if(s.id===e)return s;s.children.size===0&&await this.resolveHandler(s);let o=s.children.get(e);return o||this.findTestInGroup(e,s,n)}async activate(){await this.runner.activate()}get streamingPort(){return this.runner.tcpPort}async refreshHandler(e){this.testController.items.replace([]),this.testController.invalidateTestResults(),await this.testController.resolveHandler(void 0)}async handleTests(e,t){let n=this.testController.createTestRun(e),i=[];e.include?e.include.forEach(a=>i.push(a)):this.testController.items.forEach(a=>i.push(a)),await this.discoverFrameworkTag(i);let s=new Map;i.forEach(a=>{let c=W.workspace.getWorkspaceFolder(a.uri),d=s.get(c);d?d.push(a):s.set(c,[a])});let o=new Pc(t,n.token);for(let[a,c]of s){if(o.isCancellationRequested())break;let d=this.buildRequestTestItems(c,e.exclude),g=await this.getOrActivateWorkspace(a);if(!g.lspClient?.initializeResult?.capabilities.experimental?.full_test_discovery){n.appendOutput(`The version of the Ruby LSP server being used by ${a.name} does not support the new
           test explorer functionality. Please make sure you are using the latest version of the server.
           See https://shopify.github.io/ruby-lsp/troubleshooting.html#outdated-version for more information.`);break}let v=await g.lspClient?.resolveTestCommands(d);if(!v){c.forEach(S=>n.errored(S,new W.TestMessage("Could not resolve test command to run selected tests")));continue}c.forEach(S=>n.enqueued(S));let m=e.profile;!m||m.label===rg||m.label===PR||m.label===kR?await this.executeTestCommands(v,g,n,m,o):m.label===DR&&await this.debugTestCommands(v,g,n,o)}n.end(),o.dispose()}async discoverFrameworkTag(e){let t=e.filter(n=>!n.tags.some(i=>i.id.startsWith("framework")));if(t.length!==0)for(let n of t){let i=n;for(;!i.tags.some(s=>s===TR);){let s;i.children.forEach(o=>{s===void 0&&(s=o)}),i=s}await this.resolveHandler(i),this.setFrameworkTagInAllParents(i)}}setFrameworkTagInAllParents(e){let t=e.tags.find(i=>i.id.startsWith("framework")),n=e.parent;for(;n;)n.tags.some(i=>i.id.startsWith("framework"))||(n.tags=[...n.tags,t]),n=n.parent}async executeTestCommands(e,t,n,i,s){let o;if(e.reporterPaths){let d=`-rbundler/setup ${e.reporterPaths.map(g=>`-r${g}`).join(" ")}`;o=t.ruby.env.RUBYOPT?`${t.ruby.env.RUBYOPT} ${d}`:d}let a=i===this.coverageProfile?"coverage":"run",c=i===this.runInTerminalProfile?"runInTerminal":"run";for(let d of e.commands){n.appendOutput(`Running tests with command:\r
"${d}"\r
\r
`);try{await this.runner.execute(n,d,{...t.ruby.env,RUBY_LSP_TEST_RUNNER:a,RUBYOPT:o},t,c,s)}catch(g){await W.window.showErrorMessage(`Running ${d} failed: ${g.message}`)}}i===this.coverageProfile&&(n.appendOutput(`\r
\r
Processing test coverage results...\r
\r
`),await this.processTestCoverageResults(n,t.workspaceFolder))}async debugTestCommands(e,t,n,i){for(let s of e.commands){if(i.isCancellationRequested())break;let o;if(e.reporterPaths){let a=`-rbundler/setup ${e.reporterPaths.map(c=>`-r${c}`).join(" ")}`;o=t.ruby.env.RUBYOPT?`${t.ruby.env.RUBYOPT} ${a}`:a}await this.runner.execute(n,s,{...t.ruby.env,RUBY_LSP_TEST_RUNNER:"debug",RUBYOPT:o},t,"debug",i)}}findTestInGroup(e,t,n){let i;if(t.children.forEach(d=>{(e.startsWith(`${d.id}#`)||e.startsWith(`${d.id}::`))&&(i=d)}),!i)return;let s=i.children.get(e);if(s)return s;if(e.startsWith(`${i.id}::`))return this.findTestInGroup(e,i,n);if(!n)return;let o=e.split("#")[1],a=this.testController.createTestItem(e,`\u2605 ${o}`,i.uri);a.description="dynamic test",a.range=new W.Range(new W.Position(n,0),new W.Position(n,1));let c=i.tags.find(d=>d.id.startsWith("framework"));return a.tags=c?[Tr,c]:[Tr],i.children.add(a),a}getTerminal(){let e=this.currentWorkspace(),t=e?`${e.workspaceFolder.name}: test`:"Ruby LSP: test",n=W.window.terminals.find(i=>i.name===t);return n||W.window.createTerminal({name:t})}async debugHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=e.include[0],s=Date.now();await this.debugTest("","",this.testCommands.get(i)),n.passed(i,Date.now()-s),n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"debug",vscodemachineid:W.env.machineId}})}async runHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=[],s=a=>{i.push(a),n.enqueued(a)};e.include?e.include.forEach(s):this.testController.items.forEach(s);let o=this.currentWorkspace();for(;i.length>0&&!t.isCancellationRequested;){let a=i.pop();if(e.exclude?.includes(a)){n.skipped(a);continue}if(n.started(a),a.tags.find(c=>c.id==="example")){let c=Date.now();try{if(!o){n.errored(a,new W.TestMessage("No workspace found"));continue}let d=await this.assertTestPasses(a,o.workspaceFolder.uri.fsPath,o.ruby.env);n.appendOutput(d.replace(/\r?\n/g,`\r
`),void 0,a),n.passed(a,Date.now()-c)}catch(d){let g=d;n.appendOutput(g.message.replace(/\r?\n/g,`\r
`),void 0,a);let v=Date.now()-c;if(g.killed){n.errored(a,new W.TestMessage(`Test timed out after ${this.testTimeout} seconds`),v);continue}let m=g.message.split(`
`),S=m[0]===""?m.slice(10,m.length-2).join(`
`):m.slice(4,m.length-9).join(`
`),b=[new W.TestMessage(g.message),new W.TestMessage(S)];m.find(E=>E==="F")?n.failed(a,b,v):n.errored(a,b,v)}}a.children.forEach(s)}n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test",vscodemachineid:W.env.machineId}})}async assertTestPasses(e,t,n){try{return(await Hk(this.testCommands.get(e),{cwd:t,env:n,timeout:this.testTimeout*1e3})).stdout}catch(i){throw i.killed?i:new Error(i.stdout)}}findTestById(e,t=this.testController.items){if(!e)return this.findTestByActiveLine();let n=t.get(e);return n||(t.forEach(i=>{let s=this.findTestById(e,i.children);s&&(n=s)}),n)}findTestByActiveLine(e=W.window.activeTextEditor,t=this.testController.items){if(!e)return;let n=e.selection.active.line,i;return t.forEach(s=>{if(i)return;let o=s.range;if(s.uri?.toString()===e.document.uri.toString()&&o&&o.start.line<=n&&o.end.line>=n&&(i=s),s.children.size>0){let a=this.findTestByActiveLine(e,s.children);a&&(i=a)}}),i}async resolveHandler(e,t){let n=W.workspace.workspaceFolders;if(n&&!(e===void 0&&this.testController.items.size>0))if(e){let i=W.workspace.getWorkspaceFolder(e.uri);if(e.tags.some(s=>s===RR))await this.gatherWorkspaceTests(i,e);else if(!e.tags.some(s=>s===_R)){let s=await this.getOrActivateWorkspace(i);if(!s.lspClient?.initializeResult?.capabilities.experimental?.full_test_discovery){await W.window.showWarningMessage(`The version of the Ruby LSP server being used by ${i.name} does not support the new
             test explorer functionality. Please make sure you are using the latest version of the server.
             See https://shopify.github.io/ruby-lsp/troubleshooting.html#outdated-version for more information.`);return}let o=s.lspClient;if(o){await o.waitForIndexing();let a=await o.discoverTests(e.uri);a&&this.addDiscoveredItems(a,e)}}}else if(n.length===1)await W.commands.executeCommand("testing.clearTestResults"),await this.gatherWorkspaceTests(n[0],void 0,t);else{await W.commands.executeCommand("testing.clearTestResults");for(let i of n){let s=this.testPattern(i);if((await W.workspace.findFiles(s,void 0,1)).length===0)continue;let a=i.uri,c=this.testController.createTestItem(a.toString(),i.name,a);c.canResolveChildren=!0,c.tags=[RR,Tr],this.testController.items.add(c)}}}async gatherWorkspaceTests(e,t,n){let i=t?t.children:this.testController.items,s=this.testPattern(e),o=await W.workspace.findFiles(s),a=Math.floor(o.length/100);for(let c of o)n&&n.report({message:`Processing ${Mr.default.basename(c.fsPath)}`,increment:a}),await this.addTestItemsForFile(c,e,i)}async addTestItemsForFile(e,t,n){let i=Mr.default.basename(e.fsPath),o=W.workspace.asRelativePath(e,!1).split(Mr.default.sep);if(this.shouldSkipTestFile(i,o))return;let{firstLevel:a,secondLevel:c}=await this.getOrCreateHierarchyLevels(e,t,n),d=c??a,g=this.testController.createTestItem(e.toString(),Mr.default.relative(d.uri.fsPath,e.fsPath),e);return g.canResolveChildren=!0,g.tags=[TR,Tr],d.children.add(g),{firstLevel:a,secondLevel:c,testItem:g}}async detectHierarchyLevels(e,t){let i=W.workspace.asRelativePath(e,!1).split(Mr.default.sep),s=this.testDirectoryPosition(i),o=i.slice(0,s+1).join(Mr.default.sep),a=W.Uri.joinPath(t.uri,o),c=i.slice(s+1,s+2).join(Mr.default.sep);if(c.length>0){let d=W.Uri.joinPath(a,c);try{if((await W.workspace.fs.stat(d)).type===W.FileType.Directory)return{firstLevel:{name:o,uri:a},secondLevel:{name:c,uri:d}}}catch{}}return{firstLevel:{name:o,uri:a}}}async getOrCreateHierarchyLevels(e,t,n){let{firstLevel:i,secondLevel:s}=await this.detectHierarchyLevels(e,t),o=n.get(i.uri.toString());if(o||(o=this.testController.createTestItem(i.uri.toString(),i.name,i.uri),o.tags=[SR,Tr],n.add(o)),s){let a=o.children.get(s.uri.toString());return a||(a=this.testController.createTestItem(s.uri.toString(),s.name,s.uri),a.tags=[SR,Tr],o.children.add(a)),{firstLevel:o,secondLevel:a}}return{firstLevel:o,secondLevel:void 0}}shouldSkipTestFile(e,t){return!!(e==="test_helper.rb"||t.some(n=>n==="fixtures"))}testPattern(e){return new W.RelativePattern(e,ng)}testDirectoryPosition(e){let t=e.indexOf("test");return t!==-1||(t=e.indexOf("spec"),t!==-1)?t:e.indexOf("features")}async getParentTestItem(e){let t=W.workspace.workspaceFolders;if(!t)return;let n=this.testController.items,i=t[0];if(t.length>1){i=W.workspace.getWorkspaceFolder(e);let c=n.get(i.uri.toString());n=c.children,n.size===0&&await this.resolveHandler(c)}let{firstLevel:s,secondLevel:o}=await this.detectHierarchyLevels(e,i),a=n.get(s.uri.toString());return o&&(a=a?.children.get(o.uri.toString())),a}addDiscoveredItems(e,t){if(e.length===0)return;e.forEach(i=>{let s=this.testController.createTestItem(i.id,i.label,W.Uri.parse(i.uri));s.canResolveChildren=i.children.length>0;let o=i.range.start,a=i.range.end;s.range=new W.Range(new W.Position(o.line,o.character),new W.Position(a.line,a.character));let c=i.tags.map(d=>new W.TestTag(d));s.tags=s.canResolveChildren?[_R,Tr,...c]:[Tr,...c],t.children.add(s),s.canResolveChildren&&this.addDiscoveredItems(i.children,s)});let n=e[0].tags.find(i=>i.startsWith("framework"));n&&(t.tags.some(i=>i.id.startsWith("framework"))||(t.tags=[...t.tags,new W.TestTag(n)]))}recursivelyFilter(e,t){if(t.includes(e))return null;let n=[];if(e.children.forEach(s=>{let o=this.recursivelyFilter(s,t);o&&n.push(o)}),e.children.size>0&&n.length===0)return null;let i={id:e.id,label:e.label,uri:e.uri.toString(),tags:e.tags.map(s=>s.id),children:[]};return e.range&&(i.range={start:{line:e.range.start.line,character:e.range.start.character},end:{line:e.range.end.line,character:e.range.end.character}}),e.children.size!==n.length&&(i.children=n),i}testItemToServerItem(e){let t=[];e.children.forEach(i=>{t.push(this.testItemToServerItem(i))});let n;return e.range&&(n={start:{line:e.range.start.line,character:e.range.start.character},end:{line:e.range.end.line,character:e.range.end.character}}),{id:e.id,label:e.label,uri:e.uri.toString(),range:n,children:t,tags:e.tags.map(i=>i.id)}}async processTestCoverageResults(e,t){try{let n=await W.workspace.fs.readFile(W.Uri.joinPath(t.uri,".ruby-lsp","coverage_result.json")),i=JSON.parse(n.toString());Object.entries(i).forEach(([s,o])=>{let a=W.FileCoverage.fromDetails(W.Uri.parse(s),o);e.addCoverage(a),this.coverageData.set(a,o)})}catch(n){e.appendOutput(`Failed to process coverage results: ${n.message}`)}}};var qR=re(require("path")),Ye=re(require("vscode"));async function OR(r,e,t){let{file:n,...i}=t,{line:s,character:o=0,endLine:a=s,endCharacter:c=o}=i,d=new Ye.Range(s,o,a,c),g=Ye.Uri.parse(`file://${n}`),v=await Ye.workspace.openTextDocument(g);await Ye.window.showTextDocument(v,{selection:d}),e?.lspClient?.serverVersion&&r.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"open_file",vscodemachineid:Ye.env.machineId}})}async function ig(r){if(r.length===1){await Ye.commands.executeCommand("vscode.open",Ye.Uri.parse(r[0]));return}let e=r.map(n=>{let i=Ye.Uri.parse(n);return{label:qR.default.basename(i.fsPath),iconPath:new Ye.ThemeIcon("go-to-file"),uri:i}}),t=await Ye.window.showQuickPick(e,{title:"Select a file to jump to"});t&&await Ye.commands.executeCommand("vscode.open",t.uri)}async function FR(){let r=await Ye.workspace.openTextDocument({language:"ruby"}),e=await Ye.window.showTextDocument(r,{preview:!1}),t=new Ye.Position(0,0);await e.insertSnippet(new Ye.SnippetString(`require "test_helper"

class $1Test < Minitest::Test
  def test_$2
    $3
  end
end
`),new Ye.Selection(t,t))}var LR=re(require("net")),MR=re(require("os")),NR=require("child_process"),Dt=re(require("vscode"));var sg=class{append(e){console.log(e)}appendLine(e){console.log(e)}},Xc=class{constructor(e,t){this.console=process.env.CI?new sg:Dt.debug.activeDebugConsole;this.workspaceResolver=t,e.subscriptions.push(Dt.debug.registerDebugConfigurationProvider("ruby_lsp",this),Dt.debug.registerDebugAdapterDescriptorFactory("ruby_lsp",this))}async createDebugAdapterDescriptor(e,t){return e.configuration.request==="launch"?this.spawnDebuggeeForLaunch(e):e.configuration.request==="attach"?this.attachDebuggee(e):new Promise((n,i)=>i(new Error(`Unknown request type: ${e.configuration.request}. Please review your launch configurations`)))}provideDebugConfigurations(e,t){return[{type:"ruby_lsp",name:"Debug script",request:"launch",program:"ruby ${file}"},{type:"ruby_lsp",name:"Debug test",request:"launch",program:"ruby -Itest ${relativeFile}"},{type:"ruby_lsp",name:"Attach debugger",request:"attach"}]}resolveDebugConfiguration(e,t,n){let i=e?.uri,s=this.workspaceResolver(i);if(!s)throw new Error(`Couldn't find a workspace for URI: ${i?.toString()}`);t.env?t.env=Object.assign(s.ruby.env,t.env):t.env=s.ruby.env;let o=s.workspaceFolder.uri;if(t.targetFolder={path:o.fsPath,name:s.workspaceFolder.name},t.env.BUNDLE_GEMFILE)return t;let a=Dt.Uri.joinPath(o,".ruby-lsp");return Dt.workspace.fs.readDirectory(a).then(c=>(c.some(d=>d[0]==="Gemfile")?t.env.BUNDLE_GEMFILE=Dt.Uri.joinPath(a,"Gemfile").fsPath:c.some(d=>d[0]==="gems.rb")&&(t.env.BUNDLE_GEMFILE=Dt.Uri.joinPath(a,"gems.rb").fsPath),t),()=>t)}dispose(){this.debugProcess&&this.debugProcess.kill("SIGTERM")}async getSockets(e){let t=e.configuration,n=e.configuration.debugSocketPath;if(n)return[n];let i=[];try{i=(await gn("bundle exec rdbg --util=list-socks",{cwd:e.workspaceFolder?.uri.fsPath,env:t.env})).stdout.toString().split(`
`).filter(o=>o.length>0)}catch(s){this.console.append(`Error listing sockets: ${s.message}`)}return i}async attachDebuggee(e){let t=e.configuration.debugPort;if(t){let s=e.configuration.debugHost;return s?new Dt.DebugAdapterServer(t,s):new Dt.DebugAdapterServer(t)}let n=await this.getSockets(e);if(n.length===0)throw new Error("No debuggee processes found. Is the process running?");if(n.length===1)return new Dt.DebugAdapterNamedPipeServer(n[0]);let i=await Dt.window.showQuickPick(n,{placeHolder:"Select a debuggee",ignoreFocusOut:!0}).then(s=>{if(s===void 0)throw new Error("No debuggee selected");return s});return new Dt.DebugAdapterNamedPipeServer(i)}async spawnDebuggeeForLaunch(e){let t="",n=!1,i=e.configuration,o=i.targetFolder.path,a=MR.default.platform()==="win32"?await this.availablePort():void 0;return new Promise((c,d)=>{let g=["exec","rdbg"];a&&g.push("--port",a.toString()),g.push("--open","--command","--",i.program),this.logDebuggerMessage(`Spawning debugger in directory ${o}`),this.logDebuggerMessage(`   Command bundle ${g.join(" ")}`),this.debugProcess=(0,NR.spawn)("bundle",g,{shell:!0,env:i.env,cwd:o}),this.debugProcess.stderr.on("data",v=>{let m=v.toString();if(this.logDebuggerMessage(m),n||(t+=m),t.includes("DEBUGGER: wait for debugger connection...")){n=!0;let b=RegExp(/DEBUGGER: Debugger can attach via UNIX domain socket \((.*)\)/).exec(t);a?c(new Dt.DebugAdapterServer(a)):b&&b.length===2?c(new Dt.DebugAdapterNamedPipeServer(b[1])):d(new Error("Debugger not found on UNIX socket"))}}),this.debugProcess.stdout.on("data",v=>{this.logDebuggerMessage(v.toString())}),this.debugProcess.on("error",v=>{this.logDebuggerMessage(v.message),d(v)}),this.debugProcess.on("close",v=>{if(v){let m=`Debugger exited with status ${v}.
Please make sure \`bundle ${g.join(" ")}\` runs without errors in the terminal.
Check the Ruby LSP output channel for more information.
`;this.logDebuggerMessage(m),d(new Error(m))}})})}async availablePort(){return new Promise((e,t)=>{let n=LR.default.createServer();n.unref(),n.on("error",t),n.listen(0,()=>{let i=n.address(),s=typeof i=="string"?Number(i):i?.port;n.close(()=>{e(s)})})})}logDebuggerMessage(e){Rr.info(`[debugger]: ${e.trimEnd()}`),this.console.append(e)}};var AR=re(require("path")),ze=re(require("vscode")),jR=re(sc());var Qc=class{constructor(){this._onDidChangeTreeData=new ze.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.subscriptions=[];this.gemRootFolders={};this.treeView=ze.window.createTreeView("dependencies",{treeDataProvider:this,showCollapseAll:!0}),this.subscriptions.push(Yn.event(this.workspaceDidChange.bind(this)),ze.window.onDidChangeActiveTextEditor(this.activeEditorDidChange.bind(this)),this.treeView.onDidChangeVisibility(this.treeVisibilityDidChange.bind(this)))}dispose(){this.subscriptions.forEach(e=>e.dispose()),this.treeView.dispose()}getTreeItem(e){return e}getChildren(e){return e?e.getChildren():this.fetchDependencies()}getParent(e){let t=ze.Uri.joinPath(e.resourceUri,".."),n=AR.default.parse(t.path).root;if(t.path!==n)if(e instanceof ho||e instanceof ys){let i=this.gemRootFolders[t.toString()];return i||new ho(t)}else return}async refresh(){await this.fetchDependencies(),this._onDidChangeTreeData.fire(void 0)}async workspaceDidChange(e){if(!(!e||e===this.currentWorkspace))return this.currentWorkspace=e,this.refresh()}async activeEditorDidChange(e){let t=e?.document.uri;t&&(this.currentVisibleItem=new ys(t),this.treeView.visible&&await this.revealElement(this.currentVisibleItem))}async treeVisibilityDidChange(e){this.currentVisibleItem&&e.visible&&await this.revealElement(this.currentVisibleItem)}async revealElement(e){ze.workspace.getConfiguration("explorer").get("autoReveal")&&await this.treeView.reveal(e,{select:!0,focus:!1,expand:!0}),this.currentVisibleItem=void 0}async fetchDependencies(){if(this.gemRootFolders={},!this.currentWorkspace)return[];let e=this.currentWorkspace.lspClient;if(!e||e.state!==jR.State.Running)return[];let n=(await e.sendRequest("rubyLsp/workspace/dependencies",{})).sort((i,s)=>i.dependency===s.dependency?i.name.localeCompare(s.name):s.dependency?1:-1).map(i=>{let s=ze.Uri.file(i.path),o=new og(i.name,i.version,s);return this.gemRootFolders[s.toString()]=o,o});return n.forEach(i=>{this.gemRootFolders[i.resourceUri.toString()]=i}),n}},og=class extends ze.TreeItem{constructor(t,n,i){super(`${t} (${n})`,ze.TreeItemCollapsibleState.Collapsed);this.resourceUri=i;this.contextValue="dependency",this.iconPath=new ze.ThemeIcon("ruby")}async getChildren(){let t=this.resourceUri;return(await ze.workspace.fs.readDirectory(t)).map(([i,s])=>s===ze.FileType.Directory?new ho(ze.Uri.joinPath(t,i)):new ys(ze.Uri.joinPath(t,i)))}},ho=class r extends ze.TreeItem{constructor(t){super(t,ze.TreeItemCollapsibleState.Collapsed);this.resourceUri=t;this.contextValue="gem-directory-path",this.description=!0,this.command={command:"list.toggleExpand",title:"Toggle"}}async getChildren(){let t=this.resourceUri;return(await ze.workspace.fs.readDirectory(t)).map(([i,s])=>s===ze.FileType.Directory?new r(ze.Uri.joinPath(t,i)):new ys(ze.Uri.joinPath(t,i)))}},ys=class extends ze.TreeItem{constructor(t){super(t,ze.TreeItemCollapsibleState.None);this.resourceUri=t;this.contextValue="gem-file-path",this.description=!0,this.command={command:"vscode.open",title:"Open",arguments:[t]}}getChildren(){}};var UR=re(require("os")),yn=re(require("vscode")),$R=UR.default.platform()==="win32"?"ruby bin/rails":"bin/rails",Yc=class{constructor(e){this.showWorkspacePick=e}async generate(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${$R} generate ${e}`;await yn.window.withProgress({location:yn.ProgressLocation.Notification,title:"Running Rails generate"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/create\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Revealing generated files"}),await this.revealFormattedFiles(n,i)})}async destroy(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${$R} destroy ${e}`;await yn.window.withProgress({location:yn.ProgressLocation.Notification,title:"Running Rails destroy"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/remove\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Closing deleted files"});for(let c of i)await yn.commands.executeCommand("workbench.action.closeActiveEditor",yn.Uri.joinPath(n.workspaceFolder.uri,c))})}async revealFormattedFiles(e,t){for(let n of t){let i=yn.Uri.joinPath(e.workspaceFolder.uri,n);await yn.window.showTextDocument(i,{preview:!1}),await yn.commands.executeCommand("editor.action.formatDocument",i),await yn.commands.executeCommand("workbench.action.files.save",i)}}};var ut=re(require("vscode"));var WR="rubyLsp.chatAgent",Vk=`
  You are a domain driven design and Ruby on Rails expert.
  The user will provide you with details about their Rails application.
  The user will ask you to help model a single specific concept.

  Analyze the provided concept carefully and think step by step. Consider the following aspects:
  1. The core purpose of the concept
  2. Its relationships with other potential entities in the system
  3. The attributes that would best represent this concept in a database

  Based on your analysis, suggest an appropriate model name and attributes to effectively model the concept.
  Follow these guidelines:

  1. Choose a clear, singular noun for the model name that accurately represents the concept
  2. Select attributes that capture the essential characteristics of the concept
  3. Use appropriate data types for each attribute (e.g. string, integer, datetime, boolean)
  4. Consider adding foreign keys for relationships with other models, if applicable

  After determining the model structure, generate the Rails commands to create the model and any associated resources.
  Include all relevant \`generate\` commands in a single Markdown shell code block at the end of your response.

  The \`generate\` commands should ONLY include the type of generator and arguments, not the \`rails generate\` part
  (e.g.: \`model User name:string\` but not \`rails generate model User name:string\`).
  NEVER include commands to migrate the database as part of the code block.
  NEVER include redundant commands (e.g. including the migration and model generation commands for the same model).
`.trim(),Zc=class{constructor(e,t){this.agent=ut.chat.createChatParticipant(WR,this.handler.bind(this)),this.agent.iconPath=ut.Uri.joinPath(e.extensionUri,"icon.png"),this.showWorkspacePick=t}dispose(){this.agent.dispose()}async handler(e,t,n,i){return this.withinConversation("design",e,t)?this.runDesignCommand(e,t,n,i):(n.markdown("Please indicate which command you would like to use for our chat."),{metadata:{command:""}})}async runDesignCommand(e,t,n,i){let s=this.previousInteractions(t),o=[ut.LanguageModelChatMessage.User(`User prompt: ${e.prompt}`),ut.LanguageModelChatMessage.User(Vk),ut.LanguageModelChatMessage.User(`Previous interactions with the user: ${s}`)],a=await this.showWorkspacePick();if(e.command&&a){let c=await this.schema(a);c&&o.push(ut.LanguageModelChatMessage.User(`Existing application schema: ${c}`))}try{let[c]=await ut.lm.selectChatModels({vendor:"copilot",family:"gpt-4o"});n.progress("Designing the models for the requested concept...");let d=await c.sendRequest(o,{},i),g="";for await(let m of d.text)n.markdown(m),g+=m;let v=/(?<=```shell)[^.$]*(?=```)/.exec(g);if(a&&v&&v[0]){let m=v[0].trim().split(`
`).map(S=>S.replace(/\s*(bin\/rails|rails) generate\s*/,""));n.button({command:"rubyLsp.railsGenerate",title:"Generate with Rails",arguments:[m,a]}),n.button({command:"rubyLsp.railsDestroy",title:"Revert previous generation",arguments:[m,a]})}}catch(c){this.handleError(c,n)}return{metadata:{command:"design"}}}async schema(e){try{return(await ut.workspace.fs.readFile(ut.Uri.joinPath(e.workspaceFolder.uri,"db/schema.rb"))).toString()}catch{}try{return(await ut.workspace.fs.readFile(ut.Uri.joinPath(e.workspaceFolder.uri,"db/structure.sql"))).toString()}catch{}}withinConversation(e,t,n){return t.command===e||!t.command&&n.history.some(i=>i instanceof ut.ChatRequestTurn&&i.command===e)}handleError(e,t){if(e instanceof ut.LanguageModelError)e.cause instanceof Error&&e.cause.message.includes("off_topic")&&t.markdown("Sorry, I can only help you with Ruby related questions");else throw e}previousInteractions(e){let t="";return e.history.forEach(n=>{if(n instanceof ut.ChatResponseTurn){if(n.participant===WR){let i="";n.response.forEach(s=>{s instanceof ut.ChatResponseMarkdownPart&&(i+=s.value.value)}),t+=`Response: ${i}`}}else t+=`Request: ${n.prompt}`}),t}};var jn=re(require("vscode"));async function HR(r){if(!r){await jn.window.showErrorMessage("No active Ruby workspace found.");return}let e=zk(r),t=jn.window.createWebviewPanel("rubyLspInfo","Ruby LSP Information",jn.ViewColumn.One,{enableScripts:!0});t.webview.html=Bk(e)}function zk(r){let e=jn.version,n=jn.extensions.getExtension("Shopify.ruby-lsp").packageJSON.version,i=r.lspClient?.serverVersion??"Unknown",s=r.lspClient?.addons?.map(g=>`${g.name} (${g.version??"unknown"})`)??[],o=Kk(),a=jn.workspace.getConfiguration("rubyLsp",r.workspaceFolder),c=jn.workspace.getConfiguration("rubyLsp"),d={};for(let g of Object.keys(a))a.inspect(g)?.workspaceValue!==void 0&&(d[g]=a.get(g));return{"VS Code Version":e,"Ruby LSP Extension Version":n,"Ruby LSP Server Version":i,"Ruby LSP Add-ons":s,"Ruby Version":r.ruby.rubyVersion??"Unknown","Ruby Version Manager":r.ruby.versionManager.identifier,"Installed Extensions":o.sort(),"Ruby LSP Settings":{Workspace:d,User:c}}}function Kk(){return jn.extensions.all.filter(r=>!(r.packageJSON.isBuiltin||r.packageJSON.license==="UNLICENSED"||!r.packageJSON.license)).map(r=>`${r.packageJSON.name} (${r.packageJSON.version})`)}function Bk(r){let e=`
### Ruby LSP Information

`;for(let[n,i]of Object.entries(r)){if(e+=`#### ${n}

`,Array.isArray(i))n==="Installed Extensions"?(e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`,e+=`${i.map(s=>`- ${s}`).join(`
`)}
`,e+=`&lt;/details&gt;
`):e+=`${i.map(s=>`- ${s}`).join(`
`)}
`;else if(typeof i=="object"&&i!==null){e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`;for(let[s,o]of Object.entries(i))e+=`##### ${s}

`,e+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`;e+=`&lt;/details&gt;
`}else e+=`${i}
`;e+=`
`}return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Ruby LSP Information</title>
      <style>
        body { font-family: var(--vscode-font-family); padding: 20px; }
        h1, h2, h3, p, li { color: var(--vscode-editor-foreground); }
        pre {
          background-color: var(--vscode-textBlockQuote-background);
          padding: 16px;
          overflow-x: auto;
          position: relative;
        }
        code { font-family: var(--vscode-editor-font-family); }
        #copyButton {
          position: absolute;
          top: 5px;
          right: 5px;
          background-color: var(--vscode-button-background);
          color: var(--vscode-button-foreground);
          border: none;
          padding: 5px 10px;
          cursor: pointer;
        }
        #copyButton:hover { background-color: var(--vscode-button-hoverBackground); }
      </style>
    </head>
    <body>
      <h1>Ruby LSP Information</h1>
      <p>Please copy the content below and paste it into the issue you're opening:</p>
      <pre><button id="copyButton">Copy</button><code id="diagnosticContent">${e}</code></pre>
      <script>
        const copyButton = document.getElementById('copyButton');
        const diagnosticContent = document.getElementById('diagnosticContent');

        copyButton.addEventListener('click', () => {
          const range = document.createRange();
          range.selectNode(diagnosticContent);
          window.getSelection().removeAllRanges();
          window.getSelection().addRange(range);
          document.execCommand('copy');
          window.getSelection().removeAllRanges();

          copyButton.textContent = 'Copied!';
          setTimeout(() => {
            copyButton.textContent = 'Copy';
          }, 2000);
        });
      </script>
    </body>
    </html>
  `}var eu=class{constructor(e,t){this.workspaces=new Map;this.virtualDocuments=new Map;this.workspacesBeingLaunched=new Map;this.context=e,this.telemetry=t,this.testController=new Jc(e,this.telemetry,this.currentActiveWorkspace.bind(this),this.getOrActivateWorkspace.bind(this)),this.debug=new Xc(e,this.workspaceResolver.bind(this)),this.rails=new Yc(this.showWorkspacePick.bind(this)),this.statusItems=new Tc;let n=new Qc;e.subscriptions.push(this.statusItems,this.debug,n,new Zc(e,this.showWorkspacePick.bind(this)),N.window.onDidChangeActiveTextEditor(i=>{Yn.fire(this.currentActiveWorkspace(i))}),N.workspace.onDidChangeWorkspaceFolders(async i=>{for(let s of i.removed){let o=this.getWorkspace(s.uri);o&&(await o.stop(),await o.dispose(),this.workspaces.delete(s.uri.toString()))}}),N.workspace.onDidOpenTextDocument(async i=>{if(!ti.includes(i.languageId))return;let s=N.workspace.getWorkspaceFolder(i.uri);if(!s)return;this.getWorkspace(s.uri)||await this.activateWorkspace(s,!1)}),N.workspace.registerTextDocumentContentProvider("embedded-content",{provideTextDocumentContent:i=>{let s=/^\/(.*)\.[^.]+$/.exec(i.path)?.[1];if(!s)return"";let o=decodeURIComponent(s);return this.virtualDocuments.get(o)}}),Rr,N.workspace.registerTextDocumentContentProvider("ruby-lsp",new to),...this.registerCommands())}async activate(){await N.commands.executeCommand("testing.clearTestResults");let e=N.workspace.workspaceFolders?.[0];e&&await this.activateWorkspace(e,!0);let t=N.window.activeTextEditor?.document;if(t&&ti.includes(t.languageId)){let n=N.workspace.getWorkspaceFolder(t.uri);n&&(this.workspaces.get(n.uri.toString())||await this.activateWorkspace(n,!1))}Yn.fire(this.currentActiveWorkspace()),await this.testController.activate()}async deactivate(){for(let e of this.workspaces.values())await e.stop(),await e.dispose()}async activateWorkspace(e,t){let n=this.workspacesBeingLaunched.get(e.index);if(n)return n;let i=this.runActivation(e,t);return this.workspacesBeingLaunched.set(e.index,i),i}async runActivation(e,t){let n=N.workspace.getConfiguration("rubyLsp").get("bundleGemfile"),i=await this.lockfileExists(e.uri);if(t&&!i){this.workspacesBeingLaunched.delete(e.index);return}n.length===0&&!i&&await this.showStandaloneWarning(e.uri.fsPath);let s=new Sc(this.context,e,this.telemetry,this.testController.createTestItems.bind(this.testController),this.virtualDocuments,this.workspaces.size===0);return await s.activate(),await s.start(),this.workspaces.set(e.uri.toString(),s),await N.commands.executeCommand("setContext","rubyLsp.activated",!0),await this.showFormatOnSaveModeWarning(s),this.workspacesBeingLaunched.delete(e.index),s}registerCommands(){return[N.commands.registerCommand("rubyLsp.update",async()=>{let e=await this.showWorkspacePick();e&&(await e.installOrUpdateServer(!0),await e.restart())}),N.commands.registerCommand("rubyLsp.start",async()=>{await(await this.showWorkspacePick())?.start()}),N.commands.registerCommand("rubyLsp.restart",async()=>{await(await this.showWorkspacePick())?.restart()}),N.commands.registerCommand("rubyLsp.stop",async()=>{await(await this.showWorkspacePick())?.dispose()}),N.commands.registerCommand("rubyLsp.showSyntaxTree",this.showSyntaxTree.bind(this)),N.commands.registerCommand("rubyLsp.diagnoseState",this.diagnoseState.bind(this)),N.commands.registerCommand("rubyLsp.showServerChangelog",()=>{let e=this.currentActiveWorkspace()?.lspClient?.serverVersion;if(e)return N.env.openExternal(N.Uri.parse(`https://github.com/Shopify/ruby-lsp/releases/tag/v${e}`))}),N.commands.registerCommand("rubyLsp.formatterHelp",()=>N.env.openExternal(N.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#formatting"))),N.commands.registerCommand("rubyLsp.displayAddons",()=>{let e=this.currentActiveWorkspace()?.lspClient;if(!e||!e.addons)return;let t=e.addons.sort(i=>i.errored?1:-1).map(i=>({label:`${i.errored?"$(error)":"$(pass)"} ${i.name} ${i.version?`v${i.version}`:""}`})),n=N.window.createQuickPick();n.items=t,n.placeholder="Addons (click to view output)",n.onDidAccept(()=>{n.selectedItems[0]&&this.currentActiveWorkspace()?.outputChannel.show(),n.hide()}),n.onDidHide(()=>{n.dispose()}),n.show()}),N.commands.registerCommand("rubyLsp.toggleFeatures",async()=>{let e=N.extensions.getExtension("Shopify.ruby-lsp").packageJSON.contributes.configuration.properties["rubyLsp.enabledFeatures"].properties,t={};Object.entries(e).forEach(([c,d])=>{t[c]=d.description});let i=N.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),s=Object.keys(i),o=s.map(c=>({label:c,picked:i[c],description:t[c]})),a=await N.window.showQuickPick(o,{canPickMany:!0,placeHolder:"Select the features you would like to enable"});a!==void 0&&(s.forEach(c=>{i[c]=a.some(d=>d.label===c)}),await N.workspace.getConfiguration("rubyLsp").update("enabledFeatures",i,!0,!0))}),N.commands.registerCommand("rubyLsp.toggleExperimentalFeatures",async()=>{let e=N.workspace.getConfiguration("rubyLsp"),t=e.get("enableExperimentalFeatures");await e.update("enableExperimentalFeatures",!t,!0,!0),Yn.fire(this.currentActiveWorkspace())}),N.commands.registerCommand("rubyLsp.serverOptions",async e=>{let t=await N.window.showQuickPick(e,{placeHolder:"Select server action"});t!==void 0&&await N.commands.executeCommand(t.description)}),N.commands.registerCommand("rubyLsp.selectRubyVersionManager",async()=>{let e=await N.window.showQuickPick(["Change version manager","Change manual Ruby configuration"],{placeHolder:"What would you like to do?"});if(!e)return;if(e==="Change version manager"){let n=N.workspace.getConfiguration("rubyLsp"),i=n.get("rubyVersionManager"),s=Object.values(Mh),o=await N.window.showQuickPick(s,{placeHolder:`Current: ${i.identifier}`});o!==void 0&&(i.identifier=o,await n.update("rubyVersionManager",i,!0));return}let t=await this.showWorkspacePick();t&&await t.ruby.manuallySelectRuby()}),N.commands.registerCommand("rubyLsp.runTest",(e,t,n)=>Or("fullTestDiscovery")?this.testController.runViaCommand(e,t,"run"):this.testController.runOnClick(t)),N.commands.registerCommand("rubyLsp.runTestInTerminal",(e,t,n)=>Or("fullTestDiscovery")?this.testController.runViaCommand(e,t,"runInTerminal"):this.testController.runTestInTerminal(e,t,n)),N.commands.registerCommand("rubyLsp.debugTest",(e,t,n)=>Or("fullTestDiscovery")?this.testController.runViaCommand(e,t,"debug"):this.testController.debugTest(e,t,n)),N.commands.registerCommand("rubyLsp.runTask",async e=>{let t=this.currentActiveWorkspace();t||(t=await this.showWorkspacePick()),t&&await t.execute(e,!0)}),N.commands.registerCommand("rubyLsp.bundleInstall",e=>{let t=this.workspaces.get(e);if(!t)return;let n=N.window.createTerminal({name:"Bundle install",cwd:t.workspaceFolder.uri.fsPath,env:t.ruby.env});n.show(),n.sendText("bundle install")}),N.commands.registerCommand("rubyLsp.openFile",e=>{if(typeof e[0]=="string")return ig(e);let[t,n]=e,i=this.currentActiveWorkspace();return OR(this.telemetry,i,{file:t,line:parseInt(n,10)-1})}),N.commands.registerCommand("rubyLsp.railsGenerate",async(e,t)=>{let n=e??await N.window.showInputBox({title:"Rails generate arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.generate(n,t);return}for(let i of n)await this.rails.generate(i,t)}}),N.commands.registerCommand("rubyLsp.railsDestroy",async(e,t)=>{let n=e??await N.window.showInputBox({title:"Rails destroy arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.destroy(n,t);return}for(let i of n)await this.rails.destroy(i,t)}}),N.commands.registerCommand("rubyLsp.fileOperation",async()=>{let e=await this.showWorkspacePick();if(!e)return;let t=[{label:"Minitest test",description:"Create a new Minitest test",iconPath:new N.ThemeIcon("new-file"),command:"rubyLsp.newMinitestFile",args:[]}];e.lspClient?.addons?.some(i=>i.name==="Ruby LSP Rails")&&t.push({label:"Rails generate",description:"Run Rails generate",iconPath:new N.ThemeIcon("new-file"),command:"rubyLsp.railsGenerate",args:[void 0,e]},{label:"Rails destroy",description:"Run Rails destroy",iconPath:new N.ThemeIcon("trash"),command:"rubyLsp.railsDestroy",args:[void 0,e]});let n=await N.window.showQuickPick(t,{title:"Select a Ruby file operation"});n&&await N.commands.executeCommand(n.command,...n.args)}),N.commands.registerCommand("rubyLsp.newMinitestFile",FR),N.commands.registerCommand("rubyLsp.collectRubyLspInfo",async()=>{let e=await this.showWorkspacePick();await HR(e)}),N.commands.registerCommand("rubyLsp.startServerInDebugMode",async()=>{await(await this.showWorkspacePick())?.start(!0)}),N.commands.registerCommand("rubyLsp.showOutput",()=>{Rr.show()}),N.commands.registerCommand("rubyLsp.migrateLaunchConfiguration",async()=>{if(!await this.showWorkspacePick())return;let n=(N.workspace.getConfiguration("launch")?.get("configurations")||[]).map(i=>{if(i.type==="rdbg"){if(i.request==="launch"){let s={...i};if(s.type="ruby_lsp",s.askParameters!==!0){delete s.rdbgPath,delete s.cwd,delete s.useBundler;let o=(s.command??"").replace("${workspaceRoot}/",""),a=s.script??"",c=(s.args??[]).join(" ");s.program=`${o} ${a} ${c}`.trim(),delete s.command,delete s.script,delete s.args,delete s.askParameters}return s}else if(i.request==="attach"){let s={...i};return s.type="ruby_lsp",s.debugSocketPath=i.debugPort,s}}return i});await N.workspace.getConfiguration("launch").update("configurations",n,N.ConfigurationTarget.Workspace)}),N.commands.registerCommand("rubyLsp.goToRelevantFile",async()=>{let e=N.window.activeTextEditor?.document.uri;if(!e)return;let t=await this.currentActiveWorkspace()?.lspClient?.sendGoToRelevantFileRequest(e);if(t&&t.locations.length>0)return ig(t.locations);await N.window.showInformationMessage("Couldn't find relevant files")}),N.commands.registerCommand("rubyLsp.profileCurrentFile",async()=>{let e=this.currentActiveWorkspace();if(!e){N.window.showInformationMessage("No workspace found");return}try{let{stdout:n}=await e.execute("vernier --version"),i=n.trim(),[s,o,a]=i.split(".").map(Number);if(s<1||s===1&&o<8)if(await N.window.showInformationMessage("Vernier version 1.8.0 or higher is required for profiling. Would you like to install it?","Install")==="Install")await e.execute("gem install vernier");else return}catch{if(await N.window.showInformationMessage("Vernier is required for profiling. Would you like to install it?","Install")==="Install")await e.execute("gem install vernier");else return}let t=N.window.activeTextEditor?.document.uri.fsPath;if(!t){N.window.showInformationMessage("No file opened in the editor to profile");return}await N.window.withProgress({location:N.ProgressLocation.Notification,title:"Profiling in progress...",cancellable:!1},async()=>{let n=N.Uri.file(zR.join(VR.tmpdir(),`profile-${Date.now()}.cpuprofile`));await e.execute(`vernier run --output ${n.fsPath} --format cpuprofile -- ruby ${t}`),await N.commands.executeCommand("vscode.open",n,{viewColumn:N.ViewColumn.Beside})})})]}currentActiveWorkspace(e=N.window.activeTextEditor){let t;if(e?t=N.workspace.getWorkspaceFolder(e.document.uri):t=N.workspace.workspaceFolders?.find(n=>n.name===N.workspace.name),!!t)return this.getWorkspace(t.uri)}async getOrActivateWorkspace(e){let t=this.getWorkspace(e.uri);return t||N.window.withProgress({location:N.ProgressLocation.Notification,title:`Workspace ${e.name} is not activated yet.`},async n=>(n.report({message:"Activating workspace..."}),this.activateWorkspace(e,!1)))}getWorkspace(e){return this.workspaces.get(e.toString())}workspaceResolver(e){if(!e)return this.currentActiveWorkspace();let t=this.workspaces.get(e.toString());return t||this.currentActiveWorkspace()}async showWorkspacePick(){if(this.workspaces.size===1)return this.workspaces.values().next().value;let e=await N.window.showWorkspaceFolderPick();if(e)return this.getWorkspace(e.uri)}async diagnoseState(){let t=await(await this.showWorkspacePick())?.lspClient?.sendRequest("rubyLsp/diagnoseState");if(t){let n=Object.entries(t.documents),i=[`Worker alive: ${t.workerAlive}`,`Incoming queue size: ${t.incomingQueueSize}`,`Backtrace:
${t.backtrace.join(`
`)}
`,`=========== Documents (${n.length}) ===========`,...n.map(([o,a])=>`URI: ${o}

${a}
===========`)].join(`
`),s=await N.workspace.openTextDocument(N.Uri.from({scheme:"ruby-lsp",path:"show-diagnose-state",query:i}));await N.window.showTextDocument(s,{viewColumn:N.ViewColumn.Beside,preserveFocus:!0})}}async showSyntaxTree(){let e=N.window.activeTextEditor;if(e){let t=e.document;if(t.languageId!=="ruby"){await N.window.showErrorMessage("Show syntax tree: not a Ruby file");return}let n=N.workspace.getWorkspaceFolder(t.uri);if(!n)return;let i=this.getWorkspace(n.uri),s=e.selection,o;s.active.isEqual(s.anchor)||(s.isReversed?o=ag.Range.create(s.active.line,s.active.character,s.anchor.line,s.anchor.character):o=ag.Range.create(s.anchor.line,s.anchor.character,s.active.line,s.active.character));let a=await i?.lspClient?.sendShowSyntaxTreeRequest(t.uri,o);if(a){let c=await N.workspace.openTextDocument(N.Uri.from({scheme:"ruby-lsp",path:"show-syntax-tree",query:a.ast}));await N.window.showTextDocument(c,{viewColumn:N.ViewColumn.Beside,preserveFocus:!0})}}}async showFormatOnSaveModeWarning(e){let t=N.workspace.getConfiguration("editor",{languageId:"ruby"}),n=t.get("formatOnSaveMode");if(n==="file")return;await N.window.showWarningMessage(`The "editor.formatOnSaveMode" setting is set to ${n} in workspace ${e.workspaceFolder.name}, which
      is currently unsupported by the Ruby LSP. If you'd like to have formatting enabled, please set it to 'file'`,"Change setting to 'file'","Use without formatting")==="Change setting to 'file'"&&await t.update("formatOnSaveMode","file",N.ConfigurationTarget.Global)}async lockfileExists(e){try{return await N.workspace.fs.stat(N.Uri.joinPath(e,"Gemfile.lock")),!0}catch{}try{return await N.workspace.fs.stat(N.Uri.joinPath(e,"gems.locked")),!0}catch{}return!1}async showStandaloneWarning(e){await N.window.withProgress({location:N.ProgressLocation.Notification,title:"No bundle found. Launching in standalone mode in 5 seconds",cancellable:!0},async(t,n)=>{if(t.report({message:"If working in a monorepo, cancel to see configuration instructions"}),await new Promise(i=>{n.onCancellationRequested(()=>{i()}),setTimeout(i,5e3)}),n.isCancellationRequested&&await N.window.showWarningMessage(`Could not find a lockfile in ${e}. Are you using a monorepo setup?`,"See the multi-root workspace docs","Launch anyway")==="See the multi-root workspace docs"){let s=N.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md?tab=readme-ov-file#multi-root-workspaces");await N.env.openExternal(s)}})}};var dr=re(require("vscode")),tu=class{constructor(){this.disposables=[];this.decorationType=dr.window.createTextEditorDecorationType({opacity:dr.workspace.getConfiguration("rubyLsp").get("sigOpacityLevel")}),this.disposables.push(dr.window.onDidChangeActiveTextEditor(()=>this.updateDecorations()),dr.workspace.onDidChangeTextDocument(()=>this.updateDecorations())),this.updateDecorations()}reload(){let e=dr.workspace.getConfiguration("rubyLsp").get("sigOpacityLevel");this.decorationType.dispose(),this.decorationType=dr.window.createTextEditorDecorationType({opacity:e}),this.updateDecorations()}dispose(){this.decorationType.dispose(),this.disposables.forEach(e=>e.dispose())}updateDecorations(){let e=dr.window.activeTextEditor;if(!e||e.document.languageId!=="ruby")return;let t=e.document.getText(),n=[],i=t.split(`
`);for(let s=0;s<i.length;s++){let o=i[s],a=o.trim();(a.startsWith("#:")||a.startsWith("#|"))&&n.push({range:new dr.Range(s,0,s,o.length)})}e.setDecorations(this.decorationType,n)}};var cg;async function Gk(r){if(!on.workspace.workspaceFolders){await on.window.showWarningMessage(`Using the Ruby LSP without any workspaces opened is currently not supported
      ([learn more](https://github.com/Shopify/ruby-lsp/issues/1780))`,"Open a workspace","Continue anyway")==="Open a workspace"&&await on.commands.executeCommand("workbench.action.files.openFolder");return}let e=new tu;r.subscriptions.push(e,on.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("rubyLsp.sigOpacityLevel")&&e.reload()}));let t=await Xk(r);r.subscriptions.push(t),cg=new eu(r,t),await cg.activate()}async function Jk(){await cg.deactivate()}async function Xk(r){let e;switch(r.extensionMode){case on.ExtensionMode.Development:e={sendEventData:(t,n)=>{Rr.debug(t,n)},sendErrorData:(t,n)=>{Rr.error(t,n)}};break;case on.ExtensionMode.Test:e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}};break;default:try{let t=0;for(;!e&&t<5;)await on.commands.executeCommand("getTelemetrySenderObject"),e=await on.commands.executeCommand("getTelemetrySenderObject"),t++}catch{e={sendEventData:(n,i)=>{},sendErrorData:(n,i)=>{}}}break}return e||(e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}}),on.env.createTelemetryLogger(e,{ignoreBuiltInCommonProperties:!0,ignoreUnhandledErrors:!0,additionalCommonProperties:{extensionVersion:r.extension.packageJSON.version,environment:KR.default.platform(),machineId:on.env.machineId}})}0&&(module.exports={activate,deactivate});
